<?php


class Tool extends CI_Controller
{

    public function __construct()
    {
        parent::__construct();
        $this->masterConfigUi = $this->config->item("heTransaksi_ui");
    }

    function index()
    {
        $arrTools = array(
            "kas" => "viewUnsyncedKas",
            "produk" => "viewUnsyncedProduk",
            "produk rakitan" => "viewUnsyncedProdukRakitan",
            "supplies" => "viewUnsyncedSupplies",
            "valas" => "viewUnsyncedValas",
        );

//        foreach ($arrTools as $key => $value) {
//            echo "<div>";
//            echo "<h3>";
//            echo "<a href='" . base_url() . get_class($this) . "/$value' target='_blank'>:: $key ::</a>";
//            echo "</h3>";
//            echo "</div>";
//        }
    }

    function viewUnsynced()
    {
        //        $branchID = $this->session->login['cabang_id'];
        //        $whID = $this->session->login['gudang_id'];

        $branchID = 1;
        $whID = -10;

        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("Mdls/MdlLockerStock");
        $this->load->model("Mdls/MdlFifoProdukJadi");
        $this->load->model("Mdls/MdlFifoAverage");

        $products = array();
        $ids = array();
        $ffStocks = array();

        $c = new ComRekeningPembantuProduk();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("persediaan produk");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                );
                $ids[] = $row->extern_id;


                $ff = new MdlFifoProdukJadi();
                $ff->addFilter("cabang_id='$branchID'");
                $ff->addFilter("gudang_id='$whID'");
                $ff->addFilter("produk_id='" . $row->extern_id . "'");
                $ffStocks[$row->extern_id] = $ff->lookupAllQty()->result();

            }
        }

        $l = new MdlLockerStock();
        $l->addFilter("cabang_id='$branchID'");
        $lStocks = $l->fetchStates2($branchID, $whID, $ids);
        //        arrprint($lStocks);


        $fa = new MdlFifoAverage();
        $fa->addFilter("cabang_id='$branchID'");
        $fa->addFilter("gudang_id='$whID'");
        $faStocks = $fa->lookupAllQty()->result();
        $arrHppAvg = array();
        if (sizeof($faStocks) > 0) {
            foreach ($faStocks as $faSpec) {
                $arrHppAvg[$faSpec->produk_id] = array(
                    "hpp" => $faSpec->hpp,
                );
            }
        }
        //arrPrint($faStocks);


        echo "<div>";
        echo "<h2>:: PRODUK ::</h2>";
        echo "</div>";
        echo "<table align='center' border='1' cellspacing='0' cellpadding='2'>";
        echo "<tr>";
        echo "<td>pID</td>";
        echo "<td>product</td>";
        echo "<td>fifo-debet</td>";
        echo "<td>fifo</td>";
        echo "<td>debet</td>";
        echo "<td>active</td>";
        echo "<td>hold</td>";
        echo "<td>hold trID</td>";
        echo "<td>sold</td>";
        echo "<td>total locker</td>";
        echo "</tr>";
        if (sizeof($products) > 0) {

            $this->db->trans_start();


            $nof = 0;
            foreach ($products as $pID => $pSpec) {


                $jmlActive = isset($lStocks[$pID]['active']) ? $lStocks[$pID]['active'] : 0;
                $jmlHold = isset($lStocks[$pID]['hold']) ? $lStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($lStocks[$pID]['hold_trID']) ? $lStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($lStocks[$pID]['sold']) ? $lStocks[$pID]['sold'] : 0;

                $jmlFifo = isset($ffStocks[$pID][0]->qty) ? $ffStocks[$pID][0]->qty : 0;
                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;

                $jmlLoker = ($jmlActive + $jmlHold);

                $selisih = $jmlRek - ($jmlFifo + $jmlHoldTrID);


                $bg_color = "";
                $add = "";
                if ($jmlFifo != $pSpec['stock']) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }


                if ($selisih > 0) {
                    $nof++;
                    // inject fifo average
                    $xx = new MdlFifoAverage();
                    $xx->updateData(
                        array(
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,

                        ), array(
                            "jml" => $jmlRek,
                            "jml_nilai" => $arrHppAvg[$pID]['hpp'] * $jmlRek,
                        )
                    );
                    cekUngu($this->db->last_query() . ";");

                    // inject fifo murni
                    $yy = new MdlFifoProdukJadi();
                    $yy->addData(
                        array(
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,
                            "produk_nama" => $pSpec['name'],
                            "unit" => $selisih,
                            "hpp" => $arrHppAvg[$pID]['hpp'],
                            "jml_nilai" => $arrHppAvg[$pID]['hpp'] * $selisih,
                        )
                    );
                    cekLime($this->db->last_query() . ";");
                }


                if ($pSpec['stock'] != $jmlLoker) {

                    echo "<tr style='$bg_color'>";
                    echo "<td>" . $pID . "</td>";
                    echo "<td>" . $pSpec['name'] . " $add</td>";
                    echo "<td align='right'>" . $selisih . "</td>";
                    echo "<td align='right'>" . $jmlFifo . "</td>";
                    echo "<td bgcolor='#eeffee'>" . $pSpec['stock'] . "</td>";
                    echo "<td align='right'>" . $jmlActive . "</td>";
                    echo "<td align='right'>" . $jmlHold . "</td>";
                    echo "<td align='right'>" . $jmlHoldTrID . "</td>";
                    echo "<td align='right'>" . $jmlSold . "</td>";
                    echo "<td bgcolor='#ffeeee' align='right'>" . $jmlLoker . "</td>";
                    echo "</tr>";


                    //hilangkan saja
                    $ll = new MdlLockerStock();
                    $ll->updateData(
                        array(
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,

                        ), array(
                            "produk_id" => 6666,
                            "jumlah" => 0,
                            "nama" => "unknown",
                            "state" => "dest",
                        )
                    );
                    echo($this->db->last_query() . ";<br>");

                    $ll = new MdlLockerStock();
                    $ll->addData(
                        array(
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,
                            "nama" => $pSpec['name'],
                            "oleh_id" => 0,
                            "transaksi_id" => 0,
                            "state" => "active",
                            "jumlah" => $pSpec['stock'],
                        )
                    );
                    echo($this->db->last_query() . ";<br>");


                    //                    if($selisih > 0){
                    //                        // inject fifo average
                    //                        $xx = new MdlFifoAverage();
                    //                        $xx->updateData(
                    //                            array(
                    //                                "cabang_id"=>$branchID,
                    //                                "gudang_id"=>$whID,
                    //                                "produk_id"=>$pID,
                    //
                    //                            ), array(
                    //                                "jml" => $jmlRek,
                    //                                "jml_nilai" => $arrHppAvg[$pID]['hpp']*$jmlRek,
                    //                            )
                    //                        );
                    //                        cekUngu($this->db->last_query());
                    //
                    //
                    //
                    //                        // inject fifo murni
                    //                        $yy = new MdlFifoProdukJadi();
                    //                        $yy->addData(
                    //                            array(
                    //                                "cabang_id"=>$branchID,
                    //                                "gudang_id"=>$whID,
                    //                                "produk_id"=>$pID,
                    //                                "produk_nama"=>$pSpec['name'],
                    //                                "unit"=>$selisih,
                    //                                "hpp"=>$arrHppAvg[$pID]['hpp'],
                    //                                "jml_nilai"=>$arrHppAvg[$pID]['hpp']*$selisih,
                    //                            )
                    //                        );
                    //                        cekLime($this->db->last_query());
                    //                    }


                }
                else {

                    //                    if($selisih > 0){
                    //                        // inject fifo average
                    //                        $xx = new MdlFifoAverage();
                    //                        $xx->updateData(
                    //                            array(
                    //                                "cabang_id"=>$branchID,
                    //                                "gudang_id"=>$whID,
                    //                                "produk_id"=>$pID,
                    //
                    //                            ), array(
                    //                                "jml" => $jmlRek,
                    //                                "jml_nilai" => $arrHppAvg[$pID]['hpp']*$jmlRek,
                    //                            )
                    //                        );
                    //                        cekUngu($this->db->last_query());
                    //
                    //
                    //                        // inject fifo murni
                    //                        $yy = new MdlFifoProdukJadi();
                    //                        $yy->addData(
                    //                            array(
                    //                                "cabang_id"=>$branchID,
                    //                                "gudang_id"=>$whID,
                    //                                "produk_id"=>$pID,
                    //                                "produk_nama"=>$pSpec['name'],
                    //                                "unit"=>$selisih,
                    //                                "hpp"=>$arrHppAvg[$pID]['hpp'],
                    //                                "jml_nilai"=>$arrHppAvg[$pID]['hpp']*$selisih,
                    //                            )
                    //                        );
                    //                        cekLime($this->db->last_query());
                    //                    }

                    echo "<tr style='$bg_color'>";
                    echo "<td >" . $pID . "</td>";
                    echo "<td >" . $pSpec['name'] . " $add</td>";
                    echo "<td align='right'>" . $selisih . "</td>";
                    echo "<td align='right'>" . $jmlFifo . "</td>";
                    echo "<td bgcolor='#eeffee'>" . $pSpec['stock'] . "</td>";
                    echo "<td align='right'>" . $jmlActive . "</td>";
                    echo "<td align='right'>" . $jmlHold . "</td>";
                    echo "<td align='right'>" . $jmlHoldTrID . "</td>";
                    echo "<td align='right'>" . $jmlSold . "</td>";
                    echo "<td bgcolor='#ffeeee' align='right'>" . $jmlLoker . "</td>";
                    echo "</tr>";
                }


            }


            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        }
        echo "</table>";

    }

    function syncTransPrices()
    {
        $this->load->model("MdlTransaksi");
        $tr = new MdlTransaksi();
        $tr->addFilter("jenis='582'");
        $tmp = $tr->lookupAll()->result();
        $ids = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $ids[] = $row->id;
            }
        }
        //        arrprint($ids);

        if (sizeof($ids) > 0) {
            $this->db->trans_start();
            $trr = new MdlTransaksi();
            $trr->setTableName($trr->getTableNames()['registry']);
            $trr->setFilters(array());
            $trr->addFilter("param='tableIn_detail_values'");
            $trr->addFilter("transaksi_id in (" . implode(",", $ids) . ")");
            $tmpReg = $trr->lookupAll()->result();


            $trr2 = new MdlTransaksi();
            $trr2->setFilters(array());
            $trr2->setTableName($trr->getTableNames()['registry']);


            //            arrprint($tmpReg);
            if (sizeof($tmpReg) > 0) {
                foreach ($tmpReg as $row) {
                    $id = $row->id;
                    //                    echo "id $id to be updated<br>";
                    $values = blobDecode($row->values);
                    $valuesIntext = blobDecode($row->values_intext);
                    $newValues = $values;
                    if (sizeof($values) > 0) {
                        foreach ($values as $iID => $iSpec) {
                            //                            echo "-- -- ".$iSpec['jual_nppn']." will be replaced into ".($iSpec['harga']+$iSpec['ppn'])."<br>";
                            $newValues[$iID]['jual_nppn'] = ($iSpec['harga_nett1']);
                        }
                    }
                    $newValuesInText = print_r($newValues, true);
                    //                    $trr2=new MdlTransaksi();
                    //                    $trr2->setFilters(array());
                    //                    $trr2->setTableName($trr->getTableNames()['registry']);
                    $trr2->updateData(
                        array("id" => $id),
                        array(
                            "values" => blobEncode($newValues),
                            "values_intext" => $newValuesInText,
                        )
                    );
                    echo $this->db->last_query() . ";<br>";
                }
            }
        }
    }

    function syncElements()
    {
        $this->load->model("MdlTransaksi");
        $elementConfigs = isset($this->config->item('heTransaksi_ui')["582"]['receiptElements']) ? $this->config->item('heTransaksi_ui')["582"]['receiptElements'] : array();
        $trr = new MdlTransaksi();
        $this->db->select("*,transaksi_registry.id as id");
        $trr->setTableName($trr->getTableNames()['registry']);
        $trr->setFilters(array());
        $trr->addFilter("param='main_elements'");
        $trr->addFilter("param='main_elements'");
        $this->db->join("transaksi", "transaksi_id = transaksi.id  and transaksi.jenis='582'");
        //        $this->db->limit(1);
        $tmpReg = $trr->lookupAll()->result();
        //        $oElements=array();
        //        arrprint($tmpReg);

        $replacePairs = array(
            "paymentMethod_cash_cash_account" => "cash_account",
            "paymentMethod_debit_card_debit_account" => "debit_account",
            "paymentMethod_debit_card_debit_account_bca_card_number" => "card_number",
            "paymentMethod_debit_card_debit_account_bca_card_name" => "card_name",
            "paymentMethod_debit_card_cash_account" => "cash_account",
        );

        $repList = array();

        if (sizeof($tmpReg) > 0) {
            $this->db->trans_start();


            $trr2 = new MdlTransaksi();
            $trr2->setFilters(array());
            $trr2->setTableName($trr->getTableNames()['registry']);


            foreach ($tmpReg as $row) {
                $rID = $row->id;
                $oElements = blobDecode($row->values);
                $nElements = array();
                if (sizeof($oElements) > 0) {
                    foreach ($oElements as $elName => $elSpec) {

                        if (!array_key_exists($elName, $elementConfigs)) {


                            //                            if(!in_array($elName,$repList)){
                            //
                            ////                                echo "\"$elName\"=>\"\",<br>";
                            ////                                echo "$elName doesnt exist anymore and need to replace<br>";
                            //                                $repList[]=$elName;
                            //                            }
                            //                            echo "$rID <span style='color:#dd3300;'>$elName</span> doesnt exist anymore and need to replace with <span style='color:#009900;'>".$replacePairs[$elName]."</span><br>";
                            $shouldBeEl = $replacePairs[$elName];
                            $nElements[$shouldBeEl] = $elSpec;

                        }
                        else {
                            $nElements[$elName] = $elSpec;
                        }
                    }
                    //                    cekmerah($rID);
                    //                    arrprint($oElements);
                    //                    arrprint($nElements);
                    $trr2->updateData(
                        array("id" => $rID),
                        array(
                            "values" => blobEncode($nElements),
                            "values_intext" => print_r($nElements, true),
                        )
                    );
                    echo($this->db->last_query() . ";<br>");
                }

            }
        }
    }

    function injectReceiptFields()
    {
        $this->load->model("MdlTransaksi");
        $tr = new MdlTransaksi();
        $tmp = $tr->lookupAll()->result();
        if (sizeof($tmp) > 0) {
            $this->db->trans_start();
            foreach ($tmp as $row) {
                $id = $row->id;
                $stepNum = heWhichStep($row->jenis_master, $row->jenis);
                $detailFields = $this->config->item('heTransaksi_layout')[$row->jenis_master]['receiptDetailFields'][$stepNum];
                $sumFields = $this->config->item("heTransaksi_layout")[$row->jenis_master]['receiptSumFields'][$stepNum];
                $baseRegistries = array(
                    "receiptSumFields" => $sumFields,
                    "receiptDetailFields" => $detailFields,
                );

                $doWriteReg = $tr->writeRegistries($id, $baseRegistries) or die(lgShowError("Ada kesalahan", "Gagal saat berusaha  write base params into registries"));
                //                cekbiru($this->db->last_query());
            }
            $this->db->trans_complete();
        }

    }

    function fillInDetailValues()
    {
        $this->load->model("MdlTransaksi");
        $tr = new MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("param='tableIn_detail_values'");
        $tmp = $tr->lookupRegistries()->result();
        arrprint($tmp);
        //        die();
        if (sizeof($tmp) > 0) {
            $this->db->trans_start();
            foreach ($tmp as $row) {
                $_id = $row->id;
                $oldValues = blobDecode($row->values);
                $newValues = $oldValues;
                if (sizeof($oldValues) > 0) {
                    foreach ($oldValues as $key => $val) {

                    }
                }
                $baseRegistries = array(
                    //                    "receiptSumFields"                 => $sumFields,
                    "tableIn_detail_values" => $detailValues,
                );

                $doWriteReg = $tr->writeRegistries($id, $baseRegistries) or die(lgShowError("Ada kesalahan", "Gagal saat berusaha  write base params into registries"));
                //                cekbiru($this->db->last_query());
            }

        }

    }

    function syncRekNums()
    {
        $searchFilter = "__rek";

        $dbName = $this->db->database;
        $tableNameSearch = $this->db->query("SELECT t.TABLE_NAME AS myTables FROM INFORMATION_SCHEMA.TABLES AS t WHERE t.TABLE_SCHEMA = '$dbName' AND t.TABLE_NAME LIKE '%$searchFilter%' ")->result_array();
        //        arrPrint($tableNameSearch);
        $tableNames = array();
        foreach ($tableNameSearch as $inx => $tblnames) {
            $tableNames[] = $tblnames["myTables"];
        }


        //        arrprint($tableNames);
        if (sizeof($tableNames) > 0) {
            $this->db->trans_start();
            foreach ($tableNames as $tb) {

                $this->db->where(array());
                $this->db->update($tb, array(
                    "transaksi_no" => "(select nomer from transaksi where id=transaksi_id)",
                ));
                echo str_replace("'", "", $this->db->last_query()) . ";<br>";
            }
        }


    }

    function syncPrice()
    {

        $arrKonverter = array(
            array(
                "filter" => array(
                    "jenis" => "bahan",
                    "cabang_id" => "-1",
                ),
                "additional" => array(
                    "jenis_value" => "hpp",
                    "jenis" => "bahan",
                ),
                "tabel" => array(
                    "harga" => "price",
                ),
                "kolom" => array(
                    "produk_id" => "produk_id",
                    "cabang_id" => "cabang_id",
                    "status" => "status",
                    "netto" => "nilai",
                ),
            ),
            array(
                "filter" => array(
                    "jenis" => "bahan",
                    "cabang_id" => "-1",
                ),
                "additional" => array(
                    "jenis_value" => "hpp_nppn",
                    "jenis" => "bahan",
                ),
                "tabel" => array(
                    "harga" => "price",
                ),
                "kolom" => array(
                    "produk_id" => "produk_id",
                    "cabang_id" => "cabang_id",
                    "status" => "status",
                    "beli" => "nilai",
                ),
            ),
            array(
                "filter" => array(
                    "jenis" => "produk",
                    //                    "cabang_id" => "-1",
                ),
                "additional" => array(
                    "jenis_value" => "jual",
                    "jenis" => "produk",
                ),
                "tabel" => array(
                    "harga" => "price",
                ),
                "kolom" => array(
                    "produk_id" => "produk_id",
                    "cabang_id" => "cabang_id",
                    "status" => "status",
                    "netto" => "nilai",
                ),
            ),
            array(
                "filter" => array(
                    "jenis" => "produk",
                    //                    "cabang_id" => "-1",
                ),
                "additional" => array(
                    "jenis_value" => "jual_nppn",
                    "jenis" => "produk",
                ),
                "tabel" => array(
                    "harga" => "price",
                ),
                "kolom" => array(
                    "produk_id" => "produk_id",
                    "cabang_id" => "cabang_id",
                    "status" => "status",
                    "jual" => "nilai",
                ),
            ),
            array(
                "filter" => array(
                    "jenis" => "produk",
                    //                    "cabang_id" => "-1",
                ),
                "additional" => array(
                    "jenis_value" => "komisi",
                    "jenis" => "produk",
                ),
                "tabel" => array(
                    "harga" => "price",
                ),
                "kolom" => array(
                    "produk_id" => "produk_id",
                    "cabang_id" => "cabang_id",
                    "status" => "status",
                    "komisi" => "nilai",
                ),
            ),
        );


        $this->db->trans_begin();


        if (sizeof($arrKonverter) > 0) {
            foreach ($arrKonverter as $k => $kSpec) {
                foreach ($kSpec['tabel'] as $fromTabel => $toTabel) {
                    $tmp = array();


                    cekBiru("ambil dari tabel $fromTabel");

                    if (array_key_exists("filter", $kSpec)) {
                        $this->db->where($kSpec['filter']);
                    }
                    $tmp = $this->db->get($fromTabel)->result();

                    cekMerah($this->db->last_query());


                    if (sizeof($tmp) > 0) {
                        $hasil = array();
                        foreach ($kSpec['kolom'] as $fromKolom => $toKolom) {
                            foreach ($tmp as $e => $eSpec) {
                                $hasil[$e][$toKolom] = $eSpec->$fromKolom;
                                if (isset($kSpec['additional']) && sizeof($kSpec['additional']) > 0) {
                                    foreach ($kSpec['additional'] as $key => $val) {
                                        $hasil[$e][$key] = $val;
                                    }
                                }
                            }
                        }

                        cekMerah("tulis ke tabel $toTabel");
                        if (sizeof($hasil) > 0) {
                            //                                $this->db->truncate($toTabel);

                            $no = 0;
                            $insertID = array();
                            foreach ($hasil as $hSpec) {
                                $insertID[] = $this->db->insert($toTabel, $hSpec);

                                $no++;
                                cekKuning("$no :: " . $this->db->last_query());
                            }
                            if (sizeof($insertID) == 0) {
                                mati_disini("konverter no $k, GAGAL menulis ke tabel $toTabel");
                            }
                        }

                    }
                    else {
                        cekHitam("konverter no $k, tabel $fromTabel KOSONG, tidak menulis ke tabel $toTabel");
                    }
                }
            }
        }

        mati_disini("SETOOPPP.... TESTING LAGI... HI HI HI");
        if ($this->db->trans_status() === FALSE) {
            $this->db->trans_rollback();
        }
        else {
            $this->db->trans_commit();
        }


    }

    function seizeGudangID()
    {
        $searchFilter = "";

        $dbName = $this->db->database;
        $tableNameSearch = $this->db->query("SELECT t.TABLE_NAME AS myTables FROM INFORMATION_SCHEMA.TABLES AS t WHERE t.TABLE_SCHEMA = '$dbName' AND t.TABLE_NAME LIKE '%$searchFilter%' ")->result_array();
        //        arrPrint($tableNameSearch);
        $tableNames = array();
        foreach ($tableNameSearch as $inx => $tblnames) {
            $tableNames[] = $tblnames["myTables"];
        }
        //        arrprint($tableNames);
        if (sizeof($tableNames) > 0) {
            $this->db->trans_start();
            foreach ($tableNames as $tb) {

                $fields = $this->db->list_fields($tb);
                if (in_array("gudang_id", $fields)) {
                    echo "alter table $tb change gudang_id gudang_id int;" . "<br>";
                }


            }
        }
    }


    // ============== ========================== ============================== //

    function encodeToArray()
    {
        $str = "<form method='post' action=''>";
        $str .= "<textarea name='text' rows='40' cols='75'>";
        if (isset($_POST['text'])) {
            $str .= $_POST['text'];
        }
        $str .= "</textarea>";

        if (isset($_POST['process'])) {
            $hasilEncode = blobEncode(print_r_reverse($_POST['text']));
            //            $hasilEncode = base64_encode(serialize((array)$_POST['text']));


            $str .= "<textarea rows='40' cols='75' placeholder='isikan disini data textnya......'>";
            $str .= "$hasilEncode";
            $str .= "</textarea>";
        }
        $str .= "&nbsp;";
        $str .= "<input type='submit' name='process' value='ENCODE' class='btn btn-primary'>";
        $str .= "</form>";

        $data = array(
            "mode" => "index",
            "title" => "ENCODE TO BLOB",
            "subTitle" => "",
            "headerFields" => array(),
            "items" => array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => array(),
            "content" => $str,

        );
        $this->load->view("tool", $data);
    }

    function decodeFromArray()
    {
        $str = "<form method='post' action=''>";
        $str .= "<textarea name='text' rows='40' cols='75'>";
        if (isset($_POST['text'])) {
            $str .= $_POST['text'];
        }
        $str .= "</textarea>";

        if (isset($_POST['process'])) {
            $hasilEncode = blobDecode($_POST['text']);

            $str .= "<textarea rows='40' cols='75' placeholder='isikan disini data blobnya......'>";
            $str .= print_r($hasilEncode, true);
            $str .= "</textarea>";
        }

        $str .= "<input type='submit' name='process' value='ENCODE' class='btn btn-primary'>";
        $str .= "</form>";

        $data = array(
            "mode" => "index",
            "title" => "DECODE FROM BLOB",
            "subTitle" => "",
            "headerFields" => array(),
            "items" => array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => array(),
            "content" => $str,
        );
        $this->load->view("tool", $data);
    }

    function showRegistry()
    {

        $str = "<form method='post' action=''>";

        $val = "";
        if (isset($_POST['text'])) {
            $val = $_POST['text'];
        }
        $str .= "<span class='text-uppercase text-bold'>masukkan nomer nota / transaksi ID: </span>";
        $str .= "<input type='text' name='text' value='$val' class='btn btn-default' placeholder='masukkan nomer nota / transaksiID' style='size:300px;'>";
        $str .= "&nbsp;";
        $str .= "<input type='submit' name='process' value='SHOW' class='btn btn-primary'>";
        $str .= "</form>";

        if (isset($_POST['text'])) {
            $val = $_POST['text'];

            $this->load->model("MdlTransaksi");

            $tr = New MdlTransaksi();
            $tr->setFilters(array());

            if (is_numeric($val)) {
                $this->db->where('id=', $val);
            }
            else {
                $this->db->or_where('nomer=', $val);
            }
            $tmp = $tr->lookupAll()->result();


            if (sizeof($tmp) > 0) {
                $trID = $tmp[0]->id;
                $trNomer = $tmp[0]->nomer;

                $str .= "<div class='alert alert-info'>";
                $str .= "<span>TrID: </span><span class='text-bold' style='font-size: 20px;'>$trID</span>";
                $str .= "&nbsp;&nbsp;<span>TrNomer: </span><span class='text-bold' style='font-size: 20px;'>$trNomer</span>";
                $str .= "</div>";

                $tr = New MdlTransaksi();
                $tr->setFilters(array());
                $regTmp = $tr->lookupDataRegistriesByMasterID($trID)->result();
                if (sizeof($regTmp) > 0) {
                    foreach ($regTmp as $regTmpSpec) {
//                        arrPrint($regTmpSpec);
                        //                        $gateName = $regTmpSpec->param;
                        //                        $values = isset($regTmpSpec->values) ? blobDecode($regTmpSpec->values) : array();
                        foreach ($regTmpSpec as $gateName => $gateValue) {
                            if ($gateName != "transaksi_id") {
                                $values = $gateValue != NULL ? blobDecode($gateValue) : "";
                                if (!is_array($values)) {
                                    $values = blobDecode($values);
                                }
                                $values_text = print_r($values, true);

                                $attr = sizeof($values) ? "rows='50' cols='75'" : "rows='5' cols='75'";

                                $str .= "<h3>$gateName</h3>";
                                $str .= "<textarea $attr>";
                                $str .= $values_text;
                                $str .= "</textarea>";
                            }
                        }
                    }
                }
                else {
                    $str .= "<br><br>";
                    $str .= "<h3>NOMER / NOTA INI TIDAK PUNYA REGISTRY </h3>";
                }
            }

        }

        $data = array(
            "mode" => "index",
            "title" => "SHOW REGISTRY",
            "subTitle" => "",
            "headerFields" => array(),
            "items" => array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => array(),
            "content" => $str,
        );
        $this->load->view("tool", $data);
    }

    // ============== ========================== ============================== //


    function seizeRekID()
    {
        $searchFilter = "_rek";

        $dbName = $this->db->database;
        $tableNameSearch = $this->db->query("SELECT t.TABLE_NAME AS myTables FROM INFORMATION_SCHEMA.TABLES AS t WHERE t.TABLE_SCHEMA = '$dbName' AND t.TABLE_NAME LIKE '%$searchFilter%' ")->result_array();
        //        arrPrint($tableNameSearch);
        $tableNames = array("neraca",
            "rugilaba",
            "neraca_div",
            "rugilaba_div",
            "jurnal"
        );
        foreach ($tableNameSearch as $inx => $tblnames) {
            $tableNames[] = $tblnames["myTables"];
        }


        //        arrprint($tableNames);
        if (sizeof($tableNames) > 0) {
            $this->db->trans_start();
            foreach ($tableNames as $tb) {

                $fields = $this->db->list_fields($tb);
                //                if (in_array("gudang_id", $fields)) {
                //                    echo "alter table $tb change gudang_id gudang_id int;" . "<br>";
                //                }
                if (in_array("rekening", $fields)) {

                    echo "alter table $tb add rek_id varchar(12) after id;" . "<br>";
                }


            }
        }
    }

    function showReturnedEntries()
    {
        $ids = array();
        $customers = array();
        $customerNames = array();
        $retMethods = array();

        $trSpec = array();

        $this->load->model("MdlTransaksi");
        $tr = new MdlTransaksi();
        $tr->addFilter("jenis='982'");
        $tmp = $tr->lookupAll()->result();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $ids[] = $row->id;
                echo $row->id . " = custID: " . $row->customers_nama . "<br>";
                $customers[$row->id] = $row->customers_id;
                $customerNames[$row->customers_id] = $row->customers_nama;
                $trSpec[$row->id] = array(
                    "custID" => $row->customers_id,
                    "custName" => $row->customers_nama,
                    "value" => $row->transaksi_nilai,
                    "dtime" => $row->dtime,
                    "nomer" => $row->nomer,
                );
            }
        }
        arrprint($ids);

        $tr->setFilters(array());
        $tr->addFilter("param='main'");
        $tr->addFilter("transaksi_id in (" . implode(",", $ids) . ") ");
        $tr->setTableName($tr->getTableNames()['registry']);
        $tmpr = $tr->lookupRegistries()->result();
        cekbiru($this->db->last_query());
        //        arrprint($tmpr);
        //returnMethod
        if (sizeof($tmpr) > 0) {
            foreach ($tmpr as $row) {
                $rawData = blobDecode($row->values);
                if (isset($row->transaksi_id) && isset($rawData['returnMethod'])) {
                    $tID = $row->transaksi_id;
                    $retMethods[$row->transaksi_id] = $rawData['returnMethod'];
                    $custID = $customers[$row->transaksi_id];
                    $custName = $customerNames[$custID];
                    $val2 = isset($rawData['nilai_cash']) ? $rawData['nilai_cash'] : 0;

                    cekhijau("trID: $tID");
                    cekhijau("time/number: " . $trSpec[$tID]['dtime'] . "/" . $trSpec[$tID]['nomer']);
                    cekhijau("custID: " . $trSpec[$tID]['custID']);
                    cekhijau("custName: " . $trSpec[$tID]['custName']);
                    cekhijau("val1: " . $trSpec[$tID]['value']);
                    cekhijau("val2: " . $val2);

                }
            }
        }

        arrprint($retMethods);
    }


    function viewUnsyncedProdukRakitan()
    {

        $branchID = isset($this->session->login['cabang_id']) ? $this->session->login['cabang_id'] : "-1";
        $whID = isset($this->session->login['gudang_id']) ? $this->session->login['gudang_id'] : "-1";

        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("Mdls/MdlLockerStock");
        $this->load->model("Mdls/MdlFifoProdukJadi");
        $this->load->model("Mdls/MdlFifoAverage");

        $products = array();
        $ids = array();
        $ffStocks = array();

        $c = new ComRekeningPembantuProduk();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("gudang_id='$whID'");
        $tmp = $c->fetchBalances("persediaan produk rakitan");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                );
                $ids[] = $row->extern_id;


                $ff = new MdlFifoProdukJadi();
                $ff->addFilter("cabang_id='$branchID'");
                $ff->addFilter("gudang_id='$whID'");
                $ff->addFilter("produk_id='" . $row->extern_id . "'");
                $ffStocks[$row->extern_id] = $ff->lookupAllQty()->result();

            }
        }

        $l = new MdlLockerStock();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("gudang_id='$whID'");
        $lStocks = $l->fetchStates2($branchID, $whID, $ids);
        //        arrprint($lStocks);


        $fa = new MdlFifoAverage();
        $fa->addFilter("cabang_id='$branchID'");
        $fa->addFilter("gudang_id='$whID'");
        $fa->addFilter("jenis='produk'");
        $faStocks = $fa->lookupAllQty()->result();
        $arrHppAvg = array();
        if (sizeof($faStocks) > 0) {
            foreach ($faStocks as $faSpec) {
                $arrHppAvg[$faSpec->produk_id] = array(
                    "hpp" => $faSpec->hpp,
                    "qty" => $faSpec->jml,
                );
            }
        }


        echo "<div>";
        echo "<h2>:: PRODUK ::</h2>";
        echo "BranchID: $branchID";
        echo "<br>";
        echo "WarehouseID: $whID";
        echo "</div>";


        echo "<table align='center' border='1' cellspacing='0' cellpadding='2'>";
        echo "<tr>";
        echo "<td>pID</td>";
        echo "<td>product</td>";
        echo "<td>fifo-debet</td>";
        echo "<td>fifo murni</td>";
        echo "<td>fifo avg</td>";
        echo "<td>debet</td>";
        echo "<td>active</td>";
        echo "<td>hold</td>";
        echo "<td>hold trID</td>";
        echo "<td>sold</td>";
        echo "<td>total locker</td>";
        echo "</tr>";
        if (sizeof($products) > 0) {

            $this->db->trans_start();


            $nof = 0;
            foreach ($products as $pID => $pSpec) {


                $jmlActive = isset($lStocks[$pID]['active']) ? $lStocks[$pID]['active'] : 0;
                $jmlHold = isset($lStocks[$pID]['hold']) ? $lStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($lStocks[$pID]['hold_trID']) ? $lStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($lStocks[$pID]['sold']) ? $lStocks[$pID]['sold'] : 0;

                $jmlFifo = isset($ffStocks[$pID][0]->qty) ? $ffStocks[$pID][0]->qty : 0;
                $jmlAvg = isset($arrHppAvg[$pID]['qty']) ? $arrHppAvg[$pID]['qty'] : 0;

                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;

                $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);

                $selisih = $jmlRek - $jmlFifo;


                $bg_color = "";
                $add = "";
                if ($jmlFifo != $pSpec['stock']) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }


                if ($selisih > 0) {
                    $nof++;
                    // inject fifo average
                    //                    $xx = new MdlFifoAverage();
                    //                    $xx->updateData(
                    //                        array(
                    //                            "cabang_id" => $branchID,
                    //                            "gudang_id" => $whID,
                    //                            "produk_id" => $pID,
                    //
                    //                        ), array(
                    //                            "jml" => $jmlRek,
                    //                            "jml_nilai" => $arrHppAvg[$pID]['hpp'] * $jmlRek,
                    //                        )
                    //                    );
                    //cekUngu($this->db->last_query() . ";");

                    // inject fifo murni
                    //                    $yy = new MdlFifoProdukJadi();
                    //                    $yy->addData(
                    //                        array(
                    //                            "cabang_id" => $branchID,
                    //                            "gudang_id" => $whID,
                    //                            "produk_id" => $pID,
                    //                            "produk_nama" => $pSpec['name'],
                    //                            "unit" => $selisih,
                    //                            "hpp" => $arrHppAvg[$pID]['hpp'],
                    //                            "jml_nilai" => $arrHppAvg[$pID]['hpp'] * $selisih,
                    //                        )
                    //                    );
                    //cekLime($this->db->last_query() . ";");
                }


                if ($pSpec['stock'] != $jmlLoker) {

                    echo "<tr style='$bg_color'>";
                    echo "<td>" . $pID . "</td>";
                    echo "<td>" . $pSpec['name'] . " $add</td>";
                    echo "<td align='right'>" . $selisih . "</td>";
                    echo "<td align='right'>" . $jmlFifo . "</td>";
                    echo "<td align='right'>" . $jmlAvg . "</td>"; // fifo avg
                    echo "<td bgcolor='#eeffee'>" . $pSpec['stock'] . "</td>";
                    echo "<td align='right'>" . $jmlActive . "</td>";
                    echo "<td align='right'>" . $jmlHold . "</td>";
                    echo "<td align='right'>" . $jmlHoldTrID . "</td>";
                    echo "<td align='right'>" . $jmlSold . "</td>";
                    echo "<td bgcolor='#ffeeee' align='right'>" . $jmlLoker . "</td>";
                    echo "</tr>";


                    //hilangkan saja
                    $ll = new MdlLockerStock();
                    $ll->updateData(
                        array(
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,

                        ), array(
                            "produk_id" => 6666,
                            "jumlah" => 0,
                            "nama" => "unknown",
                            "state" => "dest",
                        )
                    );
                    echo($this->db->last_query() . ";<br>");

                    $ll = new MdlLockerStock();
                    $ll->addData(
                        array(
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,
                            "nama" => $pSpec['name'],
                            "oleh_id" => 0,
                            "transaksi_id" => 0,
                            "state" => "active",
                            "jumlah" => $pSpec['stock'],
                        )
                    );
                    echo($this->db->last_query() . ";<br>");


                    //                    if($selisih > 0){
                    //                        // inject fifo average
                    //                        $xx = new MdlFifoAverage();
                    //                        $xx->updateData(
                    //                            array(
                    //                                "cabang_id"=>$branchID,
                    //                                "gudang_id"=>$whID,
                    //                                "produk_id"=>$pID,
                    //
                    //                            ), array(
                    //                                "jml" => $jmlRek,
                    //                                "jml_nilai" => $arrHppAvg[$pID]['hpp']*$jmlRek,
                    //                            )
                    //                        );
                    //                        //cekUngu($this->db->last_query());
                    //
                    //
                    //
                    //                        // inject fifo murni
                    //                        $yy = new MdlFifoProdukJadi();
                    //                        $yy->addData(
                    //                            array(
                    //                                "cabang_id"=>$branchID,
                    //                                "gudang_id"=>$whID,
                    //                                "produk_id"=>$pID,
                    //                                "produk_nama"=>$pSpec['name'],
                    //                                "unit"=>$selisih,
                    //                                "hpp"=>$arrHppAvg[$pID]['hpp'],
                    //                                "jml_nilai"=>$arrHppAvg[$pID]['hpp']*$selisih,
                    //                            )
                    //                        );
                    //                        //cekLime($this->db->last_query());
                    //                    }


                }
                else {

                    //                    if($selisih > 0){
                    //                        // inject fifo average
                    //                        $xx = new MdlFifoAverage();
                    //                        $xx->updateData(
                    //                            array(
                    //                                "cabang_id"=>$branchID,
                    //                                "gudang_id"=>$whID,
                    //                                "produk_id"=>$pID,
                    //
                    //                            ), array(
                    //                                "jml" => $jmlRek,
                    //                                "jml_nilai" => $arrHppAvg[$pID]['hpp']*$jmlRek,
                    //                            )
                    //                        );
                    //                        //cekUngu($this->db->last_query());
                    //
                    //
                    //                        // inject fifo murni
                    //                        $yy = new MdlFifoProdukJadi();
                    //                        $yy->addData(
                    //                            array(
                    //                                "cabang_id"=>$branchID,
                    //                                "gudang_id"=>$whID,
                    //                                "produk_id"=>$pID,
                    //                                "produk_nama"=>$pSpec['name'],
                    //                                "unit"=>$selisih,
                    //                                "hpp"=>$arrHppAvg[$pID]['hpp'],
                    //                                "jml_nilai"=>$arrHppAvg[$pID]['hpp']*$selisih,
                    //                            )
                    //                        );
                    //                        //cekLime($this->db->last_query());
                    //                    }

                    echo "<tr style='$bg_color'>";
                    echo "<td >" . $pID . "</td>";
                    echo "<td >" . $pSpec['name'] . " $add</td>";
                    echo "<td align='right'>" . $selisih . "</td>";
                    echo "<td align='right'>" . $jmlFifo . "</td>";
                    echo "<td align='right'>" . $jmlAvg . "</td>"; // fifo avg
                    echo "<td bgcolor='#eeffee'>" . $pSpec['stock'] . "</td>";
                    echo "<td align='right'>" . $jmlActive . "</td>";
                    echo "<td align='right'>" . $jmlHold . "</td>";
                    echo "<td align='right'>" . $jmlHoldTrID . "</td>";
                    echo "<td align='right'>" . $jmlSold . "</td>";
                    echo "<td bgcolor='#ffeeee' align='right'>" . $jmlLoker . "</td>";
                    echo "</tr>";
                }


            }


            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        }
        echo "</table>";

    }


    function viewUnsyncedPiutangDagang()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuCustomer");
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentAntiSource");
        $this->load->model("Mdls/MdlCabang");


        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $deposit = array();
        $products = array();
        $ids = array();
        $ffStocks = array();

        // piutang dagang
        $c = new ComRekeningPembantuCustomer();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("piutang dagang");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "debet" => $row->debet,
                    "kredit" => $row->kredit,
                );
                $ids[] = $row->extern_id;
            }
        }

        // hutang ke konsumen
        $c = new ComRekeningPembantuCustomer();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("hutang ke konsumen");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $deposit[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "debet" => $row->debet,
                    "kredit" => $row->kredit,
                );
                //                $ids[] = $row->extern_id;
            }
        }
        //cekKuning($deposit);

        $l = new MdlPaymentSource();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("sisa>'0'");
        //        $l->addFilter("trash='0'");
        $l->addFilter("target_jenis in ('749')");
        $lSource = $l->lookupAll()->result();
        $srcData = array();
        if (sizeof($lSource) > 0) {
            foreach ($lSource as $srcSpec) {
                if (!isset($srcData[$srcSpec->extern_id])) {
                    $srcData[$srcSpec->extern_id] = 0;
                }
                $srcData[$srcSpec->extern_id] += $srcSpec->sisa;
            }
        }

        $m = new MdlPaymentAntiSource();
        $m->addFilter("cabang_id='$branchID'");
        $m->addFilter("sisa>'0'");
        $m->addFilter("trash='0'");
        $m->addFilter("target_jenis in ('749')");
        $mAntiSrc = $m->lookupAll()->result();
        $antiSrcData = array();
        if (sizeof($mAntiSrc) > 0) {
            foreach ($mAntiSrc as $srcSpec) {
                if (!isset($antiSrcData[$srcSpec->extern_id])) {
                    $antiSrcData[$srcSpec->extern_id] = 0;
                }
                $antiSrcData[$srcSpec->extern_id] += $srcSpec->sisa;
            }
        }


        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
            "debet" => "rek debet<br>piutang dagang",
            "kredit" => "rek kredit<br>piutang dagang",

            "debet_konsumen" => "rek debet<br>hutang ke konsumen",
            "kredit_konsumen" => "rek kredit<br>hutang ke konsumen",

            "pymSrc" => "pym src",
            "pymASrc" => "pym anti<br>src",
            "netto" => "netto",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            $this->db->trans_start();

            foreach ($products as $pID => $pSpec) {
                $jmlDeposit_debet = isset($deposit[$pID]['debet']) ? $deposit[$pID]['debet'] : 0;
                $jmlDeposit_kredit = isset($deposit[$pID]['kredit']) ? $deposit[$pID]['kredit'] : 0;

                $jmlRek_debet = isset($pSpec['debet']) ? $pSpec['debet'] : 0;
                $jmlRek_kredit = isset($pSpec['kredit']) ? $pSpec['kredit'] : 0;
                $jmlPymSrc = isset($srcData[$pID]) ? $srcData[$pID] : 0;
                $jmlPymAntiSrc = isset($antiSrcData[$pID]) ? $antiSrcData[$pID] : 0;
                $jmlNetto = $jmlPymSrc - $jmlPymAntiSrc;

                $items[] = array(
                    "pID" => $pID,
                    "pName" => $pSpec['name'],
                    "debet" => $jmlRek_debet,
                    "kredit" => $jmlRek_kredit,

                    "debet_konsumen" => $jmlDeposit_debet,
                    "kredit_konsumen" => $jmlDeposit_kredit,

                    "pymSrc" => $jmlPymSrc,
                    "pymASrc" => $jmlPymAntiSrc,
                    "netto" => $jmlNetto,
                );
                $markingColumn[$pID] = array(
                    "debet" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "pymSrc" => array(
                        "background-color" => "#B5FF7B",
                    ),

                    "kredit_konsumen" => array(
                        "background-color" => "pink",
                    ),
                    "pymASrc" => array(
                        "background-color" => "pink",
                    ),
                );

                $bg_color = "";
                $add = "";
                //                if ($jmlLoker != $pSpec['stock']) {
                //                    $bg_color = "background-color:yellow;";
                //                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                //                }

                $nof++;
                if (round($jmlRek_debet, 2) != round($jmlPymSrc, 2)) {

                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );

                    //hilangkan saja
                    //                    $ll = new MdlLockerValue();
                    //                    $ll->updateData(
                    //                        array(
                    //                            "jenis" => "kas",
                    //                            "jenis_locker" => "value",
                    //                            "cabang_id" => $branchID,
                    //                            "gudang_id" => $whID,
                    //                            "produk_id" => $pID,
                    //                            "transaski_id" => 0,
                    //                            "state" => "active",
                    //                        ), array(
                    ////                            "produk_id" => 6666,
                    //                            "nilai" => $jmlActive_new,
                    ////                            "nama" => "unknown",
                    ////                            "state" => "dest",
                    //                        )
                    //                    );
                    //                    $update = $this->db->last_query() . ";";
                    //
                    //
                    //                    $ll = new MdlLockerValue();
                    //                    $ll->addData(
                    //                        array(
                    //                            "jenis" => "kas",
                    //                            "jenis_locker" => "value",
                    //                            "cabang_id" => $branchID,
                    //                            "gudang_id" => $whID,
                    //                            "produk_id" => $pID,
                    //                            "nama" => $pSpec['name'],
                    //                            "oleh_id" => 0,
                    //                            "transaksi_id" => 0,
                    //                            "state" => "active",
                    //                            "nilai" => $jmlActive_new,
                    ////                            "nilai" => $pSpec['stock'],
                    //                        )
                    //                    );
                    //                    $insert = $this->db->last_query() . ";";

                    //                    $warning[$nof] = array(
                    //                        "update" => $update,
                    ////                        "insert" => $insert,
                    //                    );

                }
                else {

                }

            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        }


        $data = array(
            "mode" => "index",
            "title" => "PIUTANG DAGANG ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    function viewCheckerTransaksiOLD()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;
        $date1 = date("Y-m-20");
        $date2 = 0;


        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlCabang");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }

        $trIDs = array();
        $TransData = array();

        $c = new MdlTransaksi();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("date(dtime)='$date1'");
        $tmp = $c->lookupAll()->result();

        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $trIDs[] = $row->id;
                if (!isset($TransData[$row->jenis])) {
                    $TransData[$row->jenis] = 0;
                }
                $TransData[$row->jenis] += 1;
            }
        }


        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "tJenis" => "tr jenis",
            "tName" => "transaksi",
            "jml" => "jumlah",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($TransData) > 0) {

            $arrTrName = arrCodeAliasing($branchID);
            foreach ($TransData as $trJenis => $trJml) {


                $items[] = array(
                    "tJenis" => $trJenis,
                    "tName" => isset($arrTrName[$trJenis]) ? $arrTrName[$trJenis] : "not define",
                    "jml" => $trJml,
                );

                //                $markingColumn[$pID] = array(
                //                    "debet" => array(
                //                        "background-color" => "#B5FF7B",
                //                    ),
                //                    "netto" => array(
                //                        "background-color" => "#B5FF7B",
                //                    ),
                //                );
                //
                //                $bg_color = "";
                //                $add = "";
                //                if ($jmlLoker != $pSpec['stock']) {
                //                    $bg_color = "background-color:yellow;";
                //                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                //                }

                //                $nof++;
                //                if (floor($jmlRek_debet) != floor($jmlNetto)) {
                //
                //                    $marking[$pID] = array(
                //                        "add_name" => "(yellow)",
                //                        "background-color" => "yellow",
                //                    );
                //
                //                    //hilangkan saja
                ////                    $ll = new MdlLockerValue();
                ////                    $ll->updateData(
                ////                        array(
                ////                            "jenis" => "kas",
                ////                            "jenis_locker" => "value",
                ////                            "cabang_id" => $branchID,
                ////                            "gudang_id" => $whID,
                ////                            "produk_id" => $pID,
                ////                            "transaski_id" => 0,
                ////                            "state" => "active",
                ////                        ), array(
                //////                            "produk_id" => 6666,
                ////                            "nilai" => $jmlActive_new,
                //////                            "nama" => "unknown",
                //////                            "state" => "dest",
                ////                        )
                ////                    );
                ////                    $update = $this->db->last_query() . ";";
                ////
                ////
                ////                    $ll = new MdlLockerValue();
                ////                    $ll->addData(
                ////                        array(
                ////                            "jenis" => "kas",
                ////                            "jenis_locker" => "value",
                ////                            "cabang_id" => $branchID,
                ////                            "gudang_id" => $whID,
                ////                            "produk_id" => $pID,
                ////                            "nama" => $pSpec['name'],
                ////                            "oleh_id" => 0,
                ////                            "transaksi_id" => 0,
                ////                            "state" => "active",
                ////                            "nilai" => $jmlActive_new,
                //////                            "nilai" => $pSpec['stock'],
                ////                        )
                ////                    );
                ////                    $insert = $this->db->last_query() . ";";
                //
                ////                    $warning[$nof] = array(
                ////                        "update" => $update,
                //////                        "insert" => $insert,
                ////                    );
                //
                //                }
                //                else {
                //
                //                }

            }

        }


        $data = array(
            "mode" => "index",
            "title" => "TRANSAKSI ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }


    function viewUnsyncedValasOLD()
    {

        $branchID = 1;
        $whID = -10;

        $this->load->model("Coms/ComRekeningPembantuValas");
        $this->load->model("Mdls/MdlFifoValas");
        $this->load->model("Mdls/MdlFifoValasAverage");

        $products = array();
        $ids = array();
        $ffStocks = array();
        $raw_ffStocks = array();

        $c = new ComRekeningPembantuValas();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("gudang_id='$whID'");
        $tmp = $c->fetchBalances("valas");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "qty" => $row->qty_debet,
                    "value" => $row->debet,
                );
                $ids[] = $row->extern_id;
                //                $rekStocks[$row->extern_id] = $row->qty_debet;

                $ff = new MdlFifoValas();
                $ff->addFilter("cabang_id='$branchID'");
                $ff->addFilter("gudang_id='$whID'");
                $ff->addFilter("produk_id='" . $row->extern_id . "'");
                //                $ffStocks[$row->extern_id] = $ff->lookupAllQty()->result();
                $raw_ffStocks[$row->extern_id] = $ff->lookupAll()->result();
            }
            if (sizeof($raw_ffStocks) > 0) {
                foreach ($raw_ffStocks as $vID => $vSpec) {
                    foreach ($vSpec as $vvSpec) {
                        if (!isset($ffStocks[$vID])) {
                            $ffStocks[$vID]["qty"] = 0;
                            $ffStocks[$vID]["value"] = 0;
                        }
                        $ffStocks[$vID]["qty"] += $vvSpec->unit;
                        $ffStocks[$vID]["value"] += $vvSpec->jml_nilai;
                    }
                }
            }
        }
        //arrPrint($ffStocks);

        $fa = new MdlFifoValasAverage();
        $fa->addFilter("cabang_id='$branchID'");
        $fa->addFilter("gudang_id='$whID'");
        $fa->addFilter("jenis='valas'");
        $faStocks = $fa->lookupAllQty()->result();

        $arrHppAvg = array();
        if (sizeof($faStocks) > 0) {
            foreach ($faStocks as $faSpec) {
                $arrHppAvg[$faSpec->produk_id] = array(
                    "hpp" => $faSpec->hpp,
                    "value" => $faSpec->jml_nilai,
                    "qty" => $faSpec->jml,
                );
            }
        }
        //arrPrint($arrHppAvg);

        echo "<div>";
        echo "<h2>:: VALAS ::</h2>";
        echo "</div>";

        //        echo "<div>";
        //        echo "";
        //        echo "</div>";


        echo "<table align='center' border='1' cellspacing='0' cellpadding='2'>";
        echo "<tr style='text-align:center;background-color: #9FAFD1'>";
        echo "<td>ID</td>";
        echo "<td>Name</td>";
        echo "<td>val<br>selisih</td>";
        echo "<td>qty<br>selisih</td>";

        echo "<td>val<br>fifo murni</td>";
        echo "<td>qty<br>fifo murni</td>";
        echo "<td>val<br>fifo avg</td>";
        echo "<td>qty<br>fifo avg</td>";
        echo "<td>val<br>debet</td>";
        echo "<td>qty<br>debet</td>";
        echo "</tr>";
        if (sizeof($products) > 0) {

            $this->db->trans_start();


            $nof = 0;
            foreach ($products as $pID => $pSpec) {
                $val_fifo_murni = isset($ffStocks[$pID]["value"]) ? $ffStocks[$pID]["value"] : 0;
                $qty_fifo_murni = isset($ffStocks[$pID]["qty"]) ? $ffStocks[$pID]["qty"] : 0;
                $val_fifo_avg = isset($arrHppAvg[$pID]["value"]) ? $arrHppAvg[$pID]["value"] : 0;
                $qty_fifo_avg = isset($arrHppAvg[$pID]["qty"]) ? $arrHppAvg[$pID]["qty"] : 0;
                $val_rek = isset($products[$pID]["value"]) ? $products[$pID]["value"] : 0;
                $qty_rek = isset($products[$pID]["qty"]) ? $products[$pID]["qty"] : 0;


                $val_selisih = $val_fifo_murni - $val_rek;
                $qty_selisih = $qty_fifo_murni - $qty_rek;


                $bg_color = "";
                $add = "";
                if ($val_selisih != 0) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }
                if ($qty_selisih != 0) {
                    $bg_color = "background-color:pink;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( pink )</span>";
                }

                echo "<tr style='$bg_color'>";
                echo "<td >" . $pID . "</td>";
                echo "<td >" . $pSpec['name'] . " $add</td>";
                echo "<td align='right'>" . $val_selisih . "</td>";
                echo "<td align='right'>" . $qty_selisih . "</td>";

                echo "<td align='right'>$val_fifo_murni</td>";
                echo "<td align='right'>$qty_fifo_murni</td>";
                echo "<td align='right' bbgcolor='#eeffee'>$val_fifo_avg</td>";
                echo "<td align='right'>$qty_fifo_avg</td>";
                echo "<td align='right'>$val_rek</td>";
                echo "<td align='right' bbgcolor='#eeffee'>$qty_rek</td>";
                echo "</tr>";
                //                }
            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        }
        echo "</table>";

    }

    function cekCounters()
    {
        $this->load->model('MdlTransaksi');
        $this->load->library('table');

        $tr = new MdlTransaksi();

        $jenis = array(
            "582spo",
            "582so",
            "582spd",
            "582pkd",
            "582",
        );

        $koloms = array(
            "nom" => "No",
            "cOleh" => "c-by",
            "cCabang" => "c-Cb",
            "cGlobal_f" => "c-Gb",
            // "jenis" => "Jenis",
            "dtime" => "Tgl",

            "nomer_top_f" => "noSO",
            "nomer" => "no",
            "cabang_nama" => "Cabang",
            "oleh_nama" => "Oleh",
            // "test" => "test",
        );
        foreach ($jenis as $jeni) {


            $wheres = array(
                // "jenis_master" => "582",
                // "jenis" => "582spd",
                // "jenis" => "582spo",
                "jenis" => $jeni,
                // "step_curent" => 0,
            );

            $this->db->order_by("id", "desc");
            $this->db->limit(20);
            $tmps = $tr->lookupByCondition($wheres)->result();
            // cekMerah($this->db->last_query());

            /* ============================================
             * contoh pengunaan table ci
             * ============================================*/

            // $kolomFormats = array(
            //     "cCabang" => array(
            //         "style" => "color:red;text-align:right;"
            //     ),
            // );
            // arrPrint($tmps);
            echo "<div style='float: left;font-family: Verdana, Helvetica;margin: 0 5px 5px 0;'>";

            //region tablenya
            $no = 21;
            foreach ($tmps as $item) {
                $no--;
                // $oleh_nama = $item->oleh_nama;
                // $customers_nama = $item->customers_nama;
                // $nomer_top = $item->nomer_top;
                // $cabang_nama = $item->cabang_nama;
                $eCounters = blobDecode($item->counters);

                // arrPrint($eCounters);
                // $cCabang = $eCounters['stepCode|placeID'][$item->jenis ."|". $item->cabang_id ."|". $item->customers_id ];
                // $cCabang = $eCounters['stepCode|placeID'][$item->jenis ."|". $item->cabang_id ."|". $item->customers_id ];

                $cOleh = $eCounters['stepCode|olehID'][$item->jenis . "|" . $item->oleh_id];
                $cCabang = $eCounters['stepCode|placeID'][$item->jenis . "|" . $item->cabang_id];
                $cGlobal = $eCounters['stepCode'][$item->jenis];
                $nomer_top_f = formatField('nomer_top', $item->nomer_top);
                $nomer_f = formatField('nomer', $item->nomer);

                $kolomList = array();
                foreach ($koloms as $kolom => $kAlias) {
                    // $$koloms= $item->$kolom;

                    $test = array(
                        "data" => 6,
                        "style" => "color:red;text-align:right;"
                    );
                    $nom = array(
                        "data" => $no,
                        "style" => "color:red;text-align:right;"
                    );
                    $cGlobal_f = array(
                        "data" => $cGlobal,
                        "style" => "text-align:center;"
                    );
                    // foreach ($kolomFormats as $kolom => $formater) {
                    //     $kolom['data'] = $cCabang;
                    //
                    // }

                    $kolomList[] = isset($item->$kolom) ? $item->$kolom : $$kolom;
                }

                // $this->table->add_row($no, $cOleh, $oleh_nama, $customers_nama, $nomer_top, $cabang_nama);
                // cekHitam(implode(",", $kolomList));
                $this->table->add_row($kolomList);
            }

            $template = array(
                'table_open' => '<table style="color: blue;font-size: .7em;" border="1" rules="all" class="table">',
                //
                // 'thead_open'            => '<thead>',
                // 'thead_close'           => '</thead>',
                //
                // 'heading_row_start'     => '<tr>',
                // 'heading_row_end'       => '</tr>',
                // 'heading_cell_start'    => '<th>',
                // 'heading_cell_end'      => '</th>',
                //
                // 'tbody_open'            => '<tbody>',
                // 'tbody_close'           => '</tbody>',
                //
                // 'row_start'             => '<tr>',
                // 'row_end'               => '</tr>',
                // 'cell_start'            => '<td align="center">',
                // 'cell_end'              => '</td>',
                //
                // 'row_alt_start'         => '<tr>',
                // 'row_alt_end'           => '</tr>',
                // 'cell_alt_start'        => '<td align="center">',
                // 'cell_alt_end'          => '</td>',
                //
                // 'table_close'           => '</table>'
            );
            // $headings = array(
            //   "No","count","oleh","Customer","nomer","cabang"
            // );
            $headings = array();
            foreach ($koloms as $kolom => $kAlias) {
                $headings[] = $kAlias;
            }
            $this->table->set_heading($headings);
            $this->table->set_template($template);

            echo "<div style='color: blue;font-family: 'Courgette', serif;>";
            echo $this->table->generate();
            echo "</div>";
            //endregion

            echo "</div>";
            // echo $this->table->generate($datas);
        }
        // echo dueDate("2019-11-1",-1);

    }

    function injectPembantuBiayaJasa()
    {
        $jenisTr = "463";
        $this->load->model("MdlTransaksi");
        $tr = new MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("transaksi.jenis='$jenisTr'");
        $tmp = $tr->lookupJoined()->result();
        cekHere($this->db->last_query());
        // arrPrint($tmp);
        $tmpID = array();
        if (sizeof($tmp) > 0) {

        }

        $this->db->trans_start();

        if (sizeof($tmp) > 0) {
            // arrPrint($tmp);
            foreach ($tmp as $tmpSpec) {
                // cekUngu(":: trID -> $tmpSpec->transaksi_id ::");
                $this->load->model("Coms/ComRekeningPembantuBiayaJasa");
                $ca = New ComRekeningPembantuBiayaJasa();
                $data = array();
                $data[] = array(
                    "loop" => array(
                        "biaya" => $tmpSpec->produk_ord_hrg,
                    ),
                    "static" => array(
                        "cabang_id" => $tmpSpec->cabang_id,
                        "cabang_nama" => $tmpSpec->cabang_nama,
                        "extern_id" => $tmpSpec->produk_id,
                        "extern_nama" => $tmpSpec->produk_nama,
                        "jenis" => $jenisTr,
                        "transaksi_id" => $tmpSpec->transaksi_id,
                        "transaksi_no" => $tmpSpec->nomer,
                        "fulldate" => formatTanggal($tmpSpec->dtime, "Y-m-d"),
                        "tgl" => formatTanggal($tmpSpec->dtime, "d"),
                        "bln" => formatTanggal($tmpSpec->dtime, "m"),
                        "thn" => formatTanggal($tmpSpec->dtime, "Y"),
                    ),
                );
                $ca->pair($data);
                $ca->exec();

                // mati_disini();
            }
        }


        mati_disini();
        $this->db->trans_commit();
    }


    function patchFifo()
    {

        $this->load->model("MdlTransaksi");


        $trID = "19653";

        $reg = New MdlTransaksi();
        $reg->setFilters(array());
        $reg->addFilter("param='items'");
        $reg->addFilter("transaksi_id='$trID'");
        $tmp = $reg->lookupRegistries()->result();
        cekHere($this->db->last_query());
        $items = blobDecode($tmp[0]->values);
        //arrPrint($items);

        $this->db->trans_start();


        if (sizeof($items) > 0) {
            foreach ($items as $itemSpec) {
                $arrFifo = array();
                if ($itemSpec['qty_debet'] > 0) {
                    $arrFifo = array(
                        array(
                            "comName" => "ComFifoAverage",
                            "loop" => array(),
                            "static" => array(
                                "jenis" => "produk",
                                "jml" => $itemSpec['qty_debet'],
                                "produk_id" => $itemSpec['id'],
                                "hpp" => $itemSpec['harga'],
                                "jml_nilai" => $itemSpec['sub_debet'],
                                "nama" => $itemSpec['name'],
                                "cabang_id" => $itemSpec['cabangID'],
                                "gudang_id" => $itemSpec['gudangID'],
                                "dtime" => date("Y-m-d H:i:s"),
                                "fulldate" => date("Y-m-d"),
                            ),
                        ),
                        array(
                            "comName" => "ComFifoProdukJadi",
                            "loop" => array(),
                            "static" => array(
                                "unit" => $itemSpec['qty_debet'],
                                "produk_id" => $itemSpec['id'],
                                "produk_nama" => $itemSpec['name'],
                                "hpp" => $itemSpec['harga'],
                                "jml_nilai" => $itemSpec['sub_debet'],
                                "cabang_id" => $itemSpec['cabangID'],
                                "gudang_id" => $itemSpec['gudangID'],
                                "dtime" => date("Y-m-d H:i:s"),
                                "fulldate" => date("Y-m-d"),
                                "transaksi_id" => $itemSpec['transaksi_id'],
                                "transaksi_jenis" => $itemSpec['jenisTr'],
                            ),
                        )
                    );
                }

                if (sizeof($arrFifo) > 0) {

                    foreach ($arrFifo as $arrFifoSpec) {
                        $arrFifoSpecIn[0] = $arrFifoSpec;
                        $this->load->model("Coms/" . $arrFifoSpec['comName']);
                        $mdl = New $arrFifoSpec['comName'];
                        $mdl->pair($arrFifoSpecIn) or die("Tidak berhasil memasang  values pada komponen");
                        $mdl->exec() or die("Gagal saat berusaha  exec values pada komponen");
                    }

                }
            }
        }


        mati_disini("UNDER MAINTENANCE");
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        cekLime("DONE");
    }

    function patchPrice()
    {
        $this->load->model("Mdls/MdlFifoSupplies");
        $this->load->model("Mdls/MdlHargaSupplies");
        $this->load->model("Mdls/MdlMother");

        $cabID = "-1";
        $whID = "-1";
        $itemJenis = "supplies";
        $itemJenisValue = "hpp";

        $mdl = New MdlFifoSupplies();
        $mdl->addFilter("unit>0");
        $mdl->addFilter("cabang_id='$cabID'");
        $mdl->addFilter("gudang_id='$whID'");
        $arrFifo = $mdl->lookupAll()->result();
        $fifoHpp = array();
        if (sizeof($arrFifo) > 0) {
            foreach ($arrFifo as $spec) {
                $fifoHpp[$spec->produk_id] = $spec->hpp;
            }
        }


        $mdl = New MdlHargaSupplies();
        $mdl->addFilter("cabang_id='$cabID'");
        $mdl->addFilter("status='1'");
        $arrHargaSupplies = $mdl->lookupAll()->result();
        $suppliesHpp = array();
        if (sizeof($arrHargaSupplies) > 0) {
            foreach ($arrHargaSupplies as $spec) {
                $suppliesHpp[$spec->produk_id] = $spec->nilai;
            }
        }


        if (sizeof($fifoHpp) > 0) {
            $arrItemInsert = array();
            foreach ($fifoHpp as $pID => $hpp) {
                if (!array_key_exists($pID, $suppliesHpp)) {
                    $arrItemInsert[] = array(
                        "jenis" => $itemJenis,
                        "jenis_value" => $itemJenisValue,
                        "produk_id" => $pID,
                        "cabang_id" => $cabID,
                        "nilai" => $hpp,
                        "status" => 1,
                        "trash" => 0,
                        "oleh_id" => "-100",
                        "oleh_nama" => "sys",
                    );
                }
            }

            $this->db->trans_start();


            if (sizeof($arrItemInsert) > 0) {
                foreach ($arrItemInsert as $data) {
                    arrPrint($data);
                    $mdl = New MdlHargaSupplies();
                    $mdl->addData($data);
                    cekHere($this->db->last_query());
                }
            }
            else {
                cekhitam("SUDAH LENGKAP...");
            }


            mati_disini("UNDER MAINTENANCE");
            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
            cekLime("DONE");

        }
    }


    public function cekHutangDagang()
    {

        $this->load->model("Coms/ComRekeningPembantuSupplier");
        $this->load->model("Mdls/MdlPaymentUangMuka");
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentAntiSource");
        $this->load->model("Mdls/MdlSupplier");
        $cabangID = "-1";
        $periode = "forever";

        $arrRekening = array(
            "hutang dagang" => array(
                "comNama" => "RekeningPembantuSupplier",
                "mdlNamaPym" => "PaymentSource",
                "mdlNamaPymAnti" => "PaymentAntiSource",
                //                "key" => "kredit",
            ),
            "hutang biaya" => array(
                "comNama" => "RekeningPembantuSupplier",
                "mdlNamaPym" => "PaymentSource",
                "mdlNamaPymAnti" => "PaymentAntiSource",
                //                "key" => "kredit",
            ),
            "piutang pembelian" => array(
                "comNama" => "RekeningPembantuSupplier",
                "mdlNamaPym" => "PaymentSource",
                "mdlNamaPymAnti" => "PaymentAntiSource",
                //                "key" => "debet",
            ),
        );
        $arrRekeningPosition = array(
            "hutang dagang" => array(
                "key" => "kredit",
            ),
            "hutang biaya" => array(
                "key" => "kredit",
            ),
            "piutang pembelian" => array(
                "key" => "debet",
            ),
        );

        $sp = New MdlSupplier();
        $arrVendor = $sp->lookupAll()->result();
        //        arrPrint($arrVendor);


        //region payment source, out going cash dari cia...
        $ps = New MdlPaymentSource();
        $ps->addFilter("label='outgoing cash'");
        $ps->addFilter("cabang_id='$cabangID'");
        $tmp = $ps->lookupAll()->result();
        $arrOutResult = array();
        foreach ($tmp as $tmpSpec) {
            if (!isset($arrOutResult[$tmpSpec->label][$tmpSpec->extern_id])) {
                $arrOutResult[$tmpSpec->label][$tmpSpec->extern_id] = 0;
            }
            $arrOutResult[$tmpSpec->label][$tmpSpec->extern_id] += $tmpSpec->sisa;
        }
        //endregion


        $arrRekeningResult = array();
        $arrPymResult = array();
        $arrPymAntiResult = array();
        foreach ($arrRekening as $rekNama => $rekSpec) {
            $comNama = $rekSpec['comNama'];
            $comNama_full = "Com" . $comNama;
            $comNamaPymSrc = $rekSpec['mdlNamaPym'];
            $comNamaPymSrc_full = "Mdl" . $comNamaPymSrc;
            $comNamaPymAntiSrc = $rekSpec['mdlNamaPymAnti'];
            $comNamaPymAntiSrc_full = "Mdl" . $comNamaPymAntiSrc;
            $key = $arrRekeningPosition[$rekNama]['key'];

            //region rekening utama
            $ps = New $comNama_full();
            $ps->addFilter("rekening='$rekNama'");
            $ps->addFilter("cabang_id='$cabangID'");
            $ps->addFilter("periode='$periode'");
            $tmp = $ps->lookupAll()->result();
            foreach ($tmp as $tmpSpec) {
                if (!isset($arrRekeningResult[$rekNama][$tmpSpec->extern_id])) {
                    $arrRekeningResult[$rekNama][$tmpSpec->extern_id] = 0;
                }
                $arrRekeningResult[$rekNama][$tmpSpec->extern_id] += $tmpSpec->$key;
            }
            //endregion

            //region payment source
            $ps = New $comNamaPymSrc_full();
            $ps->addFilter("label='$rekNama'");
            $ps->addFilter("cabang_id='$cabangID'");
            $tmp = $ps->lookupAll()->result();
            //            showLast_query("biru");
            foreach ($tmp as $tmpSpec) {
                if (!isset($arrPymResult[$rekNama][$tmpSpec->extern_id])) {
                    $arrPymResult[$rekNama][$tmpSpec->extern_id] = 0;
                }
                $arrPymResult[$rekNama][$tmpSpec->extern_id] += $tmpSpec->sisa;
            }
            //endregion

            //region payment anti source
            $ps = New $comNamaPymAntiSrc_full();
            $ps->addFilter("label='$rekNama'");
            $ps->addFilter("cabang_id='$cabangID'");
            $tmp = $ps->lookupAll()->result();
            foreach ($tmp as $tmpSpec) {
                if (!isset($arrPymAntiResult[$rekNama][$tmpSpec->extern_id])) {
                    $arrPymAntiResult[$rekNama][$tmpSpec->extern_id] = 0;
                }
                $arrPymAntiResult[$rekNama][$tmpSpec->extern_id] += $tmpSpec->sisa;
            }
            //endregion
        }
        //arrPrint($arrPymAntiResult);


        $str = "<table rules='all' style='border:1px solid black;width: 100%;'>";
        $str .= "<tr>";
        $str .= "<th style='width: 50px;'>no</th>";
        $str .= "<th style='width: 50px;'>vID</th>";
        $str .= "<th>vendor</th>";
        foreach ($arrRekening as $rekNama => $ii) {
            foreach ($ii as $ii_label) {

                $str .= "<th style='width: 100px;' colspan='1'>$rekNama<br>$ii_label</th>";
            }
        }
        $str .= "<th style='width: 200px;' colspan='2'>outgoing cash</th>";
        $str .= "</tr>";

        $no = 0;
        foreach ($arrVendor as $vSpec) {
            $no++;
            $vendorID = $vSpec->id;
            $vendorNama = $vSpec->nama;

            $str .= "<tr>";
            $str .= "<td style='text-align: right;'>$no</td>";
            $str .= "<td style='text-align: center;'>$vendorID</td>";
            $str .= "<td style='text-align: left;'>$vendorNama</td>";

            foreach ($arrRekening as $rekNama => $ii) {
                $saldo_rek = isset($arrRekeningResult[$rekNama][$vendorID]) ? $arrRekeningResult[$rekNama][$vendorID] : 0;
                $saldo_pym = isset($arrPymResult[$rekNama][$vendorID]) ? $arrPymResult[$rekNama][$vendorID] : 0;
                $saldo_pym_anti = isset($arrPymAntiResult[$rekNama][$vendorID]) ? $arrPymAntiResult[$rekNama][$vendorID] : 0;


                $saldo_f = number_format($saldo_rek, "0", ".", ",");
                $saldo_pym_f = number_format($saldo_pym, "0", ".", ",");
                $saldo_pym_anti_f = number_format($saldo_pym_anti, "0", ".", ",");


                $str .= "<th style='width: 200px;background-color: yellow;'>$saldo_f</th>";
                $str .= "<th style='width: 200px;background-color: pink;'>$saldo_pym_f</th>";
                $str .= "<th style='width: 200px;background-color: lightblue;'>$saldo_pym_anti_f</th>";
            }


            $outgoing_pym = isset($arrOutResult['outgoing cash'][$vendorID]) ? $arrOutResult['outgoing cash'][$vendorID] : 0;

            $outgoing_pym_f = number_format($outgoing_pym, "0", ".", ",");

            $str .= "<th style='width: 200px;background-color: tomato;'>$outgoing_pym_f</th>";

            $str .= "</tr>";
        }

        $str .= "</table>";
        echo $str;
    }

    public function cekPatchPembebanan()
    {

        $this->load->model("MdlTransaksi");


        $jenisTr = "463";
        $jenisTr2 = "462";


        // sudah dipindah dengan transfer2 expense
        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        //        $tr->addFilter("sinkron='1'");
        $tr->addFilter("jenis='$jenisTr'");
        $tmpTr = $tr->lookupAll()->result();
        $tmpTrRegData = array();
        if (sizeof($tmpTr) > 0) {
            foreach ($tmpTr as $tmpTrSpec) {
                $tmpTrRegData[$tmpTrSpec->id] = array(
                    "nilai_bayar" => $tmpTrSpec->transaksi_nilai,
                    "externMain" => "",
                    "dtaDetail" => "",
                    "sinkron" => $tmpTrSpec->sinkron,
                );
            }
        }


        // sudah dipindah dengan service a/p payment
        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        //        $tr->addFilter("sinkron='0'");
        $tr->addFilter("jenis='$jenisTr2'");
        $tmpTr_ap = $tr->lookupAll()->result();

        $tmpRegPembebanan = array();
        if (sizeof($tmpTr_ap) > 0) {
            $trIDs = array();
            foreach ($tmpTr_ap as $tmpTr_apSpec) {
                $trIDs[] = $tmpTr_apSpec->id;
            }

            $trReg = New MdlTransaksi();
            $trReg->setFilters(array());
            $trReg->addFilter("trash='0'");
            $trReg->addFilter("param='main'");
            $trReg->addFilter("transaksi_id in ('" . implode("','", $trIDs) . "')");
            $tmpReg = $trReg->lookupRegistries()->result();
            $tmpRegData = array();
            if (sizeof($tmpReg) > 0) {
                foreach ($tmpReg as $tmpRegSpec) {
                    $tmpRegData[$tmpRegSpec->transaksi_id] = blobDecode($tmpRegSpec->values);
                }

                foreach ($tmpRegData as $trID => $reg) {
                    $tmpRegPembebanan[$reg['refID']] = array(
                        "nilai_bayar" => $reg['nilai_bayar'],
                        "externMain" => isset($reg['externMain']) ? $reg['externMain'] : NULL,
                        "dtaDetail" => isset($reg['dtaDetail']) ? $reg['dtaDetail'] : NULL,
                    );
                }
            }
        }

        //        arrPrint($tmpRegPembebanan);

        $this->db->trans_start();


        $str = "<table style='border: 1px solid black;' rules='all' width='100%'>";
        $str .= "<tr>";
        $str .= "<td>trID</td>";
        $str .= "<td>sinkron</td>";
        $str .= "<td>externNama</td>";
        $str .= "<td>dtaDetail</td>";
        $str .= "</tr>";

        foreach ($tmpTrRegData as $trID => $spec) {
            $sinkron = $spec['sinkron'];
            $externMain = isset($tmpRegPembebanan[$trID]['externMain']) ? $tmpRegPembebanan[$trID]['externMain'] : NULL;
            $externDetail = isset($tmpRegPembebanan[$trID]['dtaDetail']) ? $tmpRegPembebanan[$trID]['dtaDetail'] : NULL;

            $background = "";
            if (($sinkron == 0) && ($externMain != NULL)) {
                $background = "background-color:yellow;";


                $tr = New MdlTransaksi();
                $data = array(
                    "sinkron" => 1,
                );
                $where = array(
                    "id" => $trID,
                );
                $tr->setFilters(array());
                $tr->updateData($where, $data);
                showLast_query("biru");
            }


            $str .= "<tr style='$background'>";
            $str .= "<td>$trID</td>";
            $str .= "<td>" . $sinkron . "</td>";
            $str .= "<td>$externMain</td>";
            $str .= "<td>$externDetail</td>";
            $str .= "</tr>";


        }

        $str .= "</table>";
        echo $str;


        mati_disini("UNDER MAINTENANCE");
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        cekLime("DONE");

    }

    public function cekPembebanan()
    {

        $this->load->model("MdlTransaksi");


        $jenisTr = "463";


        // sudah dipindah dengan transfer2 expense
        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("sinkron='0'");
        $tr->addFilter("trash_4='0'");
        $tr->addFilter("jenis='$jenisTr'");
        $tmpTr = $tr->lookupAll()->result();
        $tmpTrIDs = array();
        $tmpTrRegData = array();
        if (sizeof($tmpTr) > 0) {
            foreach ($tmpTr as $tmpTrSpec) {
                $tmpTrRegData[$tmpTrSpec->id] = $tmpTrSpec;
                $tmpTrIDs[] = $tmpTrSpec->id;
            }
            $trReg = New MdlTransaksi();
            $trReg->setFilters(array());
            $trReg->addFilter("trash='0'");
            $trReg->addFilter("param='main'");
            $trReg->addFilter("transaksi_id in ('" . implode("','", $tmpTrIDs) . "')");
            $tmpReg = $trReg->lookupRegistries()->result();
            $tmpRegData = array();
            if (sizeof($tmpReg) > 0) {
                foreach ($tmpReg as $tmpRegSpec) {
                    $tmpRegData[$tmpRegSpec->transaksi_id] = blobDecode($tmpRegSpec->values);
                }
            }
        }


        $str = "<table style='border: 1px solid black;' rules='all' width='100%'>";
        $str .= "<tr>";
        $str .= "<td>No.</td>";
        $str .= "<td>Tanggal</td>";
        $str .= "<td>Vendor</td>";
        $str .= "<td>Nomer</td>";
        $str .= "<td>harga-disc</td>";
        $str .= "<td>ppn</td>";
        $str .= "<td>Nilai</td>";
        $str .= "<td>Pym Method</td>";
        $str .= "</tr>";
        $no = 0;
        $nilai_total = 0;
        $harga_total = 0;
        $ppn_total = 0;
        foreach ($tmpTrRegData as $trID => $spec) {
            if (isset($tmpRegData[$trID])) {
                foreach ($tmpRegData[$trID] as $key => $val) {
                    if (!isset($spec->$key)) {
                        $spec->$key = $val;
                    }
                }
            }

            //            arrPrint($spec);
            $vendor = $spec->suppliers_nama;
            $dtime = $spec->dtime;
            $nomer = $spec->nomer;
            $harga = $spec->harga;
            //            $nilai = $spec->ppn;
            $ppn_value = isset($spec->ppn_value) ? $spec->ppn_value : $spec->ppn;
            $nilai = $harga_disc = $spec->harga_disc;
            $nett = $spec->nett;
            $paymentMethod__label = $spec->paymentMethod__label;
            $harga_total += $harga;
            $ppn_total += $ppn_value;
            $nilai_total += $nett;


            $no++;
            $str .= "<tr>";
            $str .= "<td>$no</td>";
            $str .= "<td>$dtime</td>";
            $str .= "<td>$vendor</td>";
            $str .= "<td>" . formatField("nomer", $nomer) . "</td>";
            $str .= "<td>" . formatField("debet", $harga) . "</td>";
            $str .= "<td>" . formatField("debet", $ppn_value) . "</td>";
            $str .= "<td>" . formatField("debet", $nett) . "</td>";
            $str .= "<td>$paymentMethod__label</td>";
            $str .= "</tr>";


        }
        $str .= "<tr>";
        $str .= "<td colspan='4'>TOTAL</td>";
        $str .= "<td>" . formatField("debet", $harga_total) . "</td>";
        $str .= "<td>" . formatField("debet", $ppn_total) . "</td>";
        $str .= "<td>" . formatField("debet", $nilai_total) . "</td>";
        $str .= "</tr>";

        $str .= "</table>";
        echo $str;


    }

    // ================ ================ ================
    // ================ ================ ================

    function viewCliTransaksi()
    {
        if (isset($_GET["stop"]) && ($_GET["stop"] == 1)) {
            // tidak ada auto refresh
        }
        else {
            header("refresh:120");
        }

        $this->load->model("MdlTransaksi");
        $masterConfigUI = $this->config->item("heTransaksi_ui");

        $headerFields = array(
            "dtime" => "dtime<br>transaksi",
            "dtime_now" => "dtime<br>sekarang",
            "dtime_waiting" => "waktu<br>tunggu",
            "id" => "trID",
            "customers_id" => "customer ID",
            "customers_nama" => "customer Nama",
            "suppliers_id" => "vendor ID",
            "suppliers_nama" => "vendor Nama",
            "oleh_id" => "oleh ID",
            "oleh_nama" => "oleh Nama",
            "jenis" => "jenis",
            "jenis_label" => "label",
            "nomer_top" => "nomer top",
            "nomer" => "nomer",
        );

        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("link_id='0'");
        $tr->addFilter("cli!='1'");
        $trTmp = $tr->lookupAll()->result();
//        arrPrint($trTmp);
//        cekMerah($this->db->last_query());

        $items = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $trID = $trSpec->id;
                $jenisMaster = $trSpec->jenis_master;
                $items[$trID]['pID'] = $trID;
                $modul = isset($masterConfigUI[$jenisMaster]['modul']) ? $masterConfigUI[$jenisMaster]['modul'] : NULL;
                foreach ($headerFields as $key => $val) {
                    $items[$trID][$key] = isset($trSpec->$key) ? $trSpec->$key : null;
                }

                $dtimeNow = dtimeNow();
                $dtime_waiting = timeDiff($trSpec->dtime, $dtimeNow);
                $dtime_umur = umurHour($trSpec->dtime, "H:i");
                $items[$trID]['dtime_now'] = $dtimeNow;
                $items[$trID]['dtime_waiting'] = $dtime_waiting . " (s)<br>" . $dtime_umur . " (jam:menit)";
                $items[$trID]['cek'] = "<a target='_blank' href=\"" . base_url() . "CliTransaksi/run_cliTransaksi/?&tr_id=$trID\"><button class='btn btn-danger'>CEK</button></a>";
                $items[$trID]['jenisTr_master'] = $jenisMaster;
                $items[$trID]['modul'] = $modul;
                $items[$trID]['modul_path'] = base_url() . "$modul/";
            }
        }

        $jumlah_cli = sizeof($trTmp);
        $headerFields['cek'] = "cek<br>manual";
        $data = array(
            "mode" => "index",
            "title" => "($jumlah_cli) CLI TRANSAKSI  " . dtimeNow('ymd H:i:s'),
            "subTitle" => "daftar cli transaksi yang menunggu dieksekusi ya bro...",
            "headerFields" => isset($headerFields) ? $headerFields : array(),
            "items" => isset($items) ? $items : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
        );

        $this->load->view("tool", $data);


    }

    function viewCliInvoice()
    {
        header("refresh:120");

        $this->load->helper("he_session_replacer");
        $this->load->model("MdlTransaksi");
        $masterConfigUI = $this->config->item("heTransaksi_ui");
        $batas_tanggal = "2024-02-18";

        $headerFields = array(
            "dtime" => "dtime<br>transaksi",
            "dtime_now" => "dtime<br>sekarang",
            "dtime_waiting" => "waktu<br>tunggu",
            "id" => "trID",
            "customers_id" => "customer ID",
            "customers_nama" => "customer Nama",
//            "suppliers_id" => "vendor ID",
//            "suppliers_nama" => "vendor Nama",
            "oleh_id" => "oleh ID",
            "oleh_nama" => "oleh Nama",
            "jenis" => "jenis",
            "jenis_label" => "label",
            "nomer_top" => "nomer top",
            "nomer" => "nomer",
        );

        $tr = new MdlTransaksi();
        $tr->addFilter("transaksi.status_inv='0'");
        $tr->addFilter("transaksi.fulldate>='$batas_tanggal'");
        $tr->addFilter("transaksi.cabang_id>'0'");
        $this->db->limit(1);
        $this->db->order_by("transaksi.id", "ASC");
        $this->db->group_start();

        $where_1 = "transaksi.jenis='5822spd' and transaksi.pembayaran in ('credit','cod')";
        $this->db->group_start();
        $this->db->where($where_1);
        $this->db->group_end();

        $where_2 = "transaksi.jenis='4464'";
        $where_3 = "transaksi.jenis='7499'";// termin
        $this->db->or_where($where_2);
        $this->db->or_where($where_3);
        $this->db->group_end();

//        $sesionReplacer = replaceSession();
        $sesionReplacer = array(//            "cabang_id" => ">0",
        );
        $trTmp = $tmpHist = $tr->lookupRecentUndoneEntries_joined($sesionReplacer)->result();
//        arrPrint($trTmp);
        cekMerah($this->db->last_query());

        $items = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $trID = $trSpec->id;
                $jenisMaster = $trSpec->jenis_master;
                $items[$trID]['pID'] = $trID;
                $modul = isset($masterConfigUI[$jenisMaster]['modul']) ? $masterConfigUI[$jenisMaster]['modul'] : NULL;
                foreach ($headerFields as $key => $val) {
                    $items[$trID][$key] = isset($trSpec->$key) ? $trSpec->$key : null;
                }

                $dtimeNow = dtimeNow();
                $dtime_waiting = timeDiff($trSpec->dtime, $dtimeNow);
                $dtime_umur = umurHour($trSpec->dtime, "H:i");
                $items[$trID]['dtime_now'] = $dtimeNow;
                $items[$trID]['dtime_waiting'] = $dtime_waiting . " (s)<br>" . $dtime_umur . " (jam:menit)";
                $items[$trID]['cek'] = "<a target='_blank' href=\"" . base_url() . "CliTransaksi/run_cliTransaksi/?&tr_id=$trID\"><button class='btn btn-danger'>CEK</button></a>";
                $items[$trID]['jenisTr_master'] = $jenisMaster;
                $items[$trID]['modul'] = $modul;
                $items[$trID]['modul_path'] = base_url() . "$modul/";
            }
        }

//        $headerFields['cek'] = "cek<br>manual";
        $data = array(
            "mode" => "index",
            "title" => "CLI INVOICE ( " . sizeof($trTmp) . " ) " . dtimeNow('ymd H:i:s'),
            "subTitle" => "daftar cli invoice yang menunggu dieksekusi ya bro...",
            "headerFields" => isset($headerFields) ? $headerFields : array(),
            "items" => isset($items) ? $items : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
        );

        $this->load->view("tool", $data);


    }

    function viewCheckerTransaksi()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = -1;


        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlCabang");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }

        $trIDs = array();
        $TransData = array();
        $headerFields = array(
            "jenis" => "jenis",
            "jenis_label" => "label",
            //            "transaksi_nilai" => "nilai",
            //            "jml" => "jumlah",
        );

        $c = new MdlTransaksi();
        $c->addFilter("cabang_id='$branchID'");
        if (!isset($_GET['date1']) && !isset($_GET['date2'])) {
            $limit = 20;
            $this->db->limit("$limit");
            $this->db->order_by("id", "ASC");

            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $subTitle_date = " <span style='font-size:12px;font-style:italic;'>(cli $limit terakhir)</span>";
        }
        else {
            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $this->db->where("date(dtime)>='" . $date1 . "'");
            $this->db->where("date(dtime)<='" . $date2 . "'");
            $this->db->order_by("id", "ASC");
            $subTitle_date = lgTranslateTime($date1) . " - " . lgTranslateTime($date2);
        }
        $tmp = $c->lookupAll()->result();
        //cekHere($this->db->last_query());
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $trIDs[] = $row->id;
                foreach ($headerFields as $key => $val) {

                    $TransData[$row->jenis][$key] = $row->$key;
                }
                if (!isset($TransData[$row->jenis]['transaksi_nilai'])) {
                    $TransData[$row->jenis]['transaksi_nilai'] = 0;
                }
                $TransData[$row->jenis]['transaksi_nilai'] += $row->transaksi_nilai;

                if (!isset($TransData[$row->jenis]['jumlah'])) {
                    $TransData[$row->jenis]['jumlah'] = 0;
                }
                $TransData[$row->jenis]['jumlah'] += 1;
            }
        }


        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }


        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        $headerFields['transaksi_nilai'] = "nilai";
        $headerFields['jumlah'] = "jumlah";
        if (sizeof($TransData) > 0) {
            $arrTrName = arrCodeAliasing($branchID);
            foreach ($TransData as $trJenis => $spec) {
                foreach ($headerFields as $key => $val) {
                    $subItems[$key] = $spec[$key];
                }
                $items[] = $subItems;
            }
        }

        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/?";
        $addSubTitle = "(" . sizeof($tmp) . " transaksi)";
        $data = array(
            "mode" => "indexDate",
            "title" => "TRANSAKSI ($branchID)",
            "subTitle" => "$subTitle_date  $addSubTitle",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,

            "thisPage" => $thisPage,
            "q" => isset($q) ? $q : "",
            "filters" => array(
                "date1" => $date1,
                "date2" => $date2,
                "dates" => date("Y-m-d"),
            ),
        );

        $this->load->view("tool", $data);
    }

    function viewCheckerSumTransaksi()
    {
        //        header("refresh:60");

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : NULL;
        $whID = -1;

        $arrMenu = $this->config->item("heTransaksi_ui");
        $arrMenuStepAlias = array();
        foreach ($arrMenu as $mSpec) {
            //            arrPrintWebs($mSpec);
            foreach ($mSpec['steps'] as $sSpec) {
                $arrMenuStepAlias[$sSpec['target']] = $sSpec['label'];
            }
        }
        //        arrPrintWebs($arrMenuStepAlias);

        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlCabang");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }

        $trIDs = array();
        $TransData = array();
        $headerFields = array(
            "jenis" => "jenis",
            "jenis_label" => "label",
            //            "transaksi_nilai" => "nilai",
            //            "jml" => "jumlah",
        );

        $c = new MdlTransaksi();
        if ($branchID != NULL) {
            $c->addFilter("cabang_id='$branchID'");
        }
        if (!isset($_GET['date1']) && !isset($_GET['date2'])) {
            $limit = 20;
            $this->db->limit("$limit");
            $this->db->order_by("id", "DESC");

            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $subTitle_date = " <span style='font-size:12px;font-style:italic;'>(cli $limit terakhir)</span>";
        }
        else {
            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $this->db->where("date(dtime)>='" . $date1 . "'");
            $this->db->where("date(dtime)<='" . $date2 . "'");
            $this->db->order_by("id", "DESC");
            $subTitle_date = lgTranslateTime($date1) . " - " . lgTranslateTime($date2);
        }
        $tmp = $c->lookupAll()->result();
        //cekHere($this->db->last_query());
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                //                arrPrint($row);
                $trIDs[] = $row->id;
                foreach ($headerFields as $key => $val) {

                    $TransData[$row->jenis][$key] = $row->$key;
                }
                if (!isset($TransData[$row->jenis]['transaksi_nilai'])) {
                    $TransData[$row->jenis]['transaksi_nilai'] = 0;
                }
                $TransData[$row->jenis]['transaksi_nilai'] += $row->transaksi_nilai;

                if (!isset($TransData[$row->jenis]['jumlah'])) {
                    $TransData[$row->jenis]['jumlah'] = 0;
                }
                $TransData[$row->jenis]['jumlah'] += 1;
            }
        }
        //        arrPrint($TransData);

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }


        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        $headerFields['transaksi_nilai'] = "nilai";
        $headerFields['jumlah'] = "jumlah";
        if (sizeof($TransData) > 0) {
            //            $arrTrName = arrCodeAliasing($branchID);
            foreach ($TransData as $trJenis => $spec) {
                foreach ($headerFields as $key => $val) {
                    $subItems[$key] = $spec[$key];

                    if ($key == "jenis_label") {
                        $subItems[$key] = $arrMenuStepAlias[$trJenis];
                    }
                }
                $items[] = $subItems;
            }
        }

        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/?";
        $addSubTitle = "(" . sizeof($tmp) . " transaksi)";
        $data = array(
            "mode" => "indexDate",
            "title" => "TRANSAKSI $addSubTitle",
            "subTitle" => "$subTitle_date  $addSubTitle",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,

            "thisPage" => $thisPage,
            "q" => isset($q) ? $q : "",
            "filters" => array(
                "date1" => $date1,
                "date2" => $date2,
                "dates" => date("Y-m-d"),
            ),
        );

        $this->load->view("tool", $data);
    }

    function viewTransaksi()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = -1;
        $date1 = date("Y-m-d");
        $date2 = 0;


        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlCabang");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }

        $trIDs = array();
        $TransData = array();

        $c = new MdlTransaksi();
        //        $c->addFilter("cabang_id='$branchID'");
        //        $c->addFilter("date(dtime)='$date1'");
        if (!isset($_GET['date1']) && !isset($_GET['date2'])) {
            $limit = 20;
            $this->db->limit("$limit");
            $this->db->order_by("id", "DESC");

            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $subTitle_date = " <span style='font-size:12px;font-style:italic;'>(cli $limit terakhir)</span>";
        }
        else {
            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $this->db->where("date(dtime)>='" . $date1 . "'");
            $this->db->where("date(dtime)<='" . $date2 . "'");
            $this->db->order_by("id", "DESC");
            $subTitle_date = lgTranslateTime($date1) . " - " . lgTranslateTime($date2);
        }
        $tmp = $c->lookupAll()->result();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $trIDs[] = $row->id;
                $TransData[] = $row;
            }
        }


        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "dtime" => "dtime",
            "id_master" => "master id",
            "jenis_master" => "jenis master",
            "jenis" => "jenis",
            "jenis_label" => "label",
            "cabang_id" => "cabang id",
            "cabang_nama" => "cabang nama",
            "nomer_top" => "nomer top",
            "nomer" => "transaksi",
            "oleh_id" => "oleh id",
            "oleh_nama" => "oleh nama",
            "suppliers_id" => "vendor id",
            "suppliers_nama" => "vendor nama",
            "customers_id" => "customer id",
            "customers_nama" => "customer nama",
            "transaksi_nilai" => "nilai",
            "cli" => "cli",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($TransData) > 0) {
            $arrTrName = arrCodeAliasing($branchID);
            foreach ($TransData as $trSpec) {

                $subItems['pID'] = $trSpec->id;
                foreach ($headerFields as $key => $val) {
                    $subItems[$key] = isset($trSpec->$key) ? $trSpec->$key : "";
                    if ($key == "cabang_id") {
                        $subItems["cabang_nama"] = isset($arrCabangs[$key]) ? $arrCabangs[$key] : "-";
                    }
                }
                $items[] = $subItems;
            }

        }

        $warning = array();
        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/?";
        $addSubTitle = "( " . sizeof($TransData) . " transaksi )";
        $data = array(
            "mode" => "indexDate",
            "title" => "DAFTAR TRANSAKSI",
            "subTitle" => "$addSubTitle",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => $thisPage,
            //            "q" => isset($q) ? $q : "",

            "filters" => array(
                "date1" => $date1,
                "date2" => $date2,
                "dates" => date("Y-m-d"),
            ),
        );

        $this->load->view("tool", $data);
    }

    function viewCliTransaksiTime()
    {

        $this->load->model("Mdls/MdlCliLogTime");
        $this->load->model("MdlTransaksi");

        $headerFields = array(
            "judul" => "judul",
            "waktu_start" => "start",
            "waktu_stop" => "stop",
            "waktu" => "time (s)",
            "transaksi_id" => "trID",
            "nomer" => "nomer",
        );


        $lc = New MdlCliLogTime();
        if (!isset($_GET['date1']) && !isset($_GET['date2'])) {
            $limit = 20;
            $this->db->limit("$limit");
            $this->db->order_by("id", "DESC");

            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $subTitle_date = " <span style='font-size:12px;font-style:italic;'>(cli $limit terakhir)</span>";
        }
        else {
            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $this->db->where("date(dtime)>='" . $date1 . "'");
            $this->db->where("date(dtime)<='" . $date2 . "'");
            $this->db->order_by("id", "DESC");
            $subTitle_date = lgTranslateTime($date1) . " - " . lgTranslateTime($date2);
        }
        $lcTmp = $lc->lookupAll()->result();

        $items = array();
        $trIDs = array();
        $sumItems = array();
        if (sizeof($lcTmp) > 0) {
            foreach ($lcTmp as $spec) {
                $trIDs[] = $spec->transaksi_id;
            }

            $tr = New MdlTransaksi();
            $tr->setTableName($tr->getTableNames()['detail']);
            $tr->setFilters(array());
            $tr->addFilter("trash='0'");
            $tr->addFilter("transaksi_id in ('" . implode("','", $trIDs) . "')");
            $trTmp = $tr->lookupAll()->result();
            if (sizeof($trTmp) > 0) {
                foreach ($trTmp as $spec) {
                    if (!isset($sumItems[$spec->transaksi_id])) {
                        $sumItems[$spec->transaksi_id] = 0;
                    }
                    $sumItems[$spec->transaksi_id] += 1;
                }
            }

            foreach ($lcTmp as $spec) {

                $subItems['items'] = isset($sumItems[$spec->transaksi_id]) ? $sumItems[$spec->transaksi_id] : 0;
                $subItems['pID'] = $spec->transaksi_id;
                foreach ($headerFields as $key => $val) {
                    $subItems[$key] = isset($spec->$key) ? $spec->$key : "-";
                }

                $items[] = $subItems;
            }
        }

        $warning = array();
        $headerFields['items'] = "items";
        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/?";
        $addSubTitle = "(" . sizeof($lcTmp) . " transaksi)";
        $data = array(
            "mode" => "indexDate",
            "title" => "DAFTAR WAKTU CLI TRANSAKSI",
            "subTitle" => "Waktu Cli start s/d stop $subTitle_date  $addSubTitle",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => $thisPage,
            "q" => isset($q) ? $q : "",

            "filters" => array(
                "date1" => $date1,
                "date2" => $date2,
                "dates" => date("Y-m-d"),
            ),
        );

        $this->load->view("tool", $data);
    }

    function viewUnsyncedProduk()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        //        $branchID = isset($this->session->login['cabang_id']) ? $this->session->login['cabang_id'] : "-1";
        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = ($_GET["w"] > 0) ? $_GET["w"] : getDefaultWarehouseID($branchID)['gudang_id'];
        if (isset($_GET['q']) && (strlen($_GET['q']) < 3)) {
            $q = $search = NULL;
        }
        elseif (isset($_GET['q']) && (strlen($_GET['q']) > 3)) {
            $q = $search = $_GET['q'];
        }
        else {
            $q = $search = NULL;
        }


        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("Mdls/MdlLockerStock");
        $this->load->model("Mdls/MdlLockerStockCache");
        $this->load->model("Mdls/MdlFifoProdukJadi");
        $this->load->model("Mdls/MdlFifoProdukJadiRakitan");
        $this->load->model("Mdls/MdlFifoAverage");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlProduk2");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $productsData = array();
        $products = array();
        $products_rakitan = array();
        $ids = array();
        $ffStocks = array();
        $pIDs = array();

        $pd = New MdlProduk2();
        $pd->setFilters(array());
//        $pd->addFilter("jenis in ('item','item_rakitan')");
        if (strlen($search) > 3) {
            if ($search != "semua") {
                $pdTmp = $pd->lookupByKeyword($search)->result();
            }
            else {
                $pdTmp = $pd->lookupAll()->result();
            }
        }
        else {
            $pdTmp = $pd->lookupAll()->result();
        }
        showLast_query("biru");
        if (sizeof($pdTmp) > 0) {
            foreach ($pdTmp as $pdSpec) {
                $productsData[$pdSpec->id] = array(
                    "nama" => strtolower($pdSpec->nama),
                    "kode" => $pdSpec->kode,
                    "kategori" => $pdSpec->folders_nama,
                );
                $pIDs[$pdSpec->id] = $pdSpec->id;
            }
            //            asort($productsData);
        }


        $c = new ComRekeningPembantuProduk();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("gudang_id='$whID'");
        if (sizeof($pIDs) > 0) {
            $c->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        }
        $tmp = $c->fetchBalances("1010030030");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                    "debet" => $row->debet,
                );
                $ids[] = $row->extern_id;

            }
        }

        $c = new ComRekeningPembantuProduk();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("gudang_id='$whID'");
        if (sizeof($pIDs) > 0) {
            $c->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        }
        $tmp = $c->fetchBalances("1010030070");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products_rakitan[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                    "debet" => $row->debet,
                );
            }
        }
        //arrprint($products_rakitan);

        $l = new MdlLockerStock();
        $l->setFilters(array());
        $l->addFilter("jenis='produk'");
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("gudang_id='$whID'");
        $lStocks = $l->fetchStates2($branchID, $whID, $ids);
        //        arrprint($lStocks);

        $l = new MdlLockerStock();
        $l->setFilters(array());
        $l->addFilter("jenis='produk rakitan'");
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("gudang_id='$whID'");
        $lStocksRakitan = $l->fetchStates2($branchID, $whID, $ids);
        //        showLast_query("kuning");
        //arrPrintWebs($lStocksRakitan);

//        $lsc = new MdlLockerStockCache();
//        $lsc->addFilter("cabang_id='$branchID'");
//        $lsc->addFilter("gudang_id='$whID'");
//        if (sizeof($pIDs) > 0) {
//            $lsc->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
//        }
//        $tmp = $lsc->lookupAll()->result();
        $productsLockerCache = array();
//        if (sizeof($tmp) > 0) {
//            foreach ($tmp as $row) {
//                $productsLockerCache[$row->extern_id] = array(
//                    "name" => $row->extern_nama,
//                    "stock" => $row->qty_debet,
//                );
//            }
//        }


        $fa = new MdlFifoAverage();
        $fa->addFilter("cabang_id='$branchID'");
        $fa->addFilter("gudang_id='$whID'");
        $fa->addFilter("jenis='produk'");
        if (sizeof($pIDs) > 0) {
            $fa->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
        }
        $faStocks = $fa->lookupAllQty()->result();
        $arrHppAvg = array();
        if (sizeof($faStocks) > 0) {
            foreach ($faStocks as $faSpec) {
                $arrHppAvg[$faSpec->produk_id] = array(
                    "hpp_total" => $faSpec->jml_nilai,
                    "hpp" => $faSpec->hpp,
                    "qty" => $faSpec->jml,
                );
            }
        }


//        $ff = new MdlFifoProdukJadi();
//        $ff->addFilter("cabang_id='$branchID'");
//        $ff->addFilter("gudang_id='$whID'");
//        if (sizeof($pIDs) > 0) {
//            $fa->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
//        }
//        $ffTmp = $ff->lookupAll()->result();
        $ffStocks = array();
//        if (sizeof($ffTmp) > 0) {
//            foreach ($ffTmp as $faSpec) {
//                //                $ffStocks[$faSpec->produk_id] = array(
//                //                    "hpp" => $faSpec->hpp,
//                //                    "qty" => $faSpec->unit,
//                //                );
//                if (!isset($ffStocks[$faSpec->produk_id]['hpp'])) {
//                    $ffStocks[$faSpec->produk_id]['hpp'] = 0;
//                }
//                if (!isset($ffStocks[$faSpec->produk_id]['qty'])) {
//                    $ffStocks[$faSpec->produk_id]['qty'] = 0;
//                }
//                if (!isset($ffStocks[$faSpec->produk_id]['subhpp'])) {
//                    $ffStocks[$faSpec->produk_id]['subhpp'] = 0;
//                }
//                if (!isset($ffStocks[$faSpec->produk_id]['jml_nilai'])) {
//                    $ffStocks[$faSpec->produk_id]['jml_nilai'] = 0;
//                }
//                $ffStocks[$faSpec->produk_id]['jml_nilai'] += $faSpec->jml_nilai;
//                $ffStocks[$faSpec->produk_id]['subhpp'] += ($faSpec->hpp * $faSpec->unit);
//                $ffStocks[$faSpec->produk_id]['hpp'] = $faSpec->hpp;
//                $ffStocks[$faSpec->produk_id]['qty'] += $faSpec->unit;
//            }
//        }

//        $ff = new MdlFifoProdukJadiRakitan();
//        $ff->addFilter("cabang_id='$branchID'");
//        $ff->addFilter("gudang_id='$whID'");
//        if (sizeof($pIDs) > 0) {
//            $fa->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
//        }
//        $ffTmp = $ff->lookupAll()->result();
        $ffStocksRakitan = array();
//        if (sizeof($ffTmp) > 0) {
//            foreach ($ffTmp as $faSpec) {
//
//                if (!isset($ffStocksRakitan[$faSpec->produk_id]['hpp'])) {
//                    $ffStocksRakitan[$faSpec->produk_id]['hpp'] = 0;
//                }
//                if (!isset($ffStocksRakitan[$faSpec->produk_id]['qty'])) {
//                    $ffStocksRakitan[$faSpec->produk_id]['qty'] = 0;
//                }
//                $ffStocksRakitan[$faSpec->produk_id]['hpp'] = $faSpec->hpp;
//                $ffStocksRakitan[$faSpec->produk_id]['qty'] += $faSpec->unit;
//            }
//        }
        //-------------------------------------

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "kode" => "code",
            "pName" => "product",
            "kategori" => "kategory",
//            "fifo" => "fifo",
//            "fifo_rakitan" => "fifo<br>rakitan",
            "avg" => "fifo avg",
            "debet" => "rek debet",
//            "debet_rakitan" => "rek debet<br>rakitan",
            "active" => "locker<br>active",
//            "active_rakitan" => "locker<br>active rkt",
            "hold" => "locker<br>hold",
            "holdTrID" => "locker<br>hold trID",
            //            "sold" => "locker<br>sold",
            //            "moved" => "locker<br>moved",
            //            "deactivate" => "locker<br>deactivate",
            //            "distribute" => "locker<br>distribute",
            //            "returned" => "locker<br>returned",
            "totalLocker" => "total<br>locker",
            "totalLockerCache" => "locker<br>cache",

            "debet_value" => "debet<br>value",
//            "fifo_value" => "fifo<br>jml nilai",
//            "fifo_kali" => "fifo<br>jml * hpp",
            "fifo_avg" => "fifo<br>jml * hpp",
            "selisih" => "selisih",
        );
        $nof = 0;
        $items = array();
        $itemsGeseh = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($productsData) > 0) {

            $this->db->trans_start();

            $nof = 0;
            foreach ($productsData as $pID => $spec) {
                $pName = $spec['nama'];
                $kode = $spec['kode'];
                $kategori = $spec['kategori'];
                $pSpec = isset($products[$pID]) ? $products[$pID] : array();
                $pSpec_rakitan = isset($products_rakitan[$pID]) ? $products_rakitan[$pID] : array();


                $jmlActive = isset($lStocks[$pID]['active']) ? $lStocks[$pID]['active'] : 0;
                $jmlHold = isset($lStocks[$pID]['hold']) ? $lStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($lStocks[$pID]['hold_trID']) ? $lStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($lStocks[$pID]['sold']) ? $lStocks[$pID]['sold'] : 0;

                $jmlActiveRakitan = isset($lStocksRakitan[$pID]['active']) ? $lStocksRakitan[$pID]['active'] : 0;

                $jmlFifoRakitan = isset($ffStocksRakitan[$pID]['qty']) ? $ffStocksRakitan[$pID]['qty'] : 0;
                $jmlFifo = isset($ffStocks[$pID]['qty']) ? $ffStocks[$pID]['qty'] : 0;
                $jmlAvg = isset($arrHppAvg[$pID]['qty']) ? $arrHppAvg[$pID]['qty'] : 0;
                $jmlNilaiAvg = isset($arrHppAvg[$pID]['hpp_total']) ? $arrHppAvg[$pID]['hpp_total'] : 0;

                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                $jmlRekRakitan = isset($pSpec_rakitan['stock']) ? $pSpec_rakitan['stock'] : 0;

                $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);

                $selisih = $jmlRek - $jmlFifo;
                $jmlLockerStockCache = isset($productsLockerCache[$pID]['stock']) ? $productsLockerCache[$pID]['stock'] : 0;
                //---------------
                $subhpp = isset($ffStocks[$pID]['subhpp']) ? $ffStocks[$pID]['subhpp'] : 0;
                $debet_value = isset($products[$pID]['debet']) ? $products[$pID]['debet'] : 0;
                $fifo_jml_nilai = isset($ffStocks[$pID]['jml_nilai']) ? $ffStocks[$pID]['jml_nilai'] : 0;
                //---------------


                $bg_color = "";
                $add = "";
                if ($jmlFifo != $jmlRek) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }
                if ($jmlAvg < 0) {
                    $bg_color = "background-color:pink;";
                }


                $markingColumn[$pID] = array(
                    "debet" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "active" => array(
                        "background-color" => "#7BFFF9",
                    ),
                    "hold" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "holdTrID" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "totalLocker" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );
                $selisih = $debet_value - $jmlNilaiAvg;
                $selisih = ($selisih < 0) ? ($selisih * -1) : $selisih;
                if ($selisih > 5) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                    $itemsGeseh[] = array(
                        "pID" => $pID,
                        "kode" => $kode,
                        "pName" => $pName,
                        "kategori" => $kategori,
                        "fifo" => $jmlFifo,
                        "fifo_rakitan" => $jmlFifoRakitan,
                        "avg" => $jmlAvg,
                        "debet" => $jmlRek,
                        "debet_rakitan" => $jmlRekRakitan,
                        "active" => $jmlActive,
                        "active_rakitan" => $jmlActiveRakitan,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,

                        "totalLocker" => $jmlLoker,
                        "totalLockerCache" => $jmlLockerStockCache,

                        "debet_value" => $debet_value,
//                        "fifo_value" => $fifo_jml_nilai,
//                        "fifo_kali" => $subhpp,
                        "fifo_avg" => $jmlNilaiAvg,
                        "selisih" => $selisih,
                    );
                    if ($_GET["exe"] == 1) {
                        // inject fifo average
                        $xx = new MdlFifoAverage();
                        $xx->updateData(
                            array(
                                "cabang_id" => $branchID,
                                "gudang_id" => $whID,
                                "produk_id" => $pID,
                            ),
                            array(
                                "jml" => $jmlRek,
                                "hpp" => ($jmlRek > 0) ? ($debet_value / $jmlRek) : 0,
                                "jml_nilai" => $debet_value,
//                                "jml_nilai" => $arrHppAvg[$pID]['hpp'] * $jmlRek,
                            )
                        );
                        cekOrange($this->db->last_query());
                    }
                }
                elseif ($jmlRek != $jmlAvg) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                    $itemsGeseh[] = array(
                        "pID" => $pID,
                        "kode" => $kode,
                        "pName" => $pName,
                        "kategori" => $kategori,
                        "fifo" => $jmlFifo,
                        "fifo_rakitan" => $jmlFifoRakitan,
                        "avg" => $jmlAvg,
                        "debet" => $jmlRek,
                        "debet_rakitan" => $jmlRekRakitan,
                        "active" => $jmlActive,
                        "active_rakitan" => $jmlActiveRakitan,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,

                        "totalLocker" => $jmlLoker,
                        "totalLockerCache" => $jmlLockerStockCache,

                        "debet_value" => $debet_value,
                        "fifo_value" => $fifo_jml_nilai,
                        "fifo_kali" => $subhpp,
                    );
                    if ($_GET["exe"] == 1) {
                        // inject fifo average
                        $xx = new MdlFifoAverage();
                        $xx->updateData(
                            array(
                                "cabang_id" => $branchID,
                                "gudang_id" => $whID,
                                "produk_id" => $pID,
                            ),
                            array(
                                "jml" => $jmlRek,
                                "hpp" => ($jmlRek > 0) ? ($debet_value / $jmlRek) : 0,
                                "jml_nilai" => $debet_value,
                            )
                        );
                        cekUngu($this->db->last_query());
                    }
                }
                elseif ($jmlRek != $jmlLoker) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                    $itemsGeseh[] = array(
                        "pID" => $pID,
                        "kode" => $kode,
                        "pName" => $pName,
                        "kategori" => $kategori,
                        "fifo" => $jmlFifo,
                        "fifo_rakitan" => $jmlFifoRakitan,
                        "avg" => $jmlAvg,
                        "debet" => $jmlRek,
                        "debet_rakitan" => $jmlRekRakitan,
                        "active" => $jmlActive,
                        "active_rakitan" => $jmlActiveRakitan,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,

                        "totalLocker" => $jmlLoker,
                        "totalLockerCache" => $jmlLockerStockCache,

                        "debet_value" => $debet_value,
                        "fifo_value" => $fifo_jml_nilai,
                        "fifo_kali" => $subhpp,
                    );
                }

                else {
                    $marking[$pID] = array();
                    $items[] = array(
                        "pID" => $pID,
                        "kode" => $kode,
                        "pName" => $pName,
                        "kategori" => $kategori,
                        "fifo" => $jmlFifo,
                        "fifo_rakitan" => $jmlFifoRakitan,
                        "avg" => $jmlAvg,
                        "debet" => $jmlRek,
                        "debet_rakitan" => $jmlRekRakitan,
                        "active" => $jmlActive,
                        "active_rakitan" => $jmlActiveRakitan,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,

                        "totalLocker" => $jmlLoker,
                        "totalLockerCache" => $jmlLockerStockCache,

                        "debet_value" => $debet_value,
//                        "fifo_value" => $fifo_jml_nilai,
//                        "fifo_kali" => $subhpp,
                        "fifo_avg" => $jmlNilaiAvg,
                        "selisih" => $selisih,
                    );
                }
            }


            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        }


        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/" . $this->uri->segment(3) . "/?";
        $warning = array();
        $data = array(
            "mode" => "stock",
            "title" => "PRODUCT BRANCH ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "itemsGeseh" => isset($itemsGeseh) ? $itemsGeseh : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
            "thisPage" => $thisPage,
            "q" => "$q",
        );

        $this->load->view("tool", $data);
    }

    function viewUnsyncedSupplies()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        //        $branchID = isset($this->session->login['cabang_id']) ? $this->session->login['cabang_id'] : "-1";
        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = isset($_GET["w"]) ? $_GET["w"] : getDefaultWarehouseID($branchID)['gudang_id'];
        if (isset($_GET['q']) && (strlen($_GET['q']) < 3)) {
            $q = $search = NULL;
        }
        elseif (isset($_GET['q']) && (strlen($_GET['q']) > 3)) {
            $q = $search = $_GET['q'];
        }
        else {
            $q = $search = NULL;
        }


        $this->load->model("Coms/ComRekeningPembantuSupplies");
        $this->load->model("Mdls/MdlLockerStockSupplies");
        $this->load->model("Mdls/MdlLockerStockSuppliesCache");
        $this->load->model("Mdls/MdlFifoSupplies");
        $this->load->model("Mdls/MdlFifoAverage");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlSupplies");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }

        $productsData = array();
        $products = array();
        $ids = array();
        $ffStocks = array();
        $pIDs = array();
        //        $rekStocks = array();

        $pd = New MdlSupplies();
        $pd->setFilters(array());
        $pd->addFilter("jenis='supplies'");
        if (strlen($search) > 3) {
            if ($search != "semua") {
                $pdTmp = $pd->lookupByKeyword($search)->result();
            }
            else {
                $pdTmp = $pd->lookupAll()->result();
            }
        }
        else {
            $pdTmp = $pd->lookupAll()->result();
        }
        if (sizeof($pdTmp) > 0) {
            foreach ($pdTmp as $pdSpec) {
                $productsData[$pdSpec->id] = array(
                    "nama" => strtolower($pdSpec->nama),
                    "kode" => $pdSpec->kode,
                    "kategori" => $pdSpec->folders_nama,
                );
                $pIDs[$pdSpec->id] = $pdSpec->id;
            }
            //            asort($productsData);
        }


        $c = new ComRekeningPembantuSupplies();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("gudang_id='$whID'");
        if (sizeof($pIDs) > 0) {
            $c->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        }
        $tmp = $c->fetchBalances("1010030010");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                    "debet" => $row->debet,
                );
                $ids[] = $row->extern_id;
                //                $rekStocks[$row->extern_id] = $row->qty_debet;


            }
        }

        $l = new MdlLockerStockSupplies();
//        $l->addFilter("produk_id='23980'");
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("gudang_id='$whID'");
//        $l->addFilter("biaya_id is null");
//        $lStocks = $l->fetchStates2($branchID, $whID, $ids, 0);
        $tmp = $l->lookupAll()->result();
//        cekHitam($this->db->last_query());
//        arrPrint($tmp);
        $lStocks = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $pID = $row->produk_id;
                $byID = $row->biaya_id;
                $state = $row->state;
                switch ($state) {
                    case "active":
                        if ($byID != NULL) {

                        }
                        else {
                            if (!isset($lStocks[$pID][$state])) {
                                $lStocks[$pID][$state] = 0;
                            }
                            $lStocks[$pID][$state] += $row->jumlah;
                        }
                        break;
                    case "hold":
                        if ($row->transaksi_id > 0) {
                            if (!isset($lStocks[$pID][$state . "_trID"])) {
                                $lStocks[$pID][$state . "_trID"] = 0;
                            }
                            $lStocks[$pID][$state . "_trID"] += $row->jumlah;
                        }
                        else {
                            if (!isset($lStocks[$pID][$state])) {
                                $lStocks[$pID][$state] = 0;
                            }
                            $lStocks[$pID][$state] += $row->jumlah;
                        }
                        break;
                }
//                if ($row->transaksi_id > 0) {
//                    if (!isset($lStocks[$pID][$row->state . "_trID"])) {
//                        $lStocks[$pID][$row->state . "_trID"] = 0;
//                    }
//                    $lStocks[$pID][$row->state . "_trID"] += $row->jumlah;
//                }
//                else {
//                    if (!isset($lStocks[$pID][$row->state])) {
//                        $lStocks[$pID][$row->state] = 0;
//                    }
//                    $lStocks[$pID][$row->state] += $row->jumlah;
//                }
            }
        }
//        arrPrint($lStocks[23980]);

        $lsc = new MdlLockerStockSuppliesCache();
        $lsc->addFilter("cabang_id='$branchID'");
        $lsc->addFilter("gudang_id='$whID'");
        if (sizeof($pIDs) > 0) {
            $lsc->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        }
        $tmp = $lsc->lookupAll()->result();
        $productsLockerCache = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $productsLockerCache[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                );
            }
        }


        $fa = new MdlFifoAverage();
        $fa->addFilter("cabang_id='$branchID'");
        $fa->addFilter("gudang_id='$whID'");
        $fa->addFilter("jenis='supplies'");
        if (sizeof($pIDs) > 0) {
            $fa->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
        }
        $faStocks = $fa->lookupAllQty()->result();
        $arrHppAvg = array();
        if (sizeof($faStocks) > 0) {
            foreach ($faStocks as $faSpec) {
                $arrHppAvg[$faSpec->produk_id] = array(
                    "hpp" => $faSpec->hpp,
                    "qty" => $faSpec->jml,
                    "nilai" => $faSpec->jml_nilai,
                );
            }
        }

//        $ff = new MdlFifoSupplies();
//        $ff->addFilter("cabang_id='$branchID'");
//        $ff->addFilter("gudang_id='$whID'");
//        if (sizeof($pIDs) > 0) {
//            $ff->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
//        }
//        $ffTmp = $ff->lookupAll()->result();
//        $ffStocks = array();
//        if (sizeof($ffTmp) > 0) {
//            foreach ($ffTmp as $ffSpec) {
//                if (!isset($ffStocks[$ffSpec->produk_id])) {
//                    $ffStocks[$ffSpec->produk_id] = 0;
//                }
//                $ffStocks[$ffSpec->produk_id] += $ffSpec->unit;
//            }
//        }
        //arrprint($ffStocks);

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
//            "fifo" => "fifo",
            "avg" => "fifo<br>avg",
            "avg_hpp" => "fifo<br>avg hpp",
            "avg_subhpp" => "fifo<br>avg (idr)",
            "debet" => "rek<br>debet",
            "debet_avg" => "rek<br>debet (avg)",
            "debet_value" => "rek<br>debet (idr)",
            "active" => "locker<br>active",
            "hold" => "locker<br>hold",
            "holdTrID" => "locker<br>hold trID",
            "totalLocker" => "total<br>locker",
            "totalLockerCache" => "locker<br>cache",
        );
        $nof = 0;
        $items = array();
        $itemsGeseh = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($productsData) > 0) {

            $this->db->trans_start();

            $nof = 0;
            foreach ($productsData as $pID => $spec) {
                $pName = $spec['nama'];
                $kode = $spec['kode'];
                $kategori = $spec['kategori'];
                $pSpec = isset($products[$pID]) ? $products[$pID] : array();


                $jmlActive = isset($lStocks[$pID]['active']) ? $lStocks[$pID]['active'] : 0;
                $jmlHold = isset($lStocks[$pID]['hold']) ? $lStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($lStocks[$pID]['hold_trID']) ? $lStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($lStocks[$pID]['sold']) ? $lStocks[$pID]['sold'] : 0;

                $jmlFifo = isset($ffStocks[$pID]) ? $ffStocks[$pID] : 0;
                $jmlAvg = isset($arrHppAvg[$pID]['qty']) ? $arrHppAvg[$pID]['qty'] : 0;
                $jmlAvgNilai = isset($arrHppAvg[$pID]['nilai']) ? $arrHppAvg[$pID]['nilai'] : 0;
                $jmlAvgAvg = isset($arrHppAvg[$pID]['hpp']) ? $arrHppAvg[$pID]['hpp'] : 0;

                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                $jmlRekNilai = isset($pSpec['debet']) ? $pSpec['debet'] : 0;
                $jmlRekNilaiAvg = ($jmlRek>0) ? ($jmlRekNilai/$jmlRek) : 0;

                $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);

                $selisih = $jmlRek - $jmlFifo;
                $jmlLockerStockCache = isset($productsLockerCache[$pID]['stock']) ? $productsLockerCache[$pID]['stock'] : 0;

                $bg_color = "";
                $add = "";
                if ($jmlAvg != $jmlRek) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }

                $markingColumn[$pID] = array(
                    "debet" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "debet_value" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "debet_avg" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "active" => array(
                        "background-color" => "#7BFFF9",
                    ),
                    "hold" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "holdTrID" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "totalLocker" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );

                if ($jmlRek != $jmlLoker) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );

                    $itemsGeseh[] = array(
                        "pID" => $pID,
                        "pName" => $pName,
                        "avg" => $jmlAvg,
                        "avg_hpp" => "$jmlAvgAvg",
                        "avg_subhpp" => "$jmlAvgNilai",
                        "debet" => $jmlRek,
                        "debet_avg" => $jmlRekNilaiAvg,
                        "debet_value" => $jmlRekNilai,
                        "active" => $jmlActive,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,
                        "totalLocker" => $jmlLoker,
                        "totalLockerCache" => $jmlLockerStockCache,
                    );

                    //hilangkan saja
                    $ll = new MdlLockerStockSupplies();
                    $ll->addFilter("state='active'");
                    $ll->addFilter("cabang_id=$branchID");
                    $ll->addFilter("gudang_id=$whID");
                    $ll->addFilter("produk_id=$pID");
                    $ll->addFilter("biaya_id is null");
                    $llTmp = $ll->lookupAll()->result();
                    if (sizeof($llTmp) > 0) {
                        $ll->updateData(
                            array(
                                "cabang_id" => "$branchID",
                                "gudang_id" => "$whID",
                                "produk_id" => "$pID",
                                "jenis" => "supplies",
                                "jenis_locker" => "stock",
                                "state" => "active",
                            ), array(
                                "jumlah" => "$jmlRek",
                            )
                        );
//                        cekHere($this->db->last_query()) . ";";
                    }
                    else {
                        $addData = array(
                            "cabang_id" => "$branchID",
                            "gudang_id" => "$whID",
                            "produk_id" => "$pID",
                            "nama" => "$pName",
                            "jenis" => "supplies",
                            "jenis_locker" => "stock",
                            "state" => "active",
                            "jumlah" => "$jmlRek",
                            "jenis" => "supplies",
                            "jenis_locker" => "stock",
                        );
                        $ll->addData($addData);
//                        cekHere($this->db->last_query()) . ";";
                    }

                    $warning[$nof] = array(
                        "update" => $update,
                        "insert" => $insert,
                    );
                }

                elseif ($jmlAvg != $jmlRek) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );

                    $itemsGeseh[] = array(
                        "pID" => $pID,
                        "pName" => $pName,
                        "avg" => "$jmlAvg",
                        "avg_hpp" => "$jmlAvgAvg",
                        "avg_subhpp" => "$jmlAvgNilai",
                        "debet" => $jmlRek,
                        "debet_avg" => $jmlRekNilaiAvg,
                        "debet_value" => $jmlRekNilai,
                        "active" => $jmlActive,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,
                        "totalLocker" => $jmlLoker,
                        "totalLockerCache" => $jmlLockerStockCache,
                    );
                }
                else {
                    $items[] = array(
                        "pID" => $pID,
                        "pName" => $pName,
                        "avg" => "$jmlAvg",
                        "avg_hpp" => "$jmlAvgAvg",
                        "avg_subhpp" => "$jmlAvgNilai",
                        "debet" => $jmlRek,
                        "debet_avg" => $jmlRekNilaiAvg,
                        "debet_value" => $jmlRekNilai,
                        "active" => $jmlActive,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,
                        "totalLocker" => $jmlLoker,
                        "totalLockerCache" => $jmlLockerStockCache,
                    );
                }
            }

//            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        }


        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/" . $this->uri->segment(3) . "/?";
        $warning = array();
        $data = array(
            "mode" => "stock",
            "title" => "SUPPLIES BRANCH ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "itemsGeseh" => isset($itemsGeseh) ? $itemsGeseh : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
            "thisPage" => $thisPage,
            "q" => "$q",
        );

        $this->load->view("tool", $data);

    }

    function viewUnsyncedSuppliesProses()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = getDefaultWarehouseID($branchID)['gudang_id'];
        if (isset($_GET['q']) && (strlen($_GET['q']) < 3)) {
            $q = $search = NULL;
        }
        elseif (isset($_GET['q']) && (strlen($_GET['q']) > 3)) {
            $q = $search = $_GET['q'];
        }
        else {
            $q = $search = NULL;
        }


        $this->load->model("Coms/ComRekeningPembantuSuppliesProses");
        $this->load->model("Mdls/MdlLockerStockSupplies");
        $this->load->model("Mdls/MdlLockerStockSuppliesProsesCache");
        $this->load->model("Mdls/MdlFifoSuppliesProses");
        $this->load->model("Mdls/MdlFifoAverageSupplies");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlSupplies");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }

        $productsData = array();
        $products = array();
        $ids = array();
        $ffStocks = array();
        $pIDs = array();
        //        $rekStocks = array();

        $pd = New MdlSupplies();
        $pd->setFilters(array());
        $pd->addFilter("jenis='item'");
        if (strlen($search) > 3) {
            if ($search != "semua") {
                $pdTmp = $pd->lookupByKeyword($search)->result();
            }
            else {
                $pdTmp = $pd->lookupAll()->result();
            }
        }
        else {
            $pdTmp = $pd->lookupAll()->result();
        }
        if (sizeof($pdTmp) > 0) {
            foreach ($pdTmp as $pdSpec) {
                $productsData[$pdSpec->id] = array(
                    "nama" => strtolower($pdSpec->nama),
                    "kode" => $pdSpec->kode,
                    "kategori" => $pdSpec->folders_nama,
                );
                $pIDs[$pdSpec->id] = $pdSpec->id;
            }
            //            asort($productsData);
        }


        $c = new ComRekeningPembantuSuppliesProses();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("gudang_id='$whID'");
        if (sizeof($pIDs) > 0) {
            $c->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        }
        $tmp = $c->fetchBalances("010308");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                );
                $ids[] = $row->extern_id;
                //                $rekStocks[$row->extern_id] = $row->qty_debet;


            }
        }

        $l = new MdlLockerStockSupplies();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("gudang_id='$whID'");
        $l->addFilter("jenis='supplies_proses'");
        //        if(sizeof($pIDs) > 0){
        //            $l->addFilter("produk_id in ('". implode("','", $pIDs) ."')");
        //        }
        $lStocks = $l->fetchStates2($branchID, $whID, $ids);
        //        showLast_query("merah");
        //        cekHere(sizeof($lStocks));

        $lsc = new MdlLockerStockSuppliesProsesCache();
        $lsc->addFilter("cabang_id='$branchID'");
        $lsc->addFilter("gudang_id='$whID'");
        if (sizeof($pIDs) > 0) {
            $lsc->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        }
        $tmp = $lsc->lookupAll()->result();
        $productsLockerCache = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $productsLockerCache[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                );
            }
        }


        $fa = new MdlFifoAverageSupplies();
        $fa->addFilter("cabang_id='$branchID'");
        $fa->addFilter("gudang_id='$whID'");
        $fa->addFilter("jenis='supplies_proses'");
        if (sizeof($pIDs) > 0) {
            $fa->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
        }
        $faStocks = $fa->lookupAllQty()->result();
        $arrHppAvg = array();
        if (sizeof($faStocks) > 0) {
            foreach ($faStocks as $faSpec) {
                $arrHppAvg[$faSpec->produk_id] = array(
                    "hpp" => $faSpec->hpp,
                    "qty" => $faSpec->jml,
                );
            }
        }

        $ff = new MdlFifoSuppliesProses();
        $ff->addFilter("cabang_id='$branchID'");
        $ff->addFilter("gudang_id='$whID'");
        if (sizeof($pIDs) > 0) {
            $ff->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
        }
        $ffTmp = $ff->lookupAll()->result();
        //        showLast_query("biru");
        $ffStocks = array();
        if (sizeof($ffTmp) > 0) {
            foreach ($ffTmp as $ffSpec) {
                if (!isset($ffStocks[$ffSpec->produk_id])) {
                    $ffStocks[$ffSpec->produk_id] = 0;
                }
                $ffStocks[$ffSpec->produk_id] += $ffSpec->unit;
            }
        }
        //arrprint($ffStocks);

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
            "fifo" => "fifo",
            "avg" => "fifo<br>avg",
            "debet" => "rek<br>debet",
            "active" => "locker<br>active",
            "hold" => "locker<br>hold",
            "holdTrID" => "locker<br>hold trID",
            //            "sold" => "locker sold",
            //            "moved" => "locker moved",
            //            "deactivate" => "locker deactivate",
            //            "distribute" => "locker distribute",
            //            "returned" => "locker returned",
            "totalLocker" => "total<br>locker",
            "totalLockerCache" => "locker<br>cache",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($productsData) > 0) {

            $this->db->trans_start();

            $nof = 0;
            foreach ($productsData as $pID => $spec) {
                $pName = $spec['nama'];
                $kode = $spec['kode'];
                $kategori = $spec['kategori'];
                $pSpec = isset($products[$pID]) ? $products[$pID] : array();


                $jmlActive = isset($lStocks[$pID]['active']) ? $lStocks[$pID]['active'] : 0;
                $jmlHold = isset($lStocks[$pID]['hold']) ? $lStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($lStocks[$pID]['hold_trID']) ? $lStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($lStocks[$pID]['sold']) ? $lStocks[$pID]['sold'] : 0;

                $jmlFifo = isset($ffStocks[$pID]) ? $ffStocks[$pID] : 0;
                $jmlAvg = isset($arrHppAvg[$pID]['qty']) ? $arrHppAvg[$pID]['qty'] : 0;

                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;

                $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);

                $selisih = $jmlRek - $jmlFifo;
                $jmlLockerStockCache = isset($productsLockerCache[$pID]['stock']) ? $productsLockerCache[$pID]['stock'] : 0;

                $bg_color = "";
                $add = "";
                if ($jmlFifo != $jmlRek) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }
                elseif ($jmlFifo != $jmlAvg) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }

                $items[] = array(
                    "pID" => $pID,
                    "pName" => $pName,
                    "fifo" => $jmlFifo,
                    "avg" => $jmlAvg,
                    "debet" => $jmlRek,
                    "active" => $jmlActive,
                    "hold" => $jmlHold,
                    "holdTrID" => $jmlHoldTrID,
                    //                    "sold" => $jmlSold,
                    //                    "moved" => "0",
                    //                    "deactivate" => "0",
                    //                    "distribute" => "0",
                    //                    "returned" => "0",
                    "totalLocker" => $jmlLoker,
                    "totalLockerCache" => $jmlLockerStockCache,
                );
                $markingColumn[$pID] = array(
                    "debet" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "active" => array(
                        "background-color" => "#7BFFF9",
                    ),
                    "hold" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "holdTrID" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "totalLocker" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );

                if ($jmlRek != $jmlLoker) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );

                    //hilangkan saja
                    $ll = new MdlLockerStockSupplies();
                    $ll->updateData(
                        array(
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,

                        ), array(
                            "produk_id" => 6666,
                            "jumlah" => 0,
                            "nama" => "unknown",
                            "state" => "dest",
                        )
                    );
                    $update = $this->db->last_query() . ";";

                    $ll = new MdlLockerStockSupplies();
                    $ll->addData(
                        array(
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,
                            "nama" => $pName,
                            "oleh_id" => 0,
                            "transaksi_id" => 0,
                            "state" => "active",
                            "jumlah" => $jmlRek,
                        )
                    );
                    $insert = $this->db->last_query() . ";";
                    $warning[$nof] = array(
                        "update" => $update,
                        "insert" => $insert,
                    );
                }
                elseif ($jmlFifo != $jmlAvg) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }
                elseif ($jmlFifo != $jmlRek) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }
                elseif ($jmlAvg != $jmlRek) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }
                else {

                }
            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        }


        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/" . $this->uri->segment(3) . "/?";
        $warning = array();
        $data = array(
            "mode" => "stock",
            "title" => "SUPPLIES DALAM PROSES BRANCH ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
            "thisPage" => $thisPage,
            "q" => "$q",
        );

        $this->load->view("tool", $data);

    }

    function viewUnsyncedKas()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuKas");
        $this->load->model("Mdls/MdlLockerValue");
        $this->load->model("Mdls/MdlCabang");


        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $ids = array();
        $ffStocks = array();


        $c = new ComRekeningPembantuKas();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("1010010010");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->debet,
                );
                $ids[] = $row->extern_id;
            }
        }

        $l = new MdlLockerValue();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("jenis='kas'");
        $l->addFilter("gudang_id='0'");
        $lStocks = $l->fetchStates2($branchID, 0, $ids);
        //showLast_query("biru");

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
            //            "fifo" => "fifo",
            //            "avg" => "fifo avg",
            "debet" => "rek debet",
            "active" => "locker active",
            "hold" => "locker hold",
            "holdTrID" => "locker hold trID",
            "totalLocker" => "total locker",
            "selisih" => "selisih",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            $this->db->trans_start();

            foreach ($products as $pID => $pSpec) {

                $jmlActive = isset($lStocks[$pID]['active']) ? $lStocks[$pID]['active'] : 0;
                $jmlHold = isset($lStocks[$pID]['hold']) ? $lStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($lStocks[$pID]['hold_trID']) ? $lStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($lStocks[$pID]['sold']) ? $lStocks[$pID]['sold'] : 0;

                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);

                $jmlActive_new = $pSpec['stock'] - $jmlHold - $jmlHoldTrID;
                $selisih = $jmlRek - ($jmlActive + $jmlHoldTrID);

                $items[] = array(
                    "pID" => $pID,
                    "pName" => $pSpec['name'],
                    "fifoReal" => 0,
                    "fifoAvg" => 0,
                    "debet" => $pSpec['stock'],
                    "active" => $jmlActive,
                    "hold" => $jmlHold,
                    "holdTrID" => $jmlHoldTrID,
                    "sold" => $jmlSold,
                    "selisih" => $selisih,
                    "totalLocker" => $jmlLoker,
                );
                $markingColumn[$pID] = array(
                    "debet" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "active" => array(
                        "background-color" => "#7BFFF9",
                    ),
                    "hold" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "holdTrID" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "totalLocker" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );

                $bg_color = "";
                $add = "";
                if ($jmlLoker != $pSpec['stock']) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }

                $nof++;
                if ($pSpec['stock'] != $jmlLoker) {

                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );

                    //hilangkan saja
                    $ll = new MdlLockerValue();
                    $ll->updateData(
                        array(
                            "jenis" => "kas",
                            "jenis_locker" => "value",
                            "cabang_id" => $branchID,
                            "gudang_id" => $whID,
                            "produk_id" => $pID,
                            "transaksi_id" => 0,
                            "state" => "active",
                        ), array(
                            //                            "produk_id" => 6666,
                            "nilai" => $jmlActive_new,
                            //                            "nama" => "unknown",
                            //                            "state" => "dest",
                        )
                    );
                    $update = $this->db->last_query() . ";";
                    //                    showLast_query("pink2");
                    //                    $ll = new MdlLockerValue();
                    //                    $ll->addData(
                    //                        array(
                    //                            "jenis" => "kas",
                    //                            "jenis_locker" => "value",
                    //                            "cabang_id" => $branchID,
                    //                            "gudang_id" => $whID,
                    //                            "produk_id" => $pID,
                    //                            "nama" => $pSpec['name'],
                    //                            "oleh_id" => 0,
                    //                            "transaksi_id" => 0,
                    //                            "state" => "active",
                    //                            "nilai" => $jmlActive_new,
                    ////                            "nilai" => $pSpec['stock'],
                    //                        )
                    //                    );
                    //                    $insert = $this->db->last_query() . ";";

                    $warning[$nof] = array(
                        "update" => $update,
                        //                        "insert" => $insert,
                    );

                }
                else {

                }
            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        }


        $data = array(
            "mode" => "index",
            "title" => "KAS BRANCH ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    function viewUnsyncedKasAll()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuKas");
        $this->load->model("Mdls/MdlLockerValue");
        $this->load->model("Mdls/MdlCabang");


        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $ids = array();
        $ffStocks = array();


        $c = new ComRekeningPembantuKas();
//        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("1010010010");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->cabang_id][$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->debet,
                );
//                $ids[] = $row->extern_id;
            }
        }

        $l = new MdlLockerValue();
//        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("state in ('active','hold')");
        $l->addFilter("jenis='kas'");
        $l->addFilter("gudang_id='0'");
//        $lStocks = $l->fetchStates2($branchID, 0, $ids);
        $lStocksTmp = $l->lookupAll()->result();
//        arrPrint($lStocksTmp);
        $lStocks = array();
        foreach ($lStocksTmp as $lStocksSpec) {
//            arrPrint($lStocksSpec);
            if ($lStocksSpec->state == "active") {
                if (!isset($lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id][$lStocksSpec->state])) {
                    $lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id][$lStocksSpec->state] = 0;
                }
                $lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id][$lStocksSpec->state] += $lStocksSpec->nilai;
            }
            if (($lStocksSpec->state == "hold") && ($lStocksSpec->transaksi_id == "0")) {
                if (!isset($lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id][$lStocksSpec->state])) {
                    $lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id][$lStocksSpec->state] = 0;
                }
                $lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id][$lStocksSpec->state] += $lStocksSpec->nilai;
            }
            if (($lStocksSpec->state == "hold") && ($lStocksSpec->transaksi_id > "0")) {
                if (!isset($lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id]["hold_trID"])) {
                    $lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id]["hold_trID"] = 0;
                }
                $lStocks[$lStocksSpec->cabang_id][$lStocksSpec->produk_id]["hold_trID"] += $lStocksSpec->nilai;
            }
        }

//showLast_query("biru");
//arrPrintPink($lStocks);
//arrPrintKuning($products);
//mati_disini(__LINE__);

        $arrButton = array();
//        foreach ($arrCabangs as $branchIDc => $branchNama) {
//            $link = base_url() . "$ctrl/$method/$branchIDc";
//            $selected = $branchIDc == $branchID ? "selected" : "";
//            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
//            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
//        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
            //            "fifo" => "fifo",
            //            "avg" => "fifo avg",
            "debet" => "rek debet",
            "active" => "locker active",
            "hold" => "locker hold",
            "holdTrID" => "locker hold trID",
            "totalLocker" => "total locker",
            "selisih" => "selisih",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            $this->db->trans_start();

            foreach ($products as $cID => $ppSpec) {
                foreach ($ppSpec as $pID => $pSpec) {

                    $jmlActive = isset($lStocks[$cID][$pID]['active']) ? $lStocks[$cID][$pID]['active'] : 0;
                    $jmlHold = isset($lStocks[$cID][$pID]['hold']) ? $lStocks[$cID][$pID]['hold'] : 0;
                    $jmlHoldTrID = isset($lStocks[$cID][$pID]['hold_trID']) ? $lStocks[$cID][$pID]['hold_trID'] : 0;
                    $jmlSold = isset($lStocks[$cID][$pID]['sold']) ? $lStocks[$cID][$pID]['sold'] : 0;

                    $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                    $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);

                    $jmlActive_new = $pSpec['stock'] - $jmlHold - $jmlHoldTrID;
                    $selisih = $jmlRek - ($jmlActive + $jmlHoldTrID);

                    $items[$cID][] = array(
                        "pID" => $pID,
                        "pName" => $pSpec['name'],
                        "fifoReal" => 0,
                        "fifoAvg" => 0,
                        "debet" => $pSpec['stock'],
                        "active" => $jmlActive,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,
                        "sold" => $jmlSold,
                        "selisih" => $selisih,
                        "totalLocker" => $jmlLoker,
                    );
                    $markingColumn[$cID][$pID] = array(
                        "debet" => array(
                            "background-color" => "#B5FF7B",
                        ),
                        "active" => array(
                            "background-color" => "#7BFFF9",
                        ),
                        "hold" => array(
                            "background-color" => "#AC9AFF",
                        ),
                        "holdTrID" => array(
                            "background-color" => "#AC9AFF",
                        ),
                        "totalLocker" => array(
                            "background-color" => "#B5FF7B",
                        ),
                    );

                    $bg_color = "";
                    $add = "";
                    if ($jmlLoker != $pSpec['stock']) {
                        $bg_color = "background-color:yellow;";
                        $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                    }

                    $nof++;
                    if ($pSpec['stock'] != $jmlLoker) {

                        $marking[$cID][$pID] = array(
                            "add_name" => "(yellow)",
                            "background-color" => "yellow",
                        );

                        //hilangkan saja
                        $ll = new MdlLockerValue();
                        $ll->updateData(
                            array(
                                "jenis" => "kas",
                                "jenis_locker" => "value",
                                "cabang_id" => $branchID,
                                "gudang_id" => $whID,
                                "produk_id" => $pID,
                                "transaksi_id" => 0,
                                "state" => "active",
                            ), array(
                                //                            "produk_id" => 6666,
                                "nilai" => $jmlActive_new,
                                //                            "nama" => "unknown",
                                //                            "state" => "dest",
                            )
                        );
                        $update = $this->db->last_query() . ";";
                        //                    showLast_query("pink2");
                        //                    $ll = new MdlLockerValue();
                        //                    $ll->addData(
                        //                        array(
                        //                            "jenis" => "kas",
                        //                            "jenis_locker" => "value",
                        //                            "cabang_id" => $branchID,
                        //                            "gudang_id" => $whID,
                        //                            "produk_id" => $pID,
                        //                            "nama" => $pSpec['name'],
                        //                            "oleh_id" => 0,
                        //                            "transaksi_id" => 0,
                        //                            "state" => "active",
                        //                            "nilai" => $jmlActive_new,
                        ////                            "nilai" => $pSpec['stock'],
                        //                        )
                        //                    );
                        //                    $insert = $this->db->last_query() . ";";

                        $warning[$cID][$nof] = array(
                            "update" => $update,
                            //                        "insert" => $insert,
                        );

                    }
                    else {

                    }

                }
            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        }
//arrPrintKuning($items);

        $data = array(
            "mode" => "index_all",
            "title" => "KAS BRANCH ($branchID)",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => isset($arrButton) ? $arrButton : array(),
            "cabang" => isset($arrCabangs) ? $arrCabangs : array(),
        );

        $this->load->view("tool", $data);
    }


    function viewUnsyncedRekeningKoran()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuRekeningKoran");
        $this->load->model("Mdls/MdlLockerValue");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlPlafonHutangBank");
        $this->load->model("Mdls/MdlLockerPlafonHutangBankCache");


        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $ids = array();
        $ffStocks = array();


        $c = new ComRekeningPembantuRekeningKoran();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("rekening koran");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->kredit,
                );
                $ids[] = $row->extern_id;
            }
        }


        $l = new MdlLockerValue();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("gudang_id='0'");
        $l->addFilter("jenis='plafon hutang bank'");
        $lStocks = $l->fetchStates2($branchID, 0, $ids);

        $pf = New MdlPlafonHutangBank();
        $pfResult = $pf->lookupAll()->result();
        $pfResult_tmp = array();
        if (sizeof($pfResult) > 0) {
            foreach ($pfResult as $spec) {
                $pfResult_tmp[$spec->extern_id] = $spec->nilai;
            }
        }

        $lc = New MdlLockerPlafonHutangBankCache();
        $lcResult = $lc->lookupAll()->result();
        $lcResult_tmp = array();
        if (sizeof($lcResult) > 0) {
            foreach ($lcResult as $spec) {
                $lcResult_tmp[$spec->extern_id] = $spec->debet;
            }
        }


        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
            "plafon" => "plafon",
            "debet" => "rek kredit",
            "active" => "locker available",
            "realisasi" => "locker realisasi",
            "totalLocker" => "total locker",
            "cache" => "cache",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            $this->db->trans_start();

            foreach ($products as $pID => $pSpec) {

                $jmlActive = isset($lStocks[$pID]['active']) ? $lStocks[$pID]['active'] : 0;
                $jmlHold = isset($lStocks[$pID]['hold']) ? $lStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($lStocks[$pID]['hold_trID']) ? $lStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($lStocks[$pID]['sold']) ? $lStocks[$pID]['sold'] : 0;

                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);

                $jmlActive_new = $pSpec['stock'] - $jmlHold - $jmlHoldTrID;
                $cache = isset($lcResult_tmp[$pID]) ? $lcResult_tmp[$pID] : 0;
                $realisasi = $pfResult_tmp[$pID] - $jmlActive;
                $batas_atas = $pSpec['stock'] + $jmlActive;
                $plafon = isset($pfResult_tmp[$pID]) ? $pfResult_tmp[$pID] : 0;

                $items[] = array(
                    "pID" => $pID,
                    "pName" => $pSpec['name'],
                    "plafon" => $plafon,
                    "debet" => $pSpec['stock'],
                    "active" => $jmlActive,
                    "realisasi" => $realisasi,
                    "totalLocker" => $jmlLoker,
                    "cache" => $cache,
                );
                $markingColumn[$pID] = array(
                    "debet" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "active" => array(
                        "background-color" => "#7BFFF9",
                    ),
                    "hold" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "holdTrID" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "totalLocker" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );

                $bg_color = "";
                $add = "";
                if ($jmlLoker != $pSpec['stock']) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }

                $nof++;
                //                if ($jmlRek != $jmlLoker) {
                //
                //                    $marking[$pID] = array(
                //                        "add_name" => "(yellow)",
                //                        "background-color" => "yellow",
                //                    );
                //
                //                    //hilangkan saja
                //
                ////                    $ll = new MdlLockerValue();
                ////                    $ll->updateData(
                ////                        array(
                ////                            "jenis"        => "kas",
                ////                            "jenis_locker" => "value",
                ////                            "cabang_id"    => $branchID,
                ////                            "gudang_id"    => $whID,
                ////                            "produk_id"    => $pID,
                ////                            "transaski_id" => 0,
                ////                            "state"        => "active",
                ////                        ), array(
                //////                            "produk_id" => 6666,
                ////                            "nilai" => $jmlActive_new,
                //////                            "nama" => "unknown",
                //////                            "state" => "dest",
                ////                        )
                ////                    );
                ////                    $update = $this->db->last_query() . ";";
                //                    $update = "";
                //                    $warning[$nof] = array(
                //                        "update" => $update,
                ////                        "insert" => $insert,
                //                    );
                //
                //                }
                //                else
                if ($jmlRek != $realisasi) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }
                elseif ($plafon != $batas_atas) {
                    cekHere($plafon - $batas_atas);
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }
                else {

                }
            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        }

        $warning = array();
        //        $marking = array();
        $data = array(
            "mode" => "index",
            "title" => "REKENING KORAN ($branchID)",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    function viewUnsyncedUangMuka()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuUangMuka");
        $this->load->model("Mdls/MdlLockerValue");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlPaymentUangMuka");
        //        $this->load->model("Mdls/MdlCurrency");
        //        $this->load->model("Mdls/MdlFifoValasExtern");

        //        $ff = new MdlFifoValasExtern();
        //        $ff->addFilter("cabang_id='$branchID'");
        //        $ff->addFilter("unit>'0'");
        //        $ffTmp = $ff->lookupAll()->result();
        //        $ffValas = array();
        //        if (sizeof($ffTmp) > 0) {
        //            foreach ($ffTmp as $ffSpec) {
        //                if (!isset($ffValas[$ffSpec->extern_id][$ffSpec->produk_id])) {
        //                    $ffValas[$ffSpec->extern_id][$ffSpec->produk_id] = 0;
        //                }
        //                $ffValas[$ffSpec->extern_id][$ffSpec->produk_id] += $ffSpec->unit;
        //            }
        //        }

        $cr = new MdlPaymentUangMuka();
        $cr->addFilter("extern_label2='vendor'");
        $cr->addFilter("label='uang muka'");
        $crTmp = $cr->lookupAll()->result();
        $arrUangMuka = array();
        if (sizeof($crTmp) > 0) {
            foreach ($crTmp as $spec) {
                $arrUangMuka[$spec->extern_id] = array(
                    "nama" => $spec->extern_nama,
                    "nilai" => $spec->sisa,
                );
            }
        }

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $crTmp['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $productsName = array();
        $ids = array();
        $ffStocks = array();


        $c = new ComRekeningPembantuUangMuka();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("1010050010");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->debet,
                    "qty_stock" => $row->qty_debet,
                );
                $productsName[$row->extern_id] = $row->extern_nama;
            }
        }
        //cekKuning($productsName);
        //mati_disini($this->db->last_query());

        $l = new MdlLockerValue();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("jenis='uang_muka_dibayar'");
//        $l->addFilter("gudang_id='0'");
        $lStocks = $l->lookupAll()->result();
        $arrLockerStocks = array();
        if (sizeof($lStocks) > 0) {
            foreach ($lStocks as $spec) {
                if (!isset($arrLockerStocks[$spec->produk_id][$spec->state])) {
                    $arrLockerStocks[$spec->produk_id][$spec->state] = 0;
                }
                $arrLockerStocks[$spec->produk_id][$spec->state] += $spec->nilai;
            }
        }
        //showLast_query("biru");
        //arrPrint($arrLockerStocks);

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "vendor",
            //            "crName" => "valas",
            //            "fifo" => "fifo",
            //            "qty_debet" => "rek debet<br>(qty)",
            "debet" => "rek debet<br>(idr)",
            "uang_muka" => "uang muka<br>pym src",
            "active" => "locker active",
            "hold" => "locker hold",
            "holdTrID" => "locker hold trID",
            "totalLocker" => "total locker",
            "selisih" => "selisih",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            $this->db->trans_start();

            foreach ($products as $pID => $pSpec) {

                $jmlActive = isset($arrLockerStocks[$pID]['active']) ? $arrLockerStocks[$pID]['active'] : 0;
                $jmlHold = isset($arrLockerStocks[$pID]['hold']) ? $arrLockerStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($arrLockerStocks[$pID]['hold_trID']) ? $arrLockerStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($arrLockerStocks[$pID]['sold']) ? $arrLockerStocks[$pID]['sold'] : 0;

                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);
                $stock = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                $qty_stock = isset($pSpec['qty_stock']) ? $pSpec['qty_stock'] : 0;
                $qty_fifo = isset($ffValas[$pID]) ? $ffValas[$pID] : 0;
                $uang_muka = isset($arrUangMuka[$pID]['nilai']) ? $arrUangMuka[$pID]['nilai'] : 0;

                $jmlActive_new = $stock - $jmlHold - $jmlHoldTrID;
                $selisih = $qty_stock - ($jmlActive + $jmlHoldTrID);

                $items[] = array(
                    "pID" => $pID,
                    "pName" => $productsName[$pID],
                    //                        "crName" => $crNama,
                    //                        "fifo" => $qty_fifo,
                    //                        "fifoAvg" => 0,
                    //                        "qty_debet" => $qty_stock,
                    "debet" => $stock,
                    "uang_muka" => $uang_muka,
                    "active" => $jmlActive,
                    "hold" => $jmlHold,
                    "holdTrID" => $jmlHoldTrID,
                    "sold" => $jmlSold,
                    "selisih" => $selisih,
                    "totalLocker" => $jmlLoker,
                );
                $markingColumn[$pID] = array(
                    "debet" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "active" => array(
                        "background-color" => "#7BFFF9",
                    ),
                    "hold" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "holdTrID" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "totalLocker" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );

                //                $bg_color = "";
                //                $add = "";
                //                if ($jmlLoker != $qty_stock) {
                //                    $bg_color = "background-color:yellow;";
                //                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                //                }
                //                elseif ($qty_fifo != $qty_stock) {
                //                    $bg_color = "background-color:yellow;";
                //                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                //                }

                $nof++;
                if ($uang_muka != $stock) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                    $warning[$nof] = array();
                }
                //                elseif ($uang_muka != $jmlLoker) {
                //                    $marking[$pID] = array(
                //                        "add_name" => "(yellow)",
                //                        "background-color" => "yellow",
                //                    );
                //                    $warning[$nof] = array();
                //                }
                //                elseif ($stock != $jmlLoker) {
                //                    $marking[$pID] = array(
                //                        "add_name" => "(yellow)",
                //                        "background-color" => "yellow",
                //                    );
                //                    $warning[$nof] = array();
                //                }
                else {

                }

//
//                if($stock != $jmlActive){
//
//                }
            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        }
        //cekKuning($items);

        $data = array(
            "mode" => "index",
            "title" => "UANG MUKA ke VENDOR ($branchID)",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    function viewUnsyncedUangMukaValas()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuUangMukaExternMain");
        $this->load->model("Mdls/MdlLockerValueExtern");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlCurrency");
        $this->load->model("Mdls/MdlFifoValasExtern");

        $ff = new MdlFifoValasExtern();
        $ff->addFilter("cabang_id='$branchID'");
        $ff->addFilter("unit>'0'");
        $ffTmp = $ff->lookupAll()->result();
//        showLast_query("biru");
        $ffValas = array();
        if (sizeof($ffTmp) > 0) {
            foreach ($ffTmp as $ffSpec) {
                if (!isset($ffValas[$ffSpec->extern_id][$ffSpec->produk_id])) {
                    $ffValas[$ffSpec->extern_id][$ffSpec->produk_id] = 0;
                }
                $ffValas[$ffSpec->extern_id][$ffSpec->produk_id] += $ffSpec->unit;
            }
        }

        $cr = new MdlCurrency();
        $crTmp = $cr->lookupAll()->result();
//        showLast_query("biru");
        $arrCurrency = array();
        if (sizeof($crTmp) > 0) {
            foreach ($crTmp as $spec) {
                $arrCurrency[$spec->id] = $spec->nama;
            }
        }

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $crTmp['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $productsName = array();
        $ids = array();
        $ffStocks = array();


        $c = new ComRekeningPembantuUangMukaExternMain();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("1010050020");
//        showLast_query("biru");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id][$row->extern2_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->debet,
                    "qty_stock" => $row->qty_debet,
                );
                $productsName[$row->extern_id] = $row->extern_nama;
            }
        }

        $l = new MdlLockerValueExtern();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("jenis='valas'");
        $l->addFilter("gudang_id='0'");
        $lStocks = $l->lookupAll()->result();
//        showLast_query("biru");
        $arrLockerStocks = array();
        if (sizeof($lStocks) > 0) {
            foreach ($lStocks as $spec) {
                if (!isset($arrLockerStocks[$spec->extern_id][$spec->produk_id][$spec->state])) {
                    $arrLockerStocks[$spec->extern_id][$spec->produk_id][$spec->state] = 0;
                }
                $arrLockerStocks[$spec->extern_id][$spec->produk_id][$spec->state] += $spec->nilai;
            }
        }
        //showLast_query("biru");
        //arrPrint($arrLockerStocks);

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "vendor",
            "crName" => "valas",
            "fifo" => "fifo",
            "qty_debet" => "rek debet<br>(qty)",
            "debet" => "rek debet<br>(idr)",
            "active" => "locker active",
            "hold" => "locker hold",
            "holdTrID" => "locker hold trID",
            "totalLocker" => "total locker",
            "selisih" => "selisih",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            $this->db->trans_start();
            //arrPrint($ffValas);
            foreach ($products as $pID => $pSpec) {

                foreach ($arrCurrency as $crID => $crNama) {

                    $jmlActive = isset($arrLockerStocks[$pID][$crID]['active']) ? $arrLockerStocks[$pID][$crID]['active'] : 0;
                    $jmlHold = isset($arrLockerStocks[$pID][$crID]['hold']) ? $arrLockerStocks[$pID][$crID]['hold'] : 0;
                    $jmlHoldTrID = isset($arrLockerStocks[$pID][$crID]['hold_trID']) ? $arrLockerStocks[$pID][$crID]['hold_trID'] : 0;
                    $jmlSold = isset($arrLockerStocks[$pID][$crID]['sold']) ? $arrLockerStocks[$pID][$crID]['sold'] : 0;

                    $jmlRek = isset($pSpec[$crID]['stock']) ? $pSpec[$crID]['stock'] : 0;
                    $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);
                    $stock = isset($pSpec[$crID]['stock']) ? $pSpec[$crID]['stock'] : 0;
                    $qty_stock = isset($pSpec[$crID]['qty_stock']) ? $pSpec[$crID]['qty_stock'] : 0;
                    $qty_fifo = isset($ffValas[$pID][$crID]) ? $ffValas[$pID][$crID] : 0;
                    //cekPink2("$pID, $crID, $qty_fifo");
                    $jmlActive_new = $stock - $jmlHold - $jmlHoldTrID;
                    $selisih = $qty_stock - ($jmlActive + $jmlHoldTrID);

                    $items[] = array(
                        "pID" => $pID,
                        "pName" => $productsName[$pID],
                        "crName" => $crNama,
                        "fifo" => $qty_fifo,
                        //                        "fifoAvg" => 0,
                        "qty_debet" => $qty_stock,
                        "debet" => $stock,
                        "active" => $jmlActive,
                        "hold" => $jmlHold,
                        "holdTrID" => $jmlHoldTrID,
                        "sold" => $jmlSold,
                        "selisih" => $selisih,
                        "totalLocker" => $jmlLoker,
                    );
                    $markingColumn[$pID] = array(
                        "debet" => array(
                            "background-color" => "#B5FF7B",
                        ),
                        "active" => array(
                            "background-color" => "#7BFFF9",
                        ),
                        "hold" => array(
                            "background-color" => "#AC9AFF",
                        ),
                        "holdTrID" => array(
                            "background-color" => "#AC9AFF",
                        ),
                        "totalLocker" => array(
                            "background-color" => "#B5FF7B",
                        ),
                    );

                    $bg_color = "";
                    $add = "";
                    if ($jmlLoker != $qty_stock) {
                        $bg_color = "background-color:yellow;";
                        $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                    }
                    elseif ($qty_fifo != $qty_stock) {
                        $bg_color = "background-color:yellow;";
                        $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                    }

                    $nof++;
                    if ($qty_stock != $jmlLoker) {
                        $marking[$pID] = array(
                            "add_name" => "(yellow)",
                            "background-color" => "yellow",
                        );
                        $warning[$nof] = array();
                    }
                    elseif ($qty_fifo != $qty_stock) {
                        $marking[$pID] = array(
                            "add_name" => "(yellow)",
                            "background-color" => "yellow",
                        );
                        $warning[$nof] = array();
                    }
                    else {

                    }
                }

            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        }

//arrPrint($items);
        $data = array(
            "mode" => "index",
            "title" => "UANG MUKA VALAS BRANCH ($branchID)",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    function viewUnsyncedValas()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuValas");
        $this->load->model("Mdls/MdlLockerValue");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlCurrency");
        $this->load->model("Mdls/MdlFifoValas");

        $ff = new MdlFifoValas();
        $ff->addFilter("cabang_id='$branchID'");
        $ff->addFilter("unit>'0'");
        $ffTmp = $ff->lookupAll()->result();
        $ffValas = array();
        if (sizeof($ffTmp) > 0) {
            foreach ($ffTmp as $ffSpec) {
                if (!isset($ffValas[$ffSpec->produk_id])) {
                    $ffValas[$ffSpec->produk_id] = 0;
                }
                $ffValas[$ffSpec->produk_id] += $ffSpec->unit;
            }
        }

        $cr = new MdlCurrency();
        $crTmp = $cr->lookupAll()->result();
        $arrCurrency = array();
        if (sizeof($crTmp) > 0) {
            foreach ($crTmp as $spec) {
                $arrCurrency[$spec->id] = $spec->nama;
            }
        }

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $crTmp['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $productsName = array();
        $ids = array();
        $ffStocks = array();


        $c = new ComRekeningPembantuValas();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("valas");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->debet,
                    "qty_stock" => $row->qty_debet,
                );
                $productsName[$row->extern_id] = $row->extern_nama;
            }
        }

        $l = new MdlLockerValue();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("jenis='valas'");
        $l->addFilter("gudang_id='0'");
        $lStocks = $l->lookupAll()->result();
        $arrLockerStocks = array();
        if (sizeof($lStocks) > 0) {
            foreach ($lStocks as $spec) {
                if (!isset($arrLockerStocks[$spec->produk_id][$spec->state])) {
                    $arrLockerStocks[$spec->produk_id][$spec->state] = 0;
                }
                $arrLockerStocks[$spec->produk_id][$spec->state] += $spec->nilai;
            }
        }
        //showLast_query("biru");
        //arrPrint($arrLockerStocks);

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "pName" => "vendor",
            //            "crName" => "valas",
            "fifo" => "fifo",
            "qty_debet" => "rek debet<br>(qty)",
            "debet" => "rek debet<br>(idr)",
            "active" => "locker active",
            "hold" => "locker hold",
            "holdTrID" => "locker hold trID",
            "totalLocker" => "total locker",
            "selisih" => "selisih",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            $this->db->trans_start();

            foreach ($products as $pID => $pSpec) {

                //                foreach ($arrCurrency as $crID => $crNama) {

                $jmlActive = isset($arrLockerStocks[$pID]['active']) ? $arrLockerStocks[$pID]['active'] : 0;
                $jmlHold = isset($arrLockerStocks[$pID]['hold']) ? $arrLockerStocks[$pID]['hold'] : 0;
                $jmlHoldTrID = isset($arrLockerStocks[$pID]['hold_trID']) ? $arrLockerStocks[$pID]['hold_trID'] : 0;
                $jmlSold = isset($arrLockerStocks[$pID]['sold']) ? $arrLockerStocks[$pID]['sold'] : 0;

                $jmlRek = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                $jmlLoker = ($jmlActive + $jmlHold + $jmlHoldTrID);
                $stock = isset($pSpec['stock']) ? $pSpec['stock'] : 0;
                $qty_stock = isset($pSpec['qty_stock']) ? $pSpec['qty_stock'] : 0;
                $qty_fifo = isset($ffValas[$pID]) ? $ffValas[$pID] : 0;

                $jmlActive_new = $stock - $jmlHold - $jmlHoldTrID;
                $selisih = $qty_stock - ($jmlActive + $jmlHoldTrID);

                $items[] = array(
                    "pID" => $pID,
                    "pName" => $productsName[$pID],
                    //                        "crName" => $crNama,
                    "fifo" => $qty_fifo,
                    //                        "fifoAvg" => 0,
                    "qty_debet" => $qty_stock,
                    "debet" => $stock,
                    "active" => $jmlActive,
                    "hold" => $jmlHold,
                    "holdTrID" => $jmlHoldTrID,
                    "sold" => $jmlSold,
                    "selisih" => $selisih,
                    "totalLocker" => $jmlLoker,
                );
                $markingColumn[$pID] = array(
                    "debet" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "active" => array(
                        "background-color" => "#7BFFF9",
                    ),
                    "hold" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "holdTrID" => array(
                        "background-color" => "#AC9AFF",
                    ),
                    "totalLocker" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );

                $bg_color = "";
                $add = "";
                if ($jmlLoker != $qty_stock) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }
                elseif ($qty_fifo != $qty_stock) {
                    $bg_color = "background-color:yellow;";
                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                }

                $nof++;
                if ($qty_stock != $jmlLoker) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                    $warning[$nof] = array();
                }
                elseif ($qty_fifo != $qty_stock) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                    $warning[$nof] = array();
                }
                else {

                }
                //                }

            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        }


        $data = array(
            "mode" => "index",
            "title" => "STOCK VALAS BRANCH ($branchID)",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    function viewFifoProduk()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        //        $branchID = isset($this->session->login['cabang_id']) ? $this->session->login['cabang_id'] : "-1";
        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = getDefaultWarehouseID($branchID)['gudang_id'];
        if (isset($_GET['q']) && (strlen($_GET['q']) < 3)) {
            $q = $search = NULL;
        }
        elseif (isset($_GET['q']) && (strlen($_GET['q']) > 3)) {
            $q = $search = $_GET['q'];
        }
        else {
            $q = $search = NULL;
        }


        $this->load->model("Mdls/MdlFifoProdukJadi");
        $this->load->model("Mdls/MdlFifoAverage");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlProduk");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $productsData = array();
        $products = array();
        $ids = array();
        $ffStocks = array();
        $pIDs = array();

        $pd = New MdlProduk();
        $pd->setFilters(array());
        $pd->addFilter("jenis='item'");
        if (strlen($search) > 3) {
            if ($search != "semua") {
                $pdTmp = $pd->lookupByKeyword($search)->result();
            }
            else {
                $pdTmp = $pd->lookupAll()->result();
            }
        }
        elseif (isset($_GET['id'])) {
            $pd->addFilter("id='" . $_GET['id'] . "'");
            $pdTmp = $pd->lookupAll()->result();
        }
        else {
            $pdTmp = $pd->lookupAll()->result();
        }
        if (sizeof($pdTmp) > 0) {
            foreach ($pdTmp as $pdSpec) {
                $productsData[$pdSpec->id] = array(
                    "nama" => strtolower($pdSpec->nama),
                    "kode" => $pdSpec->kode,
                    "kategori" => $pdSpec->folders_nama,
                );
                $pIDs[$pdSpec->id] = $pdSpec->id;
            }
            //            asort($productsData);
        }


        $ff = new MdlFifoProdukJadi();
        $ff->addFilter("cabang_id='$branchID'");
        $ff->addFilter("gudang_id='$whID'");
        $ff->addFilter("unit>'0'");
        if (sizeof($pIDs) > 0) {
            $ff->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
        }
        $ffTmp = $ff->lookupAll()->result();

        $ffStocks = array();
        if (sizeof($ffTmp) > 0) {
            foreach ($ffTmp as $faSpec) {
                //                $ffStocks[$faSpec->produk_id] = array(
                //                    "hpp" => $faSpec->hpp,
                //                    "qty" => $faSpec->unit,
                //                );
                if (!isset($ffStocks[$faSpec->produk_id]['hpp'])) {
                    $ffStocks[$faSpec->produk_id]['hpp'] = 0;
                }
                if (!isset($ffStocks[$faSpec->produk_id]['qty'])) {
                    $ffStocks[$faSpec->produk_id]['qty'] = 0;
                }
                $ffStocks[$faSpec->produk_id]['hpp'] = $faSpec->hpp;
                $ffStocks[$faSpec->produk_id]['qty'] += $faSpec->unit;
            }
        }


        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "produk_id" => "pID",
            "kode" => "Kode",
            "produk_nama" => "pName",
            "unit" => "qty",
            "hpp" => "cost",
            "jml_nilai" => "cost nilai",

            "hpp_riil" => "hpp",
            "jml_nilai_riil" => "hpp nilai",

            "ppv_riil" => "ppv",
            "ppv_nilai_riil" => "ppv nilai",

            "ppn_in" => "ppn",
            "ppn_in_nilai" => "ppn nilai",

            "suppliers_id" => "vendor<br>ID",
            "suppliers_nama" => "vendor<br>Nama",

            "transaksi_id" => "trID",
            "transaksi_jenis" => "trJenis",
            "dtime" => "dtime",
        );
        $nof = 0;
        $items = array();
        $itemsGeseh = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        $markLink = array("produk_id",
            "produk_nama"
        );
        if (sizeof($ffTmp) > 0) {
            krsort($ffTmp);
            $nof = 0;
            foreach ($ffTmp as $ii => $spec) {
                //cekHere($spec->produk_id);
                foreach ($headerFields as $key => $val) {
                    //                    $items[$ii][$key] = isset($spec->$key) ? $spec->$key : "-";

                    if (isset($spec->$key)) {
                        if (in_array($key, $markLink)) {
                            $url = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/" . $this->uri->segment(3) . "/?id=" . $spec->produk_id;
                            $link = "<span><a href='$url'>" . $spec->$key . "</a></span>";
                        }
                        else {
                            $link = $spec->$key;
                        }

                        if ($key == "kode") {
                            $link = isset($productsData[$spec->produk_id][$key]) ? $productsData[$spec->produk_id][$key] : "-";
                        }

                        $items[$ii][$key] = $link;
                    }
                    else {

                        if ($key == "kode") {
                            $link = isset($productsData[$spec->produk_id][$key]) ? $productsData[$spec->produk_id][$key] : "-";
                        }

                        $items[$ii][$key] = $link;
                    }


                }
            }
        }


        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/" . $this->uri->segment(3) . "/?";
        $warning = array();
        $data = array(
            "mode" => "stock",
            "title" => "FIFO PRODUCT BRANCH ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "itemsGeseh" => isset($itemsGeseh) ? $itemsGeseh : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
            "thisPage" => $thisPage,
            "q" => "$q",
        );

        $this->load->view("tool", $data);
    }

    function viewFifoSupplies()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        //        $branchID = isset($this->session->login['cabang_id']) ? $this->session->login['cabang_id'] : "-1";
        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = getDefaultWarehouseID($branchID)['gudang_id'];
        if (isset($_GET['q']) && (strlen($_GET['q']) < 3)) {
            $q = $search = NULL;
        }
        elseif (isset($_GET['q']) && (strlen($_GET['q']) > 3)) {
            $q = $search = $_GET['q'];
        }
        else {
            $q = $search = NULL;
        }


        $this->load->model("Mdls/MdlFifoSupplies");
        $this->load->model("Mdls/MdlFifoAverage");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlSupplies");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $productsData = array();
        $products = array();
        $ids = array();
        $ffStocks = array();
        $pIDs = array();

        $pd = New MdlSupplies();
        $pd->setFilters(array());
        $pd->addFilter("jenis='item'");
        if (strlen($search) > 3) {
            if ($search != "semua") {
                $pdTmp = $pd->lookupByKeyword($search)->result();
            }
            else {
                $pdTmp = $pd->lookupAll()->result();
            }
        }
        elseif (isset($_GET['id'])) {
            $pd->addFilter("id='" . $_GET['id'] . "'");
            $pdTmp = $pd->lookupAll()->result();
        }
        else {
            $pdTmp = $pd->lookupAll()->result();
        }
        if (sizeof($pdTmp) > 0) {
            foreach ($pdTmp as $pdSpec) {
                $productsData[$pdSpec->id] = array(
                    "nama" => strtolower($pdSpec->nama),
                    "kode" => $pdSpec->kode,
                    "kategori" => $pdSpec->folders_nama,
                );
                $pIDs[$pdSpec->id] = $pdSpec->id;
            }
            //            asort($productsData);
        }


        //        $c = new ComRekeningPembantuProduk();
        //        $c->addFilter("cabang_id='$branchID'");
        //        $c->addFilter("gudang_id='$whID'");
        //        if (sizeof($pIDs) > 0) {
        //            $c->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        //        }
        //        $tmp = $c->fetchBalances("persediaan produk");
        //        if (sizeof($tmp) > 0) {
        //            foreach ($tmp as $row) {
        //                $products[$row->extern_id] = array(
        //                    "name" => $row->extern_nama,
        //                    "stock" => $row->qty_debet,
        //                );
        //                $ids[] = $row->extern_id;
        //
        //            }
        //        }


        //        $l = new MdlLockerStock();
        //        $l->addFilter("cabang_id='$branchID'");
        //        $l->addFilter("gudang_id='$whID'");
        //        $lStocks = $l->fetchStates2($branchID, $whID, $ids);


        //        $lsc = new MdlLockerStockCache();
        //        $lsc->addFilter("cabang_id='$branchID'");
        //        $lsc->addFilter("gudang_id='$whID'");
        //        if (sizeof($pIDs) > 0) {
        //            $lsc->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        //        }
        //        $tmp = $lsc->lookupAll()->result();
        //        $productsLockerCache = array();
        //        if (sizeof($tmp) > 0) {
        //            foreach ($tmp as $row) {
        //                $productsLockerCache[$row->extern_id] = array(
        //                    "name" => $row->extern_nama,
        //                    "stock" => $row->qty_debet,
        //                );
        //            }
        //        }


        //        $fa = new MdlFifoAverage();
        //        $fa->addFilter("cabang_id='$branchID'");
        //        $fa->addFilter("gudang_id='$whID'");
        //        $fa->addFilter("jenis='produk'");
        //        if (sizeof($pIDs) > 0) {
        //            $fa->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
        //        }
        //        $faStocks = $fa->lookupAllQty()->result();
        //        $arrHppAvg = array();
        //        if (sizeof($faStocks) > 0) {
        //            foreach ($faStocks as $faSpec) {
        //                $arrHppAvg[$faSpec->produk_id] = array(
        //                    "hpp" => $faSpec->hpp,
        //                    "qty" => $faSpec->jml,
        //                );
        //            }
        //        }


        $ff = new MdlFifoSupplies();
        $ff->addFilter("cabang_id='$branchID'");
        $ff->addFilter("gudang_id='$whID'");
        $ff->addFilter("unit>'0'");
        if (sizeof($pIDs) > 0) {
            $ff->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
        }
        $ffTmp = $ff->lookupAll()->result();
        $ffStocks = array();
        if (sizeof($ffTmp) > 0) {
            foreach ($ffTmp as $faSpec) {
                //                $ffStocks[$faSpec->produk_id] = array(
                //                    "hpp" => $faSpec->hpp,
                //                    "qty" => $faSpec->unit,
                //                );
                if (!isset($ffStocks[$faSpec->produk_id]['hpp'])) {
                    $ffStocks[$faSpec->produk_id]['hpp'] = 0;
                }
                if (!isset($ffStocks[$faSpec->produk_id]['qty'])) {
                    $ffStocks[$faSpec->produk_id]['qty'] = 0;
                }
                $ffStocks[$faSpec->produk_id]['hpp'] = $faSpec->hpp;
                $ffStocks[$faSpec->produk_id]['qty'] += $faSpec->unit;
            }
        }


        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "produk_id" => "pID",
            "produk_nama" => "pName",
            "unit" => "qty",
            "hpp" => "cost",
            "jml_nilai" => "cost nilai",

            "hpp_riil" => "hpp",
            "jml_nilai_riil" => "hpp nilai",

            "ppv_riil" => "ppv",
            "ppv_nilai_riil" => "ppv nilai",

            "ppn_in" => "ppn",
            "ppn_in_nilai" => "ppn nilai",

            "suppliers_id" => "vendor<br>ID",
            "suppliers_nama" => "vendor<br>Nama",

            "transaksi_id" => "trID",
            "transaksi_jenis" => "trJenis",
            "dtime" => "dtime",
        );
        $nof = 0;
        $items = array();
        $itemsGeseh = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        $markLink = array("produk_id",
            "produk_nama"
        );
        if (sizeof($ffTmp) > 0) {

            $nof = 0;
            foreach ($ffTmp as $ii => $spec) {

                foreach ($headerFields as $key => $val) {

                    if (isset($spec->$key)) {
                        if (in_array($key, $markLink)) {
                            $url = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/" . $this->uri->segment(3) . "/?id=" . $spec->produk_id;
                            $link = "<span><a href='$url'>" . $spec->$key . "</a></span>";
                        }
                        else {
                            $link = $spec->$key;
                        }
                        $items[$ii][$key] = $link;
                    }
                    else {
                        $items[$ii][$key] = "-";
                    }
                }
            }
        }


        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/" . $this->uri->segment(3) . "/?";
        $warning = array();
        $data = array(
            "mode" => "stock",
            "title" => "FIFO SUPPLIES BRANCH ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "itemsGeseh" => isset($itemsGeseh) ? $itemsGeseh : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
            "thisPage" => $thisPage,
            "q" => "$q",
        );

        $this->load->view("tool", $data);
    }

    function viewLog()
    {

        $tbl = "log";
        $this->db->where("ipadd like '202.65%'");
        $this->db->order_by("id", "DESC");
        $this->db->limit("50");
        $result = $this->db->get($tbl)->result();
        //        showLast_query("biru");
        //        mati_disini(sizeof($result));

        $headerFields = array(
            "id" => "ID",
            "dtime" => "dtime",
            "uid" => "userID",
            "uname" => "username",
            "ipadd" => "IPADD",
            "devices" => "Devices",
            "title" => "Title",
            "subtitle" => "Subtitle",
            "url" => "URL",

        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        $no = 0;
        if (sizeof($result) > 0) {
            foreach ($result as $pSpec) {
                //                arrPrintPink($pSpec);

                $no++;
                foreach ($headerFields as $key => $label) {
                    $items[$no][$key] = isset($pSpec->$key) ? $pSpec->$key : "";
                }

            }

        }

        //arrPrintWebs($items);
        $data = array(
            "mode" => "index",
            "title" => "LOG",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => isset($arrButton) ? $arrButton : array(),
        );

        $this->load->view("tool", $data);
    }

    //---------------------------------------------------
    function viewEmployee()
    {
//                mati_disini(__LINE__);

        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlLockerTransaksi");
        $this->load->model("MdlTransaksi");

        //-------------------------------------
        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }
        //-------------------------------------
        $lt = New MdlLockerTransaksi();
        $lt->setFilters(array());
        $lt->addFilter("state='hold'");
        $lt->addFilter("jumlah>'0'");
        $ltTmp = $lt->lookupAll()->result();
        $arrTrIDs = array();
        $arrLocker = array();
        $arrTrData = array();
        if (sizeof($ltTmp) > 0) {
            $kolom = array(
                "id",
                "produk_id",
                "transaksi_id",
                "oleh_id",
                "last_access",
            );
            foreach ($ltTmp as $spec) {
                $subTmp = array();
                foreach ($kolom as $val) {
                    $subTmp[$val] = isset($spec->$val) ? $spec->$val : "";
                }
                $arrLocker[$spec->oleh_id][] = $subTmp;
                $arrTrIDs[] = $spec->transaksi_id;
            }


            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id in ('" . implode("','", $arrTrIDs) . "')");
            $trTmp = $tr->lookupAll()->result();

            if (sizeof($trTmp) > 0) {
                foreach ($trTmp as $trSpec) {
                    $arrTrData[$trSpec->id] = array(
                        "id" => $trSpec->id,
                        "nomer_top" => $trSpec->nomer_top,
                        "nomer" => $trSpec->nomer,
                        "cabang_nama" => $trSpec->cabang_nama,
                    );
                }
            }
        }
        //-------------------------------------
        $arrUser = array();
        $authProps = array(
            //            "MdlUser",
            //            "MdlPos",
            "MdlEmployee",
            "MdlEmployee__shadow",
            "MdlEmployeeCabang",
            "MdlEmployeeCabang__shadow",
            "MdlEmployeeGudang",
        );
        $kolom = array("id",
            "nama",
            "status_login",
            "cabang_id",
            "membership",
            "last_dtime_active"
        );
        foreach ($authProps as $mdlName) {
            $this->load->model("Mdls/" . $mdlName);
            $u = new $mdlName();
            $uTmp = $u->lookupAll()->result();
            if (sizeof($uTmp) > 0) {
                foreach ($uTmp as $spec) {
                    $subTmp = array();
                    foreach ($kolom as $val) {
                        $subTmp[$val] = isset($spec->$val) ? $spec->$val : "-";
                    }
                    $arrUser[$spec->id] = $subTmp;
                }
            }
        }
        //-------------------------------------


        $TransData = array();
        $headerFields = array(
            "id" => "id",
            "nama" => "nama",
            "cabang_id" => "cabang id",
            "locker" => "locker transaksi",
            "membership" => "group akses",
            "last_dtime_active" => "last date<br>action",
        );
        $nof = 0;
        $items = array();
        $itemsLogin = array();
        $itemsLock = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();

        $userByMembership = array();
        if (sizeof($arrUser) > 0) {
//                        arrPrintWebs($arrUser);
            //            arrPrintWebs($arrTrData);
            foreach ($arrUser as $trSpec_s) {
                $trSpec = (object)$trSpec_s;

                $subItems['pID'] = $trSpec->id;
                foreach ($headerFields as $key => $val) {
                    $subItems[$key] = isset($trSpec->$key) ? formatField($key, $trSpec->$key) : "";

                    if ($key == "cabang_id") {
                        $subItems[$key] = $arrCabangs[$trSpec->$key];
                    }

                    if ($key == "locker") {
                        $result = NULL;
                        if (isset($arrLocker[$trSpec->id])) {
                            $nob = 0;
                            foreach ($arrLocker[$trSpec->id] as $lSpec) {
                                $id_locker = $lSpec['id'];
                                $date = $lSpec['last_access'];
                                $trLocker = $lSpec['transaksi_id'];
                                $cabang_nama = isset($arrTrData[$trLocker]['cabang_nama']) ? formatField("cabang_nama", $arrTrData[$trLocker]['cabang_nama']) : "";
                                $nomerTop = isset($arrTrData[$trLocker]['nomer_top']) ? formatField("nomer_top", $arrTrData[$trLocker]['nomer_top']) : "none";
                                $nomer_orig = isset($arrTrData[$trLocker]['nomer']) ? $arrTrData[$trLocker]['nomer'] : "none";
                                $nomer = isset($arrTrData[$trLocker]['nomer']) ? formatField("nomer", $arrTrData[$trLocker]['nomer']) : "none";
                                $link = base_url() . "Tool/viewEmployeeClear/$trLocker";
                                $msg = "locker transaksi $nomer_orig akan dibuang";

                                $nob++;
                                if ($result == NULL) {
                                    $result = "$nob.&nbsp;
                                        <button class='btn btn-disabled'>$date</button>
                                        <button class='btn btn-disabled'>$nomerTop &nbsp; $cabang_nama</button>
                                        <button class='btn btn-disabled'>$nomer &nbsp; $cabang_nama</button>
                                        
                                        <button class='btn btn-danger pull-right' onclick=\"if(confirm('$msg')==1){getElementById('result').src='$link';}\"
                                                >DELETE LOCKER</button>
                                        <br><br>";
                                }
                                else {
                                    $result .= "$nob.&nbsp;
                                        <button class='btn btn-disabled'>$date</button>
                                        <button class='btn btn-disabled'>$nomerTop &nbsp; $cabang_nama</button>
                                        <button class='btn btn-disabled'>$nomer &nbsp; $cabang_nama</button>
                                        
                                        <button class='btn btn-danger pull-right' onclick=\"if(confirm('$msg')==1){getElementById('result').src='$link';}\"
                                                >DELETE LOCKER</button>
                                        <br><br>";
                                }

                            }
                        }
                        $subItems['locker'] = $result;
                    }

                    if ($key == "membership") {
                        $mems = "";
                        if ($trSpec->$key != NULL) {
                            $member = blobDecode($trSpec->$key);
                            if ($member != NULL) {
                                $mems = implode(",<br>", $member);
                                foreach ($member as $k => $memLabel) {
                                    if (!isset($userByMembership[$memLabel])) {
                                        $userByMembership[$memLabel] = array();
                                    }
                                    $userByMembership[$memLabel][$trSpec->id] = $trSpec->nama;
                                }
                            }
                        }
                        $subItems[$key] = $mems;
                    }
                }

                //                if($trSpec->id==225){
                //                    cekMerah($trSpec->status_login);
                //                    cekMerah(sizeof($subItems['locker']));
                //                    arrPrintWebs($subItems['locker']);
                //                }

                if (($trSpec->status_login == 1) && ($subItems['locker'] != NULL)) {
                    $marking[$trSpec->id] = array(
                        "add_name" => "",
                        "background-color" => "orange",
                    );
                    $itemsLock[] = $subItems;
                }
                elseif (($trSpec->status_login == 1) && ($subItems['locker'] == NULL)) {
                    $marking[$trSpec->id] = array(
                        "add_name" => "",
                        "background-color" => "lime",
                    );
                    $itemsLogin[] = $subItems;
                }
                else {
                    $items[] = $subItems;
                }
            }


            arrPrintWebs($userByMembership);
        }
        //arrPrintWebs($itemsLock);


        $warning = array();
        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/?";
        //        $addSubTitle = "( " . sizeof($TransData) . " transaksi )";
        $data = array(
            "mode" => "stock",
            "title" => "EMPLOYEE.....",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "items2" => $itemsLock,
            "items3" => $itemsLogin,
            "items2_label" => "employee yang meng-lock transaksi....",
            "items3_label" => "employee yang login ke system....",
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => $thisPage,
            "filters" => array(),
            "q" => "",
            "search" => false,
        );

        $this->load->view("tool", $data);
    }

    function viewEmployeeClear()
    {
        $this->load->model("Mdls/MdlLockerTransaksi");

        $trID = $this->uri->segment(3);

        $lt = New MdlLockerTransaksi();
        $lt->setFilters(array());
        $lt->addFilter("state='hold'");
        $lt->addFilter("transaksi_id='$trID'");
        $lt->addFilter("jumlah>'0'");
        $lt_tmp = $lt->lookupAll()->result();


        $this->db->trans_start();

        if (sizeof($lt_tmp) > 0) {
            $id = $lt_tmp[0]->id;
            $where = array("id" => "$id");
            $update = array("jumlah" => "0");
            $lt->setFilters(array());
            $lt->updateData($where, $update);
        }

        $this->db->trans_complete() or mati_disini("Gagal saat berusaha  commit transaction!");


        $arrAlert = array(
            "type" => "success",
            "title" => "SUCCESS",
            "html" => "Delete Locker Transaksi berhasil.....",
            "showConfirmButton" => false,
            "allowOutsideClick" => false,
        );
        echo swalAlert($arrAlert);
        echo "<script>topReload(500)</script>";
        echo topReload();
        echo "</script>";

    }

    function viewUnsyncedHutangDagang()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuSupplier");
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentAntiSource");
        $this->load->model("Mdls/MdlCabang");


        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $ids = array();
        $ffStocks = array();

        //------------------------------------------------------
        $c = new ComRekeningPembantuSupplier();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("hutang dagang");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "kredit" => $row->kredit,
                );
                $ids[] = $row->extern_id;
            }
        }
        //------------------------------------------------------
        $l = new MdlPaymentSource();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("sisa>'0'");
        $l->addFilter("target_jenis in ('487', '489', '4891')");
        $lSource = $l->lookupAll()->result();
        $srcData = array();
        if (sizeof($lSource) > 0) {
            foreach ($lSource as $srcSpec) {
                if (!isset($srcData[$srcSpec->extern_id])) {
                    $srcData[$srcSpec->extern_id] = 0;
                }
                $srcData[$srcSpec->extern_id] += $srcSpec->sisa;
            }
        }
        //------------------------------------------------------
        $m = new MdlPaymentAntiSource();
        $m->addFilter("cabang_id='$branchID'");
        $m->addFilter("sisa>'0'");
        $m->addFilter("target_jenis in ('487', '489', '4891')");
        $mAntiSrc = $m->lookupAll()->result();
        $antiSrcData = array();
        if (sizeof($mAntiSrc) > 0) {
            foreach ($mAntiSrc as $srcSpec) {
                if (!isset($antiSrcData[$srcSpec->extern_id])) {
                    $antiSrcData[$srcSpec->extern_id] = 0;
                }
                $antiSrcData[$srcSpec->extern_id] += $srcSpec->sisa;
            }
        }
        //------------------------------------------------------

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }
        //------------------------------------------------------
        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
            "kredit" => "rek kredit",
            "pymSrc" => "pym src",
            "pymASrc" => "pym anti<br>src",
            "netto" => "netto",
            "selisih" => "selisih",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            $this->db->trans_start();

            foreach ($products as $pID => $pSpec) {

                $jmlRek = isset($pSpec['kredit']) ? $pSpec['kredit'] : 0;
                $jmlPymSrc = isset($srcData[$pID]) ? $srcData[$pID] : 0;
                $jmlPymAntiSrc = isset($antiSrcData[$pID]) ? $antiSrcData[$pID] : 0;
                $jmlNetto = $jmlPymSrc - $jmlPymAntiSrc;
                $selisih = $jmlRek - $jmlPymSrc;

                $items[] = array(
                    "pID" => $pID,
                    "pName" => $pSpec['name'],
                    "kredit" => $jmlRek,
                    "pymSrc" => $jmlPymSrc,
                    "pymASrc" => $jmlPymAntiSrc,
                    "netto" => $jmlNetto,
                    "selisih" => $selisih,
                );
                $markingColumn[$pID] = array(
                    "kredit" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "netto" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );

                $bg_color = "";
                $add = "";
                //                if ($jmlLoker != $pSpec['stock']) {
                //                    $bg_color = "background-color:yellow;";
                //                    $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                //                }

                $nof++;
                if (round($jmlRek, 2) != round($jmlPymSrc, 2)) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }


                //                if ($pSpec['stock'] != $jmlLoker) {

                //                    $marking[$pID] = array(
                //                        "add_name" => "(yellow)",
                //                        "background-color" => "yellow",
                //                    );

                //hilangkan saja
                //                    $ll = new MdlLockerValue();
                //                    $ll->updateData(
                //                        array(
                //                            "jenis" => "kas",
                //                            "jenis_locker" => "value",
                //                            "cabang_id" => $branchID,
                //                            "gudang_id" => $whID,
                //                            "produk_id" => $pID,
                //                            "transaski_id" => 0,
                //                            "state" => "active",
                //                        ), array(
                ////                            "produk_id" => 6666,
                //                            "nilai" => $jmlActive_new,
                ////                            "nama" => "unknown",
                ////                            "state" => "dest",
                //                        )
                //                    );
                //                    $update = $this->db->last_query() . ";";
                //
                //
                //                    $ll = new MdlLockerValue();
                //                    $ll->addData(
                //                        array(
                //                            "jenis" => "kas",
                //                            "jenis_locker" => "value",
                //                            "cabang_id" => $branchID,
                //                            "gudang_id" => $whID,
                //                            "produk_id" => $pID,
                //                            "nama" => $pSpec['name'],
                //                            "oleh_id" => 0,
                //                            "transaksi_id" => 0,
                //                            "state" => "active",
                //                            "nilai" => $jmlActive_new,
                ////                            "nilai" => $pSpec['stock'],
                //                        )
                //                    );
                //                    $insert = $this->db->last_query() . ";";

                //                    $warning[$nof] = array(
                //                        "update" => $update,
                ////                        "insert" => $insert,
                //                    );
                //                }
                //                else {
                //
                //                }
            }

            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        }


        $data = array(
            "mode" => "index",
            "title" => "HUTANG DAGANG ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    //---------------------------------------------------
    // ================ ================ ================


    // grouping menu
    public function viewTransaksi_ui()
    {
        $this->load->model("Mdls/MdlMenuGroup");
        $this->load->model("Mdls/MdlMenuGroupUi");
        $gr = new MdlMenuGroup();
        $gu = new MdlMenuGroupUi();

        // $gDatas = $gr->lookupAll()->result();
        $gDatas = $gr->callGroupMenuTransaksi();
        $uDatas = $gu->callGroupMenuTransaksiUi();
        // showLast_query("orange");

        // arrPrint($gDatas);
        // arrPrint($uDatas);

        $confSources = $this->config->item("heTransaksi_ui");
        $jeniseGroup = $gu->callJenisGroup("transaksi");

        $jml_groupJenis = sizeof($jeniseGroup);
        $jml_jenis = sizeof($confSources);
        // arrPrint($confSources);
        // arrPrint($jeniseGroup);
        // matiHere();
        $jml_kolom = 4;
        $jml_perkolom = (int)($jml_jenis / $jml_kolom);
        // cekHere("UJ=$jml_jenis /// GJ=$jml_groupJenis");

        ksort($confSources);
        $xx = 0;
        foreach ($confSources as $jenis => $confSource) {
            $xx++;
            $label = $confSource['label'];
            $groupJenies = isset($jeniseGroup[$jenis]) ? $jeniseGroup[$jenis] : array();
            $hasil = "";
            foreach ($groupJenies as $groupJeny) {
                $var = $groupJeny;
                if ($hasil == "") {
                    $hasil .= "<i style='color: red;'>$var</i>";
                }
                else {
                    $hasil = "<b>$hasil</b>" . "-<i style='color: deepskyblue;'>$var</i>";
                }
            }
            $strGjeny = $hasil;

            $groupJ = isset($jeniseGroup[$jenis]) ? "-" . $strGjeny : "";
            // echo "<b>$jenis</b>-$label$groupJ<br>";
            // echo "<div class='col-md-3 border-cek'>**</div>";
        }

        $data = array(
            "mode" => "viewMenu",
            "title" => "control group menu transaksi",
            "subTitle" => "cicicici",
            "confSources" => $confSources,
            "jeniseGroup" => $jeniseGroup,
            "jenis_group" => "transaksi",
            // "groupJenies" => $groupJenies,
            // "confReportObject"  => $confReportObject,
            // "sumCabang"         => $sumCabang,
            // "sumSubject"        => $sumSubject,
            // "sumObject"         => $sumObject,
            // "tblHeadings"       => $header,
            // "tblBodies"         => $bodies,
            "linkEditor" => base_url() . get_class($this) . "/formMenuGroup",
            "names" => isset($names) ? $names : array(),
            // "jenisTr"           => $this->jenisTr,
            "trName" => "",
        );
        $this->load->view("tool", $data);
    }

    public function viewData_ui()
    {
        $this->load->model("Mdls/MdlMenuGroup");
        $this->load->model("Mdls/MdlMenuGroupUi");
        // $gr = new MdlMenuGroup();
        $gu = new MdlMenuGroupUi();

        // $gDatas = $gr->lookupAll()->result();
        // $gDatas = $gr->callGroupMenuTransaksi();
        // $gDatas_2 = $gr->callGroupMenu("data");
        // $uDatas = $gu->callGroupMenuTransaksiUi();
        // showLast_query("orange");

        // arrPrint($gDatas);
        // arrPrint($gDatas_2);
        // arrPrint($uDatas);
        $confSources = $this->config->item('heDataBehaviour');
        // $confSources = $this->config->item("heTransaksi_ui");
        $jeniseGroup = $gu->callJenisGroup("data");

        $jml_groupJenis = sizeof($jeniseGroup);
        $jml_jenis = sizeof($confSources);
        // arrPrint($confSources);
        // arrPrint($jeniseGroup);
        // matiHere();
        $jml_kolom = 4;
        $jml_perkolom = (int)($jml_jenis / $jml_kolom);
        // cekHere("UJ=$jml_jenis /// GJ=$jml_groupJenis");

        ksort($confSources);
        $xx = 0;
        foreach ($confSources as $jenis => $confSource) {
            $xx++;
            $label = $confSource['label'];
            $groupJenies = isset($jeniseGroup[$jenis]) ? $jeniseGroup[$jenis] : array();
            $hasil = "";
            foreach ($groupJenies as $groupJeny) {
                $var = $groupJeny;
                if ($hasil == "") {
                    $hasil .= "<i style='color: red;'>$var</i>";
                }
                else {
                    $hasil = "<b>$hasil</b>" . "-<i style='color: deepskyblue;'>$var</i>";
                }
            }
            $strGjeny = $hasil;

            $groupJ = isset($jeniseGroup[$jenis]) ? "-" . $strGjeny : "";
            // echo "<b>$jenis</b>-$label$groupJ<br>";
            // echo "<div class='col-md-3 border-cek'>**</div>";
        }

        $data = array(
            "mode" => "viewMenu",
            "title" => "control group menu data",
            "subTitle" => "huahahaha",
            "confSources" => $confSources,
            "jeniseGroup" => $jeniseGroup,
            "jenis_group" => "data",
            // "confReportObject"  => $confReportObject,
            // "sumCabang"         => $sumCabang,
            // "sumSubject"        => $sumSubject,
            // "sumObject"         => $sumObject,
            // "tblHeadings"       => $header,
            // "tblBodies"         => $bodies,
            "linkEditor" => base_url() . get_class($this) . "/formMenuGroup",
            "names" => isset($names) ? $names : array(),
            // "jenisTr"           => $this->jenisTr,
            "trName" => "",
        );
        $this->load->view("tool", $data);
    }

    public function formmenuGroup()
    {
        $ss = $this->uri->segment_array();
        $trJenis = $this->uri->segment(3);
        $trLabel_e = $this->uri->segment(4);
        $trGroupJenis_e = (strlen($this->uri->segment(5)) > 0) ? $this->uri->segment(5) : "transaksi";
        $trLabel = base64_decode($trLabel_e);
        $this->load->model("Mdls/MdlMenuGroup");
        $this->load->model("Mdls/MdlMenuGroupUi");
        $gr = new MdlMenuGroup();
        $gu = new MdlMenuGroupUi();
        // $gDatas = $gr->lookupAll()->result();
        $gDatas = $gr->callGroupMenu($trGroupJenis_e);
        $uDatas = $gu->callGroupMenuTransaksiUi();
        $uJenisGroups = $gu->callJenisGroup($trGroupJenis_e);

        // cekLime($trGroupJenis_e);
        // arrPrint($uDatas['menuGroup_members']);
        $menuGroupMember = array();
        foreach ($uDatas['menuGroup_members'] as $mnGroup => $menuGroup_member) {
            $menuGroupMember[$mnGroup] = sizeof($menuGroup_member);
        }
        // arrPrint($uJenisGroups);
        $onGroups = isset($uJenisGroups[$trJenis]) ? $uJenisGroups[$trJenis] : array();
        // arrPrint($onGroups);
        // arrPrintWebs($uDatas);
        // arrPrintWebs($gDatas);
        // arrPrint($ss);
        // cekBiru("$trJenis --- $trLabel");
        $fields = array(
            "nama" => array(
                "label" => "group",
            )
        );

        foreach ($gDatas as $gData) {
            $gNama = $gData->nama;
        }

        $data = array(
            "mode" => "modalCheck",
            "title" => "control group menu transaksi",
            "forms" => $gDatas,
            "menuGroupMember" => $menuGroupMember,
            "onGroups" => $onGroups,
            "actions" => "",
            "trjenis" => $trJenis,
            "field" => $fields,
            "heading" => $trLabel,
            "linkSave" => base_url() . get_class($this),
            "footer" => form_button('reload', 'close & reload', "class='btn btn-warning pull-right' onclick=\"top.window.location.reload();\""),
            "target" => "result",
        );
        $this->load->view("data", $data);

    }

    public function saveGroup()
    {
        $this->load->model("Mdls/MdlMenuGroupUi");
        $gu = new MdlMenuGroupUi();

        $ss = $this->uri->segment_array();
        $arrDatas_e = $this->uri->segment(3);
        $arrDatas = blobDecode($arrDatas_e);

        $cekData = $gu->lookupByCondition($arrDatas);
        $jmlData = $cekData->num_rows();
        showLast_query("lime", "data:$jmlData");

        if ($jmlData == 0) {
            // insert
            $insertDatas = $arrDatas;
            $insertDatas["author_id"] = my_id();
            $gu->addData($insertDatas);
            showLast_query("merah");
        }
        else {
            $datas = $cekData->result();
            arrPrint($datas);
            $data_id = $datas[0]->id;
            $condites = array(
                "id" => $data_id
            );
            $update_datas = array(
                "trash" => 1,
            );
            $gu->updateData($condites, $update_datas);
            showLast_query("orange");
            // delete
        }

        // arrPrint();
        // arrPrintWebs($ss);
        // arrPrint($arrDatas);
        // matiHere();
    }


    function genFifoPpv()
    {

        //        $mode = "produk";
        $mode = "supplies";
        $cabangID = "25";
        $gudangDefault = getDefaultWarehouseID($cabangID);

        $gudangIDs = array();
        $gudangIDs[$gudangDefault['gudang_id']] = $gudangDefault['gudang_id'];

        // deteksi gudang rusak
        $this->load->model("Mdls/MdlProduk");
        $this->load->model("Mdls/MdlGudang");
        $g = New MdlGudang();
        $g->addFilter("cabang_id='" . $cabangID . "'");
        $gTmp = $g->lookupAll()->result();
        foreach ($gTmp as $ggTmp) {
            $gudangIDs[$ggTmp->id] = $ggTmp->id;
        }


        $produkBlacklist = array();
        switch ($mode) {
            case "produk":
                $ppv_setting = "1.25";
                $mdl = "MdlFifoProdukJadi";
                $p = New MdlProduk();
                $p->setFilters(array());
                $p->addFilter("jenis='item_rakitan'");
                $pTmp = $p->lookupAll()->result();
                foreach ($pTmp as $pTmpSpec) {
                    $produkBlacklist[$pTmpSpec->id] = $pTmpSpec->id;
                }

                break;
            case "supplies":
                $ppv_setting = "1.0";
                $mdl = "MdlFifoSupplies";

                break;
            default:

                mati_disini("tidak ada mode yang dipilih");

                break;
        }


        //        arrPrintWebs($produkBlacklist);

        $this->load->model("Mdls/$mdl");
        $m = New $mdl;
        $m->addFilter("unit>'0'");
        $tmp = $m->lookupAll()->result();
        showLast_query("biru");
        //        mati_disini();

        if (sizeof($tmp) > 0) {
            $arrUpdateFifo = array();
            $ppvTotal = 0;
            $ppvCabang = array();
            $trIDFifo = array();
            $pIDFifo = array();
            foreach ($tmp as $tmpSpec) {
                //                arrPrintWebs($tmpSpec);
                $jml = $tmpSpec->unit;
                $hpp_std = $tmpSpec->hpp;
                $jml_nilai_std = $tmpSpec->jml_nilai;

                $hpp_riil = $hpp_std / $ppv_setting;
                $jml_nilai_riil = $hpp_riil * $jml;

                $ppv_nilai_riil = $jml_nilai_std - $jml_nilai_riil;
                $ppv_riil = $ppv_nilai_riil / $jml;

                //cekHere("PID: $tmpSpec->produk_id, PName: $tmpSpec->produk_nama, jml: $jml, budget: $hpp_std, riil: $hpp_riil, ppv: $ppv_riil");

                if (!isset($ppvCabang[$tmpSpec->cabang_id])) {
                    $ppvCabang[$tmpSpec->cabang_id] = 0;
                }

                $pIDFifo[$tmpSpec->produk_id] = $tmpSpec->produk_id;

                if (!in_array($tmpSpec->produk_id, $produkBlacklist)) {
                    $trIDFifo[$tmpSpec->transaksi_id] = $tmpSpec->transaksi_id;
                    $arrUpdateFifo[$tmpSpec->id] = array(
                        "hpp_riil" => $hpp_riil,
                        "jml_nilai_riil" => $jml_nilai_riil,
                        "ppv_riil" => $ppv_riil,
                        "ppv_nilai_riil" => $ppv_nilai_riil,
                        "transaksi_id" => $tmpSpec->transaksi_id,
                        "produk_id" => $tmpSpec->produk_id,
                    );
                    $ppvCabang[$tmpSpec->cabang_id] += $ppv_nilai_riil;
                    $ppvTotal += $ppv_nilai_riil;
                }
                else {
                    $arrUpdateFifo[$tmpSpec->id] = array(
                        "hpp_riil" => $hpp_std,
                        "jml_nilai_riil" => $hpp_std,
                        "ppv_riil" => 0,
                        "ppv_nilai_riil" => 0,
                        "transaksi_id" => $tmpSpec->transaksi_id,
                        "produk_id" => $tmpSpec->produk_id,
                    );
                    $ppvCabang[$tmpSpec->cabang_id] += 0;
                    $ppvTotal += 0;
                }

                //                cekHere("hppstd: $hpp_std, jmlnilaistd: $jml_nilai_std, hppriil: $hpp_riil, jmlnilairiil: $jml_nilai_riil, ppvriil: $ppv_riil, ppvnilairiil: $ppv_nilai_riil");
                //                break;
            }

            $pakai_ini = 1;
            $trDatas = array();
            $psDatas = array();
            $vendorDatas = array();
            if ($pakai_ini == 1) {
                if (sizeof($trIDFifo) > 0) {
                    $this->load->model("MdlTransaksi");
                    $tr = New MdlTransaksi();
                    $tr->addFilter("id in ('" . implode("','", $trIDFifo) . "')");
                    $trTmp = $tr->lookupAll()->result();
                    if (sizeof($trTmp) > 0) {
                        foreach ($trTmp as $trSpec) {
                            $trDatas[$trSpec->id] = array(
                                "suppliers_id" => $trSpec->suppliers_id,
                                "suppliers_nama" => $trSpec->suppliers_nama,
                            );
                        }
                    }
                }
            }
            elseif ($pakai_ini == 2) {
                if (sizeof($pIDFifo) > 0) {
                    $this->load->model("Mdls/MdlProdukPerSupplier");
                    $this->load->model("Mdls/MdlSuppliers");

                    $sp = New MdlSuppliers();
                    $sp->setFilters(array());
                    $spTmp = $sp->lookupAll()->result();
                    foreach ($spTmp as $spSpec) {
                        $vendorDatas[$spSpec->id] = $spSpec->nama;
                    }

                    $ps = New MdlProdukPerSupplier();
                    $ps->addFilter("produk_id in ('" . implode("','", $pIDFifo) . "')");
                    $trTmp = $ps->lookupAll()->result();

                    if (sizeof($trTmp) > 0) {
                        foreach ($trTmp as $trSpec) {
                            $psDatas[$trSpec->produk_id] = array(
                                "suppliers_id" => $trSpec->suppliers_id,
                                //                                "suppliers_nama" => $trSpec->suppliers_nama,
                            );
                        }

                    }
                }
            }
            else {

            }


            $this->db->trans_start();

            $totalPpvNilai = 0;
            if (sizeof($arrUpdateFifo) > 0) {
                foreach ($arrUpdateFifo as $idTbl => $uSpec) {

                    // menambahn kolom suppliers_id dan suppliers_nama untuk update tabel fifo
                    if (isset($trDatas[$uSpec['transaksi_id']])) {
                        $uSpec['suppliers_id'] = $trDatas[$uSpec['transaksi_id']]['suppliers_id'];
                        $uSpec['suppliers_nama'] = $trDatas[$uSpec['transaksi_id']]['suppliers_nama'];
                    }

                    if (isset($psDatas[$uSpec['produk_id']])) {
                        $uSpec['suppliers_id'] = isset($psDatas[$uSpec['produk_id']]['suppliers_id']) ? $psDatas[$uSpec['produk_id']]['suppliers_id'] : 0;
                        $uSpec['suppliers_nama'] = isset($vendorDatas[$psDatas[$uSpec['produk_id']]['suppliers_id']]) ? $vendorDatas[$psDatas[$uSpec['produk_id']]['suppliers_id']] : "";
                    }

                    // menambah kolom ppn_in dan ppn_in_nilai
                    $uSpec['ppn_in'] = 0;
                    $uSpec['ppn_in_nilai'] = 0;
                    //arrprint($uSpec);
                    $totalPpvNilai += $uSpec['ppv_nilai_riil'];

                    $m = New $mdl();
                    $where = array(
                        "id" => $idTbl,
                    );
                    $rslt = $m->updateData($where, $uSpec);
                    showLast_query("orange");

                }
            }


            mati_disini("SELESAI " . __FUNCTION__ . " total PPV FIFO: $totalPpvNilai");

            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

            cekHijau("OKE, DONE ====  total PPV FIFO: $totalPpvNilai");
        }
    }


    // patch harga beli supplies
    function patchPriceSupplies()
    {
        $jenis = "supplies";
        $this->load->model("Mdls/MdlHargaSupplies");

    }


    function patchLastPurchase()
    {

        $this->load->model("Mdls/MdlFifoProdukJadi");
        $this->load->model("Mdls/MdlHargaProdukLastPurchase");

        $ff = New MdlFifoProdukJadi();
        $ff->setFilters(array());
        $ff->addFilter("cabang_id='-1'");
        $tmp = $ff->lookupAll()->result();
        //        showLast_query("biru");
        if (sizeof($tmp) > 0) {
            $result = array();
            foreach ($tmp as $tmpSpec) {

                $result[$tmpSpec->produk_id] = array(
                    "jenis" => "produk",
                    "jenis_value" => "hpp",
                    "produk_id" => $tmpSpec->produk_id,
                    "produk_nama" => $tmpSpec->produk_nama,
                    //                    "hpp" => $tmpSpec->hpp,
                    "nilai" => $tmpSpec->hpp / 1.25,
                    "cabang_id" => $tmpSpec->cabang_id,
                    "dtime" => date("Y-m-d H:i:s"),
                );
            }

            //            arrPrintWebs($result);

        }


        $this->db->trans_start();

        if (sizeof($result) > 0) {
            foreach ($result as $spec) {

                $lp = New MdlHargaProdukLastPurchase();
                $lp->setFilters(array());
                $lp->addFilter("produk_id=" . $spec['produk_id'] . "");
                $lp->addFilter("jenis=" . $spec['jenis'] . "");
                $lp->addFilter("jenis_value=" . $spec['jenis_value'] . "");
                $rslt = $lp->lookupAll()->result();
                if (sizeof($rslt) > 0) {
                    $where = array(
                        "id" => $rslt[0]->id,
                    );
                    $lp->updateData($where, $spec);
                }
                else {

                    $lp->addData($spec);
                }
                showLast_query("lime");
            }
        }


        mati_disini();

        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
    }

    //--------------------------------------
    function patchLastPurchaseSupplies()
    {

        $this->load->model("Mdls/MdlFifoSupplies");
        $this->load->model("Mdls/MdlHargaSupplies");
        $this->load->model("Mdls/MdlCabang");


        $cabangID = "-1";

        $ff = New MdlFifoSupplies();
        $ff->setFilters(array());
        $ff->setSortBy(array("kolom" => "id",
            "mode" => "ASC"
        ));
        $ff->addFilter("cabang_id='$cabangID'");
        $ffTmp = $ff->lookupAll()->result();
        //showLast_query("biru");
        $arrFifo = array();
        if (sizeof($ffTmp) > 0) {
            foreach ($ffTmp as $spec) {
                $arrFifo[$spec->produk_id] = $spec->hpp;
            }
        }
        //arrPrintWebs($arrFifo);
        //mati_disini();

        $l = new MdlHargaSupplies();
        $l->setFilters(array());
        $l->addFilter("jenis='supplies'");
        $l->addFilter("jenis_value='hpp'");
        $lTmp = $l->lookupAll()->result();
        $arrPriceSupplies = array();
        foreach ($lTmp as $spec) {
            $arrPriceSupplies[$spec->cabang_id][$spec->produk_id] = $spec->nilai;
        }


        $cb = New MdlCabang();
        $cb->addFilter("status='1'");
        $cb->addFilter("trash='0'");
        $cbTmp = $cb->lookupAll()->result();


        $arrHargaSuppliesUpdate = array();
        if (sizeof($cbTmp) > 0) {
            foreach ($cbTmp as $spec) {
                //                foreach ($arrPriceSupplies[$spec->id] as $pID => $nilai){
                //                    if(array_key_exists($pID, $arrFifo) && ($nilai == 0)){
                //                        // ini insert ke tabel price
                //                        $data = array(
                //                            "jenis" => "supplies",
                //                            "jenis_value" => "hpp",
                //                            "produk_id" => $pID,
                //                            "cabang_id" => $spec->id,
                //                            "nilai" => isset($arrFifo[$pID]) ? $arrFifo[$pID] : 0,
                //                            "oleh_id" => "-100",
                //                            "oleh_nama" => "system",
                //                            "keterangan" => "harga beli by system",
                //                        );
                //                        $arrHargaSuppliesUpdate[] = $data;
                //                    }
                //                }
                foreach ($arrFifo as $pID => $nilai) {
                    //                    if(!isset($arrPriceSupplies[$spec->id][$pID])){
                    if (isset($arrPriceSupplies[$spec->id][$pID]) && ($arrPriceSupplies[$spec->id][$pID] <= 0)) {
                        $data = array(
                            "jenis" => "supplies",
                            "jenis_value" => "hpp",
                            "produk_id" => $pID,
                            "cabang_id" => $spec->id,
                            "nilai" => $nilai,
                            "oleh_id" => "-100",
                            "oleh_nama" => "system",
                            "keterangan" => "harga beli by system",
                            "dtime" => date("Y-m-d H:i:s"),
                        );
                        $arrHargaSuppliesUpdate[] = $data;
                    }
                }
            }
        }


        $this->db->trans_start();

        if (sizeof($arrHargaSuppliesUpdate) > 0) {
            foreach ($arrHargaSuppliesUpdate as $dataUpdate) {
                //                arrPrintWebs($dataUpdate);
                $s = New MdlHargaSupplies();
                $s->addData($dataUpdate);
                showLast_query("biru");
            }
        }


        mati_disini();

        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");


    }


    //--------------------------------------
    public function getOpnameKeluar()
    {
        $trID = "75003";

        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlProduk2");


        $p = New MdlProduk2();
        $tmp = $p->lookupAll()->result();
        $pData = array();
        foreach ($tmp as $spec) {
            $pData[$spec->id] = array(
                "kode" => $spec->kode,
                "no_part" => $spec->no_part,
                "label" => $spec->label,
            );
        }

        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("transaksi_id='$trID'");
        $tr->addFilter("param in ('rsltItems', 'items')");
        $tmp = $tr->lookupRegistries()->result();
        foreach ($tmp as $tmps) {
            $param = $tmps->param;

            $$param = blobDecode($tmps->values);
        }

        $itemData = array();
        foreach ($items as $pID => $specs) {
            $spec = (object)$specs;
            $itemData[$pID] = array(
                "qty_buku" => $spec->stok,
                "qty_riil" => $spec->qty_opname,
            );
        }


        $arrData = array();
        $arrDataTerakhir = array();
        $arrDataPID = array();
        foreach ($rsltItems as $specs) {
            $spec = (object)$specs;

            $arrData[$spec->id][] = array(
                "nama" => $spec->nama,
                "qty" => $spec->qty,
                "hpp" => $spec->hpp,
                "subhpp" => $spec->sub_hpp,
            );
            if (!isset($arrDataPID[$spec->id])) {
                $arrDataPID[$spec->id] = 0;
            }
            $arrDataPID[$spec->id] += $spec->sub_hpp;


            $arrDataTerakhir[$spec->id] = array(
                "nama" => $spec->nama,
                "qty" => $spec->qty,
                "hpp" => $spec->hpp,
                "subhpp" => $spec->sub_hpp,
            );

        }
        //        arrPrintWebs($arrData);


        $str = "";
        $str .= "<table rules='all' style='border:solid 1px black;'>";
        $str .= "<tr>";
        $str .= "<td class='text-center'>No.</td>";
        $str .= "<td class='text-center'>pID</td>";
        $str .= "<td class='text-left'>Label</td>";
        $str .= "<td class='text-left'>Kode</td>";
        $str .= "<td class='text-left'>Part NO</td>";
        $str .= "<td class='text-left'>Produk</td>";

        $str .= "<td class='text-right'>STOK BUKU</td>";
        $str .= "<td class='text-right'>QTY (-)</td>";
        $str .= "<td class='text-right'>STOK RIIL</td>";

        $str .= "<td class='text-right'>HPP</td>";
        $str .= "<td class='text-right'>SUBTOTAL</td>";
        $str .= "</tr>";
        $total = 0;
        $no = 0;
        foreach ($arrData as $pID => $spec) {
            foreach ($spec as $subspec) {
                $no++;
                $total += $subspec['subhpp'];
                $str .= "<tr>";
                $str .= "<td align='center'>" . $no . "</td>";
                $str .= "<td align='center'>" . $pID . "</td>";
                $str .= "<td align='left'>" . $pData[$pID]['label'] . "</td>";
                $str .= "<td align='left'>" . $pData[$pID]['kode'] . "</td>";
                $str .= "<td align='left'>" . $pData[$pID]['no_part'] . "</td>";
                $str .= "<td align='left'>" . $subspec['nama'] . "</td>";

                $str .= "<td align='right'>" . formatField("debet", $itemData[$pID]['qty_buku']) . "</td>";
                $str .= "<td align='right'>" . formatField("debet", $subspec['qty']) . "</td>";
                $str .= "<td align='right'>" . formatField("debet", $itemData[$pID]['qty_riil']) . "</td>";

                $str .= "<td align='right'>" . formatField("debet", $subspec['hpp']) . "</td>";
                $str .= "<td align='right'>" . formatField("debet", $subspec['subhpp']) . "</td>";
                $str .= "</tr>";
            }
        }
        $str .= "<tr>";
        $str .= "<td align='center' colspan='10'>TOTAL</td>";
        $str .= "<td align='right'>" . formatField("debet", $total) . "</td>";
        $str .= "</tr>";
        $str .= "</table>";

        echo $str;
    }

    public function getOpnameMasuk()
    {
        $trID = "75003";

        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlProduk2");
        $this->load->model("Mdls/MdlHargaProduk");


        $p = New MdlProduk2();
        $tmp = $p->lookupAll()->result();
        $pData = array();
        foreach ($tmp as $spec) {
            $pData[$spec->id] = array(
                "kode" => $spec->kode,
                "no_part" => $spec->no_part,
                "label" => $spec->label,
            );
        }

        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("transaksi_id='$trID'");
        $tr->addFilter("param in ('items')");
        $tmp = $tr->lookupRegistries()->result();
        foreach ($tmp as $tmps) {
            $param = $tmps->param;

            $$param = blobDecode($tmps->values);
        }


        $arrData = array();
        $arrDataTerakhir = array();
        $arrDataPID = array();
        foreach ($items as $specs) {
            $spec = (object)$specs;
            if (($spec->qty_kredit == 0)) {
                $arrData[$spec->id][] = array(
                    "nama" => $spec->nama,
                    "qty" => $spec->qty_debet,
                    "hpp" => $spec->hpp,
                    "subhpp" => $spec->qty_debet * $spec->hpp,
                    "qty_buku" => $spec->stok,
                    "qty_riil" => $spec->qty_opname,
                );

                if (!isset($arrDataPID[$spec->id])) {
                    $arrDataPID[$spec->id] = 0;
                }
                $arrDataPID[$spec->id] += $spec->qty_debet * $spec->hpp;
            }
        }
        $arrProdukIDs = array_keys($arrDataPID);
        //arrPrint($arrProdukIDs);

        $h = New MdlHargaProduk();
        $h->setFilters(array());
        $h->addFilter("status='1'");
        $h->addFilter("trash='0'");
        $h->addFilter("jenis='produk'");
        $h->addFilter("jenis_value='hpp'");
        $h->addFilter("cabang_id='-1'");
        $h->addFilter("produk_id in ('" . implode("','", $arrProdukIDs) . "')");
        $hTmp = $h->lookupAll()->result();
        $hargaProduk = array();
        foreach ($hTmp as $spec) {
            $hargaProduk[$spec->produk_id] = $spec->nilai;
        }


        $str = "";
        $str .= "<table rules='all' style='border:solid 1px black;'>";
        $str .= "<tr>";
        $str .= "<td class='text-center'>No.</td>";
        $str .= "<td class='text-center'>pID</td>";
        $str .= "<td class='text-left'>Label</td>";
        $str .= "<td class='text-left'>Kode</td>";
        $str .= "<td class='text-left'>Part NO</td>";
        $str .= "<td class='text-left'>Produk</td>";

        $str .= "<td class='text-right'>STOK BUKU</td>";
        $str .= "<td class='text-right'>QTY (+)</td>";
        $str .= "<td class='text-right'>STOK RIIL</td>";

        $str .= "<td class='text-right'>HPP</td>";
        $str .= "<td class='text-right'>SUBTOTAL</td>";
        $str .= "</tr>";
        $total = 0;
        $no = 0;
        foreach ($arrData as $pID => $spec) {
            foreach ($spec as $subspec) {

                $no++;
                $total += $subspec['subhpp'];
                $str .= "<tr>";
                $str .= "<td align='center'>" . $no . "</td>";
                $str .= "<td align='center'>" . $pID . "</td>";
                $str .= "<td align='left'>" . $pData[$pID]['label'] . "</td>";
                $str .= "<td align='left'>" . $pData[$pID]['kode'] . "</td>";
                $str .= "<td align='left'>" . $pData[$pID]['no_part'] . "</td>";
                $str .= "<td align='left'>" . $subspec['nama'] . "</td>";

                $str .= "<td align='right'>" . formatField("debet", $subspec['qty_buku']) . "</td>";
                $str .= "<td align='right'>" . formatField("debet", $subspec['qty']) . "</td>";
                $str .= "<td align='right'>" . formatField("debet", $subspec['qty_riil']) . "</td>";

                $str .= "<td align='right'>" . formatField("debet", $subspec['hpp']) . "</td>";
                $str .= "<td align='right'>" . formatField("debet", $subspec['subhpp']) . "</td>";
                $str .= "</tr>";
            }
        }
        $str .= "<tr>";
        $str .= "<td align='center' colspan='10'>TOTAL</td>";
        $str .= "<td align='right'>" . formatField("debet", $total) . "</td>";
        $str .= "</tr>";
        $str .= "</table>";

        echo $str;
    }


    //--------------------------------------
    public function genSignMongo()
    {
        $date = "2021-01-07";
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlMongoMother");

        $tabelMainKey = "main";
        $tabelKey = "sign";

        //        $tr = New MdlTransaksi();
        //        $tr->setTableName($tr->getTableNames()[$tabelMainKey]);
        //        $tr->setFilters(array());
        //        $tr->addFilter("date(dtime)='$date'");
        //        $tr->addFilter("link_id='0'");
        //        $trTmp = $tr->lookupAll()->result();
        //        showLast_query("biru");
        //        $trIDs = array();
        //        foreach($trTmp as $spec){
        //            $trIDs[] = $spec->id;
        //        }
        //arrPrintWebs($trIDs);

        $tr = New MdlTransaksi();
        $tr->setTableName($tr->getTableNames()[$tabelKey]);
        $tr->setFilters(array());
        //        $tr->addFilter("transaksi_id in ('". implode("','", $trIDs) ."')");
        $tr->addFilter("date(dtime)='$date'");
        $tr->setSortBy(array("kolom" => "id",
            "mode" => "ASC"
        ));
        $trTmp = $tr->lookupAll()->result();
        showLast_query("biru");


        //        mati_disini(sizeof($trTmp));

        foreach ($trTmp as $spec) {
            //            arrPrintWebs($spec);
            $sm = New MdlMongoMother();
            $sm->setTableName($sm->getColection()[$tabelKey]);
            $sm->setFilters(array());
            $sm->addFilter(array("id" => $spec->id));
            $smTmp = $sm->lookupAll();
            if (sizeof($smTmp) == 0) {
                cekPink2("insert baru " . $spec->id);
                //                $sm->addData((array)$spec);
            }
            //            else{
            //                cekPink("sudah ada " . $spec->id);
            //            }
        }
        cekHijau("DONE");
    }


    //--------------------------------------
    public function genLockerRakitan()
    {
        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("Mdls/MdlLockerStock");


        $cm = New ComRekeningPembantuProduk();
        $cm->setTableName($cm->getTableName());
        $cm->addFilter("periode='forever'");
        $cm->addFilter("rekening='persediaan produk rakitan'");
        $cm->addFilter("cabang_id='25'");
        $cmTmp = $cm->lookupAll()->result();
        //        arrPrintWebs($cmTmp);
        $arrQty = array();
        $arrQtyData = array();
        foreach ($cmTmp as $spec) {
            $arrQty[$spec->extern_id] = $spec->qty_debet;
            $arrQtyData[$spec->extern_id] = array(
                "jenis" => "produk rakitan",
                "jenis_locker" => "stock",
                "jumlah" => $spec->qty_debet,
                "cabang_id" => $spec->cabang_id,
                "gudang_id" => $spec->gudang_id,
                "produk_id" => $spec->extern_id,
                "nama" => $spec->extern_nama,
                "state" => "active",
            );
        }
        //        arrPrintWebs($arrQtyData);


        $this->db->trans_start();

        $ls = New MdlLockerStock();
        $ls->setFilters(array());
        foreach ($arrQtyData as $arrQtyDataSpec) {

            $ls->addData($arrQtyDataSpec);
            showLast_query("kuning");
        }


        mati_disini("SETOPPP...");
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        cekHijau("OKE, DONE");
    }

    public function genLockerProduk()
    {
        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("Mdls/MdlLockerStock");


        $cm = New ComRekeningPembantuProduk();
        $cm->setTableName($cm->getTableName());
        $cm->addFilter("periode='forever'");
        $cm->addFilter("rekening='persediaan produk'");
        $cm->addFilter("cabang_id='25'");
        $cm->addFilter("gudang_id='-250'");
        $cmTmp = $cm->lookupAll()->result();
        //        arrPrintWebs($cmTmp);
        $arrQty = array();
        $arrQtyData = array();
        foreach ($cmTmp as $spec) {
            $arrQty[$spec->extern_id] = $spec->qty_debet;
            $arrQtyData[$spec->extern_id] = array(
                "jenis" => "produk",
                "jenis_locker" => "stock",
                "jumlah" => $spec->qty_debet,
                "cabang_id" => $spec->cabang_id,
                "gudang_id" => $spec->gudang_id,
                "produk_id" => $spec->extern_id,
                "nama" => $spec->extern_nama,
                "state" => "active",
            );
        }
        //        arrPrintWebs($arrQtyData);


        $this->db->trans_start();

        foreach ($arrQtyData as $arrQtyDataSpec) {

            $ls = New MdlLockerStock();
            $ls->setFilters(array());
            $ls->addFilter("state='active'");
            $ls->addFilter("produk_id=" . $arrQtyDataSpec['produk_id']);
            $ls->addFilter("cabang_id=" . $arrQtyDataSpec['cabang_id']);
            $ls->addFilter("gudang_id=" . $arrQtyDataSpec['gudang_id']);
            $tmp = $ls->lookupAll()->result();
            showLast_query("biru");
            if (sizeof($tmp) > 0) {
                //update
                $arrData = array(
                    "jumlah" => $arrQtyDataSpec['jumlah'],
                );
                $ls->updateData(array("id" => $tmp[0]->id), $arrData);
                showLast_query("hijau");
            }
            else {
                //insert
                $ls->addData($arrQtyDataSpec);
                showLast_query("kuning");
            }

        }


        //        mati_disini("SETOPPP...");
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        cekHijau("OKE, DONE");
    }


    //--------------------------------------
    //--------------------------------------
    public function genLockerSupplies()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlLockerStockSupplies");

        $arrIDs = array(76841,
            76845,
            76847
        );

        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("id in ('" . implode("','", $arrIDs) . "')");
        $trTmp = $tr->lookupAll()->result();
        $regIDs = array();
        foreach ($trTmp as $tmp) {
            $indexReg = blobDecode($tmp->indexing_registry);
            $regIDs[] = $indexReg['items2_sum'];
        }
        if (sizeof($regIDs) > 0) {
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id in ('" . implode("','", $regIDs) . "')");
            $trReg = $tr->lookupRegistries()->result();
            showLast_query("biru");
            $suppliesQty = array();
            $suppliesData = array();
            foreach ($trReg as $tmp) {

                $values = blobDecode($tmp->values);
                //                arrPrintWebs($values);
                foreach ($values as $spID => $spSpec) {
                    if (!isset($suppliesQty[$spSpec['id']])) {
                        $suppliesQty[$spSpec['id']] = 0;
                    }
                    $suppliesQty[$spSpec['id']] += $spSpec['jml'];
                    $suppliesData[$spSpec['id']] = array(
                        "produk_id" => $spSpec['id'],
                        "nama" => $spSpec['nama'],
                        "state" => "active",
                        "jenis" => "supplies_proses",
                        "jenis_locker" => "stock",
                    );
                }
            }

            $this->db->trans_start();

            arrPrintWebs($suppliesQty);
            foreach ($suppliesQty as $pID => $qty) {

                $ls = New MdlLockerStockSupplies();
                $ls->setFilters(array());
                $ls->addFilter("cabang_id='25'");
                $ls->addFilter("gudang_id='-250'");
                $ls->addFilter("state='active'");
                $ls->addFilter("jenis='supplies_proses'");
                $ls->addFilter("jenis_locker='stock'");
                $ls->addFilter("produk_id='$pID'");
                $lsTmp = $ls->lookupAll()->result();
                if (sizeof($lsTmp) > 0) {
                    //update
                    $where = array(
                        "cabang_id" => "25",
                        "gudang_id" => "-250",
                        "produk_id" => "$pID",
                        "jenis" => "supplies_proses",
                        "jenis_locker" => "stock",
                        "state" => "active",
                    );
                    $data = array(
                        "jumlah" => $qty,
                    );
                    $ls->updateData($where, $data);
                    showLast_query("orange");
                }
                else {
                    //insert
                    $addData = array(
                        "produk_id" => $suppliesData[$pID]['produk_id'],
                        "nama" => $suppliesData[$pID]['nama'],
                        "state" => "active",
                        "jenis" => "supplies_proses",
                        "jenis_locker" => "stock",
                        "jumlah" => $qty,
                        "cabang_id" => "25",
                        "gudang_id" => "-250",
                    );
                    $ls->addData($addData);
                    showLast_query("hijau");
                }

            }
            mati_disini("=====================");
            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
            cekHijau("-- DONE --");
        }
    }


    //--cek laporan pindah ke mongo--------------
    public function viewCheckerReportToMongo()
    {
        $this->load->model("Mdls/MdlReport");

        $r = New MdlReport();
        $tableNamesPenjualan = $r->getTableNames()['penjualan']['tableName'];
        $tablePenjualan = array_flip($tableNamesPenjualan);

        $items = array();
        foreach ($tablePenjualan as $table => $label) {

            $filter = array("mongo" => 0);
            $tmp = $r->lookupData($table, $filter)->result();

            $items[] = array(
                "tabel" => $table,
                "label" => $label,
                "jumlah" => sizeof($tmp),
            );
        }


        $headerFields = array(
            "tabel" => "tabel",
            "label" => "alias",
            "jumlah" => "jumlah",
        );
        $data = array(
            "mode" => "stock",
            "title" => "report penjualan to mongo",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "items2" => array(),
            "items3" => array(),
            "items2_label" => "",
            "items3_label" => "",
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => $thisPage,
            "filters" => array(),
            "q" => "",
            "search" => false,
        );
        $this->load->view("tool", $data);
    }


    //--cek service payment
    public function viewServicePayment()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Coms/ComJurnal");

        $tr = New MdlTransaksi();
        $jj = New ComJurnal();

        //---------------------------------------------------
        //        $jenisTr = "462";
        //        $jenisTr = "1462";
        $jenisTr = $this->uri->segment(3) != NULL ? $this->uri->segment(3) : "462";

        $jj->addFilter("jenis=$jenisTr");
        $jjTmp = $jj->lookupAll()->result();

        $arrJurnal = array();
        $arrTrID = array();
        $arrTrID_add = array();
        $arrItems = array();
        $arrItemsResult = array();
        $arrJurnalRekening = array();

        if (sizeof($jjTmp) > 0) {
            foreach ($jjTmp as $jjSpec) {
                $arrJurnal[$jjSpec->transaksi_id][$jjSpec->rekening] = $jjSpec->debet > 0 ? $jjSpec->debet : $jjSpec->kredit;
                $arrTrID[$jjSpec->transaksi_id] = $jjSpec->transaksi_id;
                $arrJurnalRekening[$jjSpec->rekening] = $jjSpec->rekening;
            }
        }
        //        arrPrintWebs($arrJurnal);

        //---------------------------------------------------
        $fields = array(
            "id",
            "nomer",
            "indexing_registry",
        );
        $this->db->select($fields);
        $this->db->where_in("id", $arrTrID);
        $trTmp = $this->db->get($tr->getTableNames()['main'])->result();

        $trIDs_index = array();
        $trIDs_index_null = array();
        foreach ($trTmp as $spec) {
            $trID = $spec->id;
            $nomer = $spec->nomer;
            $indexReg = isset($spec->indexing_registry) ? $spec->indexing_registry : NULL;
            if ($indexReg == NULL) {
                $trIDs_index_null[] = $trID;
            }
            else {
                $indexReg_decode = blobDecode($indexReg);
                $trIDs_index[] = $indexReg_decode['main'];
            }
            $arrTrID_add[$trID] = array(
                "transID" => $trID,
                "nomer" => $nomer,
            );
        }

        //---------------------------------------------------
        if (sizeof($trIDs_index) > 0) {
            $fieldReg = array(
                "vendorDetails" => "externID",
                "vendorDetails__label" => "externNama",
                "vendorDetails__npwp" => "externNpwp",
                "pph23Method" => "pph23Method",
                "pphGateLabel" => "pphGateLabel",
                "dtime" => "dtime",
                "akun_pph_label" => "biaya usaha (detail)",
            );
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("trash=0");
            $tr->addFilter("id in (" . implode(",", $trIDs_index) . ")");
            $trReg = $tr->lookupRegistries()->result();

            foreach ($trReg as $spec) {
                $decode = blobDecode($spec->values);
                foreach ($decode as $key => $val) {
                    if (array_key_exists($key, $fieldReg)) {
                        $arrItems[$spec->transaksi_id][$key] = $val;
                    }
                }
            }
        }
        //---------------------------------------------------
        if (sizeof($trIDs_index_null) > 0) {
            $fieldReg = array(
                "vendorDetails" => "externID",
                "vendorDetails__label" => "externNama",
                "vendorDetails__npwp" => "externNpwp",
                "pph23Method" => "pph23Method",
                "pphGateLabel" => "pphGateLabel",
                "dtime" => "dtime",
                "akun_pph_label" => "biaya usaha (detail)",
            );
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("trash=0");
            $tr->addFilter("param='main''");
            $tr->addFilter("transaksi_id in (" . implode(",", $trIDs_index_null) . ")");
            $trReg = $tr->lookupRegistries()->result();

            foreach ($trReg as $spec) {
                $decode = blobDecode($spec->values);
                foreach ($decode as $key => $val) {
                    if (array_key_exists($key, $fieldReg)) {
                        $arrItems[$spec->transaksi_id][$key] = $val;

                    }
                }
            }
        }
        //---------------------------------------------------
        foreach ($arrItems as $trID => $spec) {
            if (isset($arrJurnal[$trID])) {
                foreach ($arrJurnal[$trID] as $key => $val) {
                    $spec[$key] = $val;
                }
            }
            if (isset($arrTrID_add[$trID])) {
                foreach ($arrTrID_add[$trID] as $key => $val) {
                    $spec[$key] = $val;
                }
            }

            //            arrPrintWebs($spec);
            $pphGate = (isset($spec['pphGateLabel']) && ($spec['pphGateLabel'] != NULL)) ? $spec['pphGateLabel'] : "nono";
            $pphMethod = (isset($spec['pph23Method']) && ($spec['pph23Method'] != NULL)) ? $spec['pph23Method'] : "nono";
            if (($pphGate == "tidak dipotong") && ($pphMethod == "npwp")) {

                $arrItemsResult[$trID] = $spec;
            }


        }
        //arrPrintWebs($arrItemsResult);


        $headerFields = array(
            "transID" => "trid",
            "dtime" => "dtime",
            "nomer" => "nomer",
            "vendorDetails" => "vendor id",
            "vendorDetails__label" => "vendor label",
            "vendorDetails__npwp" => "vendor npwp",
            "pph23Method" => "pph23 method",
            "pphGateLabel" => "pph23 status",
            "akun_pph_label" => "biaya usaha (detail)",
        );
        $headerFields = $headerFields + $arrJurnalRekening;
        ksort($arrItemsResult);
        $data = array(
            "mode" => "stock",
            "title" => "cek payment service",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $arrItemsResult,
            "items2" => array(),
            "items3" => array(),
            "items2_label" => "",
            "items3_label" => "",
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => $thisPage,
            "filters" => array(),
            "q" => "",
            "search" => false,
        );
        $this->load->view("tool", $data);


    }

    //--cek pembantu hutang pph ps 23
    public function viewPembantuHutangPph23()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Coms/ComRekeningPembantuPphMain");
        $this->load->model("Coms/ComJurnal");

        $tr = New MdlTransaksi();
        $jj = New ComJurnal();
        $ph = New ComRekeningPembantuPphMain();


        $jenisTr = "115";
        $rekening = "hutang pph23";


        //---baca jurnal jenis 115
        $jj->addFilter("jenis=$jenisTr");
        $jj->addFilter("rekening=$rekening");
        $jjTmp = $jj->lookupAll()->result();
        $pphTmp = array();
        $trIDTmp = array();
        if (sizeof($jjTmp) > 0) {
            foreach ($jjTmp as $spec) {
                $pphTmp[$spec->transaksi_id] = array(
                    "nomer" => $spec->transaksi_no,
                    "rekening" => $spec->rekening,
                    "nilai" => $spec->debet,
                );
                $trIDTmp[$spec->transaksi_id] = $spec->transaksi_id;
            }
        }


        //---baca transaksi jenis 115
        $tr->addFilter("jenis=$jenisTr");
        $trTmp = $tr->lookupAll()->result();
        $transTmp = array();
        $transTmpByVendor = array();
        $transJurnalNilai = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $transTmp[$trSpec->id] = array(
                    "vendorID" => $trSpec->suppliers_id,
                    "vendorNama" => $trSpec->suppliers_nama,
                );
                $transTmpByVendor[$trSpec->suppliers_id] = $trSpec->suppliers_nama;
                if (!isset($transJurnalNilai[$trSpec->suppliers_id])) {
                    $transJurnalNilai[$trSpec->suppliers_id] = 0;
                }
                $nilaiJurnal = isset($pphTmp[$trSpec->id]['nilai']) ? $pphTmp[$trSpec->id]['nilai'] : 0;
                $transJurnalNilai[$trSpec->suppliers_id] += $nilaiJurnal;
            }
        }


        //---baca transaksi jenis 115
        $phTmp = $ph->fetchBalances($rekening);
        showLast_query("pink2");
        $pph23Tmp = array();
        if (sizeof($phTmp) > 0) {
            foreach ($phTmp as $phSpec) {
                $pph23Tmp[$phSpec->extern_id] = ($phSpec->kredit > 0) ? $phSpec->kredit : $phSpec->debet * -1;
            }
        }


        //-------------------------------------
        $arrItemsResult = array();
        if (sizeof($transTmpByVendor) > 0) {
            foreach ($transTmpByVendor as $vendorID => $vendorNama) {
                $saldo = isset($pph23Tmp[$vendorID]) ? $pph23Tmp[$vendorID] : 0;
                $jurnal_nilai = isset($transJurnalNilai[$vendorID]) ? $transJurnalNilai[$vendorID] : 0;
                //                $adjust =
                $arrItemsResult[$vendorID] = array(
                    "vendorID" => $vendorID,
                    "vendorNama" => $vendorNama,
                    "saldo" => $saldo,
                    "pymsrc" => "payment src",
                    "jurnal" => $jurnal_nilai,
                );
            }
        }


        $headerFields = array(
            "vendorID" => "vendorID",
            "vendorNama" => "vendorNama",
            "saldo" => "saldo",
            "pymsrc" => "payment src",
            "jurnal" => "jurnal",
        );
        $data = array(
            "mode" => "stock",
            "title" => "cek payment service",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $arrItemsResult,
            "items2" => array(),
            "items3" => array(),
            "items2_label" => "",
            "items3_label" => "",
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => $thisPage,
            "filters" => array(),
            "q" => "",
            "search" => false,
        );
        $this->load->view("tool", $data);


    }


    //--------------------------------------
    public function viewHutangDagang()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuSupplier");
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentAntiSource");
        $this->load->model("Mdls/MdlCabang");


        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $ids = array();
        $ffStocks = array();

        //------------------------------------------------------
        $c = new ComRekeningPembantuSupplier();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("hutang dagang");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "kredit" => $row->kredit,
                );
                $ids[] = $row->extern_id;
            }
        }
        //------------------------------------------------------
        $this->load->helper("he_mass_table_helper");
        $c = new ComRekeningPembantuSupplier();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchMovesAll("hutang dagang");
        $arrMutasi = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                if (!isset($arrMutasi[$row->extern_id]['debet'])) {
                    $arrMutasi[$row->extern_id]['debet'] = 0;
                }
                if (!isset($arrMutasi[$row->extern_id]['kredit'])) {
                    $arrMutasi[$row->extern_id]['kredit'] = 0;
                }
                $arrMutasi[$row->extern_id]['debet'] += $row->debet;
                $arrMutasi[$row->extern_id]['kredit'] += $row->kredit;
            }
        }
        //        arrPrintWebs($arrMutasi);
        //------------------------------------------------------
        $l = new MdlPaymentSource();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("sisa>'0'");
        $l->addFilter("target_jenis in ('487', '489', '4891')");
        $lSource = $l->lookupAll()->result();
        $srcData = array();
        if (sizeof($lSource) > 0) {
            foreach ($lSource as $srcSpec) {
                if (!isset($srcData[$srcSpec->extern_id])) {
                    $srcData[$srcSpec->extern_id] = 0;
                }
                $srcData[$srcSpec->extern_id] += $srcSpec->sisa;
            }
        }
        //------------------------------------------------------
        $m = new MdlPaymentAntiSource();
        $m->addFilter("cabang_id='$branchID'");
        $m->addFilter("sisa>'0'");
        $m->addFilter("target_jenis in ('487', '489', '4891')");
        $mAntiSrc = $m->lookupAll()->result();
        $antiSrcData = array();
        if (sizeof($mAntiSrc) > 0) {
            foreach ($mAntiSrc as $srcSpec) {
                if (!isset($antiSrcData[$srcSpec->extern_id])) {
                    $antiSrcData[$srcSpec->extern_id] = 0;
                }
                $antiSrcData[$srcSpec->extern_id] += $srcSpec->sisa;
            }
        }
        //------------------------------------------------------

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }
        //------------------------------------------------------
        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
            "saldo_cache" => "rek kredit",
            "pymSrc" => "pym src",
            "pymASrc" => "pym anti<br>src",
            "netto" => "netto",

            "debet" => "keluar",
            "kredit" => "masuk",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            foreach ($products as $pID => $pSpec) {

                $jmlRek = isset($pSpec['kredit']) ? $pSpec['kredit'] : 0;
                $jmlPymSrc = isset($srcData[$pID]) ? $srcData[$pID] : 0;
                $jmlPymAntiSrc = isset($antiSrcData[$pID]) ? $antiSrcData[$pID] : 0;
                $jmlNetto = $jmlPymSrc - $jmlPymAntiSrc;

                $kredit = isset($arrMutasi[$pID]['kredit']) ? $arrMutasi[$pID]['kredit'] : 0;
                $debet = isset($arrMutasi[$pID]['debet']) ? $arrMutasi[$pID]['debet'] : 0;


                $items[] = array(
                    "pID" => $pID,
                    "pName" => $pSpec['name'],
                    "saldo_cache" => $jmlRek,
                    "pymSrc" => $jmlPymSrc,
                    "pymASrc" => $jmlPymAntiSrc,
                    "netto" => $jmlNetto,

                    "debet" => $debet,
                    "kredit" => $kredit,
                );
                $markingColumn[$pID] = array(
                    "kredit" => array(
                        "background-color" => "#B5FF7B",
                    ),
                    "netto" => array(
                        "background-color" => "#B5FF7B",
                    ),
                );

                $bg_color = "";
                $add = "";

                $nof++;
                if (round($jmlRek, 2) != round($jmlPymSrc, 2)) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }
            }


        }


        $data = array(
            "mode" => "index",
            "title" => "HUTANG DAGANG ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    public function viewHutangDagangPymSrc()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        $vendorID = null != $this->uri->segment(4) ? $this->uri->segment(4) : NULL;

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;
        //cekHitam(":: $ctrl :: $method :: $cabangID :: $vendorID ::");
        //-----------------------------------------
        $this->load->model("Coms/ComRekeningPembantuSupplier");
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentAntiSource");
        $this->load->model("MdlTransaksi");


        $this->load->helper("he_mass_table_helper");


        $c = new ComRekeningPembantuSupplier();
        $c->addFilter("cabang_id='$branchID'");
        if ($vendorID != NULL) {
            $c->addFilter("extern_id='$vendorID'");
        }
        $tmp = $c->fetchMovesAll("hutang dagang");
        $arrTrID = array();
        $arrMutasi = array();
        $arrTrNumber = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                if ($row->kredit > 0) {
                    $arrTrID[$row->transaksi_id] = $row->transaksi_id;
                    $arrMutasi[$row->transaksi_id] = $row->kredit;
                    $arrTrNumber[$row->transaksi_id] = array(
                        "nomer" => $row->transaksi_no,
                        "dtime" => $row->dtime,
                        "jenis" => $row->jenis,
                    );
                }
            }
        }
        //-----------------------------------------
        $l = new MdlPaymentSource();
        $l->addFilter("cabang_id='$branchID'");
        if ($vendorID != NULL) {
            $l->addFilter("extern_id='$vendorID'");
        }
        $l->addFilter("target_jenis in ('487', '489', '4891')");
        $lSource = $l->lookupAll()->result();
        $srcData = array();
        if (sizeof($lSource) > 0) {
            foreach ($lSource as $srcSpec) {
                $srcData[$srcSpec->transaksi_id] = array(
                    "nomer" => $srcSpec->nomer,
                );
            }
        }
        //------------------------------------------------------
        $m = new MdlPaymentAntiSource();
        $m->addFilter("cabang_id='$branchID'");
        if ($vendorID != NULL) {
            $l->addFilter("extern_id='$vendorID'");
        }
        $m->addFilter("target_jenis in ('487', '489', '4891')");
        $mAntiSrc = $m->lookupAll()->result();
        $antiSrcData = array();
        if (sizeof($mAntiSrc) > 0) {
            foreach ($mAntiSrc as $srcSpec) {
                $antiSrcData[$srcSpec->transaksi_id] = array(
                    "nomer" => $srcSpec->nomer,
                );
            }
        }
        //------------------------------------------------------
        if ($vendorID != NULL) {
            $tr = New MdlTransaksi();
            $tr->addFilter("suppliers_id='$vendorID'");
            $tr->addFilter("id in ('" . implode("','", $arrTrID) . "')");
            $trTmp = $tr->lookupAll()->result();
            $arrVendorTrID_data = array();
            if (sizeof($trTmp) > 0) {
                foreach ($trTmp as $trSpec) {
                    $arrVendorTrID_data[$trSpec->id] = array(
                        "oleh_id" => $trSpec->oleh_id,
                        "oleh_nama" => $trSpec->oleh_nama,
                        "dtime" => $trSpec->dtime,
                        "suppliers_id" => $trSpec->suppliers_id,
                        "suppliers_nama" => $trSpec->suppliers_nama,
                        "cabang_id" => $trSpec->cabang_id,
                        "cabang_nama" => $trSpec->cabang_nama,
                        "jenis" => $trSpec->jenis,
                        "transaksi_id" => $trSpec->id,

                    );
                }
            }


            $tr = New MdlTransaksi();
            $tr->addFilter("suppliers_id='$vendorID'");
            $tr->addFilter("jenis in ('487', '489', '4891')");
            $trTmp = $tr->lookupAll()->result();
            $arrVendorTrID = array();
            //            $arrVendorTrID_data = array();
            if (sizeof($trTmp) > 0) {
                foreach ($trTmp as $trSpec) {
                    //                    arrPrint($trSpec);
                    $arrVendorTrID[$trSpec->id] = $trSpec->id;
                    //                    $arrVendorTrID_data[$trSpec->id] = array(
                    //                        "oleh_id" => $trSpec->oleh_id,
                    //                        "oleh_nama" => $trSpec->oleh_nama,
                    //                        "dtime" => $trSpec->dtime,
                    //                        "suppliers_id" => $trSpec->suppliers_id,
                    //                        "suppliers_nama" => $trSpec->suppliers_nama,
                    //                        "cabang_id" => $trSpec->cabang_id,
                    //                        "cabang_nama" => $trSpec->cabang_nama,
                    //                        "jenis" => $trSpec->jenis,
                    //                        "transaksi_id" => $trSpec->id,
                    //
                    //                    );
                }
            }

            $arrBayarItem = array();
            if (sizeof($arrVendorTrID) > 0) {
                $reg = New MdlTransaksi();
                $reg->setFilters(array());
                $reg->addFilter("param='items'");
                $reg->addFilter("transaksi_id in ('" . implode("','", $arrVendorTrID) . "')");
                $regTmp = $reg->lookupRegistries()->result();
                if (sizeof($regTmp) > 0) {
                    foreach ($regTmp as $spec) {
                        $valuesDecode = blobDecode($spec->values);
                        //                        arrPrint($valuesDecode);
                        foreach ($valuesDecode as $id => $spec) {
                            if (!isset($arrBayarItem[$id])) {
                                $arrBayarItem[$id] = 0;
                            }
                            $arrBayarItem[$id] += isset($spec['nilai_bayar']) ? $spec['nilai_bayar'] : 0;

                        }
                    }
                }
            }
        }
        //        arrPrint($arrVendorTrID_data);
        //------------------------------------------------------


        $targetJenis = array(
            "460" => "4891",
            "461" => "487",
            "467" => "489",
        );
        $headerFields = array(
            "pID" => "trID",
            "dtime" => "dtime",
            "kredit" => "nilai",
            "nomer" => "nomer",
            "source" => "pym src",
            "anti_source" => "pym src<br>(anti)",
            "bayar" => "bayar",
            "sisa" => "sisa",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        $paymentSource = array();
        if (sizeof($arrMutasi) > 0) {
            foreach ($arrMutasi as $pID => $value) {
                $trNumber = isset($arrTrNumber[$pID]['nomer']) ? $arrTrNumber[$pID]['nomer'] : "-";
                $dtimeNumber = isset($arrTrNumber[$pID]['dtime']) ? $arrTrNumber[$pID]['dtime'] : "-";
                $srcNumber = isset($srcData[$pID]['nomer']) ? $srcData[$pID]['nomer'] : "-";
                $antiSrcNumber = isset($antiSrcData[$pID]['nomer']) ? $antiSrcData[$pID]['nomer'] : "-";
                $bayar = isset($arrBayarItem[$pID]) ? $arrBayarItem[$pID] : 0;
                $sisa = ($value - $bayar) > 0 ? $value - $bayar : 0;

                $items[] = array(
                    "pID" => $pID,
                    "dtime" => $dtimeNumber,
                    "kredit" => $value,
                    //------------------
                    "nomer" => $trNumber,
                    "source" => $srcNumber,
                    "anti_source" => $antiSrcNumber,
                    "bayar" => $bayar,
                    "sisa" => $sisa,
                );
                // bagian build payment source injector
                $jenisTr = isset($arrVendorTrID_data[$pID]['jenis']) ? $arrVendorTrID_data[$pID]['jenis'] : NULL;
                //                cekKuning("$pID .... $jenisTr masuk sini");

                if (array_key_exists($jenisTr, $targetJenis)) {
                    $paymentSource[$pID] = array(
                        "jenis" => $jenisTr,
                        "target_jenis" => $targetJenis[$jenisTr],
                        "reference_jenis" => isset($arrVendorTrID_data[$pID]['jenis']) ? $arrVendorTrID_data[$pID]['jenis'] : "",
                        "transaksi_id" => $pID,
                        "extern_id" => isset($arrVendorTrID_data[$pID]['suppliers_id']) ? $arrVendorTrID_data[$pID]['suppliers_id'] : "",
                        "extern_nama" => isset($arrVendorTrID_data[$pID]['suppliers_nama']) ? $arrVendorTrID_data[$pID]['suppliers_nama'] : "",
                        "nomer" => $trNumber,
                        "label" => "hutang dagang",
                        "tagihan" => $value,
                        "terbayar" => $bayar,
                        "sisa" => $sisa,
                        "cabang_id" => isset($arrVendorTrID_data[$pID]['cabang_id']) ? $arrVendorTrID_data[$pID]['cabang_id'] : "",
                        "cabang_nama" => isset($arrVendorTrID_data[$pID]['cabang_nama']) ? $arrVendorTrID_data[$pID]['cabang_nama'] : "",
                        "oleh_id" => isset($arrVendorTrID_data[$pID]['oleh_id']) ? $arrVendorTrID_data[$pID]['oleh_id'] : "",
                        "oleh_nama" => isset($arrVendorTrID_data[$pID]['oleh_nama']) ? $arrVendorTrID_data[$pID]['oleh_nama'] : "",
                        "dtime" => isset($arrVendorTrID_data[$pID]['dtime']) ? $arrVendorTrID_data[$pID]['dtime'] : "",
                        "fulldate" => isset($arrVendorTrID_data[$pID]['dtime']) ? $arrVendorTrID_data[$pID]['dtime'] : "",
                        //                        "ppn" => "",
                        //                        "ppn_approved" => "",
                    );

                }
            }
        }


        $this->db->trans_start();
        //arrPrintWebs($paymentSource);
        if (sizeof($paymentSource) > 0) {
            foreach ($paymentSource as $trID => $spec) {
                //                arrPrint($spec);
                $trp = New MdlTransaksi();
                $trp->setFilters(array());
                $trpTmp = $trp->lookupPaymentSrcs($trID, $spec['jenis']);
                if (sizeof($trpTmp) > 0) {
                    foreach ($trpTmp as $specTbl) {

                        $where = array(
                            "id" => $specTbl['id'],
                        );
                        $arrUpdate = array(
                            "terbayar" => $spec['terbayar'],
                            "sisa" => $spec['sisa'],
                        );
                        $trp->updatePaymentSrc($where, $arrUpdate);
                        showLast_query("orange");
                    }
                }
                else {
                    //                    cekHijau("insert");
                    $trp->writePaymentSrc($trID, $spec);
                    showLast_query("hijau");
                }
            }
        }


        //                mati_disini("SETOPPP...");
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        //        cekHijau("OKE, DONE");

        $data = array(
            "mode" => "index",
            "title" => "HUTANG DAGANG vs PAYMENT SOURCE",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => isset($arrButton) ? $arrButton : array(),
        );
        $this->load->view("tool", $data);
    }

    //---PIUTANG DAGANG----------------------------
    public function viewPiutangDagang()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;


        $this->load->model("Coms/ComRekeningPembantuCustomer");
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentAntiSource");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("MdlTransaksi");


        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $products = array();
        $ids = array();
        $ffStocks = array();

        //---TRANSAKSI INVOICING-----------------------------------
        $tr = New MdlTransaksi();
        $tr->addFilter("cabang_id='$branchID'");
        $tr->addFilter("jenis='582'");
        $trTmp = $tr->lookupAll()->result();
        $masterIDs = array();
        $arrInvoice = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $masterIDs[$trSpec->id] = $trSpec->id_master;
                //                $arrInvoice[$trSpec->id] = array(
                //                    "id" => $trSpec->id,
                //                    "id_master" => $trSpec->id_master,
                //                    "nomer" => $trSpec->nomer,
                //                    "dtime" => $trSpec->dtime,
                //                    "customers_id" => $trSpec->customers_id,
                //                    "customers_nama" => $trSpec->customers_nama,
                //                );
                //                $products[$trSpec->customers_id] = array(
                //                    "name" => $trSpec->customers_nama,
                ////                    "debet" => $row->debet,
                //                );
            }
        }

        //---TRANSAKSI MASTER_ID DENGAN 582spd-----------------------------------
        $tr = New MdlTransaksi();
        $tr->addFilter("cabang_id='$branchID'");
        $tr->addFilter("jenis='582spd'");
        $tr->addFilter("id_master in ('" . implode("','", $masterIDs) . "')");
        $trTmp = $tr->lookupAll()->result();
        $arrPackinglistID_masterID = array();
        $arrPackinglistID_invoiceID = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $arrPackinglistID_masterID[$trSpec->customers_id][$trSpec->id_master] = $trSpec->id;

                $arrPackinglistID_invoiceID[$trSpec->customers_id][$trSpec->id] = $trSpec->id; //packinglist
            }
        }
        //arrPrintWebs($arrPackinglistID_invoiceID);


        //------------------------------------------------------

        $c = new ComRekeningPembantuCustomer();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchBalances("piutang dagang");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "debet" => $row->debet,
                );
                $ids[] = $row->extern_id;
            }
        }


        //------------------------------------------------------

        $this->load->helper("he_mass_table_helper");
        $c = new ComRekeningPembantuCustomer();
        $c->addFilter("cabang_id='$branchID'");
        $tmp = $c->fetchMovesAll("piutang dagang");
        $arrMutasi = array();
        $arrMutasiNotInv = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                if (!isset($arrMutasi[$row->extern_id]['debet'])) {
                    $arrMutasi[$row->extern_id]['debet'] = 0;
                }
                if (!isset($arrMutasi[$row->extern_id]['kredit'])) {
                    $arrMutasi[$row->extern_id]['kredit'] = 0;
                }
                $arrMutasi[$row->extern_id]['debet'] += $row->debet;
                $arrMutasi[$row->extern_id]['kredit'] += $row->kredit;
                //---------------------
                if (isset($arrPackinglistID_invoiceID[$row->extern_id])) {
                    if (!in_array($row->transaksi_id, $arrPackinglistID_invoiceID[$row->extern_id])) {
                        if (!isset($arrMutasiNotInv[$row->extern_id]['nilai'])) {
                            $arrMutasiNotInv[$row->extern_id]['nilai'] = 0;
                        }
                        $arrMutasiNotInv[$row->extern_id]['nilai'] += $row->debet;
                    }
                }
            }
        }
        //        arrPrintWebs($arrMutasiNotInv);

        //------------------------------------------------------
        $l = new MdlPaymentSource();
        $l->addFilter("cabang_id='$branchID'");
        $l->addFilter("sisa>'0'");
        $l->addFilter("target_jenis in ('749')");
        $lSource = $l->lookupAll()->result();
        $srcData = array();
        if (sizeof($lSource) > 0) {
            foreach ($lSource as $srcSpec) {
                if (!isset($srcData[$srcSpec->extern_id])) {
                    $srcData[$srcSpec->extern_id] = 0;
                }
                $srcData[$srcSpec->extern_id] += $srcSpec->sisa;
            }
        }

        //------------------------------------------------------
        $m = new MdlPaymentAntiSource();
        $m->addFilter("cabang_id='$branchID'");
        $m->addFilter("sisa>'0'");
        $m->addFilter("target_jenis in ('749')");
        $mAntiSrc = $m->lookupAll()->result();
        $antiSrcData = array();
        if (sizeof($mAntiSrc) > 0) {
            foreach ($mAntiSrc as $srcSpec) {
                if (!isset($antiSrcData[$srcSpec->extern_id])) {
                    $antiSrcData[$srcSpec->extern_id] = 0;
                }
                $antiSrcData[$srcSpec->extern_id] += $srcSpec->sisa;
            }
        }

        //------------------------------------------------------

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        //------------------------------------------------------
        $headerFields = array(
            "pID" => "pID",
            "pName" => "product",
            "saldo_cache" => "rek kredit",
            //            "invoice" => "not invoicing",
            "pymSrc" => "pym src",
            "selisih" => "selisih",
            //            "pymASrc" => "pym anti<br>src",
            "netto" => "netto",

            "debet" => "masuk",
            "kredit" => "keluar",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($products) > 0) {

            foreach ($products as $pID => $pSpec) {
                //jumlah invoicing total
                $jmlNotInv = isset($arrMutasiNotInv[$pID]['nilai']) ? $arrMutasiNotInv[$pID]['nilai'] : 0;

                $jmlRek = isset($pSpec['debet']) ? $pSpec['debet'] : 0;
                $jmlPymSrc = isset($srcData[$pID]) ? $srcData[$pID] : 0;
                $jmlPymAntiSrc = isset($antiSrcData[$pID]) ? $antiSrcData[$pID] : 0;
                $jmlNetto = $jmlPymSrc - $jmlPymAntiSrc;

                $kredit = isset($arrMutasi[$pID]['kredit']) ? $arrMutasi[$pID]['kredit'] : 0;
                $debet = isset($arrMutasi[$pID]['debet']) ? $arrMutasi[$pID]['debet'] : 0;

                $selisih = $jmlRek - $jmlPymSrc;

                $items[] = array(
                    "pID" => $pID,
                    "pName" => $pSpec['name'],
                    "saldo_cache" => $jmlRek,
                    //                    "invoice" => $jmlNotInv,
                    "pymSrc" => $jmlPymSrc,
                    "selisih" => $selisih,
                    //                    "pymASrc" => $jmlPymAntiSrc,
                    "netto" => $jmlNetto,

                    "debet" => $debet,
                    "kredit" => $kredit,
                );
                //                $markingColumn[$pID] = array(
                //                    "debet" => array(
                //                        "background-color" => "#B5FF7B",
                //                    ),
                //                    "netto" => array(
                //                        "background-color" => "#B5FF7B",
                //                    ),
                //                );

                $bg_color = "";
                $add = "";

                $nof++;
                if (round($jmlRek, 2) != round($jmlPymSrc, 2)) {
                    $marking[$pID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }
            }


        }


        $data = array(
            "mode" => "index",
            "title" => "PIUTANG DAGANG ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );

        $this->load->view("tool", $data);
    }

    public function viewPiutangDagangPymSrc()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        $vendorID = null != $this->uri->segment(4) ? $this->uri->segment(4) : NULL;

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;
        //cekHitam(":: $ctrl :: $method :: $cabangID :: $vendorID ::");
        //-----------------------------------------
        $this->load->model("Coms/ComRekeningPembantuCustomer");
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentAntiSource");
        $this->load->model("MdlTransaksi");

        $this->load->helper("he_mass_table_helper");

        //---TRANSAKSI INVOICING-----------------------------------
        $tr = New MdlTransaksi();
        $tr->addFilter("cabang_id='$branchID'");
        $tr->addFilter("jenis='582'");
        if ($vendorID != NULL) {
            $tr->addFilter("customers_id='$vendorID'");
        }
        $trTmp = $tr->lookupAll()->result();
        $masterIDs = array();
        $arrInvoice = array();
        $arrVendorTrID_data = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $masterIDs[$trSpec->id] = $trSpec->id_master;
                $arrInvoice[$trSpec->id] = array(
                    "id" => $trSpec->id,
                    "id_master" => $trSpec->id_master,
                    "nomer" => $trSpec->nomer,
                    "dtime" => $trSpec->dtime,
                    "customers_id" => $trSpec->customers_id,
                    "customers_nama" => $trSpec->customers_nama,
                );
                $arrVendorTrID_data[$trSpec->id] = array(
                    "oleh_id" => $trSpec->oleh_id,
                    "oleh_nama" => $trSpec->oleh_nama,
                    "dtime" => $trSpec->dtime,
                    "customers_id" => $trSpec->customers_id,
                    "customers_nama" => $trSpec->customers_nama,
                    "cabang_id" => $trSpec->cabang_id,
                    "cabang_nama" => $trSpec->cabang_nama,
                    "jenis" => $trSpec->jenis,
                    "transaksi_id" => $trSpec->id,

                );
            }
        }

        //---TRANSAKSI MASTER_ID DENGAN 582spd-----------------------------------
        $tr = New MdlTransaksi();
        $tr->addFilter("cabang_id='$branchID'");
        $tr->addFilter("jenis='582spd'");
        $tr->addFilter("id_master in ('" . implode("','", $masterIDs) . "')");
        $trTmp = $tr->lookupAll()->result();
        //        showLast_query("kuning");
        $arrPackinglistID_masterID = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $arrPackinglistID_masterID[$trSpec->id_master] = $trSpec->id;
            }
        }
        //arrPrintWebs($arrPackinglistID_masterID);

        //---MUTASI PACKINGLIST-----------------------------------

        $c = new ComRekeningPembantuCustomer();
        $c->addFilter("cabang_id='$branchID'");
        if ($vendorID != NULL) {
            $c->addFilter("extern_id='$vendorID'");
        }
        $tmp = $c->fetchMovesAll("piutang dagang");
        $arrTrID = array();
        $arrMutasi = array();
        $arrTrNumber = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                if ($row->debet > 0) {
                    $arrTrID[$row->transaksi_id] = $row->transaksi_id;
                    $arrMutasi[$row->transaksi_id] = $row->debet;
                    $arrTrNumber[$row->transaksi_id] = array(
                        "nomer" => $row->transaksi_no,
                        "dtime" => $row->dtime,
                        "jenis" => $row->jenis,
                    );
                }
            }
        }

        //cekBiru(sizeof($tmp));
        //arrPrint($arrMutasi);


        //---PAYMENT SOURCE INVOICE-------------------------------

        $l = new MdlPaymentSource();
        $l->addFilter("cabang_id='$branchID'");
        if ($vendorID != NULL) {
            $l->addFilter("extern_id='$vendorID'");
        }
        $l->addFilter("target_jenis in ('749')");
        $lSource = $l->lookupAll()->result();
        //        showLast_query("biru");
        $srcData = array();
        if (sizeof($lSource) > 0) {
            foreach ($lSource as $srcSpec) {
                $srcData[$srcSpec->transaksi_id] = array(
                    "nomer" => $srcSpec->nomer,
                    "nilai" => $srcSpec->sisa,
                );
            }
        }

        //----PAYMENT ANTI SOURCE RETURN--------------------------------------------------

        //        $m = new MdlPaymentAntiSource();
        //        $m->addFilter("cabang_id='$branchID'");
        //        if ($vendorID != NULL) {
        //            $l->addFilter("extern_id='$vendorID'");
        //        }
        //        $m->addFilter("target_jenis in ('749')");
        //        $mAntiSrc = $m->lookupAll()->result();
        //        $antiSrcData = array();
        //        if (sizeof($mAntiSrc) > 0) {
        //            foreach ($mAntiSrc as $srcSpec) {
        //                $antiSrcData[$srcSpec->transaksi_id] = array(
        //                    "nomer" => $srcSpec->nomer,
        //                );
        //            }
        //        }

        //------------------------------------------------------

        if ($vendorID != NULL) {

            //            $tr = New MdlTransaksi();
            //            $tr->addFilter("customers_id='$vendorID'");
            //            $tr->addFilter("id in ('" . implode("','", $arrTrID) . "')"); // ini yang dibaca adalah 582spd
            //            $trTmp = $tr->lookupAll()->result();
            //            $arrVendorTrID_data = array();
            //            if (sizeof($trTmp) > 0) {
            //                foreach ($trTmp as $trSpec) {
            //                    $arrVendorTrID_data[$trSpec->id] = array(
            //                        "oleh_id" => $trSpec->oleh_id,
            //                        "oleh_nama" => $trSpec->oleh_nama,
            //                        "dtime" => $trSpec->dtime,
            //                        "customers_id" => $trSpec->customers_id,
            //                        "customers_nama" => $trSpec->customers_nama,
            //                        "cabang_id" => $trSpec->cabang_id,
            //                        "cabang_nama" => $trSpec->cabang_nama,
            //                        "jenis" => $trSpec->jenis,
            //                        "transaksi_id" => $trSpec->id,
            //
            //                    );
            //                }
            //            }
            //
            //
            $tr = New MdlTransaksi();
            $tr->addFilter("customers_id='$vendorID'");
            $tr->addFilter("jenis in ('749')");
            $trTmp = $tr->lookupAll()->result();
            $arrVendorTrID = array();
            if (sizeof($trTmp) > 0) {
                foreach ($trTmp as $trSpec) {
                    $arrVendorTrID[$trSpec->id] = $trSpec->id;

                }
            }

            $arrBayarItem = array();
            if (sizeof($arrVendorTrID) > 0) {
                $reg = New MdlTransaksi();
                $reg->setFilters(array());
                $reg->addFilter("param='items'");
                $reg->addFilter("transaksi_id in ('" . implode("','", $arrVendorTrID) . "')");
                $regTmp = $reg->lookupRegistries()->result();
                if (sizeof($regTmp) > 0) {
                    foreach ($regTmp as $spec) {
                        $valuesDecode = blobDecode($spec->values);
                        foreach ($valuesDecode as $id => $spec) {
                            if (!isset($arrBayarItem[$id])) {
                                $arrBayarItem[$id] = 0;
                            }
                            $arrBayarItem[$id] += isset($spec['nilai_bayar']) ? $spec['nilai_bayar'] : 0;// ini dapat detail 582

                        }
                    }
                }
            }
        }
        //        arrPrint($arrBayarItem);

        //------------------------------------------------------

        //mati_disini("SETOP...");

        $targetJenis = array(
            //            "460" => "4891",
            //            "461" => "487",
            "582" => "749",
        );
        $headerFields = array(
            "pID" => "trID",
            "dtime" => "dtime",
            "debet" => "nilai",
            "nomer" => "nomer",
            "source" => "pym src",
            "source_nilai" => "pym src<br>nilai",
            "anti_source" => "pym src<br>(anti)",
            "bayar" => "bayar",
            "sisa" => "sisa",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        $paymentSource = array();
        if (sizeof($arrInvoice) > 0) {
            foreach ($arrInvoice as $pID => $invSpec) {
                $masterID = $invSpec['id_master'];
                $packinglistID = $arrPackinglistID_masterID[$masterID];
                $rekNilai = isset($arrMutasi[$packinglistID]) ? $arrMutasi[$packinglistID] : 0;

                $trNumber = isset($invSpec[$pID]['nomer']) ? $invSpec[$pID]['nomer'] : "-";
                $dtimeNumber = isset($invSpec[$pID]['dtime']) ? $invSpec[$pID]['dtime'] : "-";

                $srcNumber = isset($srcData[$pID]['nomer']) ? $srcData[$pID]['nomer'] : "-";
                $srcNilai = isset($srcData[$pID]['nilai']) ? $srcData[$pID]['nilai'] : "-";
                //                $antiSrcNumber = isset($antiSrcData[$pID]['nomer']) ? $antiSrcData[$pID]['nomer'] : "-";
                $bayar = isset($arrBayarItem[$pID]) ? $arrBayarItem[$pID] : 0;
                $sisa = ($rekNilai - $bayar) > 0 ? $rekNilai - $bayar : 0;


                $items[] = array(
                    "pID" => $pID,
                    "dtime" => $invSpec['dtime'],
                    "debet" => $rekNilai,
                    //------------------
                    "nomer" => $invSpec['nomer'],
                    "source" => $srcNumber,
                    "source_nilai" => $srcNilai,
                    "anti_source" => 0,
                    "bayar" => $bayar,
                    "sisa" => 0,
                );
                // bagian build payment source injector
                $jenisTr = isset($arrVendorTrID_data[$pID]['jenis']) ? $arrVendorTrID_data[$pID]['jenis'] : NULL;
                //                cekKuning("$pID .... $jenisTr masuk sini");

                if (array_key_exists($jenisTr, $targetJenis)) {
                    $paymentSource[$pID] = array(
                        "jenis" => $jenisTr,
                        "target_jenis" => $targetJenis[$jenisTr],
                        "reference_jenis" => isset($arrVendorTrID_data[$pID]['jenis']) ? $arrVendorTrID_data[$pID]['jenis'] : "",
                        "transaksi_id" => $pID,
                        "extern_id" => isset($arrVendorTrID_data[$pID]['customers_id']) ? $arrVendorTrID_data[$pID]['customers_id'] : "",
                        "extern_nama" => isset($arrVendorTrID_data[$pID]['customers_nama']) ? $arrVendorTrID_data[$pID]['customers_nama'] : "",
                        "nomer" => $trNumber,
                        "label" => "piutang dagang",
                        "tagihan" => $rekNilai,
                        "terbayar" => $bayar,
                        "sisa" => $sisa,
                        "cabang_id" => isset($arrVendorTrID_data[$pID]['cabang_id']) ? $arrVendorTrID_data[$pID]['cabang_id'] : "",
                        "cabang_nama" => isset($arrVendorTrID_data[$pID]['cabang_nama']) ? $arrVendorTrID_data[$pID]['cabang_nama'] : "",
                        "oleh_id" => isset($arrVendorTrID_data[$pID]['oleh_id']) ? $arrVendorTrID_data[$pID]['oleh_id'] : "",
                        "oleh_nama" => isset($arrVendorTrID_data[$pID]['oleh_nama']) ? $arrVendorTrID_data[$pID]['oleh_nama'] : "",
                        "dtime" => isset($arrVendorTrID_data[$pID]['dtime']) ? $arrVendorTrID_data[$pID]['dtime'] : "",
                        "fulldate" => isset($arrVendorTrID_data[$pID]['dtime']) ? $arrVendorTrID_data[$pID]['dtime'] : "",
                        //                        "ppn" => "",
                        //                        "ppn_approved" => "",
                    );

                }
            }
        }


        $this->db->trans_start();
        //        arrPrintWebs($paymentSource);
        if (sizeof($paymentSource) > 0) {
            foreach ($paymentSource as $trID => $spec) {
                //                arrPrint($spec);
                $trp = New MdlTransaksi();
                $trp->setFilters(array());
                $trpTmp = $trp->lookupPaymentSrcs($trID, $spec['jenis']);
                if (sizeof($trpTmp) > 0) {
                    foreach ($trpTmp as $specTbl) {

                        $where = array(
                            "id" => $specTbl['id'],
                        );
                        $arrUpdate = array(
                            "terbayar" => $spec['terbayar'],
                            "sisa" => $spec['sisa'],
                        );
                        $trp->updatePaymentSrc($where, $arrUpdate);
                        showLast_query("orange");
                    }
                }
                else {
                    //                    cekHijau("insert");
                    $trp->writePaymentSrc($trID, $spec);
                    showLast_query("hijau");
                }
            }
        }


        //                mati_disini("SETOPPP...");
        //        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        //        cekHijau("OKE, DONE");

        $data = array(
            "mode" => "index",
            "title" => "PIUTANG DAGANG vs PAYMENT SOURCE",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => isset($arrButton) ? $arrButton : array(),
        );
        $this->load->view("tool", $data);
    }

    public function viewSetoranKas()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        $vendorID = null != $this->uri->segment(4) ? $this->uri->segment(4) : NULL;

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;
        //-----------------------------------------
        //        $this->load->model("Coms/ComRekeningPembantuSupplier");
        $this->load->model("Mdls/MdlPaymentSource");
        //        $this->load->model("Mdls/MdlPaymentAntiSource");
        $this->load->model("MdlTransaksi");

        $this->load->helper("he_mass_table_helper");
        //-----------------------------------------
        $arrTrJenis = array(
            "582",
            "700",
            "749",
        );
        $arrAllowed = array("700",
            "749"
        );
        $arrNotAllowed = array("582");

        //---TRANSAKSI-----------------------------------
        $tr = New MdlTransaksi();
        $tr->addFilter("id_master>0");
        $tr->addFilter("jenis in ('" . implode("','", $arrAllowed) . "')");
        $trTmp = $tr->lookupAll()->result();
        //        showLast_query("kuning");
        //        cekKuning(sizeof($trTmp));
        $kolom = array(
            "id",
            "dtime",
            "jenis",
            "nomer",
            "oleh_id",
            "oleh_nama",
            "customers_id",
            "customers_nama",
            "cabang_id",
            "cabang_nama",
        );
        $arrTrData = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $sub = array();
                foreach ($kolom as $kol) {
                    $sub[$kol] = $trSpec->$kol;
                }
                $arrTrData[$trSpec->id] = $sub;

            }
        }

        //---PAYMENT SOURCE SETORAN-------------------------------
        $l = new MdlPaymentSource();
        $l->addFilter("target_jenis='759'");
        $l->addFilter("label='hutang setoran'");
        $lSource = $l->lookupAll()->result();
        //        showLast_query("biru");
        $pymSrc = array();
        if (sizeof($lSource) > 0) {
            foreach ($lSource as $spec) {
                $pymSrc[$spec->transaksi_id] = array(
                    "nomer_pymsrc" => $spec->nomer,
                );
            }
        }


        //-----------------------------------------
        $headerFields = array(
            "id" => "trID",
            // trID
            "dtime" => "dtime",
            "cabang_nama" => "cabang",
            "oleh_nama" => "oleh",
            "customers_nama" => "customer",
            "nomer" => "nomer",
            "nomer_pymsrc" => "nomer pymsrc",
        );

        if (sizeof($arrTrData) > 0) {
            foreach ($arrTrData as $trID => $spec) {
                if (isset($pymSrc[$trID])) {
                    foreach ($pymSrc[$trID] as $key => $val) {
                        $spec[$key] = $val;
                    }
                }

                $sub = array();
                $sub["pID"] = $trID;
                foreach ($headerFields as $key => $val) {
                    $sub[$key] = isset($spec[$key]) ? $spec[$key] : NULL;
                }
                if ($sub["nomer_pymsrc"] == NULL) {
                    $marking[$trID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }

                $items[] = $sub;
            }
        }
        //arrPrintWebs($marking);


        $data = array(
            "mode" => "index",
            "title" => "SETORAN KAS KE PUSAT",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => isset($arrButton) ? $arrButton : array(),
        );
        $this->load->view("tool", $data);
    }

    public function viewSetoranHutangPph23()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        $vendorID = null != $this->uri->segment(4) ? $this->uri->segment(4) : NULL;

        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = 0;
        //-----------------------------------------
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("MdlTransaksi");

        $this->load->helper("he_mass_table_helper");
        //-----------------------------------------

        $arrTrJenis = array(
            //            "462",
            //            "1462",
            //            "4449",
            //            "485",
            //            "463",
            //            "1463",
            "672",
        );


        //---TRANSAKSI-----------------------------------
        $tr = New MdlTransaksi();
        $tr->addFilter("id_master>0");
        $tr->addFilter("jenis in ('" . implode("','", $arrTrJenis) . "')");
        $trTmp = $tr->lookupAll()->result();
        //        showLast_query("kuning");
        //        cekKuning(sizeof($trTmp));
        $kolom = array(
            "id",
            "dtime",
            "jenis",
            "nomer",
            "oleh_id",
            "oleh_nama",
            "cabang_id",
            "cabang_nama",
            "customers_id",
            "customers_nama",
            "suppliers_id",
            "suppliers_nama",
        );
        $arrTrData = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $sub = array();
                foreach ($kolom as $kol) {
                    $sub[$kol] = $trSpec->$kol;
                }
                $arrTrData[$trSpec->id] = $sub;

            }
        }


        //---PAYMENT SOURCE SETORAN-------------------------------
        $l = new MdlPaymentSource();
        $l->addFilter("target_jenis='771'");
        //        $l->addFilter("label='hutang pph23'");
        //        $l->addFilter("target_jenis in ('462','1462')");
        $l->addFilter("label='refill pettycash'");
        $lSource = $l->lookupAll()->result();
        //        showLast_query("biru");
        $pymSrc = array();
        if (sizeof($lSource) > 0) {
            foreach ($lSource as $spec) {
                $pymSrc[$spec->transaksi_id] = array(
                    "nomer_pymsrc" => $spec->nomer,
                );
            }
        }


        //-----------------------------------------
        $headerFields = array(
            "id" => "trID",
            // trID
            "dtime" => "dtime",
            "cabang_nama" => "cabang",
            "oleh_nama" => "oleh",
            "suppliers_nama" => "vendor",
            "customers_nama" => "customer",
            "nomer" => "nomer",
            "nomer_pymsrc" => "nomer pymsrc",
        );


        if (sizeof($arrTrData) > 0) {
            foreach ($arrTrData as $trID => $spec) {
                if (isset($pymSrc[$trID])) {
                    foreach ($pymSrc[$trID] as $key => $val) {
                        $spec[$key] = $val;
                    }
                }

                $sub = array();
                $sub["pID"] = $trID;
                foreach ($headerFields as $key => $val) {
                    $sub[$key] = isset($spec[$key]) ? $spec[$key] : NULL;
                }
                if ($sub["nomer_pymsrc"] == NULL) {
                    $marking[$trID] = array(
                        "add_name" => "(yellow)",
                        "background-color" => "yellow",
                    );
                }

                $items[] = $sub;
            }
        }


        $data = array(
            "mode" => "index",
            "title" => "SETOR HUTANG PPH23",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => isset($arrButton) ? $arrButton : array(),
        );
        $this->load->view("tool", $data);
    }

    //==========================================================
    public function viewPembelianProgres()
    {
        header("refresh:60");

        $this->load->model("MdlTransaksi");

        $trJenis = array(
            "467",
            "967",
        );
        $cabangID = "-1";
        //--------------------
        $totalWaiting = 0;
        $totalSuccess = 0;
        //--------------------
        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("link_id='0'");
        $tr->addFilter("jenis in ('" . implode("','", $trJenis) . "')");
        $trTmp = $tr->lookupAll()->result();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                if ($trSpec->r_jenis == 0) {
                    $totalWaiting += 1;
                }
                elseif ($trSpec->r_jenis == 1) {
                    $totalSuccess += 1;
                }
            }
        }

        $totalData = sizeof($trTmp);
        $totalWaitingPersen = ($totalWaiting / $totalData) * 100;
        $totalSuccessPersen = ($totalSuccess / $totalData) * 100;
        $items = array();
        $items[] = array(
            "pID" => 1,
            "total" => $totalData,
            "done" => $totalSuccess,
            "waiting" => $totalWaiting,
            "done_persen" => $totalSuccessPersen,
            "waiting_persen" => $totalWaitingPersen,
        );

        $headerFields = array(
            "total" => "total data",
            "done" => "success",
            "waiting" => "waiting",
            "done_persen" => "success (%)",
            "waiting_persen" => "waiting (%)",
        );
        $data = array(
            "mode" => "indexLap",
            "title" => "PROGRESS LAP. PEMBELIAN",
            "subTitle" => "",
            "headerFields" => isset($headerFields) ? $headerFields : array(),
            "items" => isset($items) ? $items : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => isset($thisPage) ? $thisPage : "",
            "q" => isset($q) ? $q : "",

            "filters" => array(
                "date1" => isset($date1) ? $date1 : "",
                "date2" => isset($date2) ? $date2 : "",
                "dates" => date("Y-m-d"),
            ),
        );
        $this->load->view("tool", $data);
    }

    public function viewPenjualanProgres()
    {
        header("refresh:60");

        //        $anu = "2021-04-16";
        //        $mg = formatTanggal($anu, 'W') * 1;
        //        cekHere($mg);

        $this->load->model("MdlTransaksi");

        $trJenis = array(
            "582",
            "982",
        );
        $cabangID = "-1";
        //--------------------
        $totalWaiting = 0;
        $totalSuccess = 0;
        //--------------------
        $koloms = array(
            "id",
            "r_jenis",

        );
        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $this->db->select($koloms);
        $tr->addFilter("link_id='0'");
        $tr->addFilter("jenis in ('" . implode("','", $trJenis) . "')");
        $trTmp = $tr->lookupAll()->result();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                if ($trSpec->r_jenis == 0) {
                    $totalWaiting += 1;
                }
                elseif ($trSpec->r_jenis == 1) {
                    $totalSuccess += 1;
                }
            }
        }

        $totalData = sizeof($trTmp);
        $totalWaitingPersen = ($totalWaiting / $totalData) * 100;
        $totalSuccessPersen = ($totalSuccess / $totalData) * 100;
        $items = array();
        $items[] = array(
            "pID" => 1,
            "total" => $totalData,
            "done" => $totalSuccess,
            "waiting" => $totalWaiting,
            "done_persen" => $totalSuccessPersen,
            "waiting_persen" => $totalWaitingPersen,
        );

        $headerFields = array(
            "total" => "total data",
            "done" => "success",
            "waiting" => "waiting",
            "done_persen" => "success (%)",
            "waiting_persen" => "waiting (%)",
        );
        $data = array(
            "mode" => "indexLap",
            "title" => "PROGRESS LAP. PENJUALAN",
            "subTitle" => "",
            "headerFields" => isset($headerFields) ? $headerFields : array(),
            "items" => isset($items) ? $items : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => isset($thisPage) ? $thisPage : "",
            "q" => isset($q) ? $q : "",

            "filters" => array(
                "date1" => isset($date1) ? $date1 : "",
                "date2" => isset($date2) ? $date2 : "",
                "dates" => date("Y-m-d"),
            ),
        );
        $this->load->view("tool", $data);
    }


    //==========================================================
    public function cekPaymentSrc()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlPaymentSource");

        $target_jenis = "487";
        $jenis = "461";
        $jenisTop = "461ro";

        $tr = New MdlTransaksi();
        $pym = New MdlPaymentSource();


        $pym->addFilter("sisa>0");
        $pym->addFilter("target_jenis=$target_jenis");
        $pym->addFilter("jenis=$jenis");
        $pymTmp = $pym->lookupAll()->result();
        showLast_query("biru");
        cekBiru(sizeof($pymTmp));
        if (sizeof($pymTmp) > 0) {
            $trID_pym = array();
            foreach ($pymTmp as $pymSpec) {
                //                cekBiru((array)$pymSpec);
                $trID_pym[$pymSpec->transaksi_id] = $pymSpec->transaksi_id;
            }
            //--------------------
            $tr = New MdlTransaksi();
            $tr->addFilter("id in ('" . implode("','", $trID_pym) . "')");
            $trTmp = $tr->lookupAll()->result();
            showLast_query("kuning");
            $trTop = array();
            foreach ($trTmp as $spec) {
                $trTop[$spec->id] = $spec->id_master;
            }
            //--------------------
            $tr = New MdlTransaksi();
            $tr->addFilter("id in ('" . implode("','", $trTop) . "')");
            $trTmp = $tr->lookupAll()->result();
            showLast_query("hijau");

            //--------------------


        }


        //        $sesionReplacer = replaceSession();
        //        $tr->addFilter("div_id='" . $this->session->login['div_id'] . "'");
        //        $tr->addFilter("jenis_top='$jenisTop'");
        //        $tr->addFilter("next_substep_code<>''");
        //        $tr->addFilter("sub_step_number>0");
        //        $tr->addFilter("valid_qty>0");
        //        $tr->addFilter("next_step_code!=''");
        //        $tmpHist = $tr->lookupRecentUndoneEntries_joined($sesionReplacer)->result();
        //        showLast_query("kuning");
    }

    public function cekDetailTransaksi()
    {
        $str = "<form method='post' action=''>";

        $val = "";
        if (isset($_POST['text'])) {
            $val = $_POST['text'];
        }
        $str .= "<span class='text-uppercase text-bold'>masukkan nomer nota / transaksi ID: </span>";
        $str .= "<input type='text' name='text' value='$val' class='btn btn-default' placeholder='masukkan nomer nota / transaksiID' style='size:300px;'>";
        $str .= "&nbsp;";
        $str .= "<input type='submit' name='process' value='SHOW' class='btn btn-primary'>";
        $str .= "</form>";

        if (isset($_POST['text'])) {
            $val = $_POST['text'];

            $this->load->model("MdlTransaksi");
            $this->load->model("ComJurnal");
            $this->load->model("ComRekening");


            $tr = New MdlTransaksi();
            $tr->setFilters(array());

            if (is_numeric($val)) {
                $this->db->where('id=', $val);
            }
            else {
                $this->db->or_where('nomer=', $val);
            }
            $tmp = $tr->lookupAll()->result();
            $transaksiID = $tmp[0]->id;


        }

        $data = array(
            "mode" => "index",
            "title" => "SHOW DETAIL TRANSAKSI",
            "subTitle" => "",
            "headerFields" => array(),
            "items" => array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => array(),
            "content" => $str,
        );
        $this->load->view("tool", $data);
    }


    //==========================================================
    public function cekHutangDagang_()
    {
        $jenisTr = "489";
        $jenisTrTarget = array("489",
            "4891"
        );
        $jenisTrMutasi = array("489",
            "467",
            "4891"
        );
        $externID = "35";
        //        $externID = "239";
        $rekening = "hutang dagang";

        $this->load->helper("he_mass_table");
        $this->load->model("Coms/ComRekeningPembantuSupplier");
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlPaymentSource");


        //-----------------------
        $py = New MdlPaymentSource();
        $py->addFilter("extern_id='$externID'");
        $py->addFilter("label='$rekening'");
        //        $py->addFilter("target_jenis='$jenisTr'");
        $py->addFilter("target_jenis in ('" . implode("','", $jenisTrTarget) . "')");
        $pyTmp = $py->lookupAll()->result();
        cekHere($this->db->last_query());
        $arrPymSrc = array();
        foreach ($pyTmp as $pySpec) {
            //            arrPrint($pySpec);
            $arrPymSrc[] = array(
                "jenis" => $pySpec->jenis,
                "trID" => $pySpec->transaksi_id,
                "nomer" => $pySpec->nomer,
                "tagihan" => $pySpec->tagihan,
                "terbayar" => $pySpec->terbayar,
            );
        }
        //arrPrint($arrPymSrc);

        //-----------------------
        $cr = New ComRekeningPembantuSupplier();
        //        $cr->addFilter("jenis in ('" . implode("','", $jenisTrMutasi) . "')");
        $tmp = $cr->fetchMoves($rekening, $externID);
        cekHere($this->db->last_query());
        $tmpTrID = array();
        $tmpPayment = array();
        $tmpIndex = array();
        $tmpBayar = array();
        $tmpHutang = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $tmpSpec) {
                $tmpPayment[] = $tmpSpec;
                $tmpTrID[] = $tmpSpec->transaksi_id;
                $tmpBayar[$tmpSpec->transaksi_id] = $tmpSpec->debet;
                $tmpHutang[$tmpSpec->transaksi_id] = $tmpSpec->kredit;
            }
            // membaca transaksi kolom index registry
            $tr = New MdlTransaksi();
            $kolom = array(
                "id",
                "indexing_registry"
            );
            $this->db->select($kolom);
            $tr->addFilter("id in ('" . implode("','", $tmpTrID) . "')");
            $trTmp = $tr->lookupAll()->result();
            cekHere($this->db->last_query());
            foreach ($trTmp as $spec) {
                $trID = $spec->id;
                $trIndex = blobDecode($spec->indexing_registry);
                $tmpIndex["items"][$trID] = $trIndex["items"];
                $tmpIndex["main"][$trID] = $trIndex["main"];
            }
            //arrPrintWebs($tmpHutang);
            if (sizeof($tmpIndex["items"]) > 0) {
                //                cekHere(implode(",", $tmpIndex["items"]));
                $tr = New MdlTransaksi();
                $tr->setFilters(array());
                $tr->addFilter("id in ('" . implode("','", $tmpIndex["items"]) . "')");
                $regTmp = $tr->lookupRegistries()->result();
                cekHere($this->db->last_query());
                foreach ($regTmp as $spec) {
                    $decodeValues = blobDecode($spec->values);
                    foreach ($decodeValues as $iSpec) {

                        if (!isset($nilaiBayar[$iSpec['id']])) {
                            $nilaiBayar[$iSpec['id']] = 0;
                        }
                        $nilaiBayar[$iSpec['id']] += $iSpec['nilai_bayar'];


                        if (!isset($nilaiBayarMain_01[$spec->transaksi_id])) {
                            $nilaiBayarMain_01[$spec->transaksi_id] = 0;
                        }
                        $nilaiBayarMain_01[$spec->transaksi_id] += $iSpec['nilai_bayar'];
                    }
                }
            }

            if (sizeof($tmpIndex["main"]) > 0) {
                $tr = New MdlTransaksi();
                $tr->setFilters(array());
                $tr->addFilter("id in ('" . implode("','", $tmpIndex["main"]) . "')");
                $regTmp = $tr->lookupRegistries()->result();
                cekHere($this->db->last_query());
                foreach ($regTmp as $spec) {
                    $decodeValues = blobDecode($spec->values);
                    //                    arrPrint($decodeValues);
                    //                    foreach ($decodeValues as $iSpec){
                    //                        if(!isset($nilaiBayarMain[$spec->transaksi_id])){
                    //                            $nilaiBayarMain[$spec->transaksi_id] = 0;
                    //                        }
                    //                        break;
                    //                    }
                    if (!isset($nilaiBayarMain_00[$spec->transaksi_id])) {
                        $nilaiBayarMain_00[$spec->transaksi_id] = 0;
                    }
                    $nil = isset($decodeValues['nilai_bayar']) ? $decodeValues['nilai_bayar'] : 0;
                    $nilaiBayarMain_00[$spec->transaksi_id] += $nil;
                }
            }

            //---------
            $cekResult = array();
            $cekResultHutang = array();
            foreach ($arrPymSrc as $spec) {
                $pymJenis = $spec['jenis'];
                $pymTagihan = $spec['tagihan'];
                $pymTerbayar = $spec['terbayar'];
                $pymTrID = $spec['trID'];
                $pymNomer = $spec['nomer'];
                $regNilaiBayar = isset($nilaiBayar[$pymTrID]) ? $nilaiBayar[$pymTrID] : 0;
                $selisih = $pymTerbayar - $regNilaiBayar;

                $hutang = isset($tmpHutang[$pymTrID]) ? $tmpHutang[$pymTrID] : 0;
                $selisihHutang = $pymTagihan - $hutang;

                if (round($pymTerbayar, 2) != round($regNilaiBayar, 2)) {
                    $cekResult[] = array(
                        "jenis" => $pymJenis,
                        "trID" => $pymTrID,
                        "nomer" => $pymNomer,
                        "tagihan" => $pymTagihan,
                        "terbayar" => $pymTerbayar,
                        "regTerbayar" => $regNilaiBayar,
                        "selisih" => $selisih,
                    );
                }

                if (round($hutang, 2) != round($pymTagihan, 2)) {
                    $cekResultHutang[] = array(
                        "jenis" => $pymJenis,
                        "trID" => $pymTrID,
                        "nomer" => $pymNomer,
                        "tagihan" => $pymTagihan,
                        "hutang" => $hutang,
                        "selisih" => $selisihHutang,
                    );
                }
            }
            //---------
            $cekMainResult = array();
            $cekMainMutasiResult = array();
            foreach ($nilaiBayarMain_00 as $trIDx => $nilai) {
                $sumItems = isset($nilaiBayarMain_01[$trIDx]) ? $nilaiBayarMain_01[$trIDx] : 0;
                $mutasiBayar = isset($tmpBayar[$trIDx]) ? $tmpBayar[$trIDx] : 0;
                $selisih = $nilai - $sumItems;
                $selisihMutasi = $nilai - $mutasiBayar;

                if (round($nilai, 2) != round($sumItems, 2)) {
                    $cekMainResult[$trIDx] = $selisih;
                }
                if (round($nilai, 2) != round($mutasiBayar, 2)) {
                    $cekMainMutasiResult[$trIDx] = array(
                        "jenis" => 0,
                        "pymSrc" => $nilai,
                        "mutasi" => $mutasiBayar,
                        "selisih" => $selisihMutasi,
                        "rumus" => "$nilai - $mutasiBayar",
                    );
                }
            }
            //---------

            //---------


            //            arrPrint($nilaiBayar);
            cekHere(" terbayar PYM_SRC vs items REG");
            arrPrint($cekResult);
            cekHere(" nilai bayar MAIN vs items");
            arrPrint($cekMainResult);
            cekHere(" nilai bayar MAIN vs MUTASI");
            arrPrint($cekMainMutasiResult);
            cekHere(" nilai pymSrc TAGIHAN vs mutasi HUTANG");
            arrPrint($cekResultHutang);
        }
    }

    public function cekHutangDagang2()
    {
        //        $externID = "221";
        $cabangID = $this->uri->segment(4);
        $externID = $this->uri->segment(3);
        $rekening = "hutang dagang";
        $jenisTr_beli = array("467");
        $jenisTr_bayar = array("489");
        $jenisTrMutasi = array("489",
            "467"
        );

        //--load model dan helper
        $this->load->helper("he_mass_table");
        $this->load->model("Coms/ComRekeningPembantuSupplier");
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlPaymentSource");

        //--resetor array
        $arrPymSrc = array();
        $arrPymSrcJenis = array();
        $tmpTrID = array();
        $tmpPayment = array();
        $tmpIndex = array();
        $tmpBayar = array();
        $tmpHutang = array();
        $tmpMutasi = array();
        $tmpRegNilaiBeli = array();
        $tmpRegNilaiBayar = array();
        $tmpHeader = array(
            "trID" => "trID",
            "jenis" => "jenis",
            "dtime" => "dtime",
            "nomer" => "nomer",
            "mutasiBeli" => array(
                "label" => "mutasi beli",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "tagihanRegMain" => array(
                "label" => "nilai nota",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "tagihanPymSrc" => array(
                "label" => "nilai nota<br>PYM_SRC",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "diskonPymSrc" => array(
                "label" => "diskon<br>PYM_SRC",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "tagihanNettoPymSrc" => array(
                "label" => "nilai nota netto<br>PYM_SRC",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            //            "bayarRegMain" => array(
            //                "label" => "nilai bayar<br>REG_MAIN",
            //                "format" => "debet",
            //                "style" => "text-align:right;",
            //                ),
            "bayarRegItems" => array(
                "label" => "nilai bayar<br>REG_ITEMS",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "bayarPymSrc" => array(
                "label" => "nilai bayar<br>PYM_SRC",
                "format" => "debet",
                "style" => "text-align:right;",
            ),

        );

        //--membaca transaksi
        $tr = New MdlTransaksi();
        $kolom = array(
            "id",
            "jenis",
            "nomer",
            "dtime",
            "indexing_registry"
        );
        $this->db->select($kolom);
        $tr->addFilter("suppliers_id='$externID'");
        $tr->addFilter("cabang_id='$cabangID'");
        $tr->addFilter("jenis in ('" . implode("','", $jenisTrMutasi) . "')");
        $trTmp = $tr->lookupAll()->result();
        cekHere($this->db->last_query());
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $spec) {
                $trID = $spec->id;
                $jenis = $spec->jenis;
                $trIndex = blobDecode($spec->indexing_registry);
                $tmpIndex["items"][$trID] = $trIndex["items"];
                $tmpIndex["main"][$trID] = $trIndex["main"];
                $tmpIndex["jenis"][$trID] = $jenis;
                $tmpIndex["data"][$trID] = array(
                    "nomer" => $spec->nomer,
                    "dtime" => $spec->dtime,
                    "jenis" => $spec->jenis,
                );
                if ($jenis == "467") {
                    $tmpIndex["main_beli"][$trID] = $trIndex["main"];
                    $tmpIndex["data_beli"][$trID] = array(
                        "trID" => $trID,
                        "nomer" => $spec->nomer,
                        "dtime" => $spec->dtime,
                        "jenis" => $spec->jenis,
                    );
                }
                if ($jenis == "489") {
                    $tmpIndex["items_bayar"][$trID] = $trIndex["items"];

                }

            }
            //--membaca registry MAIN BELI
            if (sizeof($tmpIndex["main"]) > 0) {
                $tr = New MdlTransaksi();
                $tr->setFilters(array());
                $tr->addFilter("id in ('" . implode("','", $tmpIndex["main_beli"]) . "')");
                $regTmp = $tr->lookupRegistries()->result();
                cekHere($this->db->last_query());
                foreach ($regTmp as $spec) {
                    $decodeValues = blobDecode($spec->values);
                    if ($decodeValues['jenis'] == "467") {
                        $nilai_beli = $decodeValues['nilai_credit'];
                        $tmpRegNilaiBeli[$spec->transaksi_id]['tagihanRegMain'] = $nilai_beli;
                    }

                }
            }
            //--membaca registry MAIN BAYAR
            if (sizeof($tmpIndex["items_bayar"]) > 0) {
                $tr = New MdlTransaksi();
                $tr->setFilters(array());
                $tr->addFilter("id in ('" . implode("','", $tmpIndex["items_bayar"]) . "')");
                $regTmp = $tr->lookupRegistries()->result();
                cekHere($this->db->last_query());
                foreach ($regTmp as $spec) {
                    $decodeValues = blobDecode($spec->values);
                    foreach ($decodeValues as $ii => $iSpec) {
                        $nilai_bayar = $iSpec['nilai_bayar'];
                        if (!isset($tmpRegNilaiBayar[$ii]['bayarRegItems'])) {
                            $tmpRegNilaiBayar[$ii]['bayarRegItems'] = 0;
                        }
                        $tmpRegNilaiBayar[$ii]['bayarRegItems'] += $nilai_bayar;
                    }

                }
            }
        }
        //arrPrintWebs($tmpRegNilaiBayar);

        //--membaca payment source
        $py = New MdlPaymentSource();
        $py->addFilter("cabang_id='$cabangID'");
        $py->addFilter("extern_id='$externID'");
        $py->addFilter("label='$rekening'");
        $py->addFilter("target_jenis in ('" . implode("','", $jenisTrMutasi) . "')");
        $pyTmp = $py->lookupAll()->result();
        //        cekHere($this->db->last_query());
        foreach ($pyTmp as $pySpec) {
            $arrPymSrc[] = array(
                "trID" => $pySpec->transaksi_id,
                "nomer" => $pySpec->nomer,
                "tagihan" => $pySpec->tagihan,
                "terbayar" => $pySpec->terbayar,
                "jenis" => $pySpec->jenis,
            );
            $arrPymSrcJenis[$pySpec->transaksi_id] = array(
                //                "jenis" => $pySpec->jenis,
                "diskonPymSrc" => $pySpec->diskon,
                "bayarPymSrc" => $pySpec->terbayar,
                "tagihanPymSrc" => $pySpec->tagihan,
                "tagihanNettoPymSrc" => $pySpec->tagihan - $pySpec->diskon,
            );
        }


        //--membaca mutasi rekening
        $cr = New ComRekeningPembantuSupplier();
        $cr->addFilter("cabang_id='$cabangID'");
        $cr->addFilter("jenis in ('" . implode("','", $jenisTrMutasi) . "')");
        $tmp = $cr->fetchMoves($rekening, $externID);
        cekHere($this->db->last_query());
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $tmpSpec) {
                cekKuning($tmpSpec->jenis);
                $tmpPayment[] = $tmpSpec;
                $tmpTrID[] = $tmpSpec->transaksi_id;
                $tmpBayar[$tmpSpec->transaksi_id]['mutasiBeli'] = $tmpSpec->debet;
                $tmpHutang[$tmpSpec->transaksi_id]['mutasiBeli'] = $tmpSpec->kredit;
                $tmpMutasi[$tmpSpec->transaksi_id] = array(
                    "jenisTr" => $tmpSpec->jenis,
                    "debet" => $tmpSpec->debet,
                    "kredit" => $tmpSpec->kredit,
                );
            }
        }


        //--------------------------------------
        $str = "<table rules='all' style='border: 1px solid black;width:100%;'>";
        $str .= "<tr>";
        $str .= "<th>No.</th>";
        foreach ($tmpHeader as $label) {
            if (is_array($label)) {
                $labels = $label['label'];
            }
            else {
                $labels = $label;
            }
            $str .= "<th>";
            $str .= $labels;
            $str .= "</th>";
        }
        $str .= "</tr>";
        if (sizeof($tmpIndex["data_beli"]) > 0) {
            $no = 0;
            foreach ($tmpIndex["data_beli"] as $trID => $trData) {
                if (isset($arrPymSrcJenis[$trID]) && sizeof($arrPymSrcJenis[$trID]) > 0) {
                    foreach ($arrPymSrcJenis[$trID] as $kk => $vv) {
                        $trData[$kk] = $vv;
                    }
                }
                if (isset($tmpRegNilaiBeli[$trID]) && sizeof($tmpRegNilaiBeli[$trID]) > 0) {
                    foreach ($tmpRegNilaiBeli[$trID] as $kk => $vv) {
                        $trData[$kk] = $vv;
                    }
                }
                if (isset($tmpRegNilaiBayar[$trID]) && sizeof($tmpRegNilaiBayar[$trID]) > 0) {
                    foreach ($tmpRegNilaiBayar[$trID] as $kk => $vv) {
                        $trData[$kk] = $vv;
                    }
                }
                if (isset($tmpHutang[$trID]) && sizeof($tmpHutang[$trID]) > 0) {
                    foreach ($tmpHutang[$trID] as $kk => $vv) {
                        $trData[$kk] = $vv;
                    }
                }
                //-------------------
                $style_tr = "";
                //                arrPrintWebs($trData);
                $mutasiBeli = isset($trData['mutasiBeli']) ? $trData['mutasiBeli'] : 0;
                $tagihanRegMain = isset($trData['tagihanRegMain']) ? $trData['tagihanRegMain'] : 0;
                $tagihanPymSrc = isset($trData['tagihanPymSrc']) ? $trData['tagihanPymSrc'] : 0;
                $tagihanNettoPymSrc = isset($trData['tagihanNettoPymSrc']) ? $trData['tagihanNettoPymSrc'] : 0;
                $bayarRegItems = isset($trData['bayarRegItems']) ? $trData['bayarRegItems'] : 0;
                $bayarPymSrc = isset($trData['bayarPymSrc']) ? $trData['bayarPymSrc'] : 0;
                $diskonPymSrc = isset($trData['diskonPymSrc']) ? $trData['diskonPymSrc'] : 0;
                $bayarNetto = $bayarRegItems + $diskonPymSrc;
                if (round($tagihanRegMain, 2) != round($tagihanPymSrc, 2)) {
                    $style_tr = "background-color:yellow;";
                }
                elseif (round($bayarRegItems, 2) != round($bayarPymSrc, 2)) {
                    $style_tr = "background-color:pink;";
                }
                elseif (round($mutasiBeli, 2) != round($tagihanRegMain, 2)) {
                    $style_tr = "background-color:orange;";
                }
                elseif (round($mutasiBeli, 2) != round($bayarNetto, 2)) {
                    if (round($bayarNetto, 2) == 0) {
                        $style_tr = "background-color:lime;";
                    }
                    else {
                        $style_tr = "background-color:red;";
                    }
                }
                //-------------------

                $no++;
                $str .= "<tr style='$style_tr'>";
                $str .= "<td>$no</td>";
                foreach ($tmpHeader as $key => $label) {
                    $isi_data = isset($trData[$key]) ? $trData[$key] : "";
                    if (is_array($label)) {
                        $isi_data_f = formatField($label['format'], $isi_data);
                        $style = $label['style'];
                    }
                    else {
                        $isi_data_f = $isi_data;
                        $style = "";
                    }

                    $str .= "<td style='$style'>";
                    $str .= $isi_data_f;
                    $str .= "</td>";
                }
                $str .= "</tr>";
            }
        }


        $str .= "</table rules='all' style='border: 1px solid black;'>";

        echo $str;
    }

    public function cekPiutangDagang2()
    {
        //        $externID = "221";
        $cabangID = $this->uri->segment(3);
        $externID = $this->uri->segment(4);
        $rekening = "piutang dagang";
        $jenisTr_beli = array("467");
        $jenisTr_bayar = array("749");
        $jenisTrMutasi = array("749",
            "582spd"
        );

        //--load model dan helper
        $this->load->helper("he_mass_table");
        $this->load->model("Coms/ComRekeningPembantuCustomer");
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlPaymentSource");

        //--resetor array
        $arrPymSrc = array();
        $arrPymSrcJenis = array();
        $tmpTrID = array();
        $tmpPayment = array();
        $tmpIndex = array();
        $tmpBayar = array();
        $tmpHutang = array();
        $tmpMutasi = array();
        $tmpRegNilaiBeli = array();
        $tmpRegNilaiBayar = array();
        $tmpHeader = array(
            "trID" => "trID",
            "jenis" => "jenis",
            "dtime" => "dtime",
            "nomer" => "nomer",
            "mutasiBeli" => array(
                "label" => "mutasi beli",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "tagihanRegMain" => array(
                "label" => "nilai nota",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "tagihanPymSrc" => array(
                "label" => "nilai nota<br>PYM_SRC",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "diskonPymSrc" => array(
                "label" => "diskon<br>PYM_SRC",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "tagihanNettoPymSrc" => array(
                "label" => "nilai nota netto<br>PYM_SRC",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            //            "bayarRegMain" => array(
            //                "label" => "nilai bayar<br>REG_MAIN",
            //                "format" => "debet",
            //                "style" => "text-align:right;",
            //                ),
            "bayarRegItems" => array(
                "label" => "nilai bayar<br>REG_ITEMS",
                "format" => "debet",
                "style" => "text-align:right;",
            ),
            "bayarPymSrc" => array(
                "label" => "nilai bayar<br>PYM_SRC",
                "format" => "debet",
                "style" => "text-align:right;",
            ),

        );

        //--membaca transaksi
        $tr = New MdlTransaksi();
        $kolom = array(
            "id",
            "jenis",
            "nomer",
            "dtime",
            "indexing_registry"
        );
        $this->db->select($kolom);
        $tr->addFilter("suppliers_id='$externID'");
        $tr->addFilter("jenis in ('" . implode("','", $jenisTrMutasi) . "')");
        $trTmp = $tr->lookupAll()->result();
        cekHere($this->db->last_query());
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $spec) {
                $trID = $spec->id;
                $jenis = $spec->jenis;
                $trIndex = blobDecode($spec->indexing_registry);
                $tmpIndex["items"][$trID] = $trIndex["items"];
                $tmpIndex["main"][$trID] = $trIndex["main"];
                $tmpIndex["jenis"][$trID] = $jenis;
                $tmpIndex["data"][$trID] = array(
                    "nomer" => $spec->nomer,
                    "dtime" => $spec->dtime,
                    "jenis" => $spec->jenis,
                );
                if ($jenis == "467") {
                    $tmpIndex["main_beli"][$trID] = $trIndex["main"];
                    $tmpIndex["data_beli"][$trID] = array(
                        "trID" => $trID,
                        "nomer" => $spec->nomer,
                        "dtime" => $spec->dtime,
                        "jenis" => $spec->jenis,
                    );
                }
                if ($jenis == "489") {
                    $tmpIndex["items_bayar"][$trID] = $trIndex["items"];

                }
            }
            //--membaca registry MAIN BELI
            if (sizeof($tmpIndex["main"]) > 0) {
                $tr = New MdlTransaksi();
                $tr->setFilters(array());
                $tr->addFilter("id in ('" . implode("','", $tmpIndex["main_beli"]) . "')");
                $regTmp = $tr->lookupRegistries()->result();
                cekHere($this->db->last_query());
                foreach ($regTmp as $spec) {
                    $decodeValues = blobDecode($spec->values);
                    if ($decodeValues['jenis'] == "467") {
                        $nilai_beli = $decodeValues['nilai_credit'];
                        $tmpRegNilaiBeli[$spec->transaksi_id]['tagihanRegMain'] = $nilai_beli;
                    }

                }
            }
            //--membaca registry MAIN BAYAR
            if (sizeof($tmpIndex["items_bayar"]) > 0) {
                $tr = New MdlTransaksi();
                $tr->setFilters(array());
                $tr->addFilter("id in ('" . implode("','", $tmpIndex["items_bayar"]) . "')");
                $regTmp = $tr->lookupRegistries()->result();
                cekHere($this->db->last_query());
                foreach ($regTmp as $spec) {
                    $decodeValues = blobDecode($spec->values);
                    foreach ($decodeValues as $ii => $iSpec) {
                        $nilai_bayar = $iSpec['nilai_bayar'];
                        if (!isset($tmpRegNilaiBayar[$ii]['bayarRegItems'])) {
                            $tmpRegNilaiBayar[$ii]['bayarRegItems'] = 0;
                        }
                        $tmpRegNilaiBayar[$ii]['bayarRegItems'] += $nilai_bayar;
                    }

                }
            }
        }
        //arrPrintWebs($tmpRegNilaiBayar);

        //--membaca payment source
        $py = New MdlPaymentSource();
        $py->addFilter("extern_id='$externID'");
        $py->addFilter("label='$rekening'");
        $py->addFilter("target_jenis in ('" . implode("','", $jenisTrMutasi) . "')");
        $pyTmp = $py->lookupAll()->result();
        //        cekHere($this->db->last_query());
        foreach ($pyTmp as $pySpec) {
            $arrPymSrc[] = array(
                "trID" => $pySpec->transaksi_id,
                "nomer" => $pySpec->nomer,
                "tagihan" => $pySpec->tagihan,
                "terbayar" => $pySpec->terbayar,
                "jenis" => $pySpec->jenis,
            );
            $arrPymSrcJenis[$pySpec->transaksi_id] = array(
                //                "jenis" => $pySpec->jenis,
                "diskonPymSrc" => $pySpec->diskon,
                "bayarPymSrc" => $pySpec->terbayar,
                "tagihanPymSrc" => $pySpec->tagihan,
                "tagihanNettoPymSrc" => $pySpec->tagihan - $pySpec->diskon,
            );
        }


        //--membaca mutasi rekening
        $cr = New ComRekeningPembantuCustomer();
        $tmp = $cr->fetchMoves($rekening, $externID);
        //        cekHere($this->db->last_query());
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $tmpSpec) {
                $tmpPayment[] = $tmpSpec;
                $tmpTrID[] = $tmpSpec->transaksi_id;
                $tmpBayar[$tmpSpec->transaksi_id]['mutasiBeli'] = $tmpSpec->debet;
                $tmpHutang[$tmpSpec->transaksi_id]['mutasiBeli'] = $tmpSpec->kredit;
                $tmpMutasi[$tmpSpec->transaksi_id] = array(
                    "jenisTr" => $tmpSpec->jenis,
                    "debet" => $tmpSpec->debet,
                    "kredit" => $tmpSpec->kredit,
                );
            }
        }


        //--------------------------------------
        $str = "<table rules='all' style='border: 1px solid black;width:100%;'>";
        $str .= "<tr>";
        foreach ($tmpHeader as $label) {
            if (is_array($label)) {
                $labels = $label['label'];
            }
            else {
                $labels = $label;
            }
            $str .= "<th>";
            $str .= $labels;
            $str .= "</th>";
        }
        $str .= "</tr>";
        if (sizeof($tmpIndex["data_beli"]) > 0) {
            foreach ($tmpIndex["data_beli"] as $trID => $trData) {
                if (isset($arrPymSrcJenis[$trID]) && sizeof($arrPymSrcJenis[$trID]) > 0) {
                    foreach ($arrPymSrcJenis[$trID] as $kk => $vv) {
                        $trData[$kk] = $vv;
                    }
                }
                if (isset($tmpRegNilaiBeli[$trID]) && sizeof($tmpRegNilaiBeli[$trID]) > 0) {
                    foreach ($tmpRegNilaiBeli[$trID] as $kk => $vv) {
                        $trData[$kk] = $vv;
                    }
                }
                if (isset($tmpRegNilaiBayar[$trID]) && sizeof($tmpRegNilaiBayar[$trID]) > 0) {
                    foreach ($tmpRegNilaiBayar[$trID] as $kk => $vv) {
                        $trData[$kk] = $vv;
                    }
                }
                if (isset($tmpHutang[$trID]) && sizeof($tmpHutang[$trID]) > 0) {
                    foreach ($tmpHutang[$trID] as $kk => $vv) {
                        $trData[$kk] = $vv;
                    }
                }
                //-------------------
                $style_tr = "";
                //                arrPrintWebs($trData);
                $mutasiBeli = isset($trData['mutasiBeli']) ? $trData['mutasiBeli'] : 0;
                $tagihanRegMain = isset($trData['tagihanRegMain']) ? $trData['tagihanRegMain'] : 0;
                $tagihanPymSrc = isset($trData['tagihanPymSrc']) ? $trData['tagihanPymSrc'] : 0;
                $tagihanNettoPymSrc = isset($trData['tagihanNettoPymSrc']) ? $trData['tagihanNettoPymSrc'] : 0;
                $bayarRegItems = isset($trData['bayarRegItems']) ? $trData['bayarRegItems'] : 0;
                $bayarPymSrc = isset($trData['bayarPymSrc']) ? $trData['bayarPymSrc'] : 0;
                $diskonPymSrc = isset($trData['diskonPymSrc']) ? $trData['diskonPymSrc'] : 0;
                $bayarNetto = $bayarRegItems + $diskonPymSrc;
                if (round($tagihanRegMain, 2) != round($tagihanPymSrc, 2)) {
                    $style_tr = "background-color:yellow;";
                }
                elseif (round($bayarRegItems, 2) != round($bayarPymSrc, 2)) {
                    $style_tr = "background-color:pink;";
                }
                elseif (round($mutasiBeli, 2) != round($tagihanRegMain, 2)) {
                    $style_tr = "background-color:orange;";
                }
                elseif (round($mutasiBeli, 2) != round($bayarNetto, 2)) {
                    $style_tr = "background-color:red;";
                }
                //-------------------

                $str .= "<tr style='$style_tr'>";
                foreach ($tmpHeader as $key => $label) {
                    $isi_data = isset($trData[$key]) ? $trData[$key] : "";
                    if (is_array($label)) {
                        $isi_data_f = formatField($label['format'], $isi_data);
                        $style = $label['style'];
                    }
                    else {
                        $isi_data_f = $isi_data;
                        $style = "";
                    }

                    $str .= "<td style='$style'>";
                    $str .= $isi_data_f;
                    $str .= "</td>";
                }
                $str .= "</tr>";
            }
        }


        $str .= "</table rules='all' style='border: 1px solid black;'>";

        echo $str;
    }


    //----------------------------------------------------------
    public function cekProduksi()
    {
        $this->load->model("MdlTransaksi");

        $jenisTr = "776";
        $cabangID = "25";
        $tr = New MdlTransaksi();
        $tr->addFilter("jenis='$jenisTr'");
        $tr->addFilter("cabang_id='$cabangID'");
        $trTmp = $tr->lookupAll()->result();
        $idRegistry = array();
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $trSpec) {
                $indexReg = blobDecode($trSpec->indexing_registry);
                $idRegistry['items'][] = $indexReg['items'];
                $idRegistry['items2'][] = $indexReg['items2'];
            }
        }
        //        arrPrintPink($idRegistry);

        //----------------------------------
        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("id in ('" . implode("','", $idRegistry['items']) . "')");
        $reg = $tr->lookupRegistries()->result();
        showLast_query("kuning");
        $arrItemsResult = array();
        $arrProdukID = array();
        $trCost = array();
        $trQty = array();
        $trCostTotal = 0;
        foreach ($reg as $regSpec) {
            $valuesDecode = blobDecode($regSpec->values);
            $arrItemsResult[$regSpec->transaksi_id] = $valuesDecode;
            foreach ($valuesDecode as $pid => $spec) {
                $arrProdukID[$spec['id']] = $spec['id'];
                if (!isset($trCost[$regSpec->transaksi_id])) {
                    $trCost[$regSpec->transaksi_id] = 0;
                }
                $trCost[$regSpec->transaksi_id] += $spec['sub_total_cost'];
                $trCostTotal += $spec['sub_total_cost'];

                if (!isset($trQty[$spec['id']])) {
                    $trQty[$spec['id']] = 0;
                }
                $trQty[$spec['id']] += $spec['jml'];
            }
        }
        //        arrPrintWebs($arrProdukID);
        //        arrPrintWebs($trCost);
        //        arrPrintWebs($arrItemsResult);
        arrPrintWebs($trQty);
        //        cekMerah(number_format($trCostTotal, 0, ",", "."));


    }

    public function pemindahanRegistry()
    {
        matiHEre("hoop dulu");
        if (isset($_GET['r']) && $_GET['r'] > 0) {
            header("refresh:" . $_GET['r']);
        }
        $kolom_params = array(
            "main",
            "items",
            "items2",
            "items2_sum",
            "itemSrc",
            "itemSrc_sum",
            "items3",
            "items3_sum",
            "items4",
            "items4_sum",
            "items_noapprove",
            "rsltItems",
            "rsltItems2",
            "rsltItems3",
            "tableIn_master",
            "tableIn_detail",
            "tableIn_detail2_sum",
            "tableIn_detail_rsltItems",
            "tableIn_detail_rsltItems2",
            "tableIn_master_values",
            "tableIn_detail_values",
            "tableIn_detail_values_rsltItems",
            "tableIn_detail_values_rsltItems2",
            "tableIn_detail_values2_sum",
            "main_add_values",
            "main_add_fields",
            "main_elements",
            "main_inputs",
            "main_inputs_orig",
            "receiptDetailFields",
            "receiptSumFields",
            "receiptDetailFields2",
            "receiptDetailSrcFields",
            "receiptSumFields2",
            "jurnal_index",
            "postProcessor",
            "preProcessor",
            "revert",
            "items_komposisi",
            "jurnalItems",
            "componentsBuilder",
            "items5_sum",
            "items6_sum",
            "items7_sum",
            "items8_sum",
            "items9_sum",
            "items10_sum",
        );
        $this->load->model("Mdls/MdlMongoMother");
        // $m = new MdlMongoMother();
        // $m->setTableName("transaksi_data_registry");
        $this->db = $this->load->database("testing", true);

        $start_time = microtime(true);
        $start_jam = dtimeNow('H:i:s');

        // $var = $this->te

        $this->load->model("MdlTransaksi");
        $tr = new MdlTransaksi();

        $this->db->select(array("id",));
        $jml_tr = $tr->lookupAll()->num_rows();
        // arrPrint($jml_tr);

        $condites = array(
            "pemindahan" => 1,

        );
        $this->db->select(array("id"));
        $jml_tr_done = $tr->lookupByCondition($condites)->num_rows();
        // showLast_query("kuning");
        // matiHEre();
        // arrPrint($jml_tr_done);

        // ------------------------------- start
        $limit = 1000;
        $condites = array(
            "pemindahan" => 0,
            // "id" => "22306",
        );
        $this->db->limit($limit);
        $this->db->order_by("id", "desc");

        $this->db->select(array("id",
            "indexing_registry"
        ));
        $srcTrs = $tr->lookupByCondition($condites)->result();
        // showLast_query("kuning");
        // matiHere();
        // $indekRegistries = blobDecode($srcTr->indexing_registry);
        $tr_registries = array();
        $trMaster = array();
        foreach ($srcTrs as $srcTr) {
            $tr_id = $srcTr->id;
            $indekRegistries = blobDecode($srcTr->indexing_registry);


            if (is_array($indekRegistries) && sizeof($indekRegistries) > 0) {
                $tr_registries[$tr_id] = $indekRegistries;
            }
            else {
                $trMaster[$tr_id] = $tr_id;
            }
        }
        // arrPrint($trMaster);
        // matiHEre();
        // ------------------------------- stop
        // cekHijau(sizeof($tr_registries)." punya indexing registry");
        // cekMerah(sizeof($trMaster)." tidak punya indexing registry");
        $this->db->trans_begin();
        $no = 0;
        $dataReg = array();
        if (sizeof($tr_registries) > 0) {
            foreach ($tr_registries as $trans_id => $tr_registry) {
                if (is_array($tr_registry) && sizeof($tr_registry) > 0) {
                    $regies = $tr->lookupBaseRegistries($tr_registry)->result();
                    // showLast_query("lime");
                    // arrPrintPink($regies);

                    $srcParams = array();
                    foreach ($regies as $regi) {
                        $param = $regi->param;
                        $values = $regi->values;

                        $srcParams[$param] = $values;
                    }
                    // arrPrintPink($srcParams);

                    $dataParams = array();
                    foreach ($kolom_params as $kolom_param) {
                        $dataParams[$kolom_param] = isset($srcParams[$kolom_param]) ? $srcParams[$kolom_param] : blobEncode(array());
                    }

                    // arrPrintWebs($dataParams);

                    $new_data = $dataParams + array(
                            // "transaksi_id" => $trans_id,
                            "transaksi_id" => "$trans_id",
                        );
                    // cekBiru($new_data);

                    $tr->setFilters(array());
                    $tr->setTableName("transaksi_data_registry");
                    $cekCondites = array(
                        "transaksi_id" => $trans_id,
                    );
                    $cekData = $tr->lookupByCondition($cekCondites)->num_rows();
                    // showLast_query("pink");
                    if ($cekData == 0) {
                        $ins = $tr->addData($new_data);

                        // $m->setTableName("transaksi_data_registry");
                        // $m->addData(json_decode(json_encode($new_data), true));
                        // $dataReg[] = $new_data;
                        // showLast_query("merah");
                    }

                }

                $tr->setTableName("transaksi");
                $tr->setFilters(array());
                $wheres = array(
                    "id" => $trans_id,
                );
                $dataUpd = array(
                    "pemindahan" => 1,
                );
                $tr->updateData($wheres, $dataUpd);
                // showLast_query("pink");
                $no++;
                if (($no % 200) == 0) {
                    cekPink("$no - $trans_id");
                }
            }
        }
        if (sizeof($trMaster) > 0) {
            $this->load->model("Mdls/MdlNonRegistry");
            $r = new MdlNonRegistry();
            foreach ($trMaster as $idMaster => $xID) {
                if (is_array($trMaster) && sizeof($trMaster) > 0) {

                    $dataInsert = array(
                        "transaksi_id" => $idMaster,
                    );
                    $r->addData($dataInsert);
                    // cekMerah($this->db->last_query());
                    $tr->setTableName("transaksi");
                    $tr->setFilters(array());
                    $wheres = array(
                        "id" => $idMaster,
                    );
                    $dataUpd = array(
                        "pemindahan" => 1,
                    );
                    $tr->updateData($wheres, $dataUpd);
                    //pencari resgistry disjip dulu dikumpulkan ke table non_registry

                    //                     $tr->setFilters(array());
                    //                     $regies = $tr->lookupRegistriesByMasterID($idMaster)->result();
                    //                     // showLast_query("lime");
                    //                     // arrPrintPink($regies);
                    //                     // matiHere();
                    //                     $srcParams = array();
                    //                     if (sizeof($regies) > 0) {
                    //                         foreach ($regies as $regi) {
                    //                             $param = $regi->param;
                    //                             $values = $regi->values;
                    //
                    //                             $srcParams[$param] = $values;
                    //                         }
                    //                         // arrPrintPink($srcParams);
                    //
                    //                         $dataParams = array();
                    //                         foreach ($kolom_params as $kolom_param) {
                    //                             $dataParams[$kolom_param] = isset($srcParams[$kolom_param]) ? $srcParams[$kolom_param] : blobEncode(array());
                    //                         }
                    //
                    //                         // arrPrintWebs($dataParams);
                    //
                    //                         $new_data = $dataParams + array(
                    //                                 // "transaksi_id" => $trans_id,
                    //                                 "transaksi_id" => "$idMaster",
                    //                             );
                    //                         // cekBiru($new_data);
                    //
                    //                         $tr->setFilters(array());
                    //                         $tr->setTableName("transaksi_data_registry");
                    //                         $cekCondites = array(
                    //                             "transaksi_id" => $idMaster,
                    //                         );
                    //                         $cekData = $tr->lookupByCondition($cekCondites)->num_rows();
                    //                         // showLast_query("pink");
                    //                         if ($cekData == 0) {
                    //                             $ins = $tr->addData($new_data);
                    //
                    //                             // $m->setTableName("transaksi_data_registry");
                    //                             // $m->addData(json_decode(json_encode($new_data), true));
                    //                             // $dataReg[] = $new_data;
                    //                             // showLast_query("merah");
                    //                         }
                    //                         $tr->setTableName("transaksi");
                    //                         $tr->setFilters(array());
                    //                         $wheres = array(
                    //                             "id" => $idMaster,
                    //                         );
                    //                         $dataUpd = array(
                    //                             "pemindahan" => 1,
                    //                         );
                    //                         $tr->updateData($wheres, $dataUpd);
                    // // cekMerah($this->db->last_query());
                    //                     }
                    //                     else{
                    //                         $tr->setTableName("transaksi");
                    //                         $tr->setFilters(array());
                    //                         $wheres = array(
                    //                             "id" => $idMaster,
                    //                         );
                    //                         $dataUpd = array(
                    //                             "pemindahan" => 1,
                    //                         );
                    //                         $tr->updateData($wheres, $dataUpd);
                    //                         // cekOrange($this->db->last_query());
                    //                         // cekHitam("gak punya data resgistry bro");
                    //                     }

                }
            }
        }

        // cekBiru(info_debuger());

        // cekLime($no);
        // matiHEre(__LINE__." ".__FILE__);
        $this->db->trans_complete();

        $stop_time = microtime(true);
        $exe_time = $stop_time - $start_time;
        cekBiru("$stop_time<br>$start_time<hr>$exe_time (detik)");
        $jml_done = $jml_tr == $jml_tr_done ? $jml_tr_done : ($jml_tr_done + $limit);
        $persen_done = number_format((($jml_done / $jml_tr) * 100), '2');

        cekOrange("sudah dipindah $jml_done/$jml_tr ($persen_done%) $start_jam s/d " . dtimeNow('H:i:s'));

        // sleep for 10 seconds
        // cekBiru();
        // flush();
        // ob_flush();
        // echo "okok";
        flush();
        ob_flush();
        // sleep(10);
        cekHitam("lanjut lagi .... " . dtimeNow('H:i:s'));
        // sleep(10);
        // wake up !
        // cekMerah(date('h:i:s'));
    }

    public function pemindahanRegistryMongo()
    {
        // matiHEre("hoop dulu");
        if (isset($_GET['r']) && $_GET['r'] > 0) {
            header("refresh:" . $_GET['r']);
        }
        $kolom_params = array(
            "main",
            "items",
            "items2",
            "items2_sum",
            "itemSrc",
            "itemSrc_sum",
            "items3",
            "items3_sum",
            "items4",
            "items4_sum",
            "items_noapprove",
            "rsltItems",
            "rsltItems2",
            "rsltItems3",
            "tableIn_master",
            "tableIn_detail",
            "tableIn_detail2_sum",
            "tableIn_detail_rsltItems",
            "tableIn_detail_rsltItems2",
            "tableIn_master_values",
            "tableIn_detail_values",
            "tableIn_detail_values_rsltItems",
            "tableIn_detail_values_rsltItems2",
            "tableIn_detail_values2_sum",
            "main_add_values",
            "main_add_fields",
            "main_elements",
            "main_inputs",
            "main_inputs_orig",
            "receiptDetailFields",
            "receiptSumFields",
            "receiptDetailFields2",
            "receiptDetailSrcFields",
            "receiptSumFields2",
            "jurnal_index",
            "postProcessor",
            "preProcessor",
            "revert",
            "items_komposisi",
            "jurnalItems",
            "componentsBuilder",
            "items5_sum",
            "items6_sum",
            "items7_sum",
            "items8_sum",
            "items9_sum",
            "items10_sum",
        );

        $this->db = $this->load->database("testing", true);

        $start_time = microtime(true);
        $start_jam = dtimeNow('H:i:s');

        // $var = $this->te

        $this->load->model("MdlTransaksi");
        $tr = new MdlTransaksi();

        $this->db->select(array("id",));
        $jml_tr = $tr->lookupAll()->num_rows();
        // arrPrint($jml_tr);

        $condites = array(
            "pemindahan" => 1,
        );
        $this->db->select(array("id",));
        $jml_tr_done = $tr->lookupByCondition($condites)->num_rows();
        // showLast_query("kuning");
        // arrPrint($jml_tr_done);

        // ------------------------------- start
        $limit = 2000;
        $condites = array(
            "pemindahan" => 0,
        );
        $this->db->limit($limit);
        $this->db->order_by("id", "desc");
        $this->db->select(array("id",
            "indexing_registry"
        ));
        $srcTrs = $tr->lookupByCondition($condites)->result();
        // showLast_query("kuning");

        // $indekRegistries = blobDecode($srcTr->indexing_registry);
        $tr_registries = array();
        foreach ($srcTrs as $srcTr) {
            $tr_id = $srcTr->id;
            $indekRegistries = blobDecode($srcTr->indexing_registry);
            $tr_registries[$tr_id] = $indekRegistries;
        }
        // arrPrint($tr_registries);
        // ------------------------------- stop

        $this->db->trans_begin();
        $no = 0;
        $dataReg = array();
        foreach ($tr_registries as $trans_id => $tr_registry) {
            // arrPrint($tr_registry);
            // matiHEre();
            if (is_array($tr_registry) && sizeof($tr_registry) > 0) {
                // arrPrintWebs($tr_registry);
                // matiDisini(__LINE__);
                $regies = $tr->lookupBaseRegistries($tr_registry)->result();
                // showLast_query("lime");
                // arrPrintPink($regies);

                $srcParams = array();
                foreach ($regies as $regi) {
                    $param = $regi->param;
                    $values = $regi->values;

                    $srcParams[$param] = $values;
                }
                // arrPrintPink($srcParams);

                $dataParams = array();
                foreach ($kolom_params as $kolom_param) {
                    $dataParams[$kolom_param] = isset($srcParams[$kolom_param]) ? $srcParams[$kolom_param] : blobEncode(array());
                }

                // arrPrintWebs($dataParams);

                $new_data = $dataParams + array(
                        "transaksi_id" => $trans_id,
                    );
                // cekBiru($new_data);

                $tr->setFilters(array());
                $tr->setTableName("transaksi_data_registry");
                $cekCondites = array(
                    "transaksi_id" => $trans_id,
                );
                $cekData = $tr->lookupByCondition($cekCondites)->num_rows();
                // showLast_query("pink");
                if ($cekData == 0) {
                    $ins = $tr->addData($new_data);
                    $dataReg[] = $new_data;
                    // showLast_query("merah");
                }

            }

            $tr->setTableName("transaksi");
            $tr->setFilters(array());
            $wheres = array(
                "id" => $trans_id,
            );
            $dataUpd = array(
                "pemindahan" => 1,
            );
            $tr->updateData($wheres, $dataUpd);
            // showLast_query("pink");
            $no++;
            if (($no % 200) == 0) {
                cekPink("$no - $trans_id");
            }
        }
        // cekBiru(info_debuger());

        // cekLime($no);

        $this->db->trans_complete();

        //lanjut pindah juga kemongo
        $this->load->model("Mdls/MdlMongoMother");
        $m = new MdlMongoMother();
        $m->setTableName("transaksi_data_registry");
        // cekMerah(sizeof($dataReg));
        if (sizeof($dataReg) > 0) {
            $no = 0;
            foreach ($dataReg as $dataMongo) {
                $m->addData($dataMongo);
                $no++;
                if (($no % 200) == 0) {
                    cekHitam("nulis registry mongo $no - " . $dataMongo["transaksi_id"]);
                }
            }
        }
        $stop_time = microtime(true);
        $exe_time = $stop_time - $start_time;
        cekBiru("$stop_time<br>$start_time<hr>$exe_time (detik)");
        $jml_done = $jml_tr == $jml_tr_done ? $jml_tr_done : ($jml_tr_done + $limit);
        $persen_done = number_format((($jml_done / $jml_tr) * 100), '2');

        cekOrange("sudah dipindah $jml_done/$jml_tr ($persen_done%) $start_jam s/d " . dtimeNow('H:i:s'));

        // sleep for 10 seconds
        // cekBiru();
        // flush();
        // ob_flush();
        // echo "okok";
        flush();
        ob_flush();
        // sleep(10);
        cekHitam("lanjut lagi .... " . dtimeNow('H:i:s'));
        // sleep(10);

        // wake up !
        // cekMerah(date('h:i:s'));
    }

    public function injectIndexDetail()
    {
        $this->load->model("MdlTransaksi");
        $jenisTr = "1763r";

        $tr = New MdlTransaksi();
        $tr->addFilter("jenis='$jenisTr'");
        $tr->addFilter("id_master>0");
        $tr->addFilter("indexing_details is null");
        $tr->setSortBy(array("kolom" => "id",
            "mode" => "ASC"
        ));
        $this->db->limit(1);

        $trTmp = $tr->lookupAll()->result();
        showLast_query("biru");

        if (sizeof($trTmp) > 0) {
            $transaksi_id = $trTmp[0]->id;

            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $trDetail = $tr->lookupDetailTransaksi($transaksi_id)->result();
            $arrDetailIDs = array();
            if (sizeof($trDetail) > 0) {
                foreach ($trDetail as $dSpec) {
                    $arrDetailIDs[] = $dSpec->id;
                }
            }

        }
    }

    public function cekModular()
    {
        // cekBiru($this->uri->segment_array());
        $domain = $_SERVER["HTTP_HOST"];
        $redirect = "/san_modul";
        $ipadd = ipadd();
        $this->load->config("heTransaksi_ui");
        $configUi = $this->config->item("heTransaksi_ui");

        // arrPrint($configUi);
        $count = 0;
        $uncount = 0;
        foreach ($configUi as $jenisTr => $items) {
            // arrPrintWebs($items);
            $place = $items['place'];
            $place_f = $place == "center" ? "<b style='color: #0000ff'>$place</b>" : "<b>$place</b>";

            $confModul = loadConfigModulJenis_he_misc($jenisTr, "coTransaksiUi");
            $connectTo = isset($confModul['connectTo']) ? $confModul['connectTo'] : "";
            // cekBiru("$jenisTr $connectTo");
            $connectTo_f = $connectTo != "" ? ">> <b style='color: #ff4b33'>$connectTo</b>" : "";

            if (isset($items['modul'])) {
                $count++;
                $modulars[$items['modul']][] = "$jenisTr $connectTo_f ($place_f) " . $items['label'];
                $jml_modular = $count;
            }
            else {
                $uncount++;
                $unmodulars['none'][] = "$jenisTr $connectTo_f ($place_f) " . $items['label'];
                $jml_unmodular = $uncount;
            }
        }


        $jml = sizeof($configUi);
        $persen_modular = number_format(($jml_modular / $jml * 100), 2);
        $persen_unmodular = number_format(($jml_unmodular / $jml * 100), 2);

        cekBiru("$jml = $jml_modular + $jml_unmodular");
        cekMerah("unmodular $persen_unmodular% $jml_unmodular/$jml");
        arrPrintPink($unmodulars);
        cekHijau(date('Y-m-d H:i') . "<br>modular $persen_modular% $jml_modular/$jml<br> unmodular $persen_unmodular% $jml_unmodular/$jml");

        ksort($modulars);
        arrPrint($modulars);
        $tampilan = "";
        foreach ($modulars as $mLabel => $modular) {
            $tampilan .= "<div style='float: right;width: 20%;border: 1px darkgreen dashed;'>";
            $tampilan .= "$mLabel";
            // $tampilan .= print_r($modular);
            $tampilan .= "</div>";
        }


        // echo $tampilan;
        cekMerah(substr($redirect, 1));
        /*multy log*/
        $str_log = date('Y-m-d H:i') . " modular $persen_modular% $jml_modular/$jml unmodular $persen_unmodular% $jml_unmodular/$jml | $ipadd";
        // $dir = dirname(__FILE__) . '/db';;
        $dir = "/var/www/html/log";
        $myfile = file_put_contents($dir . '/log_modul_' . substr($redirect, 1) . '.txt', $str_log . PHP_EOL, FILE_APPEND | LOCK_EX);
    }

    public function nonRegistryPindah()
    {
        $this->load->model("Mdls/MdlNonRegistry");
        $r = new MdlNonRegistry();
        $tmpData = $r->lookUpall()->result();
    }

    public function unindexingDetail()
    {
        // matiHEre("hoop dulu");
        $start_time = microtime(true);
        $start_jam = dtimeNow('H:i:s');
        if (isset($_GET['r']) && $_GET['r'] > 0) {
            header("refresh:" . $_GET['r']);
        }
        $this->db = $this->load->database("testing", true);
        $this->load->model("Mdls/MdlNonIndexingDetail");
        $this->load->model("MdlTransaksi");
        $un = new MdlNonIndexingDetail();
        $tr = new MdlTransaksi();


        $tr->addFilter("link_id='0'");
        $tr->addFilter("pemindahan='99'");
        $sudah_pindah = $tr->lookupDataCount();
        // cekLime($this->db->last_query());
        cekHitam("sudah udpate  " . $sudah_pindah);

        $limit = 1000;
        $condites = array(
            "link_id" => "0",
            "indexing_detail" => NULL,
            "pemindahan" => "1",
            // "id" => "22306",
        );

        $this->db->limit($limit);
        $this->db->select(array("id", "indexing_details"));
        $this->db->order_by("id", "desc");
        $tr->addFilter("link_id='0'");
        $tr->addFilter("pemindahan='1'");
        $tmp = $tr->lookUpAll()->result();
        // ceklime($this->db->last_query());
        $this->db->trans_begin();
        if (sizeof($tmp) > 0) {
            $listedID = array();
            $updateList = array();
            foreach ($tmp as $tmp_0) {
                // $is_null = $tmp_0->indexing_details ? NULL :$tmp_0->indexing_details;
                if ($tmp_0->indexing_details == NULL) {
                    // cekHitam($tmp_0->id);
                    $listedID[$tmp_0->id] = $tmp_0->id;
                }
                else {
                    $data = blobDecode($tmp_0->indexing_details);
                    if (sizeof($data) > 0) {

                    }
                    else {
                        $listedID[$tmp_0->id] = $tmp_0->id;
                    }
                    // cekHitam("ada");
                }
                $updateList = array("pemindahan" => "99");
                $wheres = array(
                    "id" => $tmp_0->id,
                );
                $tr->updateData($wheres, $updateList);
            }
            if (sizeof($listedID) > 0) {
                $tr->setFilters(array());

                foreach ($listedID as $ids => $ix) {
                    $lstData = $tr->lookupDetailTransaksiNoJenis($ids)->result();
                    $data = array();
                    foreach ($lstData as $tmp) {
                        $data[] = $tmp->id;
                    }
                    $dataInsert = array(
                        "indexing_details" => blobEncode($data),
                    );
                    $wheres = array(
                        "id" => $ids,
                    );
                    $tr->updateData($wheres, $dataInsert);
                    // cekHitam("$ids ".$this->db->last_query());
                }
            }
        }


        // matiHEre(__LINE__ . " " . __FILE__);
        $this->db->trans_complete();
        flush();
        ob_flush();
        $stop_time = microtime(true);
        $exe_time = $stop_time - $start_time;
        cekBiru("$stop_time<br>$start_time<hr>$exe_time (detik)");
        //hitung total belum pindah
        $tr->addFilter("link_id='0'");
        $tr->addFilter("pemindahan='1'");
        $belum_pindah = $tr->lookupDataCount();
        cekMerah("pindah " . $sudah_pindah . " / belum dipindah " . $belum_pindah . " dari " . ($sudah_pindah + $belum_pindah));
        // arrPrint($tmp);


    }

    public function insertUnRegistry()
    {
        // matiHEre("HOOP");
        if (isset($_GET['r']) && $_GET['r'] > 0) {
            header("refresh:" . $_GET['r']);
        }


        $start_time = microtime(true);
        $start_jam = dtimeNow('H:i:s');

        // $this->db = $this->load->database("default", true);
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlNonRegistry");
        $tr = new MdlTransaksi();
        $r = new MdlNonRegistry();

        $r->setFilters(array());
        $limit = 1;
        $this->db->limit($limit);
        $r->addFilter("status='1'");
        $r->addFilter("trash='0'");
        $this->db->order_by("transaksi_id", "desc");
        $idx = $r->lookUpAll()->result();
        showLast_query("merah");
        $this->db->trans_begin();
        // arrPrint($idx);
        // cekMerah($idx[0]->transaksi->id);
        if (sizeof($idx) > 0) {

            foreach ($idx as $tmp0) {
                $id = $tmp0->transaksi_id;
                // cekMerah($id);
                $regies = $tr->lookupRegistriesByMasterID($id)->result();
                // showLast_query("lime");
                // arrPrintPink($regies);
                $kolom_params = array(
                    "main",
                    "items",
                    "items2",
                    "items2_sum",
                    "itemSrc",
                    "itemSrc_sum",
                    "items3",
                    "items3_sum",
                    "items4",
                    "items4_sum",
                    "items_noapprove",
                    "rsltItems",
                    "rsltItems2",
                    "rsltItems3",
                    "tableIn_master",
                    "tableIn_detail",
                    "tableIn_detail2_sum",
                    "tableIn_detail_rsltItems",
                    "tableIn_detail_rsltItems2",
                    "tableIn_master_values",
                    "tableIn_detail_values",
                    "tableIn_detail_values_rsltItems",
                    "tableIn_detail_values_rsltItems2",
                    "tableIn_detail_values2_sum",
                    "main_add_values",
                    "main_add_fields",
                    "main_elements",
                    "main_inputs",
                    "main_inputs_orig",
                    "receiptDetailFields",
                    "receiptSumFields",
                    "receiptDetailFields2",
                    "receiptDetailSrcFields",
                    "receiptSumFields2",
                    "jurnal_index",
                    "postProcessor",
                    "preProcessor",
                    "revert",
                    "items_komposisi",
                    "jurnalItems",
                    "componentsBuilder",
                    "items5_sum",
                    "items6_sum",
                    "items7_sum",
                    "items8_sum",
                    "items9_sum",
                    "items10_sum",
                );
                $srcParams = array();
                foreach ($regies as $regi) {
                    $param = $regi->param;
                    $values = $regi->values;

                    $srcParams[$param] = $values;
                }

                $dataParams = array();
                foreach ($kolom_params as $kolom_param) {
                    $dataParams[$kolom_param] = isset($srcParams[$kolom_param]) ? $srcParams[$kolom_param] : blobEncode(array());
                }

                // $new_data = $dataParams + array(
                //         // "transaksi_id" => $trans_id,
                //         "transaksi_id" => "$id",
                //     );

                // $tr->setFilters(array());
                // $tr->setTableName("transaksi_data_registry") ;
                // $ins = $tr->writeDataRegistries($id,$dataParams) or die("gagal insert data");
                $ins = $tr->writeDataRegistries($id, $dataParams) or die("error");
                // if($ins){
                //
                // }else{
                //     matiHEre("error");
                // }
                // showLast_query("hitam");

                //update yg sudah diambil
                $r->setFilters(array());
                $updateNonReg = array("status" => "0");
                $wheres = array(
                    "transaksi_id" => "$id",
                );
                $r->updateData($wheres, $updateNonReg) or die("Failed to update tr !");
                // showLast_query("hijau");
            }
        }
        else {
            cekPink("--------SELESASI ---------");
        }


        //endupdate


        // matiHEre(__LINE__." ".__FILE__);
        $this->db->trans_complete();


        //total belum pindah
        $r->addFilter("status='0'");
        $r->addFilter("trash='0'");
        $sudah_pindah = $r->lookupDataCount();

        //hitung total belum pindah
        $r->setFilters(array());
        $r->addFilter("status='1'");
        $r->addFilter("trash='0'");
        $belum_pindah = $r->lookupDataCount();
        cekMerah("pindah " . $sudah_pindah . " / belum dipindah " . $belum_pindah . " dari " . ($sudah_pindah + $belum_pindah));

        $stop_time = microtime(true);
        $exe_time = $stop_time - $start_time;
        $stop_time = microtime(true);
        $exe_time = $stop_time - $start_time;
        cekBiru("$stop_time<br>$start_time<hr>$exe_time (detik)");
        // sleep for 10 seconds
        // cekBiru();
        // flush();
        // ob_flush();
        // echo "okok";
        flush();
        ob_flush();
        // sleep(10);
        cekHitam("lanjut lagi .... " . dtimeNow('H:i:s'));
    }

    //----------------------------------------------------------
    public function cekTransaksiJurnal()
    {

        $this->load->model("Coms/ComJurnal");
        $this->load->model("MdlTransaksi");

        $headerFields = array(
            "dtime" => "dtime",
            "id" => "trID",
            "jenis_label" => "label",
            "jenis" => "jenis",
            "nomer" => "nomer",
            "config_jurnal" => "config<br>jurnal",
            "jurnal" => "tb jurnal",
        );


        $lc = New MdlTransaksi();
        if (!isset($_GET['date1']) && !isset($_GET['date2'])) {
            $limit = 20;
            $this->db->limit("$limit");
            $this->db->order_by("id", "DESC");

            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $subTitle_date = " <span style='font-size:12px;font-style:italic;'>(cli $limit terakhir)</span>";
        }
        else {
            $date1 = isset($_GET['date1']) ? $_GET['date1'] : date("Y-m-d");
            $date2 = isset($_GET['date2']) ? $_GET['date2'] : date("Y-m-d");

            $this->db->where("date(dtime)>='" . $date1 . "'");
            $this->db->where("date(dtime)<='" . $date2 . "'");
            $this->db->order_by("id", "DESC");
            $subTitle_date = lgTranslateTime($date1) . " - " . lgTranslateTime($date2);
        }
        $lcTmp = $lc->lookupAll()->result();

        $items = array();
        $trIDs = array();
        $sumItems = array();
        if (sizeof($lcTmp) > 0) {
            foreach ($lcTmp as $spec) {
                $jenis_master = $spec->jenis_master;
                $jenis = $spec->jenis;
                $trIDs[] = $spec->id;
                $subItems['pID'] = $spec->id;
                foreach ($headerFields as $key => $val) {
                    $subItems[$key] = isset($spec->$key) ? $spec->$key : "-";
                }
                $modul = isset($this->masterConfigUi[$jenis_master]['modul']) ? $this->masterConfigUi[$jenis_master]['modul'] : NULL;
                //----------------------
                $arrJurnalExist = array();
                $configCoreJenis = loadConfigModulJenis_he_misc($jenis_master, "coTransaksiCore");
                if (isset($configCoreJenis['components'][$jenis]['master'])) {
                    foreach ($configCoreJenis['components'][$jenis]['master'] as $specc) {
                        if ($specc['comName'] == "Jurnal") {
                            $arrJurnalExist[] = $specc['loop'];
                        }
                    }
                }
                //----------------------
                $subItems["config_jurnal"] = (sizeof($arrJurnalExist) > 0) ? "YES" : "NO jurnal";
                $subItems["jenis_master"] = $jenis_master;
                $subItems["modul_path"] = base_url() . "$modul/";
                $items[$spec->id] = $subItems;
            }

            // baca tabel jurnal
            $cj = New ComJurnal();
            $cj->addFilter("transaksi_id in ('" . implode("','", $trIDs) . "')");
            $cjTmp = $cj->lookupAll()->result();
            $arrJurnal = array();
            if (sizeof($cjTmp) > 0) {
                foreach ($cjTmp as $cjSpec) {
                    $arrJurnal[$cjSpec->transaksi_id][$cjSpec->cabang_id][] = array(
                        "rekening" => $cjSpec->rekening,
                        "debet" => $cjSpec->debet,
                        "kredit" => $cjSpec->kredit,
                    );
                }
            }
            foreach ($items as $trID => $trSpec) {
                if (isset($arrJurnal[$trID]) && (sizeof($arrJurnal[$trID]) > 0)) {
                    $items[$trID]['jurnal'] = "YES";
                }
                else {
                    $items[$trID]['jurnal'] = "NO jurnal";
                }
            }
        }
        //arrPrintWebs($arrJurnal);
        $warning = array();
        $headerFields['items'] = "items";
        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/?";
        $addSubTitle = "(" . sizeof($lcTmp) . " transaksi)";
        $data = array(
            "mode" => "indexDate",
            "title" => "",
            "subTitle" => " $subTitle_date  $addSubTitle",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "thisPage" => $thisPage,
            "q" => isset($q) ? $q : "",

            "filters" => array(
                "date1" => $date1,
                "date2" => $date2,
                "dates" => date("Y-m-d"),
            ),
            "jenis_group" => "",
        );

        $this->load->view("tool", $data);
    }

    public function configRegistry()
    {
        $this->load->model("MdlTransaksi");
        $configMasterUi = $this->config->item("heTransaksi_ui");

        $date = "2021-11-01";


        $tr = New MdlTransaksi();
        $this->db->where("fulldate>='$date'");
        $this->db->limit(100);
        $tr->setSortBy(array("mode" => "ASC", "kolom" => "id"));
        $tr->addFilter("registry_patch='0'");
        $tmp = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHere(sizeof($tmp));

        $arrTrData = array();
        $arrTrDataConfig = array();
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $tmpSpec) {
                $arrTrData[$tmpSpec->id] = array(
                    "id" => $tmpSpec->id,
                    "jenis_master" => $tmpSpec->jenis_master,
                    "jenis_target" => $tmpSpec->jenis,
                    "nomer" => $tmpSpec->nomer,
                    "modul" => $configMasterUi[$tmpSpec->jenis_master]['modul'],
                );
            }

            foreach ($arrTrData as $trID => $spec) {
                $targetJenis = $spec['jenis_target'];
                $configCore = loadConfigModulJenis_he_misc($spec['jenis_master'], "coTransaksiCore");
                $preProc = isset($configCore['preProcessor'][$targetJenis]) ? $configCore['preProcessor'][$targetJenis] : array();
                $postProc = isset($configCore['postProcessor'][$targetJenis]) ? $configCore['postProcessor'][$targetJenis] : array();
                $component = isset($configCore['components'][$targetJenis]) ? $configCore['components'][$targetJenis] : array();
                //            cekHitam("targetJenis: $targetJenis");
                //            cekHitam("COMPONENT targetJenis: $targetJenis");
                //            cekKuning($component);
                //            cekHitam("PREPROCC targetJenis: $targetJenis");
                //            cekKuning($preProc);
                //            cekHitam("POSTPROCC targetJenis: $targetJenis");
                //            cekKuning($postProc);
                $arrTrDataConfig[$trID] = array(
                    "jurnal_index" => $component,
                    "preProcessor" => $preProc,
                    "postProcessor" => $postProc,
                );
            }
        }


        $this->db->trans_begin();

        //        arrPrintWebs($arrTrDataConfig);
        if (sizeof($arrTrDataConfig) > 0) {

            foreach ($arrTrDataConfig as $trID => $spec) {
                $where = array(
                    "transaksi_id" => $trID,
                );

                $tr = New MdlTransaksi();
                $tr->updateDataRegistry($where, $spec);
                showLast_query("orange");


                //---UPDATE transaksi, registry_patch = 1
                $tr = New MdlTransaksi();
                $where2 = array(
                    "id" => $trID,
                );
                $data2 = array(
                    "registry_patch" => 1,
                );
                $tr->setFilters(array());
                $tr->updateData($where2, $data2);
                showLast_query("ungu");
            }
        }
        else {
            cekHijau("<h1>-- COMPLETE --</h1>");
        }

        matiHEre(__LINE__ . " " . __FILE__);
        $this->db->trans_complete();


    }

    public function updateTransaksi()
    {
        $this->load->model("MdlTransaksi");
        $jenisTr = "9912";


        $tr = New MdlTransaksi();
        $tr->addFilter("jenis='$jenisTr'");
        $tmp = $tr->lookupAll()->result();
        showLast_query("biru");
        //        cekHere(sizeof($tmp));
        $trIDs = array();
        foreach ($tmp as $spec) {
            $trIDs[] = $spec->id;
        }

        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->setJointSelectFields("transaksi_id, main");
        $tr->addFilter("transaksi_id in ('" . implode("','", $trIDs) . "')");
        $reg = $tr->lookupDataRegistries()->result();
        showLast_query("kuning");
        $arrUpdateData = array();
        foreach ($reg as $rSpec) {
            $trID = $rSpec->transaksi_id;
            $main = blobDecode($rSpec->main);
            //            arrPrintWebs($main);
            $refID = isset($main['transaksi']) ? $main['transaksi'] : 0;
            if ($refID > 0) {
                $data = array(
                    "cancel_id" => isset($main['olehID']) ? $main['olehID'] : "",
                    "cancel_name" => isset($main['olehName']) ? $main['olehName'] : "",
                    "cancel_dtime" => isset($main['dtime']) ? $main['dtime'] : "",
                );
                $arrUpdateData[$refID] = $data;
            }
        }


        $this->db->trans_begin();


        foreach ($arrUpdateData as $trID => $update) {
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $where = array(
                "id" => $trID
            );
            $tr->updateData($where, $update);
            showLast_query("ungu");
        }


        matiHEre(__LINE__ . " " . __FILE__);
        $this->db->trans_complete();


    }
    //----------------------------------------------------------
    //injector seller_id dan seller_nama
    public function sellerInjectorTrans()
    {
        // matiHEre();
        $this->load->model("MdlTransaksi");
        $jenisTr = "582spo";


        $tr = New MdlTransaksi();
        // $this->db->limit(10);
        $tr->setFilters(array());
        $this->db->select(array("id", "oleh_id", "oleh_nama"));
        $tr->addFilter("jenis='$jenisTr'");
        $tr->addFilter("link_id='0'");
        $tmp = $tr->lookupAll()->result();
        // matiHEre(sizeof($tmp));
        $this->db->trans_begin();
        $totalData = sizeof($tmp);
        // $ii=0;
        foreach ($tmp as $temp) {
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $where = array(
                "id_master" => $temp->id,
            );
            $tr->updateData($where, array("seller_id" => $temp->oleh_id, "seller_nama" => $temp->oleh_nama,));
            // showLast_query("biru");
        }
        // showLast_query("biru");
        // cekMErah($ii."dari tota data ".$totalData);

        // matiHEre(__LINE__ . " " . __FILE__);
        cekMerah("habisss");
        $this->db->trans_complete();


    }


    public function cekSaldoRekening()
    {

        $this->load->model("Coms/ComRekening_cli");
        $cr = New ComRekening_cli();

        $periode = "forever";
        $cabangID = "1";
        $date1 = date("Y-01-01");
        $date2 = date("Y-m-d");
        $dateNow = date("Y-m-d");
        $dateTimeNow = date("Y-m-d H:i:s");
        $dateExp = explode("-", $dateNow);
        $bulan = $dateExp[1];
        $tahun = $dateExp[0];
        $tahunLast = $dateExp[0] - 1;
        cekHere(":: $date1 :: $date2 ::");

        $static = array(
            "static" => array(
                "cabang_id" => $cabangID,
                "dtime" => $dateTimeNow,
                "fulldate" => $dateNow,
                "bln" => $bulan,
                "thn" => $tahun,
                "periode" => $periode,
            ),
        );
        $filters = array(
            "periode" => $periode,
            "cabang_id" => $cabangID,
            //            "bln" => $bulan,
            //            "thn" => $tahun,
        );
        $filters2 = array(
            "periode=" => $periode,
            "cabang_id=" => $cabangID,
            //            "date(dtime)<=" => $date2,
        );


        $cr->setFilters(array());
        $cr->setFilters2(array());
        $cr->setFilters($filters);
        $cr->setFilters2($filters2);
        $cr->addFilter("cabang_id='" . $cabangID . "'");
        if (isset($this->filters)) {
            $setFilters = $this->filters;
            foreach ($this->filters as $kf => $vf) {
                $cr->addFilter("$kf='$vf'");
            }
        }
        //        if (isset($this->filters2)) {
        //            $cr->setFilters2($this->filters2);
        //        }
        //
        $tmp = $cr->fetchAllBalances2();
        cekKuning($this->db->last_query());
        if (sizeof($tmp) > 0) {
            $arrRek = array();
            $arrRekSaldo = array();
            foreach ($tmp as $rek => $rSpec) {
                $arrRek[] = $rek;

                $rSpec['debet'] = 0;
                $rSpec['kredit'] = 0;
                $arrRekSaldo[$rek] = $rSpec;
            }
        }

        // membaca in/out mutasi masing-masing rekening...
        if (sizeof($arrRek) > 0) {
            $arrMutasi = array();
            foreach ($arrRek as $rek) {

                $mts = New ComRekening_cli();
                $mts->addFilter("cabang_id='$cabangID'");
                $mts->addFilter("date(dtime)>='$date1'");
                $mts->addFilter("date(dtime)<='$date2'");
                $mts->addFilter("transaksi_id>'0'");
                $arrMutasi[$rek] = $mts->fetchMoves($rek);
                cekLime($this->db->last_query());
            }
            if (sizeof($arrMutasi) > 0) {

                $arrRekMutasi = array();
                $arrMutasiResult = array();
                foreach ($arrMutasi as $rek => $mSpec) {
                    foreach ($mSpec as $mmSpec) {

                        if (!isset($arrMutasiResult[$rek]["debet"])) {
                            $arrMutasiResult[$rek]["debet"] = 0;
                        }
                        if (!isset($arrMutasiResult[$rek]["kredit"])) {
                            $arrMutasiResult[$rek]["kredit"] = 0;
                        }

                        $arrMutasiResult[$rek]["rek_id"] = $mmSpec->rek_id;
                        $arrMutasiResult[$rek]["rekening"] = $mmSpec->rekening;
                        $arrMutasiResult[$rek]["debet"] += $mmSpec->debet;
                        $arrMutasiResult[$rek]["kredit"] += $mmSpec->kredit;
                        $arrMutasiResult[$rek]["periode"] = $periode;

                        $arrRekMutasi[$mmSpec->rekening] = $mmSpec->rekening;
                    }
                }
                //                arrPrint($arrMutasiResult);
            }
        }
        else {
            cekMerah("HAHAH");
        }


    }

    //----------------------------------------------------------
    public function tabelMutasiRekening()
    {
        cekMerah(date("Y-m-d H:i:s"));
        $this->load->helper("he_mass_table");
        $this->load->helper("he_misc");
        $this->load->model("Coms/ComRekening_cli");
        $this->load->model("CustomCounter");
        $this->load->config("heAccounting");
        $accounts = $this->config->item("accountStructure");

        $cc = New CustomCounter();
        $mts = New ComRekening_cli();
        $listtabel = "z_tabel_mutasi";

        $no = 0;
        $arrAccounts = array();
        foreach ($accounts as $accountSpec) {
            foreach ($accountSpec as $account_rekening) {
                $rekening_replacer = str_replace(" ", "_", $account_rekening);
                $tabel_master = "__rek_master__" . $rekening_replacer;
                if ($this->db->table_exists($tabel_master)) {
                    $no++;
                    //                    cekHere("$no $tabel_master");
                    $arrAccounts[$account_rekening] = $tabel_master;
                }
            }
        }
        //        arrPrint($arrAccounts);


        $this->db->trans_start();

        foreach ($arrAccounts as $rek => $tabel) {
            $data = array(
                "jenis" => "master",
                "rekening" => $rek,
                "nama" => $tabel,
                "status_counter" => 0,
                "status_saldo" => 0,
            );
            $this->db->select('id');
            $this->db->where(
                array(
                    "jenis" => "master",
                    "nama" => "$tabel"
                )
            );
            $tmp = $this->db->get($listtabel)->result();
            showLast_query("biru");
            if (sizeof($tmp) == 0) {
                cekMerah("masukkan disini nama tabel mutasinya");
                $this->db->insert($listtabel, $data);
                showLast_query("hijau");
            }
        }


        mati_disini(" OHOOOO ");
        $this->db->trans_complete();

        cekMerah(date("Y-m-d H:i:s"));

    }

    public function injectCounterRekening()
    {
        header("refresh:10");
        cekMerah(date("Y-m-d H:i:s"));
        $this->load->helper("he_mass_table");
        $this->load->helper("he_misc");
        $this->load->model("Coms/ComRekening_cli");
        $this->load->model("CustomCounter");
        $this->load->config("heAccounting");
        $accounts = $this->config->item("accountStructure");

        $cc = New CustomCounter();
        $mts = New ComRekening_cli();
        $listtabel = "z_tabel_mutasi";

        $no = 0;
        $arrAccounts = array();
        //        foreach ($accounts as $accountSpec) {
        //            foreach ($accountSpec as $account_rekening) {
        //                $rekening_replacer = str_replace(" ", "_", $account_rekening);
        //                $tabel_master = "__rek_master__" . $rekening_replacer;
        //                if ($this->db->table_exists($tabel_master)) {
        //                    $no++;
        ////                    cekHere("$no $tabel_master");
        //                    $arrAccounts[$account_rekening] = $tabel_master;
        //                }
        //            }
        //        }
        //        arrPrint($arrAccounts);

        $this->db->select(array("rekening", "nama", "id"));
        $this->db->where(
            array(
                "jenis" => "master",
                "status_counter" => "0"
            )
        );
        $this->db->order_by("id", "ASC");
        $this->db->limit(2, 0);
        $tmp = $this->db->get($listtabel)->result();
        showLast_query("biru");
        arrPrintPink($tmp);


        $listTabelIDs = array();
        $arrMutasi = array();
        foreach ($tmp as $tmpSpec) {
            $listTabelIDs[$tmpSpec->id] = $tmpSpec->id;

            $rek = $tmpSpec->rekening;
            $arrMutasi[$rek] = $mts->fetchMoves($rek);
            cekLime($this->db->last_query());
        }
        //        mati_disini(sizeof($tmp));


        $this->db->trans_start();

        foreach ($tmp as $tmpSpec) {
            $rek = $tmpSpec->rekening;
            $tabel = $tmpSpec->nama;
            foreach ($arrMutasi[$rek] as $ii => $spec) {

                $fulldate_ex = explode("-", $spec->fulldate);
                $tahun = $fulldate_ex[0];
                $bulan = $fulldate_ex[1];
                $hari = $fulldate_ex[2];
                $cabangID = $spec->cabang_id;

                //-------------
                if ($spec->debet > 0) {
                    $cc = New CustomCounter();
                    $urut_debet = $cc->setCounterRekening($spec->rekening, 0, $cabangID, "debet");
                    $urut_kredit = 0;
                }
                else {
                    $cc = New CustomCounter();
                    $urut_debet = 0;
                    $urut_kredit = $cc->setCounterRekening($spec->rekening, 0, $cabangID, "kredit");
                }
                //-------------

                $cc = New CustomCounter();
                $lastCounter = $cc->setCounterRekening($rek, 0, $cabangID, NULL);
                //            cekHitam(":: NYUSULIN COUNTER no. $lastCounter ::");
                $id = $spec->id;
                $tabel_nama = $tabel;
                $data = array(
                    "urut" => $lastCounter,
                    "urut_debet" => $urut_debet,
                    "urut_kredit" => $urut_kredit,
                    "thn" => $tahun,
                    "bln" => $bulan,
                    "tgl" => $hari,
                );
                $where = array(
                    "id" => $id
                );
                $mts->setTableName($tabel_nama);
                $mts->updateData($where, $data);
                showLast_query("hitam");
                //            break;
            }
        }

        foreach ($listTabelIDs as $idDb) {
            $data = array(
                "status_counter" => "1",
            );
            $where = array(
                "id" => "$idDb"
            );
            $this->db->where($where);
            $this->db->update($listtabel, $data);
            showLast_query("orange");
        }

        mati_disini(" OHOOOO ");
        $this->db->trans_complete();

        cekMerah(date("Y-m-d H:i:s"));

    }

    public function injectCounterRekeningPembantu()
    {
        $this->load->helper("he_mass_table");
        $this->load->helper("he_misc");
        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("CustomCounter");


        $cc = New CustomCounter();
        $mts = New ComRekeningPembantuProduk();

        //        $rek = "kas";
        $rek = "persediaan produk";
        $cabangID = "21";
        //        $rekening_detail_id = "0";
        $tabel_nama = "__rek_pembantu_produk__persediaan_produk";
        //        $mts->addFilter("cabang_id='$cabangID'");

        $arrMutasi[$rek] = $mts->fetchMoves2($rek);
        cekLime($this->db->last_query());
        //mati_disini();

        $this->db->trans_start();


        foreach ($arrMutasi[$rek] as $ii => $spec) {
            arrPrint($spec);
            $fulldate_ex = explode("-", $spec->fulldate);
            $tahun = $fulldate_ex[0];
            $bulan = $fulldate_ex[1];
            $hari = $fulldate_ex[2];
            $cabangID = $spec->cabang_id;

            //-------------
            if ($spec->qty_debet > 0) {
                $cc = New CustomCounter();
                $urut_debet = $cc->setCounterRekening($spec->rekening, $spec->extern_id, $cabangID, "debet");
                $urut_kredit = 0;
            }
            else {
                $cc = New CustomCounter();
                $urut_debet = 0;
                $urut_kredit = $cc->setCounterRekening($spec->rekening, $spec->extern_id, $cabangID, "kredit");
            }
            //-------------

            $cc = New CustomCounter();
            $lastCounter = $cc->setCounterRekening($rek, $spec->extern_id, $cabangID, NULL);
            //            cekHitam(":: NYUSULIN COUNTER no. $lastCounter ::");
            $id = $spec->id;
            //            $tabel_nama = "__rek_master__" . $rek;
            $data = array(
                "urut" => $lastCounter,
                "urut_debet" => $urut_debet,
                "urut_kredit" => $urut_kredit,
                "thn" => $tahun,
                "bln" => $bulan,
                "tgl" => $hari,
            );
            $where = array(
                "id" => $id
            );
            $mts->setTableName($tabel_nama);
            $mts->updateData($where, $data);
            showLast_query("hitam");
            //            break;
        }


        mati_disini(" OHOOOO ");
        $this->db->trans_complete();
    }


    public function injectSaldoRekening()
    {
        //        header("refresh:10");
        $this->load->helper("he_mass_table");
        $this->load->helper("he_misc");
        $this->load->model("Coms/ComRekening_cli");
        $this->load->model("CustomCounter");


        $cc = New CustomCounter();
        $mts = New ComRekening_cli();
        $listtabel = "z_tabel_mutasi";


        //        $rek = "kas";
        //        $rek = "penjualan";
        $cabangID = "25";
        $rekening_detail_id = "0";

        $no = 0;
        $arrAccounts = array();
        $this->db->select(array("rekening", "nama", "id"));
        $this->db->where(
            array(
                "jenis" => "master",
                "status_saldo" => "0"
            )
        );
        $this->db->order_by("id", "ASC");
        $this->db->limit(2, 0);
        $tmp = $this->db->get($listtabel)->result();
        showLast_query("biru");
        arrPrintPink($tmp);

        $listTabelIDs = array();
        $arrMutasi = array();
        foreach ($tmp as $tmpSpec) {
            $listTabelIDs[$tmpSpec->id] = $tmpSpec->id;

            $rek = $tmpSpec->rekening;
            $mts->addFilter("cabang_id='$cabangID'");
            $arrMutasi[$rek] = $mts->fetchMoves($rek);
            //            $this->db->select("*");
            //            $this->db->order_by("id", "asc");
            //            $this->db->where(array("cabang_id"=>"$cabangID"));
            //            $arrMutasi[$rek] = $this->db->get($tmpSpec->nama)->result();
            cekLime($this->db->last_query());
        }
        //        mati_disini(sizeof($tmp));

        $this->db->trans_start();

        foreach ($tmp as $tmpSpec) {
            $rek = $tmpSpec->rekening;
            $tabel = $tmpSpec->nama;
            if (isset($arrMutasi[$rek]) && sizeof($arrMutasi[$rek]) > 0) {
                foreach ($arrMutasi[$rek] as $ii => $spec) {
                    $fulldate_ex = explode("-", $spec->fulldate);
                    $tahun = $fulldate_ex[0];
                    $bulan = $fulldate_ex[1];
                    $hari = $fulldate_ex[2];
                    $filterDate = array(
                        "tgl" => $hari,
                        "bln" => $bulan,
                        "thn" => $tahun,
                    );


                    // region injector harian-------------
                    $lastSaldo_harian = $mts->cekPreValueMutasi($rek, $cabangID, "harian", $filterDate, $spec->id);
                    //            arrPrintPink($lastSaldo_harian);

                    if ($lastSaldo_harian['cache']['debet'] > 0) {
                        $preNumber_harian = detectRekByPosition($rek, $lastSaldo_harian['cache']['debet'], "debet");
                    }
                    else {
                        $preNumber_harian = detectRekByPosition($rek, $lastSaldo_harian['cache']['kredit'], "kredit");
                    }
                    if ($spec->debet > 0) {
                        $value_harian = detectRekByPosition($rek, $spec->debet, "debet");
                    }
                    else {
                        $value_harian = detectRekByPosition($rek, $spec->kredit, "kredit");
                    }
                    $afterNumber_harian = $preNumber_harian + $value_harian;
                    $afterPosition_harian = detectRekPosition($rek, $afterNumber_harian);
                    //            cekHitam("afterNumber: $afterNumber_harian, afterPosition: $afterPosition_harian");
                    switch ($afterPosition_harian) {
                        case "debet":
                            $saldo_harian_debet = abs($afterNumber_harian);
                            $saldo_harian_kredit = 0;
                            break;
                        case "kredit":
                            $saldo_harian_debet = 0;
                            $saldo_harian_kredit = abs($afterNumber_harian);
                            break;
                    }
                    //endregion -------------

                    $pakai_ini = 1;
                    if ($pakai_ini == 1) {

                        //region injector bulanan-------------
                        $lastSaldo_bulanan = $mts->cekPreValueMutasi($rek, $cabangID, "bulanan", $filterDate, $spec->id);
                        //            arrPrintPink($lastSaldo_bulanan);
                        //            arrPrintPink($spec);
                        if ($lastSaldo_bulanan['cache']['debet'] > 0) {
                            $preNumber_bulanan = detectRekByPosition($rek, $lastSaldo_bulanan['cache']['debet'], "debet");
                        }
                        else {
                            $preNumber_bulanan = detectRekByPosition($rek, $lastSaldo_bulanan['cache']['kredit'], "kredit");
                        }
                        if ($spec->debet > 0) {
                            $value_bulanan = detectRekByPosition($rek, $spec->debet, "debet");
                        }
                        else {
                            $value_bulanan = detectRekByPosition($rek, $spec->kredit, "kredit");
                        }
                        $afterNumber_bulanan = $preNumber_bulanan + $value_bulanan;
                        $afterPosition_bulanan = detectRekPosition($rek, $afterNumber_bulanan);
                        //                cekHitam("afterNumber: $afterNumber_bulanan, afterPosition: $afterPosition_bulanan");
                        switch ($afterPosition_bulanan) {
                            case "debet":
                                $saldo_bulanan_debet = abs($afterNumber_bulanan);
                                $saldo_bulanan_kredit = 0;
                                break;
                            case "kredit":
                                $saldo_bulanan_debet = 0;
                                $saldo_bulanan_kredit = abs($afterNumber_bulanan);
                                break;
                        }
                        //endregion-------------

                        //region injector tahunan-------------
                        $lastSaldo_tahunan = $mts->cekPreValueMutasi($rek, $cabangID, "tahunan", $filterDate, $spec->id);
                        //            arrPrintPink($lastSaldo_tahunan);
                        //            arrPrintPink($spec);
                        if ($lastSaldo_tahunan['cache']['debet'] > 0) {
                            $preNumber_tahunan = detectRekByPosition($rek, $lastSaldo_tahunan['cache']['debet'], "debet");
                        }
                        else {
                            $preNumber_tahunan = detectRekByPosition($rek, $lastSaldo_tahunan['cache']['kredit'], "kredit");
                        }
                        if ($spec->debet > 0) {
                            $value_tahunan = detectRekByPosition($rek, $spec->debet, "debet");
                        }
                        else {
                            $value_tahunan = detectRekByPosition($rek, $spec->kredit, "kredit");
                        }
                        $afterNumber_tahunan = $preNumber_tahunan + $value_tahunan;
                        $afterPosition_tahunan = detectRekPosition($rek, $afterNumber_tahunan);
                        //            cekHitam("afterNumber: $afterNumber_tahunan, afterPosition: $afterPosition_tahunan");
                        switch ($afterPosition_tahunan) {
                            case "debet":
                                $saldo_tahunan_debet = abs($afterNumber_tahunan);
                                $saldo_tahunan_kredit = 0;
                                break;
                            case "kredit":
                                $saldo_tahunan_debet = 0;
                                $saldo_tahunan_kredit = abs($afterNumber_tahunan);
                                break;
                        }
                        //endregion-------------
                    }

                    //region injector forever-------------
                    $saldo_forever_debet = $spec->debet_akhir;
                    $saldo_forever_kredit = $spec->kredit_akhir;
                    //endregion-------------


                    //            $lastCounter = $cc->setCounterRekening($rek, $rekening_detail_id, $cabangID);
                    //            cekHitam(":: NYUSULIN COUNTER no. $lastCounter ::");
                    $id = $spec->id;
                    //                $tabel_nama = "__rek_master__" . $rek;
                    $tabel_nama = $tabel;
                    $data = array(
                        //                "urut" => $lastCounter,
                        //                "thn" => $tahun,
                        //                "bln" => $bulan,
                        //                "tgl" => $hari,

                        "harian_debet" => $saldo_harian_debet,
                        "harian_kredit" => $saldo_harian_kredit,
                        "bulanan_debet" => $saldo_bulanan_debet,
                        "bulanan_kredit" => $saldo_bulanan_kredit,
                        "tahunan_debet" => $saldo_tahunan_debet,
                        "tahunan_kredit" => $saldo_tahunan_kredit,
                        "forever_debet" => $saldo_forever_debet,
                        "forever_kredit" => $saldo_forever_kredit,
                    );
                    $where = array(
                        "id" => $id
                    );
                    $mts->setFilters(array());
                    $mts->setTableName($tabel_nama);
                    $mts->updateData($where, $data);
                    showLast_query("hitam");

                    //            break;
                }
            }
        }

        foreach ($listTabelIDs as $idDb) {
            $data = array(
                "status_saldo" => "1",
            );
            $where = array(
                "id" => "$idDb"
            );
            $this->db->where($where);
            $this->db->update($listtabel, $data);
            showLast_query("orange");
        }

        //        mati_disini(" OHOOOO ");
        $this->db->trans_complete();
    }

    function coa()
    {
        $this->load->model(array(
            'Mdls/MdlAccounts',
            // 'Web_settings'
        ));
        $this->load->config("heAccounting");
        $this->load->library('parser');
        $accStucture = $this->config->item('accountStructure');
        // cekBiru($accStucture);
        //         $srcSatu = $this->MdlAccounts->get_coalist();
        $srcSatu = $this->MdlAccounts->get_userlist();
        // showLast_query("biru");
        // arrPrint($srcSatu);

        $data = array(
            "mode" => "coa",
            "title" => "coa",
            "subTitle" => "coa",
            "userList" => $srcSatu,
            "accStucture" => $accStucture,
            // 'userID'   => set_value('userID'),
        );

        $this->load->view("tool", $data);
        // $treeinfo = $this->parser->parse('newaccount/treeview',$data,true);
    }

    /* ---------------------------------------------
     * form data view maupun new
     * ---------------------------------------------*/
    public function coa_selectedform($id)
    {
        $CI = &get_instance();
        $CI->load->model('Mdls/MdlAccounts');
        $role_reult = $CI->MdlAccounts->treeview_selectform($id);
        $baseurl = base_url() . 'accounts/insert_coa';
        $fields = $CI->MdlAccounts->getFields();
        $labels = array();
        foreach ($fields as $field => $fParams) {
            $$field = $role_reult->$field;

            $labels[$field] = isset($fParams['label']) ? $fParams['label'] : $field;
        }
        $showFilters = $CI->MdlAccounts->getShowFilters();

        if ($role_reult) {
            $html = "";
            $html .= form_open_multipart('Tool/coa_insert_coa', 'id="form" target="result"');
            $html .= "<div id=\"newData\" class='col-md-7'>";
            $html .= "<table width=\"100%\" border=\"0\" cellspacing=\"1\" cellpadding=\"10\">";
            // $html .= "<table class='table'>";
            $html .= "<tr>
                <td width='70px' style='text-align: right;padding-right: 5px;'>H Code**</td>
                <td><input type=\"text\" name=\"txtHeadCode\" id=\"txtHeadCode\" class=\"form-control\"  value=\"" . $head_code . "\" readonly=\"readonly\"/>
                <input type=\"hidden\" name=\"HeadCode\" id=\"HeadCode\" class=\"form_input\" value=\"" . $head_code . "\"/>
                </td>
              </tr>";
            $html .= "<tr>
                <td style='text-align: right;padding-right: 5px;'>H Name</td>
                <td><input type=\"text\" name=\"txtHeadName\" autocomplete='off' required autofocus id=\"txtHeadName\" class=\"form-control\" value=\"" . $head_name . "\"/>
                  <input type=\"hidden\" name=\"HeadName\" id=\"HeadName\" class=\"form_input\" value=\"" . $head_name . "\"/>
                </td>
              </tr>";
            $html .= "<tr>
                <td>Parent Head</td>
                <td><input type=\"text\" name=\"txtPHead\" id=\"txtPHead\" class=\"form-control\" readonly=\"readonly\" value=\"" . $p_head_name . "\"/></td>
              </tr>";
            $html .= "<tr>
                <td style='text-align: right;padding-right: 5px;'>H Level</td>
                <td><input type=\"text\" name=\"txtHeadLevel\" id=\"txtHeadLevel\" class=\"form-control\" readonly=\"readonly\" value=\"" . $head_level . "\"/></td>
              </tr>";
            $html .= "<tr>
                <td style='text-align: right;padding-right: 5px;'>H Type</td>
                <td><input type=\"text\" name=\"txtHeadType\" id=\"txtHeadType\" class=\"form-control\" readonly=\"readonly\" value=\"" . $head_type . "\"/></td>
              </tr>";

            $html .= "<tr>";
            $html .= "<td>&nbsp;</td>";
            $html .= "<td>";

            $html .= "<div style='padding: 10px;'>";

            $html .= "<input type=\"checkbox\" name=\"IsTransaction\" value=\"1\" id=\"IsTransaction\" size=\"28\" onchange=\"IsTransaction_change()\"";
            if ($role_reult->is_transaction == 1) {
                $html .= "checked";
            }
            $html .= "/><label for=\"IsTransaction\">&nbsp; Transaksional</label> &nbsp;
                     <input type=\"checkbox\" value=\"1\" name=\"IsActive\" id=\"IsActive\" size=\"28\"";
            if ($role_reult->is_active == 1) {
                $html .= "checked";
            }
            $html .= "/><label for=\"IsActive\">&nbsp; Active</label> &nbsp;";

            $html .= "<input type=\"checkbox\" value=\"1\" name=\"IsGL\" id=\"IsGL\" size=\"28\" onchange=\"IsGL_change();\"";
            if ($role_reult->is_gl == 1) {
                $html .= "checked";
            }
            $html .= "/><label for=\"IsGL\">&nbsp; General Ladger</label> &nbsp;";

            foreach ($showFilters as $kolom) {
                $html .= "<label for='$kolom'><input type='checkbox' value='1' name='$kolom' id='$kolom' size='28' onchange='IsGL_change();'";
                if ($role_reult->$kolom == 1) {
                    $html .= "checked";
                }
                $html .= "/>&nbsp; " . $labels[$kolom] . "</label> &nbsp;";
            }

            $html .= "</div>";

            $html .= "</td>";
            $html .= "</tr>";

            $html .= "<tr><td colspan='2'>&nbsp;</td></tr>";
            $html .= "<tr>
                    <td>&nbsp;</td>
                    <td>";
            $html .= "<input type=\"button\" class='btn btn-success' name=\"btnNew\" id=\"btnNew\" value=\"+ Data Baru\" onClick=\"newHeaddata('" . $head_code . "')\" />
                      &nbsp;<input type=\"submit\" class='btn btn-primary pull-right' name=\"btnSave\" id=\"btnSave\" value=\"Save\" disabled=\"disabled\"/>&nbsp;";
            $html .= "&nbsp;<input type=\"submit\" class='btn btn-danger pull-right' name=\"btnSavef5\" id=\"btnSavef5\" value=\"Save + F5\" disabled=\"disabled\"/>&nbsp;";

            $html .= " <input type=\"submit\" class='btn btn-primary pull-right' name=\"btnUpdate\" id=\"btnUpdate\" value=\"Update\" />";
            $html .= " <input type=\"submit\" class='btn btn-danger pull-right' name=\"btnUpdatef5\" id=\"btnUpdatef5\" value=\"Update + F5\" />";
            $html .= "</tr>";
            $html .= "</table>";
            $html .= "</div>";
            $html .= "</form>";


            /* ------------------------------------------------------
             * penampil anakan per induk yg dipilih
             * ------------------------------------------------------*/
            $condites = array(
                "p_head_name" => $head_code
            );
            $this->db->order_by("head_code", "asc");
            $role_result = $CI->MdlAccounts->lookupByCondition($condites)->result();
            // showLast_query("lime");
            // arrPrintPink($role_result);
            $html .= "<div class='list-group col-md-5'>";
            $html .= "<a href='#' class='list-group-item list-group-item-action active'><b class='text-light'>$head_code</b> - $head_name</a>";
            foreach ($role_result as $item) {
                $head_codes = $item->head_code;
                $head_names = $item->head_name;
                $html .= "<a href='#' class='list-group-item list-group-item-action' style='padding: 3px 10px;'><b class='text-red'>$head_codes</b> - $head_names</a>";
            }
            // $html .= "<div class='box-body'>999</div>";
            $html .= "</div>";
        }

        echo json_encode($html);
    }

    public function coa_newform($id)
    {
        // $id = substr($id,0,1) == 0 ? "0$id" : $id;
        // cekHere($id);
        $newdata = $this->db->select('*')
            ->from('acc_coa')
            ->where('head_code', $id)
            ->get()
            ->row();

        // arrPrint($newdata);
        $newidsinfo = $this->db->select('*,count(head_code) as hc')
            ->from('acc_coa')
            ->where('p_head_name', $newdata->head_code)
            ->get()
            ->row();

        $nid = $newidsinfo->hc;
        $n = $nid + 1;

        // cekHere($newdata->head_level + 1);
        // cekHere($id);
        if ($id == "0") {
            $HeadCode = $n;
        }
        else {
            if ($n / 10 < 1) {
                if (($newdata->head_level + 1) > 2) {
                    $HeadCode = $id . digit_5($n);
                }
                else {
                    $HeadCode = $id . "0" . $n;
                }
            }
            else {
                $HeadCode = $id . $n;
            }
        }


        $info['headcode'] = $HeadCode;
        $info['rowdata'] = $newdata;
        $info['headlabel'] = $newdata->head_level + 1;

        echo json_encode($info);
    }

    public function coa_insert_coa()
    {
        echo lgShowAlert("tunggu ya");
        $this->load->model('Mdls/MdlAccounts');
        $ac = new MdlAccounts();
        $showFilters = $ac->getShowFilters();
        // arrPrint($_POST);
        // arrPrintPink($_REQUEST);

        $headcode = $this->input->post('txtHeadCode', TRUE);
        $HeadName = $this->input->post('txtHeadName', TRUE);
        $PHead = $this->input->post('txtPHead', TRUE);
        $HeadLevel = $this->input->post('txtHeadLevel', TRUE);
        $txtHeadType = $this->input->post('txtHeadType', TRUE);
        $isact = $this->input->post('IsActive', TRUE);
        $IsActive = (!empty($isact) ? $isact : 0);
        $trns = $this->input->post('IsTransaction', TRUE);
        $IsTransaction = (!empty($trns) ? $trns : 0);
        $isgl = $this->input->post('IsGL', TRUE);
        $IsGL = (!empty($isgl) ? $isgl : 0);
        $createby = my_id();
        $createdate = date('Y-m-d H:i:s');

        $postData = array(
            'head_code' => $headcode,
            'head_name' => ucwords($HeadName),
            'p_head_name' => $PHead,
            'p_head_code' => $PHead,
            'head_level' => $HeadLevel,
            'head_type' => $txtHeadType,
            'is_active' => $IsActive,
            'is_transaction' => $IsTransaction,
            'is_gl' => $IsGL,
            'is_budget' => 0,
            'create_by' => $createby,
            'create_date' => $createdate,
        );
        foreach ($showFilters as $showFilter) {
            $postData[$showFilter] = $this->input->post($showFilter, TRUE);
        }
        // $upinfo = $this->db->select('*')
        //     ->from('acc_coa')
        //     ->where('head_code', $headcode)
        //     ->get()
        //     ->row();
        //
        // arrPrint($upinfo);

        $condites = array(
            "head_code" => $headcode
        );
        $upinfo = $ac->lookupByCondition($condites)->result();
        // showLast_query("kuning");
        // arrPrintPink($upinfo);
        if (empty($upinfo)) {
            // $this->db->insert('acc_coa', $postData);
            $ac->addData($postData);
            // showLast_query("lime");
        }
        else {

            $hname = $this->input->post('HeadName', TRUE);
            $hname_f = ucwords($hname);
            $updata = array(
                'p_head_name' => $HeadName,
            );

            /* --------------------------------------------
             * update parent
             * --------------------------------------------*/
            $this->db->where('head_code', $headcode)
                ->update('acc_coa', $postData);
            // showLast_query("lime");
            /* --------------------------------------------
             * update anak
             * --------------------------------------------*/
            $this->db->where('p_head_name', $hname_f)
                ->update('acc_coa', $updata);
            // showLast_query("merah");
        }

        // matiHere();
        // redirect($_SERVER['HTTP_REFERER']);
        echo lgShowSuccess("", "data berhasil disimpan <p style='font-size: .6em'>sorry ya .. refresh dewe</p>");
        if (isset($_POST['btnSavef5']) || isset($_POST['btnUpdatef5'])) {
            echo lgShowSuccess("", "data berhasil disimpan <p style='font-size: .6em'></p>");
            topReload(700);
        }

        // topReload();
    }


    public function copyHarga()
    {

    }


    //--------------------------------------------------
    public function generateNonAkuntingAllSales_OLD()
    {
        //        header("refresh:3");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "582";
        $divID = "18";
        $arrJenis = array("582spo", "582so", "582pkd", "582spd");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
        //        arrPrintPink($tmpHist);
        //mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
                    //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------

            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            //arrPrintPink($items);
            switch ($jenisTransaksi) {
                case "582spo":
                    $sourceMain = array(
                        "loop" => array(
                            "582spo" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_name" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "582so" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_name" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "582spo" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_name" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "582so" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_name" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "582so":
                    $sourceMain = array(
                        "loop" => array(
                            "582so" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_name" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "582pkd" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_name" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "582so" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_name" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "582pkd" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_name" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "582pkd":
                    $sourceMain = array(
                        "loop" => array(
                            "582pkd" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_name" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "582spd" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_name" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "582pkd" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_name" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "582spd" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_name" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "582spd":
                    $sourceMain = array(
                        "loop" => array(
                            "582spd" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_name" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "582spo" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_name" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "582spd" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_name" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "582spo" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_name" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "update_lap" => false,
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['static'][$key] = $newVal_result;
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['static'][$key] = $newVal_result;
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


        //        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    public function generatePembantuPph21()
    {
        $tabel = "__rek_master__hutang_pph21";
        $transID = "131461";
        $rekening = "hutang pph21";
        $tabelID = "58";
        $cabangID = "-1";

        $this->load->helper("he_mass_table_helper");
        $this->load->model("MdlTransaksi");
        $this->load->model("Coms/ComRekening");
        $this->load->model("Coms/ComRekeningPembantuPphMain");

        $cr = New ComRekening();
        $tr = New MdlTransaksi();


        $this->db->trans_start();


        //---------------------
        $cr->addFilter("cabang_id='$cabangID'");
        $cr->addFilter("id<='$tabelID'");
        $crTmp = $cr->fetchMoves($rekening);
        showLast_query("biru");
        //        arrPrint($crTmp);
        $arrTrIDs = array();
        foreach ($crTmp as $spec) {
            $arrTrIDs[$spec->transaksi_id] = $spec->transaksi_id;
        }
        //        arrPrintWebs($arrTrIDs);

        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("transaksi_id in ('" . implode("','", $arrTrIDs) . "')");
        $tr->setJointSelectFields("transaksi_id, main");
        $trReg = $tr->lookupDataRegistries()->result();
        showLast_query("biru");
        $arrReg = array();
        foreach ($trReg as $regSpec) {
            $arrReg[$regSpec->transaksi_id] = isset($regSpec->main) ? blobDecode($regSpec->main) : array();
        }


        foreach ($crTmp as $spec) {
            $debet = $spec->debet;
            $kredit = $spec->kredit;
            $jenis = $spec->jenis;
            $nomer = $spec->transaksi_no;
            $trid = $spec->transaksi_id;
            $cabangID = $spec->cabang_id;

            $externID = $arrReg[$trid]['pihakID'];
            $externNama = $arrReg[$trid]['pihakName'];

            if ($debet > 0) {
                $data = array(
                    "loop" => array(
                        "hutang pph21" => "-$debet",
                    ),
                    "static" => array(
                        "cabang_id" => "$cabangID",
                        "extern_id" => "$externID",// diisi id bank
                        "extern_nama" => "$externNama",// diisi nama bank
                        "jenis" => "$jenis",
                        "transaksi_no" => "$nomer",
                        "harga" => "$debet",
                        "extern2_id" => "1",// diisi id bank
                        "extern2_nama" => "karyawan",// diisi nama bank
                        "transaksi_id" => $trid,
                        "fulldate" => $spec->fulldate,
                        "dtime" => $spec->dtime,
                    ),
                );
            }
            else {
                $data = array(
                    "loop" => array(
                        "hutang pph21" => "$kredit",
                    ),
                    "static" => array(
                        "cabang_id" => "$cabangID",
                        "extern_id" => "$externID",// diisi id bank
                        "extern_nama" => "$externNama",// diisi nama bank
                        "jenis" => "$jenis",
                        "transaksi_no" => "$nomer",
                        "harga" => "$kredit",
                        "extern2_id" => "1",// diisi id bank
                        "extern2_nama" => "karyawan",// diisi nama bank
                        "transaksi_id" => $trid,
                        "fulldate" => $spec->fulldate,
                        "dtime" => $spec->dtime,
                    ),
                );
            }
            //arrPrintPink($data);
            $crpph = New ComRekeningPembantuPphMain();
            $crpph->pair($data);
            $crpph->exec();


        }

        mati_disini(__LINE__ . " STOPP");
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

    }

    //--------------------------------------------------

    //region non akunting penjualan diload diui saat laporan tampil /laporan/Crm/vieweoutstanding loader
    public function generateNonAkuntingAllSales()
    {
        // header("refresh:5");
        echo "<script>
            function refreshParent() {
                window.opener.location.reload();
                // window.opener.$('#sum_satu').load();
            }
            // function closingCode() {
            //     alert('hitme');
            // }
            // window.addEventListener('beforeunload', (event) => {
            //     console.log(event);
            //                   event.returnValue = `yg atas Are you sure you want to leave?`;
            //                 });
            
            // window.addEventListener(\"beforeunload\", function(event) {
            //   console.log(\"UNLOAD:1\");
            //   //event.preventDefault();
            //   event.returnValue = null; //\"Any text\"; //true; //false;
            //   //return null; //\"Any text\"; //true; //false;
            // });
            
            
            // const beforeUnloadListener = (event) => {
            //   event.preventDefault();
            //   return event.returnValue = \"Are you sure you want to exit?\";
            // };
        </script>";
        // echo "<html><body onload='closingCode();' ></body></html>";

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "582";
        $divID = "18";
        $arrJenis = array("582spo", "582so", "582pkd", "582spd");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        //        $tr->addFilter("id_master=131884");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));

        /* ----------------------------------------------------------------------------------------
         * cek Jumlah data keseluruhan yg perlu dieksekusi
         * ----------------------------------------------------------------------------------------*/
        $this->db->select("count(id) as 'jml_data'");
        $cekAll = $tr->lookupAll()->row();
        // showLast_query("kuning");
        $jml_data = $cekAll->jml_data;
        // $jml_data = 2;
        // arrPrintPink($cekAll);
        // cekPink($jml_data);

        if ($jml_data > 0) {

            /* ----------------------------------------------------------------------------------------
             * eksekutor data berjalan 1 per satu
             * ----------------------------------------------------------------------------------------*/
            $this->db->limit(1);
            $tmpHist = $tr->lookupAll()->result();
            // showLast_query("biru");
            // cekHitam(sizeof($tmpHist));
            //        arrPrintPink($tmpHist);
            //mati_disini();


            $this->db->trans_start();


            $trDatas = array();
            if (sizeof($tmpHist) > 0) {

                foreach ($tmpHist[0] as $key => $val) {
                    $trDatas[$key] = $val;
                }
                cekHitam(":: " . $tmpHist[0]->id);
                $trID = $tmpHist[0]->id;
                $masterID = $tmpHist[0]->id_master;
                $masterJenis = $tmpHist[0]->jenis_master;
                $jenisTransaksi = $tmpHist[0]->jenis;
                $counters = $tmpHist[0]->counters;
                //----------------------------
                $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
                $ids_his_data = array();
                if (sizeof($ids_his) > 0) {
                    foreach ($ids_his as $step => $hisSpec) {
                        $aa = "_step_" . $step . "_nomer";
                        $bb = "_step_" . $step . "_olehID";
                        $cc = "_step_" . $step . "_olehName";
                        $trDatas[$aa] = $hisSpec['nomer'];
                        $trDatas[$bb] = $hisSpec['olehID'];
                        $trDatas[$cc] = $hisSpec['olehName'];
                    }
                }
                $cContent = blobDecode($tmpHist[0]->counters);
                $arrIndexVal = array();
                foreach ($cContent as $counterKey => $counterData) {
                    $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                    foreach ($counterData as $key => $index_conter) {
                        //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                        $trDatas[$counterIndexKey] = $index_conter;
                    }
                }
                //----------------------------

                // registry main dan items
                $tr = new MdlTransaksi();
                $tr->setFilters(array());
                $tr->setJointSelectFields("transaksi_id, main, items");
                $tr->addFilter("transaksi_id='$trID'");
                $trReg = $tr->lookupDataRegistries()->result();
                showLast_query("kuning");
                $trRegResult = array();
                foreach ($trReg as $regSpec) {
                    $trRegResult[$regSpec->transaksi_id] = array(
                        "main" => blobDecode($regSpec->main),
                        "items" => blobDecode($regSpec->items),
                    );
                }
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['main'] as $mkey => $mval) {
                        $trDatas["m_" . $mkey] = $mval;
                    }
                }
                $addItems = array(
                    "id_master" => "id_master",
                    "_stepCode_placeID" => "_stepCode_placeID",
                    "_stepCode_olehID" => "_stepCode_olehID",
                    "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                    "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                    "_stepCode_customerID" => "_stepCode_customerID",
                    "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                    "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                    "_stepCode" => "_stepCode",
                    "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                    "_stepCode_supplierID" => "_stepCode_supplierID",
                    "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                    "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                    "_step_1_nomer" => "_step_1_nomer",
                    "_step_1_olehName" => "_step_1_olehName",
                    "_step_2_nomer" => "_step_2_nomer",
                    "_step_2_olehName" => "_step_2_olehName",
                    "_step_3_nomer" => "_step_3_nomer",
                    "_step_3_olehName" => "_step_3_olehName",
                    "_step_4_nomer" => "_step_4_nomer",
                    "_step_4_olehName" => "_step_4_olehName",
                    "_step_5_nomer" => "_step_5_nomer",
                    "_step_5_olehName" => "_step_5_olehName",
                );
                $items = array();
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['items'] as $mkey => $mSpec) {
                        $items[$mkey] = $mSpec;
                        foreach ($addItems as $akey => $aval) {
                            $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                        }
                    }
                }

                switch ($jenisTransaksi) {
                    case "582spo":
                        $sourceMain = array(
                            "loop" => array(
                                "582spo" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "transaksi_id" => "id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "582so" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "582spo" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "582so" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        break;
                    case "582so":
                        $sourceMain = array(
                            "loop" => array(
                                "582so" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "582pkd" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "582so" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "582pkd" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        break;
                    case "582pkd":
                        $sourceMain = array(
                            "loop" => array(
                                "582pkd" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "582spd" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "582pkd" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "582spd" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        break;
                    case "582spd":
                        $sourceMain = array(
                            "loop" => array(
                                "582spd" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "582spo" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                //                            "oleh_id" => "m_olehID",
                                //                            "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "582spd" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "582spo" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                //                            "oleh_id" => "olehID",
                                //                            "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                                "update_lap" => false,
                            ),
                        );
                        break;
                    default:

                        mati_disini(":: $jenisTransaksi ::");

                        break;
                }
                //------------------------------------
                //            arrPrint($trDatas);
                //            arrPrint($items);

                $mainData = $trDatas;
                $gateSource = array();
                $gateTarget = array();
                foreach ($sourceMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSource['static']['transaksi_id'] = $mainData['id'];
                $gateSource['static']['fulldate'] = $mainData['fulldate'];
                $gateSource['static']['dtime'] = $mainData['dtime'];

                foreach ($targetMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTarget['static']['transaksi_id'] = $mainData['id'];
                $gateTarget['static']['fulldate'] = $mainData['fulldate'];
                $gateTarget['static']['dtime'] = $mainData['dtime'];
                //------------------------------------
                $gateSourceDetail = array();
                $gateTargetDetail = array();
                foreach ($items as $ii => $iiSpec) {
                    foreach ($sourceDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($sourceDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                    foreach ($targetDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($targetDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                }
                //------------------------------------

                //region MASTER
                $rt = New ComRekeningTransaksi();
                $rt->pair($gateSource);
                $rt->exec();

                $rt = New ComRekeningTransaksi();
                $rt->pair($gateTarget);
                $rt->exec();
                //endregion

                //region DETAIL
                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateSourceDetail);
                $rt->exec();

                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateTargetDetail);
                $rt->exec();
                //endregion


                $tr = new MdlTransaksi();
                $updateData = array(
                    "non_akunting" => "1",
                );
                $updateWhere = array(
                    "id" => $trID
                );
                $tr->updateData($updateWhere, $updateData);
                showLast_query("orange");

            }


            //        mati_disini(" OHOOOO belon comit @" . __LINE__);

            $this->db->trans_complete();
            cekHijau("<h2>-- DONE FOR IT--</h2>");

            /* --------------------------------------------------------------------
             * logic perlu reload lagi atau nutup
             * -------------------------------------------------------------------*/
            if ($jml_data == 1) {
                echo "<script>
                    window.close();
                    window.onunload = refreshParent;
                </script>";
            }
            else {
                // header("refresh:3");
                echo "<meta http-equiv='refresh' content='3'>";
                cekKuning("jml data baru $jml_data");
                echo "<b>sikronisasi data</b> windows ini akan menutup sendiri saat sikronisasi data selesai";

                echo "<script>
                        $('html, body').animate({ scrollTop: $(document).height() }, 1000);
                        // window.onbeforeunload = function(e) {
                        //     return 'Please press the Logout button to logout.';
                        // };
                </script>";
            }

        }
        else {
            cekKuning("tidak ada data baru");
            echo "<script>
                window.close();
                // window.onunload = refreshParent;
            </script>";
        }


    }

    public function generateNonAkuntingAllBatal()
    {
        // header("refresh:6");
        echo "<script>
            function refreshParent() {
                window.opener.location.reload();
                // window.opener.$('#sum_satu').load();
            }
        </script>";

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "9912";
        $divID = "18";
        $arrJenis = array("582spd");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("reference_jenis in ('" . implode("','", $arrJenis) . "')");
        //        $tr->addFilter("id_master=131884");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));

        /* ----------------------------------------------------------------------------------------
         * cek Jumlah data keseluruhan yg perlu dieksekusi
         * ----------------------------------------------------------------------------------------*/
        $this->db->select("count(id) as 'jml_data'");
        $cekAll = $tr->lookupAll()->row();
        // showLast_query("kuning");
        $jml_data = $cekAll->jml_data;

        if ($jml_data > 0) {
            /* ----------------------------------------------------------------------------------------
             * eksekutor data berjalan 1 per satu
             * ----------------------------------------------------------------------------------------*/
            $this->db->limit(1);
            $tmpHist = $tr->lookupAll()->result();
            showLast_query("biru");
            cekHitam(sizeof($tmpHist));
            //        arrPrintPink($tmpHist);
            //        mati_disini();

            $this->db->trans_start();

            $trDatas = array();
            if (sizeof($tmpHist) > 0) {

                foreach ($tmpHist[0] as $key => $val) {
                    $trDatas[$key] = $val;
                }
                cekHitam(":: " . $tmpHist[0]->id);
                $trID = $tmpHist[0]->id;
                $masterID = $tmpHist[0]->id_master;
                $masterJenis = $tmpHist[0]->jenis_master;
                $jenisTransaksi = $tmpHist[0]->jenis;
                $counters = $tmpHist[0]->counters;
                //----------------------------
                $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
                $ids_his_data = array();
                if (sizeof($ids_his) > 0) {
                    foreach ($ids_his as $step => $hisSpec) {
                        $aa = "_step_" . $step . "_nomer";
                        $bb = "_step_" . $step . "_olehID";
                        $cc = "_step_" . $step . "_olehName";
                        $trDatas[$aa] = $hisSpec['nomer'];
                        $trDatas[$bb] = $hisSpec['olehID'];
                        $trDatas[$cc] = $hisSpec['olehName'];
                    }
                }
                $cContent = blobDecode($tmpHist[0]->counters);
                $arrIndexVal = array();
                foreach ($cContent as $counterKey => $counterData) {
                    $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                    foreach ($counterData as $key => $index_conter) {
                        $trDatas[$counterIndexKey] = $index_conter;
                    }
                }
                //----------------------------

                // registry main dan items
                $tr = new MdlTransaksi();
                $tr->setFilters(array());
                $tr->setJointSelectFields("transaksi_id, main, items");
                $tr->addFilter("transaksi_id='$trID'");
                $trReg = $tr->lookupDataRegistries()->result();
//                showLast_query("kuning");
                $trRegResult = array();
                foreach ($trReg as $regSpec) {
                    $trRegResult[$regSpec->transaksi_id] = array(
                        "main" => blobDecode($regSpec->main),
                        "items" => blobDecode($regSpec->items),
                    );
                }
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['main'] as $mkey => $mval) {
                        $trDatas["m_" . $mkey] = $mval;
                    }
                }
//arrPrintHijau($trDatas);
                //----------------------------
                $referenceMasterID_top = $trDatas["reference_id_top"];
                $tr = new MdlTransaksi();
                $tr->addFilter("id='$referenceMasterID_top'");
                $trTmp = $tr->lookupAll()->result();
                showLast_query("kuning");
                $arrMasterData = array();
                if (sizeof($trTmp) > 0) {
                    $arrMasterData = array(
                        "m_sellerID" => $trTmp[0]->oleh_id,
                        "m_sellerName" => $trTmp[0]->oleh_nama,
                    );
                }
                //----------------------------
                if (sizeof($arrMasterData) > 0) {
                    foreach ($arrMasterData as $mkey => $vkey) {
                        $trDatas[$mkey] = $vkey;
                    }
                }
                cekHitam("masterID: $masterID");
//arrPrint($arrMasterData);
                arrPrintHijau($trDatas);
//mati_disini(__LINE__);

                $addItems = array(
                    "id_master" => "id_master",
                    "_stepCode_placeID" => "_stepCode_placeID",
                    "_stepCode_olehID" => "_stepCode_olehID",
                    "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                    "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                    "_stepCode_customerID" => "_stepCode_customerID",
                    "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                    "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                    "_stepCode" => "_stepCode",
                    "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                    "_stepCode_supplierID" => "_stepCode_supplierID",
                    "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                    "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                    "_step_1_nomer" => "_step_1_nomer",
                    "_step_1_olehName" => "_step_1_olehName",
                    "_step_2_nomer" => "_step_2_nomer",
                    "_step_2_olehName" => "_step_2_olehName",
                    "_step_3_nomer" => "_step_3_nomer",
                    "_step_3_olehName" => "_step_3_olehName",
                    "_step_4_nomer" => "_step_4_nomer",
                    "_step_4_olehName" => "_step_4_olehName",
                    "_step_5_nomer" => "_step_5_nomer",
                    "_step_5_olehName" => "_step_5_olehName",
                    "sellerID" => "m_sellerID",
                    "sellerName" => "m_sellerName",
                );
                $items = array();
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['items'] as $mkey => $mSpec) {
                        $items[$mkey] = $mSpec;
                        foreach ($addItems as $akey => $aval) {
                            $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                        }
                    }
                }
                arrPrintPink($items);
//mati_disini();
                switch ($jenisTransaksi) {
                    case "9912":
                        $sourceMain = array(
                            "loop" => array(
                                "9912r" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "reference_id_top",//master_id, id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "9912" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "reference_id_top",//master_id, id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "9912r" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "reference_id_top",//id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "9912" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "reference_id_top",//id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        //-----
                        $targetMain_rev = array(
                            "loop" => array(
                                "9912" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "reference_id_top",//master_id, id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceMain_rev = array(
                            "loop" => array(
                                "9912r" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "reference_id_top",//master_id, id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetDetail_rev = array(
                            "loop" => array(
                                "9912" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "reference_id_top",//id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".batal",
                            ),
                        );
                        $sourceDetail_rev = array(
                            "loop" => array(
                                "9912r" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "reference_id_top",//id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".batal",
                            ),
                        );
                        break;
                    default:

                        mati_disini(":: $jenisTransaksi ::");

                        break;
                }
                //------------------------------------
                //            arrPrint($trDatas);
                //            arrPrint($items);
                //            arrPrint($trDatas);
                //            arrPrintHijau($items);
                //            mati_disini("=====");

                $mainData = $trDatas;
                $gateSource = array();
                $gateSource_rev = array();
                $gateTarget = array();
                $gateTarget_rev = array();
                $gateMainToItems = array(
                    "reference_jenis",
                    "reference_id",
                    "reference_nomer",
                    "reference_id_top",
                    "reference_nomer_top",
                    "reference_jenis_top",
                );
                cekHere($mainData['reference_id_top']);
                foreach ($sourceMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSource['static']['transaksi_id'] = $mainData['id'];
                $gateSource['static']['fulldate'] = $mainData['fulldate'];
                $gateSource['static']['dtime'] = $mainData['dtime'];

                foreach ($targetMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTarget['static']['transaksi_id'] = $mainData['id'];
                $gateTarget['static']['fulldate'] = $mainData['fulldate'];
                $gateTarget['static']['dtime'] = $mainData['dtime'];
                //------------------------------------
                foreach ($sourceMain_rev['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource_rev['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource_rev['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceMain_rev['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource_rev['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSource_rev['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateSource_rev['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSource_rev['static']['transaksi_id'] = $mainData['id'];
                $gateSource_rev['static']['fulldate'] = $mainData['fulldate'];
                $gateSource_rev['static']['dtime'] = $mainData['dtime'];

                foreach ($targetMain_rev['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget_rev['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget_rev['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetMain_rev['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget_rev['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTarget_rev['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateTarget_rev['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTarget_rev['static']['transaksi_id'] = $mainData['id'];
                $gateTarget_rev['static']['fulldate'] = $mainData['fulldate'];
                $gateTarget_rev['static']['dtime'] = $mainData['dtime'];
                //------------------------------------
                $gateSourceDetail = array();
                $gateTargetDetail = array();
                $gateSourceDetail_rev = array();
                $gateTargetDetail_rev = array();
                foreach ($items as $ii => $iiSpec) {
                    //---
                    foreach ($gateMainToItems as $gmti) {
                        $iiSpec[$gmti] = isset($mainData[$gmti]) ? $mainData[$gmti] : "";
                    }
                    //---
                    foreach ($sourceDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($sourceDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                    //---
                    foreach ($targetDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($targetDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                    //---
                    foreach ($sourceDetail_rev['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail_rev[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail_rev[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($sourceDetail_rev['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail_rev[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateSourceDetail_rev[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateSourceDetail_rev[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateSourceDetail_rev[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateSourceDetail_rev[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateSourceDetail_rev[$ii]['static']['dtime'] = $mainData['dtime'];
                    //---
                    foreach ($targetDetail_rev['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail_rev[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail_rev[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($targetDetail_rev['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail_rev[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateTargetDetail_rev[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateTargetDetail_rev[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateTargetDetail_rev[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateTargetDetail_rev[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateTargetDetail_rev[$ii]['static']['dtime'] = $mainData['dtime'];
                    //---
                }
                //------------------------------------


                //region MASTER
                $rt = New ComRekeningTransaksi();
                $rt->pair($gateSource);
                $rt->exec();

                $rt = New ComRekeningTransaksi();
                $rt->pair($gateTarget);
                $rt->exec();

                $rt = New ComRekeningTransaksi();
                $rt->pair($gateSource_rev);
                $rt->exec();

                $rt = New ComRekeningTransaksi();
                $rt->pair($gateTarget_rev);
                $rt->exec();
                //endregion

                //region DETAIL
                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateSourceDetail);
                $rt->exec();

                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateTargetDetail);
                $rt->exec();

                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateSourceDetail_rev);
                $rt->exec();

                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateTargetDetail_rev);
                $rt->exec();
                //endregion
                //            mati_disini("=====");

                $tr = new MdlTransaksi();
                $updateData = array(
                    "non_akunting" => "1",
                );
                $updateWhere = array(
                    "id" => $trID
                );
                $tr->updateData($updateWhere, $updateData);
                showLast_query("orange");

            }

//            mati_disini(" OHOOOO belon comit @" . __LINE__);

            $this->db->trans_complete();
            cekHijau("<h2>-- DONE --</h2>");

            /* --------------------------------------------------------------------
             * logic perlu reload lagi atau nutup
             * -------------------------------------------------------------------*/
            if ($jml_data == 1) {
                echo "<script>
                    window.close();
                    window.onunload = refreshParent;
                </script>";
            }
            else {
                cekKuning("jml data baru $jml_data");
                echo "<b>sikronisasi data</b> windows ini akan menutup sendiri saat sikronisasi data selesai";
                echo "<meta http-equiv='refresh' content='3'>";

                echo "<script>
                        // window.onbeforeunload = function(e) {
                        //     return 'Please press the Logout button to logout.';
                        // };
                </script>";
            }
        }
        else {
            cekKuning("tidak ada data baru");
            echo "<script>
                window.close();
                // window.onunload = refreshParent;
            </script>";
        }

    }

    public function generateNonAkuntingAllSalesExport()
    {
        // header("refresh:6");
        echo "<script>
            function refreshParent() {
                window.opener.location.reload();
                // window.opener.$('#sum_satu').load();
            }
        </script>";

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "382";
        $divID = "18";
        $arrJenis = array("382spo", "382so", "382pkd", "382spd");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        //        $tr->addFilter("id_master=131884");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));

        /* ----------------------------------------------------------------------------------------
         * cek Jumlah data keseluruhan yg perlu dieksekusi
         * ----------------------------------------------------------------------------------------*/
        $this->db->select("count(id) as 'jml_data'");
        $cekAll = $tr->lookupAll()->row();
        // showLast_query("kuning");
        $jml_data = $cekAll->jml_data;

        if ($jml_data > 0) {
            /* ----------------------------------------------------------------------------------------
             * eksekutor data berjalan 1 per satu
             * ----------------------------------------------------------------------------------------*/
            $this->db->limit(1);
            $tmpHist = $tr->lookupAll()->result();
            showLast_query("biru");
            cekHitam(sizeof($tmpHist));
            //        arrPrintPink($tmpHist);
            //mati_disini();


            $this->db->trans_start();


            $trDatas = array();
            if (sizeof($tmpHist) > 0) {

                foreach ($tmpHist[0] as $key => $val) {
                    $trDatas[$key] = $val;
                }
                cekHitam(":: " . $tmpHist[0]->id);
                $trID = $tmpHist[0]->id;
                $masterID = $tmpHist[0]->id_master;
                $masterJenis = $tmpHist[0]->jenis_master;
                $jenisTransaksi = $tmpHist[0]->jenis;
                $counters = $tmpHist[0]->counters;
                //----------------------------
                $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
                $ids_his_data = array();
                if (sizeof($ids_his) > 0) {
                    foreach ($ids_his as $step => $hisSpec) {
                        $aa = "_step_" . $step . "_nomer";
                        $bb = "_step_" . $step . "_olehID";
                        $cc = "_step_" . $step . "_olehName";
                        $trDatas[$aa] = $hisSpec['nomer'];
                        $trDatas[$bb] = $hisSpec['olehID'];
                        $trDatas[$cc] = $hisSpec['olehName'];
                    }
                }
                $cContent = blobDecode($tmpHist[0]->counters);
                $arrIndexVal = array();
                foreach ($cContent as $counterKey => $counterData) {
                    $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                    foreach ($counterData as $key => $index_conter) {
                        //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                        $trDatas[$counterIndexKey] = $index_conter;
                    }
                }
                //----------------------------

                // registry main dan items
                $tr = new MdlTransaksi();
                $tr->setFilters(array());
                $tr->setJointSelectFields("transaksi_id, main, items");
                $tr->addFilter("transaksi_id='$trID'");
                $trReg = $tr->lookupDataRegistries()->result();
                showLast_query("kuning");
                $trRegResult = array();
                foreach ($trReg as $regSpec) {
                    $trRegResult[$regSpec->transaksi_id] = array(
                        "main" => blobDecode($regSpec->main),
                        "items" => blobDecode($regSpec->items),
                    );
                }
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['main'] as $mkey => $mval) {
                        $trDatas["m_" . $mkey] = $mval;
                    }
                }
                $addItems = array(
                    "id_master" => "id_master",
                    "_stepCode_placeID" => "_stepCode_placeID",
                    "_stepCode_olehID" => "_stepCode_olehID",
                    "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                    "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                    "_stepCode_customerID" => "_stepCode_customerID",
                    "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                    "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                    "_stepCode" => "_stepCode",
                    "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                    "_stepCode_supplierID" => "_stepCode_supplierID",
                    "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                    "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                    "_step_1_nomer" => "_step_1_nomer",
                    "_step_1_olehName" => "_step_1_olehName",
                    "_step_2_nomer" => "_step_2_nomer",
                    "_step_2_olehName" => "_step_2_olehName",
                    "_step_3_nomer" => "_step_3_nomer",
                    "_step_3_olehName" => "_step_3_olehName",
                    "_step_4_nomer" => "_step_4_nomer",
                    "_step_4_olehName" => "_step_4_olehName",
                    "_step_5_nomer" => "_step_5_nomer",
                    "_step_5_olehName" => "_step_5_olehName",
                );
                $items = array();
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['items'] as $mkey => $mSpec) {
                        $items[$mkey] = $mSpec;
                        foreach ($addItems as $akey => $aval) {
                            $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                        }
                    }
                }

                switch ($jenisTransaksi) {
                    case "382spo":
                        $sourceMain = array(
                            "loop" => array(
                                "382spo" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "transaksi_id" => "id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "382so" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "382spo" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "382so" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        break;
                    case "382so":
                        $sourceMain = array(
                            "loop" => array(
                                "382so" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "382pkd" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "382so" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "382pkd" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        break;
                    case "382pkd":
                        $sourceMain = array(
                            "loop" => array(
                                "382pkd" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "382spd" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "382pkd" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "382spd" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        break;
                    case "382spd":
                        $sourceMain = array(
                            "loop" => array(
                                "382spd" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "382spo" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "harga_nppn" => "m_nett2",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                //                            "oleh_id" => "m_olehID",
                                //                            "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "382spd" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "382spo" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "harga_nppn" => "nett2",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                //                            "oleh_id" => "olehID",
                                //                            "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                                "update_lap" => false,
                            ),
                        );
                        break;
                    default:

                        mati_disini(":: $jenisTransaksi ::");

                        break;
                }
                //------------------------------------
                //            arrPrint($trDatas);
                //            arrPrint($items);

                $mainData = $trDatas;
                $gateSource = array();
                $gateTarget = array();
                foreach ($sourceMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSource['static']['transaksi_id'] = $mainData['id'];
                $gateSource['static']['fulldate'] = $mainData['fulldate'];
                $gateSource['static']['dtime'] = $mainData['dtime'];

                foreach ($targetMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTarget['static']['transaksi_id'] = $mainData['id'];
                $gateTarget['static']['fulldate'] = $mainData['fulldate'];
                $gateTarget['static']['dtime'] = $mainData['dtime'];
                //------------------------------------
                $gateSourceDetail = array();
                $gateTargetDetail = array();
                foreach ($items as $ii => $iiSpec) {
                    foreach ($sourceDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($sourceDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                    foreach ($targetDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($targetDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                }
                //------------------------------------

                //region MASTER
                $rt = New ComRekeningTransaksi();
                $rt->pair($gateSource);
                $rt->exec();

                $rt = New ComRekeningTransaksi();
                $rt->pair($gateTarget);
                $rt->exec();
                //endregion

                //region DETAIL
                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateSourceDetail);
                $rt->exec();

                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateTargetDetail);
                $rt->exec();
                //endregion


                $tr = new MdlTransaksi();
                $updateData = array(
                    "non_akunting" => "1",
                );
                $updateWhere = array(
                    "id" => $trID
                );
                $tr->updateData($updateWhere, $updateData);
                showLast_query("orange");

            }

            //        mati_disini(" OHOOOO belom comit @" . __LINE__);

            $this->db->trans_complete();
            cekHijau("<h2>-- DONE --</h2>");

            /* --------------------------------------------------------------------
             * logic perlu reload lagi atau nutup
             * -------------------------------------------------------------------*/
            if ($jml_data == 1) {
                echo "<script>
                    window.close();
                    window.onunload = refreshParent;
                </script>";
            }
            else {
                cekKuning("jml data baru $jml_data");
                echo "<b>sikronisasi data</b> windows ini akan menutup sendiri saat sikronisasi data selesai";
                echo "<meta http-equiv='refresh' content='3'>";

                echo "<script>
                        // window.onbeforeunload = function(e) {
                        //     return 'Please press the Logout button to logout.';
                        // };
                </script>";
            }
        }
        else {
            cekKuning("tidak ada data baru");
            echo "<script>
                window.close();
                // window.onunload = refreshParent;
            </script>";
        }

    }

    // running
    public function generateNonAkuntingAllReturnSales()
    {
        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "982";
        $divID = "18";
        $arrJenis = array("982r", "982g", "982");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
        //        arrPrintPink($tmpHist);
        //mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
                    //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------


            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }

            //transaksi yang direturn-------
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id='" . $trDatas['m_referenceID'] . "'");
            $trRtnTmp = $tr->lookupAll()->result();
            if (sizeof($trRtnTmp) > 0) {
                foreach ($trRtnTmp[0] as $rtn_key => $rtn_val) {
                    $trDatas["rtn_" . $rtn_key] = $rtn_val;
                }
            }
            //-------

            $addMain = array(
                "seller_id" => "rtn_seller_id",
                "seller_nama" => "rtn_seller_nama",
                "sellerID" => "rtn_seller_id",
                "sellerName" => "rtn_seller_nama",
            );
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "rtn_id_master" => "rtn_id_master",
                "seller_id" => "rtn_seller_id",
                "seller_nama" => "rtn_seller_nama",
                "sellerID" => "rtn_seller_id",
                "sellerName" => "rtn_seller_nama",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            foreach ($addMain as $akey => $aval) {
                $trDatas[$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
            }

            //arrPrintWebs($trDatas);
            //mati_disini(__LINE__);

            switch ($jenisTransaksi) {
                //                case "582spo":
                //                    $sourceMain = array(
                //                        "loop" => array(
                //                            "582spo" => "m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "transaksi_id" => "id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $targetMain = array(
                //                        "loop" => array(
                //                            "582so" => "-m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_olehName" => "_step_2_nomer",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $sourceDetail = array(
                //                        "loop" => array(
                //                            "582spo" => "sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    $targetDetail = array(
                //                        "loop" => array(
                //                            "582so" => "-sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "-qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    break;
                //                case "582so":
                //                    $sourceMain = array(
                //                        "loop" => array(
                //                            "582so" => "m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $targetMain = array(
                //                        "loop" => array(
                //                            "582pkd" => "-m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $sourceDetail = array(
                //                        "loop" => array(
                //                            "582so" => "sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    $targetDetail = array(
                //                        "loop" => array(
                //                            "582pkd" => "-sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "-qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    break;
                //                case "582pkd":
                //                    $sourceMain = array(
                //                        "loop" => array(
                //                            "582pkd" => "m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $targetMain = array(
                //                        "loop" => array(
                //                            "582spd" => "-m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $sourceDetail = array(
                //                        "loop" => array(
                //                            "582pkd" => "sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    $targetDetail = array(
                //                        "loop" => array(
                //                            "582spd" => "-sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "-qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    break;
                //                case "582spd":
                //                    $sourceMain = array(
                //                        "loop" => array(
                //                            "582spd" => "m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $targetMain = array(
                //                        "loop" => array(
                //                            "582spo" => "-m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $sourceDetail = array(
                //                        "loop" => array(
                //                            "582pkd" => "sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    $targetDetail = array(
                //                        "loop" => array(
                //                            "582spd" => "-sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "-qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    break;

                case "982r":
                    $sourceMain = array(
                        "loop" => array(
                            "982r" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "982g" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "982r" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "982g" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "982g":
                    $sourceMain = array(
                        "loop" => array(
                            "982g" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "982" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "982g" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "982" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "982":
                    $sourceMain = array(
                        "loop" => array(
                            "982" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "982r" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                            "update_lap" => false,
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "982" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "982r" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "update_lap" => false,
                        ),
                    );
                    break;

                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------
            //arrPrint($gateTargetDetail);
            //mati_disini(":: SETOP ::");

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


        //        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    // running
    public function generateNonAkuntingAllClosed()
    {
        // header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "1982";
        $divID = "18";
        $arrJenis = array("1982", "1982g");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
        //arrPrint($tmpHist);


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
                    //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------


            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }


            //transaksi yang direturn-------
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id='" . $trDatas['m_masterID'] . "'");
            $trRtnTmp = $tr->lookupAll()->result();
            if (sizeof($trRtnTmp) > 0) {
                foreach ($trRtnTmp[0] as $rtn_key => $rtn_val) {
                    $trDatas["cls_" . $rtn_key] = $rtn_val;
                }
            }
            //-------
            // arrPrintWebs($trDatas);
            // mati_disini(__LINE__);

            $addMain = array(
                "seller_id" => "cls_seller_id",
                "seller_nama" => "cls_seller_nama",
                "sellerID" => "cls_seller_id",
                "sellerName" => "cls_seller_nama",
            );
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "rtn_id_master" => "rtn_id_master",
                "seller_id" => "cls_seller_id",
                "seller_nama" => "cls_seller_nama",
                "sellerID" => "cls_seller_id",
                "sellerName" => "cls_seller_nama",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            foreach ($addMain as $akey => $aval) {
                $trDatas[$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
            }

            //arrPrintWebs($trDatas);
            //             mati_disini(__LINE__);

            switch ($jenisTransaksi) {
                //                case "582spo":
                //                    $sourceMain = array(
                //                        "loop" => array(
                //                            "582spo" => "m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "transaksi_id" => "id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $targetMain = array(
                //                        "loop" => array(
                //                            "582so" => "-m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_olehName" => "_step_2_nomer",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $sourceDetail = array(
                //                        "loop" => array(
                //                            "582spo" => "sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    $targetDetail = array(
                //                        "loop" => array(
                //                            "582so" => "-sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "-qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    break;
                //                case "582so":
                //                    $sourceMain = array(
                //                        "loop" => array(
                //                            "582so" => "m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $targetMain = array(
                //                        "loop" => array(
                //                            "582pkd" => "-m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $sourceDetail = array(
                //                        "loop" => array(
                //                            "582so" => "sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    $targetDetail = array(
                //                        "loop" => array(
                //                            "582pkd" => "-sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "-qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    break;
                //                case "582pkd":
                //                    $sourceMain = array(
                //                        "loop" => array(
                //                            "582pkd" => "m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $targetMain = array(
                //                        "loop" => array(
                //                            "582spd" => "-m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $sourceDetail = array(
                //                        "loop" => array(
                //                            "582pkd" => "sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    $targetDetail = array(
                //                        "loop" => array(
                //                            "582spd" => "-sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "-qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    break;
                //                case "582spd":
                //                    $sourceMain = array(
                //                        "loop" => array(
                //                            "582spd" => "m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $targetMain = array(
                //                        "loop" => array(
                //                            "582spo" => "-m_nett1",
                //                        ),
                //                        "static" => array(
                //                            "cabang_id" => "m_placeID",
                //                            "cabang_nama" => "m_placeName",
                //                            "gudang_id" => "m_gudangID",
                //                            "gudang_nama" => "m_gudangName",
                //                            "rekening_nama" => "m_sourceJenisLabel",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "m_harga",
                //                            "harga_bruto" => "m_harga",
                //                            "ppn_nilai" => "m_ppn",
                //                            "harga_netto" => "m_nett1",
                //                            "diskon_nilai" => "m_disc",
                //                            "premi_nilai" => "m_premi",
                //                            "ongkir_nilai" => "m_shipping_service",
                //                            "extern_id" => "id_master",
                //                            "extern_nama" => "nomer",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "m_olehID",
                //                            "oleh_nama" => "m_olehName",
                //                            "seller_id" => "m_sellerID",
                //                            "seller_nama" => "m_sellerName",
                //                            "customer_id" => "m_pihakID",
                //                            "customer_nama" => "m_pihakName",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            "jenis" => "jenis",
                //                            "step_current" => "step_number",
                //                            "step_number" => "step_current",
                //                            "next_step_num" => "next_step_num",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                            "rel_target_jenis" => ".0",
                //                        ),
                //                    );
                //                    $sourceDetail = array(
                //                        "loop" => array(
                //                            "582pkd" => "sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    $targetDetail = array(
                //                        "loop" => array(
                //                            "582spd" => "-sub_nett1",
                //                        ),
                //                        "static" => array(
                //                            "rekening_nama" => "sourceJenisLabel",
                //                            "cabang_id" => "placeID",
                //                            "gudang_id" => "gudangID",
                //                            "gudang_nama" => "gudangName",
                //                            "cabang_nama" => "placeName",
                //                            "produk_qty" => "-qty",
                //                            "produk_nilai" => "harga",
                //                            "harga_bruto" => "harga",
                //                            "ppn_nilai" => "ppn",
                //                            "harga_netto" => "nett1",
                //                            "diskon_nilai" => "disc",
                //                            "premi_nilai" => "premi",
                //                            "extern_id" => "id",
                //                            "extern_nama" => "name",
                //                            "extern2_id" => "id_master",
                //                            "extern2_nama" => ".0",
                //                            "produk_kode" => "code",
                //                            "produk_part" => "no_part",
                //                            "produk_label" => "label",
                //                            "produk_jenis" => "jenis",
                //                            "produk_satuan" => "satuan",
                //                            "satuan" => "satuan",
                //                            "oleh_id" => "olehID",
                //                            "oleh_nama" => "olehName",
                //                            "seller_id" => "sellerID",
                //                            "seller_nama" => "sellerName",
                //                            "customer_id" => "pihakID",
                //                            "customer_nama" => "pihakName",
                ////                            "transaksi_id" => "transaksi_id",
                //                            "master_id" => "id_master",
                //                            "master_jenis" => "jenis_master",
                //                            //------
                //                            "_stepCode_placeID" => "_stepCode_placeID",
                //                            "_stepCode_olehID" => "_stepCode_olehID",
                //                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                //                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                //                            "_stepCode_customerID" => "_stepCode_customerID",
                //                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                //                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                //                            "_stepCode" => "_stepCode",
                //                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                //                            "_stepCode_supplierID" => "_stepCode_supplierID",
                //                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                //                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                //                            //------
                ////                "dtime_order" => "dtime",
                ////                "dtime_kirim" => "shippingDate",
                ////                "dtime_terima" => "",
                //                            "_step_1_nomer" => "_step_1_nomer",
                //                            "_step_1_olehName" => "_step_1_olehName",
                //                            "_step_2_nomer" => "_step_2_nomer",
                //                            "_step_2_olehName" => "_step_2_olehName",
                //                            "_step_3_nomer" => "_step_3_nomer",
                //                            "_step_3_olehName" => "_step_3_olehName",
                //                            "_step_4_nomer" => "_step_4_nomer",
                //                            "_step_4_olehName" => "_step_4_olehName",
                //                            "_step_5_nomer" => "_step_5_nomer",
                //                            "_step_5_olehName" => "_step_5_olehName",
                //                        ),
                //                    );
                //                    break;

                case "982r":
                    $sourceMain = array(
                        "loop" => array(
                            "982r" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "982g" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "982r" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "982g" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "982g":
                    $sourceMain = array(
                        "loop" => array(
                            "982g" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "982" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "982g" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "982" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "982":
                    $sourceMain = array(
                        "loop" => array(
                            "982" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "982r" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                            "update_lap" => false,
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "982" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "982r" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "update_lap" => false,
                        ),
                    );
                    break;

                default:

                    mati_disini(":: $jenisTransaksi :: @" . __LINE__);

                    break;
            }
            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------
            //arrPrint($gateTargetDetail);
            //mati_disini(":: SETOP ::");

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    // running
    public function generateNonAkuntingAllSalesReject()
    {
        // header("refresh:7");
        echo "<script>
            function refreshParent() {
                window.opener.location.reload();
                // window.opener.$('#sum_satu').load();
            }
        </script>";

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "582";
        $divID = "18";
        $arrJenis = array("582spo", "582so", "582pkd");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting_reject=0");
        $tr->addFilter("trash_4=1");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));

        /* ----------------------------------------------------------------------------------------
         * cek Jumlah data keseluruhan yg perlu dieksekusi
         * ----------------------------------------------------------------------------------------*/
        $this->db->select("count(id) as 'jml_data'");
        $cekAll = $tr->lookupAll()->row();
        // showLast_query("kuning");
        $jml_data = $cekAll->jml_data;

        if ($jml_data > 0) {
            /* ----------------------------------------------------------------------------------------
             * eksekutor data berjalan 1 per satu
             * ----------------------------------------------------------------------------------------*/
            $this->db->limit(1);
            $tmpHist = $tr->lookupAll()->result();
            showLast_query("biru");
            cekHitam(sizeof($tmpHist));
            //        arrPrintPink($tmpHist);
            //mati_disini();


            $this->db->trans_start();


            $trDatas = array();
            if (sizeof($tmpHist) > 0) {

                foreach ($tmpHist[0] as $key => $val) {
                    $trDatas[$key] = $val;
                }
                cekHitam(":: " . $tmpHist[0]->id);
                $trID = $tmpHist[0]->id;
                $masterID = $tmpHist[0]->id_master;
                $masterJenis = $tmpHist[0]->jenis_master;
                $jenisTransaksi = $tmpHist[0]->jenis;
                $counters = $tmpHist[0]->counters;
                //----------------------------
                $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
                $ids_his_data = array();
                if (sizeof($ids_his) > 0) {
                    foreach ($ids_his as $step => $hisSpec) {
                        $aa = "_step_" . $step . "_nomer";
                        $bb = "_step_" . $step . "_olehID";
                        $cc = "_step_" . $step . "_olehName";
                        $trDatas[$aa] = $hisSpec['nomer'];
                        $trDatas[$bb] = $hisSpec['olehID'];
                        $trDatas[$cc] = $hisSpec['olehName'];
                    }
                }
                $cContent = blobDecode($tmpHist[0]->counters);
                $arrIndexVal = array();
                foreach ($cContent as $counterKey => $counterData) {
                    $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                    foreach ($counterData as $key => $index_conter) {
                        //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                        $trDatas[$counterIndexKey] = $index_conter;
                    }
                }
                //----------------------------

                // registry main dan items
                $tr = new MdlTransaksi();
                $tr->setFilters(array());
                $tr->setJointSelectFields("transaksi_id, main, items");
                $tr->addFilter("transaksi_id='$trID'");
                $trReg = $tr->lookupDataRegistries()->result();
                showLast_query("kuning");
                $trRegResult = array();
                foreach ($trReg as $regSpec) {
                    $trRegResult[$regSpec->transaksi_id] = array(
                        "main" => blobDecode($regSpec->main),
                        "items" => blobDecode($regSpec->items),
                    );
                }
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['main'] as $mkey => $mval) {
                        $trDatas["m_" . $mkey] = $mval;
                    }
                }

                //----------------------------
                $pakai_ini = 0;
                if ($pakai_ini == 1) {
                    $tr = new MdlTransaksi();
                    $tr->addFilter("id='$masterID'");
                    $trTmp = $tr->lookupAll()->result();
                    showLast_query("kuning");
                    $arrMasterData = array();
                    if (sizeof($trTmp) > 0) {
                        $arrMasterData = array(
                            "m_sellerID" => $trTmp[0]->oleh_id,
                            "m_sellerName" => $trTmp[0]->oleh_nama,
                        );
                    }

                    if (sizeof($arrMasterData) > 0) {
                        foreach ($arrMasterData as $mkey => $vkey) {
                            $trDatas[$mkey] = $vkey;
                        }
                    }
                }
                //----------------------------

                $addItems = array(
                    "id_master" => "id_master",
                    "_stepCode_placeID" => "_stepCode_placeID",
                    "_stepCode_olehID" => "_stepCode_olehID",
                    "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                    "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                    "_stepCode_customerID" => "_stepCode_customerID",
                    "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                    "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                    "_stepCode" => "_stepCode",
                    "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                    "_stepCode_supplierID" => "_stepCode_supplierID",
                    "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                    "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                    "_step_1_nomer" => "_step_1_nomer",
                    "_step_1_olehName" => "_step_1_olehName",
                    "_step_2_nomer" => "_step_2_nomer",
                    "_step_2_olehName" => "_step_2_olehName",
                    "_step_3_nomer" => "_step_3_nomer",
                    "_step_3_olehName" => "_step_3_olehName",
                    "_step_4_nomer" => "_step_4_nomer",
                    "_step_4_olehName" => "_step_4_olehName",
                    "_step_5_nomer" => "_step_5_nomer",
                    "_step_5_olehName" => "_step_5_olehName",
                    "cancel_dtime" => "cancel_dtime",
                    "cancel_name" => "cancel_name",
                    "cancel_id" => "cancel_id",
                    "sellerID" => "m_sellerID",
                    "sellerName" => "m_sellerName",
                );
                $items = array();
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['items'] as $mkey => $mSpec) {
                        $items[$mkey] = $mSpec;
                        foreach ($addItems as $akey => $aval) {
                            $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                        }
                    }
                }

                switch ($jenisTransaksi) {
                    case "582spo":
                        $sourceMain = array(
                            "loop" => array(
                                "582so" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "transaksi_id" => "id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".1",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "582spo" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".1",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "582so" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".1",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "582spo" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".1",
                            ),
                        );
                        break;
                    case "582so":
                        $sourceMain = array(
                            "loop" => array(
                                "582pkd" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".2",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "582so" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".2",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "582pkd" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",

                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".2",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "582so" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".2",
                            ),
                        );
                        break;
                    case "582pkd":
                        $sourceMain = array(
                            "loop" => array(
                                "582spd" => "m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".3",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "582pkd" => "-m_nett1",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett1",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".3",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "582spd" => "sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".3",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "582pkd" => "-sub_nett1",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett1",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "id_master",
                                "master_jenis" => "jenis_master",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".rejected",
                                "step_reject" => ".3",
                            ),
                        );
                        break;

                    default:

                        mati_disini(":: $jenisTransaksi ::");

                        break;
                }
                //------------------------------------
//                arrPrint($trDatas);
//                arrPrint($items);

                $mainData = $trDatas;
                $gateSource = array();
                $gateTarget = array();
                foreach ($sourceMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSource['static']['transaksi_id'] = $mainData['id'];
                $gateSource['static']['fulldate'] = $mainData['fulldate'];
                $gateSource['static']['dtime'] = $mainData['dtime'];
                $gateSource['static']['dtime_reject'] = $mainData['cancel_dtime'];
                $gateSource['static']['oleh_id_reject'] = $mainData['cancel_name'];
                $gateSource['static']['oleh_nama_reject'] = $mainData['cancel_id'];

                foreach ($targetMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTarget['static']['transaksi_id'] = $mainData['id'];
                $gateTarget['static']['fulldate'] = $mainData['fulldate'];
                $gateTarget['static']['dtime'] = $mainData['dtime'];
                $gateSource['static']['dtime_reject'] = $mainData['cancel_dtime'];
                $gateSource['static']['oleh_id_reject'] = $mainData['cancel_name'];
                $gateSource['static']['oleh_nama_reject'] = $mainData['cancel_id'];
                //------------------------------------
                $gateSourceDetail = array();
                $gateTargetDetail = array();
                foreach ($items as $ii => $iiSpec) {
                    foreach ($sourceDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($sourceDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                    $gateSourceDetail[$ii]['static']['dtime_reject'] = $mainData['cancel_dtime'];
                    $gateSourceDetail[$ii]['static']['oleh_id_reject'] = $mainData['cancel_name'];
                    $gateSourceDetail[$ii]['static']['oleh_nama_reject'] = $mainData['cancel_id'];

                    foreach ($targetDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($targetDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                    $gateTargetDetail[$ii]['static']['dtime_reject'] = $mainData['cancel_dtime'];
                    $gateTargetDetail[$ii]['static']['oleh_id_reject'] = $mainData['cancel_name'];
                    $gateTargetDetail[$ii]['static']['oleh_nama_reject'] = $mainData['cancel_id'];
                }
                //------------------------------------

                //region MASTER
                $rt = New ComRekeningTransaksi();
                $rt->pair($gateSource);
                $rt->exec();

                $rt = New ComRekeningTransaksi();
                $rt->pair($gateTarget);
                $rt->exec();
                //endregion

                //region DETAIL
                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateSourceDetail);
                $rt->exec();

                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateTargetDetail);
                $rt->exec();
                //endregion


                $tr = new MdlTransaksi();
                $updateData = array(
                    "non_akunting_reject" => "1",
                );
                $updateWhere = array(
                    "id" => $trID
                );
                $tr->updateData($updateWhere, $updateData);
                showLast_query("orange");

            }


            // mati_disini(" OHOOOO ");

            $this->db->trans_complete();
            cekHijau("<h2>-- DONE --</h2>");

            /* --------------------------------------------------------------------
              * logic perlu reload lagi atau nutup
              * -------------------------------------------------------------------*/
            if ($jml_data == 1) {
                echo "<script>
                    window.close();
                    window.onunload = refreshParent;
                </script>";
            }
            else {
                cekKuning("jml data baru $jml_data");
                echo "<b>sikronisasi data</b> windows ini akan menutup sendiri saat sikronisasi data selesai";
                echo "<meta http-equiv='refresh' content='3'>";

                echo "<script>
                        // window.onbeforeunload = function(e) {
                        //     return 'Please press the Logout button to logout.';
                        // };
                </script>";
            }

        }
        else {
            cekKuning("tidak ada data baru");
            echo "<script>
                window.close();
                // window.onunload = refreshParent;
            </script>";
        }
    }

    public function generateNonAkuntingAllSalesProject()
    {
//        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "588";
        $divID = "18";
        $arrJenis = array(
            "588spo",
//            "588so"
        );

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
//        $tr->addFilter("id_master=131884");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//        arrPrintPink($tmpHist);
//mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------

            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }

            switch ($jenisTransaksi) {
                case "588spo":
                    $sourceMain = array(
                        "loop" => array(
                            "588spo" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "588so" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "588spo" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "588so" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;

                case "588so":
                    $sourceMain = array(
                        "loop" => array(
                            "582so" => "m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "582spd" => "-m_nett1",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_nett1",
                            "harga_nppn" => "m_nett2",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "582so" => "sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "582spd" => "-sub_nett1",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "nett1",
                            "harga_nppn" => "nett2",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;

//                case "582pkd":
//                    $sourceMain = array(
//                        "loop" => array(
//                            "582pkd" => "m_nett1",
//                        ),
//                        "static" => array(
//                            "cabang_id" => "m_placeID",
//                            "cabang_nama" => "m_placeName",
//                            "gudang_id" => "m_gudangID",
//                            "gudang_nama" => "m_gudangName",
//                            "rekening_nama" => "m_sourceJenisLabel",
//                            "produk_qty" => "qty",
//                            "produk_nilai" => "m_harga",
//                            "harga_bruto" => "m_harga",
//                            "ppn_nilai" => "m_ppn",
//                            "harga_netto" => "m_nett1",
//                            "harga_nppn" => "m_nett2",
//                            "diskon_nilai" => "m_disc",
//                            "premi_nilai" => "m_premi",
//                            "ongkir_nilai" => "m_shipping_service",
//                            "extern_id" => "id_master",
//                            "extern_nama" => "nomer",
//                            "satuan" => "satuan",
//                            "oleh_id" => "m_olehID",
//                            "oleh_nama" => "m_olehName",
//                            "seller_id" => "m_sellerID",
//                            "seller_nama" => "m_sellerName",
//                            "customer_id" => "m_pihakID",
//                            "customer_nama" => "m_pihakName",
//                            "master_id" => "id_master",
//                            "master_jenis" => "jenis_master",
//                            "jenis" => "jenis",
//                            "step_current" => "step_number",
//                            "step_number" => "step_current",
//                            "next_step_num" => "next_step_num",
//                            //------
//                            "_stepCode_placeID" => "_stepCode_placeID",
//                            "_stepCode_olehID" => "_stepCode_olehID",
//                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
//                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
//                            "_stepCode_customerID" => "_stepCode_customerID",
//                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
//                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
//                            "_stepCode" => "_stepCode",
//                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
//                            "_stepCode_supplierID" => "_stepCode_supplierID",
//                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
//                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
//                            //------
//                            "_step_1_nomer" => "_step_1_nomer",
//                            "_step_1_olehName" => "_step_1_olehName",
//                            "_step_2_nomer" => "_step_2_nomer",
//                            "_step_2_olehName" => "_step_2_olehName",
//                            "_step_3_nomer" => "_step_3_nomer",
//                            "_step_3_olehName" => "_step_3_olehName",
//                            "_step_4_nomer" => "_step_4_nomer",
//                            "_step_4_olehName" => "_step_4_olehName",
//                            "_step_5_nomer" => "_step_5_nomer",
//                            "_step_5_olehName" => "_step_5_olehName",
//                            "rel_target_jenis" => ".0",
//                        ),
//                    );
//                    $targetMain = array(
//                        "loop" => array(
//                            "582spd" => "-m_nett1",
//                        ),
//                        "static" => array(
//                            "cabang_id" => "m_placeID",
//                            "cabang_nama" => "m_placeName",
//                            "gudang_id" => "m_gudangID",
//                            "gudang_nama" => "m_gudangName",
//                            "rekening_nama" => "m_sourceJenisLabel",
//                            "produk_qty" => "qty",
//                            "produk_nilai" => "m_harga",
//                            "harga_bruto" => "m_harga",
//                            "ppn_nilai" => "m_ppn",
//                            "harga_netto" => "m_nett1",
//                            "harga_nppn" => "m_nett2",
//                            "diskon_nilai" => "m_disc",
//                            "premi_nilai" => "m_premi",
//                            "ongkir_nilai" => "m_shipping_service",
//                            "extern_id" => "id_master",
//                            "extern_nama" => "nomer",
//                            "satuan" => "satuan",
//                            "oleh_id" => "m_olehID",
//                            "oleh_nama" => "m_olehName",
//                            "seller_id" => "m_sellerID",
//                            "seller_nama" => "m_sellerName",
//                            "customer_id" => "m_pihakID",
//                            "customer_nama" => "m_pihakName",
//                            "master_id" => "id_master",
//                            "master_jenis" => "jenis_master",
//                            "jenis" => "jenis",
//                            "step_current" => "step_number",
//                            "step_number" => "step_current",
//                            "next_step_num" => "next_step_num",
//                            //------
//                            "_stepCode_placeID" => "_stepCode_placeID",
//                            "_stepCode_olehID" => "_stepCode_olehID",
//                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
//                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
//                            "_stepCode_customerID" => "_stepCode_customerID",
//                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
//                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
//                            "_stepCode" => "_stepCode",
//                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
//                            "_stepCode_supplierID" => "_stepCode_supplierID",
//                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
//                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
//                            //------
//                            "_step_1_nomer" => "_step_1_nomer",
//                            "_step_1_olehName" => "_step_1_olehName",
//                            "_step_2_olehName" => "_step_2_olehName",
//                            "_step_2_nomer" => "_step_2_nomer",
//                            "_step_3_nomer" => "_step_3_nomer",
//                            "_step_3_olehName" => "_step_3_olehName",
//                            "_step_4_nomer" => "_step_4_nomer",
//                            "_step_4_olehName" => "_step_4_olehName",
//                            "_step_5_nomer" => "_step_5_nomer",
//                            "_step_5_olehName" => "_step_5_olehName",
//                            "rel_target_jenis" => ".0",
//                        ),
//                    );
//                    $sourceDetail = array(
//                        "loop" => array(
//                            "582pkd" => "sub_nett1",
//                        ),
//                        "static" => array(
//                            "rekening_nama" => "sourceJenisLabel",
//                            "cabang_id" => "placeID",
//                            "gudang_id" => "gudangID",
//                            "gudang_nama" => "gudangName",
//                            "cabang_nama" => "placeName",
//                            "produk_qty" => "qty",
//                            "produk_nilai" => "harga",
//                            "harga_bruto" => "harga",
//                            "ppn_nilai" => "ppn",
//                            "harga_netto" => "nett1",
//                            "harga_nppn" => "nett2",
//                            "diskon_nilai" => "disc",
//                            "premi_nilai" => "premi",
//                            "extern_id" => "id",
//                            "extern_nama" => "name",
//                            "extern2_id" => "id_master",
//                            "extern2_nama" => ".0",
//                            "produk_kode" => "code",
//                            "produk_part" => "no_part",
//                            "produk_label" => "label",
//                            "produk_jenis" => "jenis",
//                            "produk_satuan" => "satuan",
//                            "satuan" => "satuan",
//                            "oleh_id" => "olehID",
//                            "oleh_nama" => "olehName",
//                            "seller_id" => "sellerID",
//                            "seller_nama" => "sellerName",
//                            "customer_id" => "pihakID",
//                            "customer_nama" => "pihakName",
////                            "transaksi_id" => "transaksi_id",
//                            "master_id" => "id_master",
//                            "master_jenis" => "jenis_master",
//                            //------
//                            "_stepCode_placeID" => "_stepCode_placeID",
//                            "_stepCode_olehID" => "_stepCode_olehID",
//                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
//                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
//                            "_stepCode_customerID" => "_stepCode_customerID",
//                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
//                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
//                            "_stepCode" => "_stepCode",
//                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
//                            "_stepCode_supplierID" => "_stepCode_supplierID",
//                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
//                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
//                            //------
////                "dtime_order" => "dtime",
////                "dtime_kirim" => "shippingDate",
////                "dtime_terima" => "",
//                            "_step_1_nomer" => "_step_1_nomer",
//                            "_step_1_olehName" => "_step_1_olehName",
//                            "_step_2_nomer" => "_step_2_nomer",
//                            "_step_2_olehName" => "_step_2_olehName",
//                            "_step_3_nomer" => "_step_3_nomer",
//                            "_step_3_olehName" => "_step_3_olehName",
//                            "_step_4_nomer" => "_step_4_nomer",
//                            "_step_4_olehName" => "_step_4_olehName",
//                            "_step_5_nomer" => "_step_5_nomer",
//                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
//                        ),
//                    );
//                    $targetDetail = array(
//                        "loop" => array(
//                            "582spd" => "-sub_nett1",
//                        ),
//                        "static" => array(
//                            "rekening_nama" => "sourceJenisLabel",
//                            "cabang_id" => "placeID",
//                            "gudang_id" => "gudangID",
//                            "gudang_nama" => "gudangName",
//                            "cabang_nama" => "placeName",
//                            "produk_qty" => "-qty",
//                            "produk_nilai" => "harga",
//                            "harga_bruto" => "harga",
//                            "ppn_nilai" => "ppn",
//                            "harga_netto" => "nett1",
//                            "harga_nppn" => "nett2",
//                            "diskon_nilai" => "disc",
//                            "premi_nilai" => "premi",
//                            "extern_id" => "id",
//                            "extern_nama" => "name",
//                            "extern2_id" => "id_master",
//                            "extern2_nama" => ".0",
//                            "produk_kode" => "code",
//                            "produk_part" => "no_part",
//                            "produk_label" => "label",
//                            "produk_jenis" => "jenis",
//                            "produk_satuan" => "satuan",
//                            "satuan" => "satuan",
//                            "oleh_id" => "olehID",
//                            "oleh_nama" => "olehName",
//                            "seller_id" => "sellerID",
//                            "seller_nama" => "sellerName",
//                            "customer_id" => "pihakID",
//                            "customer_nama" => "pihakName",
////                            "transaksi_id" => "transaksi_id",
//                            "master_id" => "id_master",
//                            "master_jenis" => "jenis_master",
//                            //------
//                            "_stepCode_placeID" => "_stepCode_placeID",
//                            "_stepCode_olehID" => "_stepCode_olehID",
//                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
//                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
//                            "_stepCode_customerID" => "_stepCode_customerID",
//                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
//                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
//                            "_stepCode" => "_stepCode",
//                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
//                            "_stepCode_supplierID" => "_stepCode_supplierID",
//                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
//                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
//                            //------
////                "dtime_order" => "dtime",
////                "dtime_kirim" => "shippingDate",
////                "dtime_terima" => "",
//                            "_step_1_nomer" => "_step_1_nomer",
//                            "_step_1_olehName" => "_step_1_olehName",
//                            "_step_2_nomer" => "_step_2_nomer",
//                            "_step_2_olehName" => "_step_2_olehName",
//                            "_step_3_nomer" => "_step_3_nomer",
//                            "_step_3_olehName" => "_step_3_olehName",
//                            "_step_4_nomer" => "_step_4_nomer",
//                            "_step_4_olehName" => "_step_4_olehName",
//                            "_step_5_nomer" => "_step_5_nomer",
//                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
//                        ),
//                    );
//                    break;

//                case "582spd":
//                    $sourceMain = array(
//                        "loop" => array(
//                            "582spd" => "m_nett1",
//                        ),
//                        "static" => array(
//                            "cabang_id" => "m_placeID",
//                            "cabang_nama" => "m_placeName",
//                            "gudang_id" => "m_gudangID",
//                            "gudang_nama" => "m_gudangName",
//                            "rekening_nama" => "m_sourceJenisLabel",
//                            "produk_qty" => "qty",
//                            "produk_nilai" => "m_harga",
//                            "harga_bruto" => "m_harga",
//                            "ppn_nilai" => "m_ppn",
//                            "harga_netto" => "m_nett1",
//                            "harga_nppn" => "m_nett2",
//                            "diskon_nilai" => "m_disc",
//                            "premi_nilai" => "m_premi",
//                            "ongkir_nilai" => "m_shipping_service",
//                            "extern_id" => "id_master",
//                            "extern_nama" => "nomer",
//                            "satuan" => "satuan",
//                            "oleh_id" => "m_olehID",
//                            "oleh_nama" => "m_olehName",
//                            "seller_id" => "m_sellerID",
//                            "seller_nama" => "m_sellerName",
//                            "customer_id" => "m_pihakID",
//                            "customer_nama" => "m_pihakName",
//                            "master_id" => "id_master",
//                            "master_jenis" => "jenis_master",
//                            "jenis" => "jenis",
//                            "step_current" => "step_number",
//                            "step_number" => "step_current",
//                            "next_step_num" => "next_step_num",
//                            //------
//                            "_stepCode_placeID" => "_stepCode_placeID",
//                            "_stepCode_olehID" => "_stepCode_olehID",
//                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
//                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
//                            "_stepCode_customerID" => "_stepCode_customerID",
//                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
//                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
//                            "_stepCode" => "_stepCode",
//                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
//                            "_stepCode_supplierID" => "_stepCode_supplierID",
//                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
//                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
//                            //------
//                            "_step_1_nomer" => "_step_1_nomer",
//                            "_step_1_olehName" => "_step_1_olehName",
//                            "_step_2_nomer" => "_step_2_nomer",
//                            "_step_2_olehName" => "_step_2_olehName",
//                            "_step_3_nomer" => "_step_3_nomer",
//                            "_step_3_olehName" => "_step_3_olehName",
//                            "_step_4_nomer" => "_step_4_nomer",
//                            "_step_4_olehName" => "_step_4_olehName",
//                            "_step_5_nomer" => "_step_5_nomer",
//                            "_step_5_olehName" => "_step_5_olehName",
//                            "rel_target_jenis" => ".0",
//                        ),
//                    );
//                    $targetMain = array(
//                        "loop" => array(
//                            "582spo" => "-m_nett1",
//                        ),
//                        "static" => array(
//                            "cabang_id" => "m_placeID",
//                            "cabang_nama" => "m_placeName",
//                            "gudang_id" => "m_gudangID",
//                            "gudang_nama" => "m_gudangName",
//                            "rekening_nama" => "m_sourceJenisLabel",
//                            "produk_qty" => "qty",
//                            "produk_nilai" => "m_harga",
//                            "harga_bruto" => "m_harga",
//                            "ppn_nilai" => "m_ppn",
//                            "harga_netto" => "m_nett1",
//                            "harga_nppn" => "m_nett2",
//                            "diskon_nilai" => "m_disc",
//                            "premi_nilai" => "m_premi",
//                            "ongkir_nilai" => "m_shipping_service",
//                            "extern_id" => "id_master",
//                            "extern_nama" => "nomer",
//                            "satuan" => "satuan",
////                            "oleh_id" => "m_olehID",
////                            "oleh_nama" => "m_olehName",
//                            "seller_id" => "m_sellerID",
//                            "seller_nama" => "m_sellerName",
//                            "customer_id" => "m_pihakID",
//                            "customer_nama" => "m_pihakName",
//                            "master_id" => "id_master",
//                            "master_jenis" => "jenis_master",
//                            "jenis" => "jenis",
//                            "step_current" => "step_number",
//                            "step_number" => "step_current",
//                            "next_step_num" => "next_step_num",
//                            //------
//                            "_stepCode_placeID" => "_stepCode_placeID",
//                            "_stepCode_olehID" => "_stepCode_olehID",
//                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
//                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
//                            "_stepCode_customerID" => "_stepCode_customerID",
//                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
//                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
//                            "_stepCode" => "_stepCode",
//                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
//                            "_stepCode_supplierID" => "_stepCode_supplierID",
//                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
//                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
//                            //------
//                            "_step_1_nomer" => "_step_1_nomer",
//                            "_step_1_olehName" => "_step_1_olehName",
//                            "_step_2_olehName" => "_step_2_olehName",
//                            "_step_2_nomer" => "_step_2_nomer",
//                            "_step_3_nomer" => "_step_3_nomer",
//                            "_step_3_olehName" => "_step_3_olehName",
//                            "_step_4_nomer" => "_step_4_nomer",
//                            "_step_4_olehName" => "_step_4_olehName",
//                            "_step_5_nomer" => "_step_5_nomer",
//                            "_step_5_olehName" => "_step_5_olehName",
//                            "rel_target_jenis" => ".0",
//                        ),
//                    );
//                    $sourceDetail = array(
//                        "loop" => array(
//                            "582spd" => "sub_nett1",
//                        ),
//                        "static" => array(
//                            "rekening_nama" => "sourceJenisLabel",
//                            "cabang_id" => "placeID",
//                            "gudang_id" => "gudangID",
//                            "gudang_nama" => "gudangName",
//                            "cabang_nama" => "placeName",
//                            "produk_qty" => "qty",
//                            "produk_nilai" => "harga",
//                            "harga_bruto" => "harga",
//                            "ppn_nilai" => "ppn",
//                            "harga_netto" => "nett1",
//                            "harga_nppn" => "nett2",
//                            "diskon_nilai" => "disc",
//                            "premi_nilai" => "premi",
//                            "extern_id" => "id",
//                            "extern_nama" => "name",
//                            "extern2_id" => "id_master",
//                            "extern2_nama" => ".0",
//                            "produk_kode" => "code",
//                            "produk_part" => "no_part",
//                            "produk_label" => "label",
//                            "produk_jenis" => "jenis",
//                            "produk_satuan" => "satuan",
//                            "satuan" => "satuan",
//                            "oleh_id" => "olehID",
//                            "oleh_nama" => "olehName",
//                            "seller_id" => "sellerID",
//                            "seller_nama" => "sellerName",
//                            "customer_id" => "pihakID",
//                            "customer_nama" => "pihakName",
////                            "transaksi_id" => "transaksi_id",
//                            "master_id" => "id_master",
//                            "master_jenis" => "jenis_master",
//                            //------
//                            "_stepCode_placeID" => "_stepCode_placeID",
//                            "_stepCode_olehID" => "_stepCode_olehID",
//                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
//                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
//                            "_stepCode_customerID" => "_stepCode_customerID",
//                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
//                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
//                            "_stepCode" => "_stepCode",
//                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
//                            "_stepCode_supplierID" => "_stepCode_supplierID",
//                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
//                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
//                            //------
////                "dtime_order" => "dtime",
////                "dtime_kirim" => "shippingDate",
////                "dtime_terima" => "",
//                            "_step_1_nomer" => "_step_1_nomer",
//                            "_step_1_olehName" => "_step_1_olehName",
//                            "_step_2_nomer" => "_step_2_nomer",
//                            "_step_2_olehName" => "_step_2_olehName",
//                            "_step_3_nomer" => "_step_3_nomer",
//                            "_step_3_olehName" => "_step_3_olehName",
//                            "_step_4_nomer" => "_step_4_nomer",
//                            "_step_4_olehName" => "_step_4_olehName",
//                            "_step_5_nomer" => "_step_5_nomer",
//                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
//                        ),
//                    );
//                    $targetDetail = array(
//                        "loop" => array(
//                            "582spo" => "-sub_nett1",
//                        ),
//                        "static" => array(
//                            "rekening_nama" => "sourceJenisLabel",
//                            "cabang_id" => "placeID",
//                            "gudang_id" => "gudangID",
//                            "gudang_nama" => "gudangName",
//                            "cabang_nama" => "placeName",
//                            "produk_qty" => "-qty",
//                            "produk_nilai" => "harga",
//                            "harga_bruto" => "harga",
//                            "ppn_nilai" => "ppn",
//                            "harga_netto" => "nett1",
//                            "harga_nppn" => "nett2",
//                            "diskon_nilai" => "disc",
//                            "premi_nilai" => "premi",
//                            "extern_id" => "id",
//                            "extern_nama" => "name",
//                            "extern2_id" => "id_master",
//                            "extern2_nama" => ".0",
//                            "produk_kode" => "code",
//                            "produk_part" => "no_part",
//                            "produk_label" => "label",
//                            "produk_jenis" => "jenis",
//                            "produk_satuan" => "satuan",
//                            "satuan" => "satuan",
////                            "oleh_id" => "olehID",
////                            "oleh_nama" => "olehName",
//                            "seller_id" => "sellerID",
//                            "seller_nama" => "sellerName",
//                            "customer_id" => "pihakID",
//                            "customer_nama" => "pihakName",
////                            "transaksi_id" => "transaksi_id",
//                            "master_id" => "id_master",
//                            "master_jenis" => "jenis_master",
//                            //------
//                            "_stepCode_placeID" => "_stepCode_placeID",
//                            "_stepCode_olehID" => "_stepCode_olehID",
//                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
//                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
//                            "_stepCode_customerID" => "_stepCode_customerID",
//                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
//                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
//                            "_stepCode" => "_stepCode",
//                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
//                            "_stepCode_supplierID" => "_stepCode_supplierID",
//                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
//                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
//                            //------
////                "dtime_order" => "dtime",
////                "dtime_kirim" => "shippingDate",
////                "dtime_terima" => "",
//                            "_step_1_nomer" => "_step_1_nomer",
//                            "_step_1_olehName" => "_step_1_olehName",
//                            "_step_2_nomer" => "_step_2_nomer",
//                            "_step_2_olehName" => "_step_2_olehName",
//                            "_step_3_nomer" => "_step_3_nomer",
//                            "_step_3_olehName" => "_step_3_olehName",
//                            "_step_4_nomer" => "_step_4_nomer",
//                            "_step_4_olehName" => "_step_4_olehName",
//                            "_step_5_nomer" => "_step_5_nomer",
//                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
//                            "update_lap" => false,
//                        ),
//                    );
//                    break;

                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
//            arrPrint($trDatas);
//            arrPrint($items);

            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO belon comit @" . __LINE__);

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    //endregion


    //region non akunting purchasing FG (dipasang di joblist realtime, group 2)
    // running cli realtime
    public function generateNonAkuntingAllPurchase()
    {
//        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "466";
        $divID = "18";
        $arrJenis = array("466r", "466", "467");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//        arrPrintPink($tmpHist);
//mati_disini();
        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {
            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------
            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }

            switch ($jenisTransaksi) {
                case "466r":
                    $sourceMain = array(
                        "loop" => array(
                            "466r" => "m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "466" => "-m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "466r" => "sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "466" => "-sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "466":
                    $sourceMain = array(
                        "loop" => array(
                            "466" => "m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
//                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "467" => "-m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
//                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "466" => "sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
//                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "467" => "-sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
//                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "467":
                    $sourceMain = array(
                        "loop" => array(
                            "467" => "m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => "dtime",
                            "dtime_terima" => "dtime",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "466r" => "-m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
//                            "oleh_id" => "m_olehID",
//                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => "dtime",
                            "dtime_terima" => "dtime",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "467" => "sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => "dtime",
                            "dtime_terima" => "dtime",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "466r" => "-sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
//                            "oleh_id" => "olehID",
//                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "update_lap" => false,
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => "dtime",
                            "dtime_terima" => "dtime",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
//            arrPrint($trDatas);
//            arrPrint($items);
//            arrPrint($trDatas);
//mati_disini();

            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");


        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");


    }

    // running cli realtime
    public function generateNonAkuntingAllPurchaseReject()
    {
//        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "466";
        $divID = "18";
        $arrJenis = array("466r", "466");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting_reject=0");
        $tr->addFilter("trash_4=1");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//        arrPrintPink($tmpHist);
//mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------

            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "cancel_dtime" => "cancel_dtime",
                "cancel_name" => "cancel_name",
                "cancel_id" => "cancel_id",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }

            switch ($jenisTransaksi) {
                case "466r":
                    $sourceMain = array(
                        "loop" => array(
                            "466" => "m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "466r" => "-m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "466" => "sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "466r" => "-sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    break;
                case "466":
                    $sourceMain = array(
                        "loop" => array(
                            "467" => "m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "466" => "-m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "467" => "sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "466" => "-sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
//            arrPrint($trDatas);
//            arrPrint($items);

            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            $gateSource['static']['dtime_reject'] = $mainData['cancel_dtime'];
            $gateSource['static']['oleh_id_reject'] = $mainData['cancel_name'];
            $gateSource['static']['oleh_nama_reject'] = $mainData['cancel_id'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            $gateSource['static']['dtime_reject'] = $mainData['cancel_dtime'];
            $gateSource['static']['oleh_id_reject'] = $mainData['cancel_name'];
            $gateSource['static']['oleh_nama_reject'] = $mainData['cancel_id'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                $gateSourceDetail[$ii]['static']['dtime_reject'] = $mainData['cancel_dtime'];
                $gateSourceDetail[$ii]['static']['oleh_id_reject'] = $mainData['cancel_name'];
                $gateSourceDetail[$ii]['static']['oleh_nama_reject'] = $mainData['cancel_id'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                $gateTargetDetail[$ii]['static']['dtime_reject'] = $mainData['cancel_dtime'];
                $gateTargetDetail[$ii]['static']['oleh_id_reject'] = $mainData['cancel_name'];
                $gateTargetDetail[$ii]['static']['oleh_nama_reject'] = $mainData['cancel_id'];
            }
            //------------------------------------

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting_reject" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    // belum final
    public function generateNonAkuntingAllPurchaseClosed()
    {
//        header("refresh:3");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "1967";
        $divID = "18";
        $arrJenis = array("1967", "1967a");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//arrPrint($tmpHist);


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = isset($hisSpec['nomer']) ? $hisSpec['nomer'] : "";
                    $trDatas[$bb] = isset($hisSpec['olehID']) ? $hisSpec['olehID'] : "";
                    $trDatas[$cc] = isset($hisSpec['olehName']) ? $hisSpec['olehName'] : "";
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------


            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }


            //transaksi yang direturn-------
//            $tr = new MdlTransaksi();
//            $tr->setFilters(array());
//            $tr->addFilter("id='" . $trDatas['m_masterID'] . "'");
//            $trRtnTmp = $tr->lookupAll()->result();
//            if (sizeof($trRtnTmp) > 0) {
//                foreach ($trRtnTmp[0] as $rtn_key => $rtn_val) {
//                    $trDatas["cls_" . $rtn_key] = $rtn_val;
//                }
//            }
            //-------
//            arrPrintWebs($trDatas);
//            mati_disini();

            $addMain = array(
                "seller_id" => "cls_seller_id",
                "seller_nama" => "cls_seller_nama",
                "sellerID" => "cls_seller_id",
                "sellerName" => "cls_seller_nama",
            );
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "rtn_id_master" => "rtn_id_master",
                "seller_id" => "cls_seller_id",
                "seller_nama" => "cls_seller_nama",
                "sellerID" => "cls_seller_id",
                "sellerName" => "cls_seller_nama",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            foreach ($addMain as $akey => $aval) {
                $trDatas[$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
            }

//arrPrintWebs($trDatas);
//            mati_disini(__LINE__);

            switch ($jenisTransaksi) {
                case "1967":
                    $sourceMain = array(
                        "loop" => array(
                            "1967" => "m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
//                            "master_id" => "id_master",
                            "master_id" => "m_masterID",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => ".0",
//                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "1967a" => "-m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
//                            "master_id" => "id_master",
                            "master_id" => "m_masterID",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => ".0",
//                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "1967" => "sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
//                            "master_id" => "id_master",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => ".0",
//                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "1967a" => "-sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
//                            "master_id" => "id_master",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => ".0",
//                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    break;
                case "1967a":
                    $sourceMain = array(
                        "loop" => array(
                            "1967a" => "m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
//                            "master_id" => "id_master",
                            "master_id" => "m_masterID",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
//                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "1967" => "-m_hpp",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_hpp",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
//                            "master_id" => "id_master",
                            "master_id" => "m_masterID",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
//                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "1967a" => "sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
//                            "master_id" => "id_master",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => "dtime",
//                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "1967" => "-sub_hpp",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "hpp",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
//                            "master_id" => "id_master",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
//                            "dtime_order" => "dtime",
//                            "dtime_kirim" => "dtime",
//                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    break;

                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------
//arrPrint($gateTargetDetail);
//mati_disini(":: SETOP ::");

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion

//mati_disini(":: SETOP ::");

            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    public function generateNonAkuntingAllPurchaseReturn()
    {
//        header("refresh:3");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "967";
        $divID = "18";
        $arrJenis = array("967r", "967");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//        arrPrintPink($tmpHist);
//mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = isset($hisSpec['nomer']) ? $hisSpec['nomer'] : "";
                    $trDatas[$bb] = isset($hisSpec['olehID']) ? $hisSpec['olehID'] : "";
                    $trDatas[$cc] = isset($hisSpec['olehName']) ? $hisSpec['olehName'] : "";
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------


            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }

            //transaksi yang direturn-------
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id='" . $trDatas['m_referenceID'] . "'");
            $trRtnTmp = $tr->lookupAll()->result();
            if (sizeof($trRtnTmp) > 0) {
                foreach ($trRtnTmp[0] as $rtn_key => $rtn_val) {
                    $trDatas["rtn_" . $rtn_key] = $rtn_val;
                }
            }
            //-------

            $addMain = array(
                "seller_id" => "rtn_seller_id",
                "seller_nama" => "rtn_seller_nama",
                "sellerID" => "rtn_seller_id",
                "sellerName" => "rtn_seller_nama",
            );
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "rtn_id_master" => "rtn_id_master",
                "seller_id" => "rtn_seller_id",
                "seller_nama" => "rtn_seller_nama",
                "sellerID" => "rtn_seller_id",
                "sellerName" => "rtn_seller_nama",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            foreach ($addMain as $akey => $aval) {
                $trDatas[$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
            }

//arrPrintWebs($trDatas);
//mati_disini(__LINE__);

            switch ($jenisTransaksi) {
                case "967r":
                    $sourceMain = array(
                        "loop" => array(
                            "967r" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "967" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "967r" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga",
                            "harga_nppn" => "hpp_nppn",
                            "ppv_nilai" => "ppv",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "967" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga",
                            "harga_nppn" => "hpp_nppn",
                            "ppv_nilai" => "ppv",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "967":
                    $sourceMain = array(
                        "loop" => array(
                            "967" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "967r" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "967" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga",
                            "harga_nppn" => "hpp_nppn",
                            "ppv_nilai" => "ppv",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "967r" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga",
                            "harga_nppn" => "hpp_nppn",
                            "ppv_nilai" => "ppv",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }


            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------
//arrPrint($gateTargetDetail);
//mati_disini(":: SETOP ::");

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    public function generateNonAkuntingAllPurchaseBatal()
    {

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "9911";
        $divID = "18";
        $arrJenis = array("467");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("reference_jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));

        /* ----------------------------------------------------------------------------------------
         * cek Jumlah data keseluruhan yg perlu dieksekusi
         * ----------------------------------------------------------------------------------------*/
        $this->db->select("count(id) as 'jml_data'");
        $cekAll = $tr->lookupAll()->row();
        // showLast_query("kuning");
        $jml_data = $cekAll->jml_data;

        if ($jml_data > 0) {
            /* ----------------------------------------------------------------------------------------
             * eksekutor data berjalan 1 per satu
             * ----------------------------------------------------------------------------------------*/
            $this->db->limit(1);
            $tmpHist = $tr->lookupAll()->result();
            showLast_query("biru");
            cekHitam(sizeof($tmpHist));
            //        arrPrintPink($tmpHist);
            //        mati_disini();

            $this->db->trans_start();

            $trDatas = array();
            if (sizeof($tmpHist) > 0) {

                foreach ($tmpHist[0] as $key => $val) {
                    $trDatas[$key] = $val;
                }
                cekHitam(":: " . $tmpHist[0]->id);
                $trID = $tmpHist[0]->id;
                $masterID = $tmpHist[0]->id_master;
                $masterJenis = $tmpHist[0]->jenis_master;
                $jenisTransaksi = $tmpHist[0]->jenis;
                $counters = $tmpHist[0]->counters;
                //----------------------------
                $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
                $ids_his_data = array();
                if (sizeof($ids_his) > 0) {
                    foreach ($ids_his as $step => $hisSpec) {
                        $aa = "_step_" . $step . "_nomer";
                        $bb = "_step_" . $step . "_olehID";
                        $cc = "_step_" . $step . "_olehName";
                        $trDatas[$aa] = $hisSpec['nomer'];
                        $trDatas[$bb] = $hisSpec['olehID'];
                        $trDatas[$cc] = $hisSpec['olehName'];
                    }
                }
                $cContent = blobDecode($tmpHist[0]->counters);
                $arrIndexVal = array();
                foreach ($cContent as $counterKey => $counterData) {
                    $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                    foreach ($counterData as $key => $index_conter) {
                        //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                        $trDatas[$counterIndexKey] = $index_conter;
                    }
                }
                //----------------------------

                // registry main dan items
                $tr = new MdlTransaksi();
                $tr->setFilters(array());
                $tr->setJointSelectFields("transaksi_id, main, items");
                $tr->addFilter("transaksi_id='$trID'");
                $trReg = $tr->lookupDataRegistries()->result();
                showLast_query("kuning");
                $trRegResult = array();
                foreach ($trReg as $regSpec) {
                    $trRegResult[$regSpec->transaksi_id] = array(
                        "main" => blobDecode($regSpec->main),
                        "items" => blobDecode($regSpec->items),
                    );
                }
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['main'] as $mkey => $mval) {
                        $trDatas["m_" . $mkey] = $mval;
                    }
                }
                $addItems = array(
                    "id_master" => "id_master",
                    "_stepCode_placeID" => "_stepCode_placeID",
                    "_stepCode_olehID" => "_stepCode_olehID",
                    "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                    "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                    "_stepCode_customerID" => "_stepCode_customerID",
                    "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                    "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                    "_stepCode" => "_stepCode",
                    "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                    "_stepCode_supplierID" => "_stepCode_supplierID",
                    "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                    "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                    "_step_1_nomer" => "_step_1_nomer",
                    "_step_1_olehName" => "_step_1_olehName",
                    "_step_2_nomer" => "_step_2_nomer",
                    "_step_2_olehName" => "_step_2_olehName",
                    "_step_3_nomer" => "_step_3_nomer",
                    "_step_3_olehName" => "_step_3_olehName",
                    "_step_4_nomer" => "_step_4_nomer",
                    "_step_4_olehName" => "_step_4_olehName",
                    "_step_5_nomer" => "_step_5_nomer",
                    "_step_5_olehName" => "_step_5_olehName",
                );
                $items = array();
                foreach ($trRegResult as $trid => $regSpec) {
                    foreach ($regSpec['items'] as $mkey => $mSpec) {
                        $items[$mkey] = $mSpec;
                        foreach ($addItems as $akey => $aval) {
                            $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                        }
                    }
                }
//arrPrintPink($items);
                switch ($jenisTransaksi) {

                    case "9911":
                        $sourceMain = array(
                            "loop" => array(
                                "9911r" => "m_nett",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett",
                                "harga_nppn" => "m_hpp_nppn",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "reference_id_top",//master_id, id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetMain = array(
                            "loop" => array(
                                "9911" => "-m_nett",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett",
                                "harga_nppn" => "m_hpp_nppn",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "reference_id_top",//master_id, id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceDetail = array(
                            "loop" => array(
                                "9911r" => "sub_nett",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett",
                                "harga_nppn" => "hpp_nppn",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "reference_id_top",//id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        $targetDetail = array(
                            "loop" => array(
                                "9911" => "-sub_nett",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett",
                                "harga_nppn" => "hpp_nppn",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "reference_id_top",//id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".reguler",
                            ),
                        );
                        //-----
                        $targetMain_rev = array(
                            "loop" => array(
                                "9911" => "m_nett",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett",
                                "harga_nppn" => "m_hpp_nppn",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "reference_id_top",//master_id, id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $sourceMain_rev = array(
                            "loop" => array(
                                "9911r" => "-m_nett",
                            ),
                            "static" => array(
                                "cabang_id" => "m_placeID",
                                "cabang_nama" => "m_placeName",
                                "gudang_id" => "m_gudangID",
                                "gudang_nama" => "m_gudangName",
                                "rekening_nama" => "m_sourceJenisLabel",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "m_harga",
                                "harga_bruto" => "m_harga",
                                "ppn_nilai" => "m_ppn",
                                "harga_netto" => "m_nett",
                                "harga_nppn" => "m_hpp_nppn",
                                "diskon_nilai" => "m_disc",
                                "premi_nilai" => "m_premi",
                                "ongkir_nilai" => "m_shipping_service",
                                "extern_id" => "id_master",
                                "extern_nama" => "nomer",
                                "satuan" => "satuan",
                                "oleh_id" => "m_olehID",
                                "oleh_nama" => "m_olehName",
                                "seller_id" => "m_sellerID",
                                "seller_nama" => "m_sellerName",
                                "customer_id" => "m_pihakID",
                                "customer_nama" => "m_pihakName",
                                "master_id" => "reference_id_top",//master_id, id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                "jenis" => "jenis",
                                "step_current" => "step_number",
                                "step_number" => "step_current",
                                "next_step_num" => "next_step_num",
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "rel_target_jenis" => ".0",
                            ),
                        );
                        $targetDetail_rev = array(
                            "loop" => array(
                                "9911" => "sub_nett",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett",
                                "harga_nppn" => "hpp_nppn",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "reference_id_top",//id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".batal",
                            ),
                        );
                        $sourceDetail_rev = array(
                            "loop" => array(
                                "9911r" => "-sub_nett",
                            ),
                            "static" => array(
                                "rekening_nama" => "sourceJenisLabel",
                                "cabang_id" => "placeID",
                                "gudang_id" => "gudangID",
                                "gudang_nama" => "gudangName",
                                "cabang_nama" => "placeName",
                                "produk_qty" => "-qty",
                                "produk_nilai" => "harga",
                                "harga_bruto" => "harga",
                                "ppn_nilai" => "ppn",
                                "harga_netto" => "nett",
                                "harga_nppn" => "hpp_nppn",
                                "diskon_nilai" => "disc",
                                "premi_nilai" => "premi",
                                "extern_id" => "id",
                                "extern_nama" => "name",
                                "extern2_id" => "id_master",
                                "extern2_nama" => ".0",
                                "produk_kode" => "code",
                                "produk_part" => "no_part",
                                "produk_label" => "label",
                                "produk_jenis" => "jenis",
                                "produk_satuan" => "satuan",
                                "satuan" => "satuan",
                                "oleh_id" => "olehID",
                                "oleh_nama" => "olehName",
                                "seller_id" => "sellerID",
                                "seller_nama" => "sellerName",
                                "customer_id" => "pihakID",
                                "customer_nama" => "pihakName",
                                //                            "transaksi_id" => "transaksi_id",
                                "master_id" => "reference_id_top",//id_master
                                "master_jenis" => "reference_jenis",//jenis_master
                                //------
                                "_stepCode_placeID" => "_stepCode_placeID",
                                "_stepCode_olehID" => "_stepCode_olehID",
                                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                                "_stepCode_customerID" => "_stepCode_customerID",
                                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                                "_stepCode" => "_stepCode",
                                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                                "_stepCode_supplierID" => "_stepCode_supplierID",
                                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                                //------
                                //                "dtime_order" => "dtime",
                                //                "dtime_kirim" => "shippingDate",
                                //                "dtime_terima" => "",
                                "_step_1_nomer" => "_step_1_nomer",
                                "_step_1_olehName" => "_step_1_olehName",
                                "_step_2_nomer" => "_step_2_nomer",
                                "_step_2_olehName" => "_step_2_olehName",
                                "_step_3_nomer" => "_step_3_nomer",
                                "_step_3_olehName" => "_step_3_olehName",
                                "_step_4_nomer" => "_step_4_nomer",
                                "_step_4_olehName" => "_step_4_olehName",
                                "_step_5_nomer" => "_step_5_nomer",
                                "_step_5_olehName" => "_step_5_olehName",
                                "transaksi_tipe" => ".batal",
                            ),
                        );
                        break;
                    default:

                        mati_disini(":: $jenisTransaksi ::");

                        break;
                }

                //------------------------------------
                //            arrPrint($trDatas);
                //            arrPrint($items);
                //            arrPrint($trDatas);
                //            arrPrintHijau($items);


                $mainData = $trDatas;
                $gateSource = array();
                $gateSource_rev = array();
                $gateTarget = array();
                $gateTarget_rev = array();
                $gateMainToItems = array(
                    "reference_jenis",
                    "reference_id",
                    "reference_nomer",
                    "reference_id_top",
                    "reference_nomer_top",
                    "reference_jenis_top",
                );
                cekHere($mainData['reference_id_top']);
                foreach ($sourceMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateSource['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSource['static']['transaksi_id'] = $mainData['id'];
                $gateSource['static']['fulldate'] = $mainData['fulldate'];
                $gateSource['static']['dtime'] = $mainData['dtime'];

                foreach ($targetMain['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetMain['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateTarget['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTarget['static']['transaksi_id'] = $mainData['id'];
                $gateTarget['static']['fulldate'] = $mainData['fulldate'];
                $gateTarget['static']['dtime'] = $mainData['dtime'];
                //------------------------------------
                foreach ($sourceMain_rev['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource_rev['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource_rev['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceMain_rev['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateSource_rev['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSource_rev['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateSource_rev['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSource_rev['static']['transaksi_id'] = $mainData['id'];
                $gateSource_rev['static']['fulldate'] = $mainData['fulldate'];
                $gateSource_rev['static']['dtime'] = $mainData['dtime'];

                foreach ($targetMain_rev['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget_rev['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget_rev['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetMain_rev['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                        $gateTarget_rev['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTarget_rev['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                            $gateTarget_rev['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTarget_rev['static']['transaksi_id'] = $mainData['id'];
                $gateTarget_rev['static']['fulldate'] = $mainData['fulldate'];
                $gateTarget_rev['static']['dtime'] = $mainData['dtime'];
                //------------------------------------
                $gateSourceDetail = array();
                $gateTargetDetail = array();
                $gateSourceDetail_rev = array();
                $gateTargetDetail_rev = array();
                foreach ($items as $ii => $iiSpec) {
                    //---
                    foreach ($gateMainToItems as $gmti) {
                        $iiSpec[$gmti] = isset($mainData[$gmti]) ? $mainData[$gmti] : "";
                    }
                    //---
                    foreach ($sourceDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($sourceDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                    //---
                    foreach ($targetDetail['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($targetDetail['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                    //---
                    foreach ($sourceDetail_rev['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail_rev[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail_rev[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($sourceDetail_rev['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateSourceDetail_rev[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateSourceDetail_rev[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateSourceDetail_rev[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateSourceDetail_rev[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateSourceDetail_rev[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateSourceDetail_rev[$ii]['static']['dtime'] = $mainData['dtime'];
                    //---
                    foreach ($targetDetail_rev['loop'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail_rev[$ii]['loop'][$key] = "-" . $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail_rev[$ii]['loop'][$key] = $newVal_result;
                        }
                    }
                    foreach ($targetDetail_rev['static'] as $key => $val) {
                        if (substr($val, 0, 1) == "-") {
                            $newVal = str_replace("-", "", $val);
                            $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                            $gateTargetDetail_rev[$ii]['static'][$key] = "-" . $newVal_result;
                        }
                        else {
                            if (substr($val, 0, 1) == ".") {
                                $newVal = str_replace(".", "", $val);
                                $newVal_result = $newVal;
                                $gateTargetDetail_rev[$ii]['static'][$key] = $newVal_result;
                            }
                            else {
                                $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                                $gateTargetDetail_rev[$ii]['static'][$key] = $newVal_result;
                            }
                        }
                    }
                    $gateTargetDetail_rev[$ii]['static']['transaksi_id'] = $mainData['id'];
                    $gateTargetDetail_rev[$ii]['static']['fulldate'] = $mainData['fulldate'];
                    $gateTargetDetail_rev[$ii]['static']['dtime'] = $mainData['dtime'];
                    //---
                }
                //------------------------------------
//arrPrintHijau($gateSourceDetail);
//arrPrintHijau($gateTargetDetail);
//arrPrintHijau($gateSourceDetail_rev);
//arrPrintHijau($gateTargetDetail_rev);
//mati_disini("=====");

                //region MASTER
                cekHitam("MAIN JALAN REGULER");
                $rt = New ComRekeningTransaksi();
                $rt->pair($gateSource);
                $rt->exec();

                $rt = New ComRekeningTransaksi();
                $rt->pair($gateTarget);
                $rt->exec();
                cekHitam("MAIN JALAN REVERT");
                $rt = New ComRekeningTransaksi();
                $rt->pair($gateSource_rev);
                $rt->exec();

                $rt = New ComRekeningTransaksi();
                $rt->pair($gateTarget_rev);
                $rt->exec();
                //endregion

                //region DETAIL
                cekHitam("DETAIL JALAN REGULER");
                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateSourceDetail);
                $rt->exec();

                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateTargetDetail);
                $rt->exec();
                cekHitam("DETAIL JALAN REVERT");
                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateSourceDetail_rev);
                $rt->exec();

                $rt = New ComRekeningTransaksiPembantu();
                $rt->pair($gateTargetDetail_rev);
                $rt->exec();
                //endregion

//            mati_disini("=====");

                $tr = new MdlTransaksi();
                $updateData = array(
                    "non_akunting" => "1",
                );
                $updateWhere = array(
                    "id" => $trID
                );
                $tr->updateData($updateWhere, $updateData);
                showLast_query("orange");

            }

//            mati_disini(" OHOOOO belon comit @" . __LINE__);

            $this->db->trans_complete();

            cekHijau("<h2>-- DONE --</h2>");

            /* --------------------------------------------------------------------
             * logic perlu reload lagi atau nutup
             * -------------------------------------------------------------------*/
//            if ($jml_data == 1) {
//                echo "<script>
//                    window.close();
//                    window.onunload = refreshParent;
//                </script>";
//            }
//            else {
//                cekKuning("jml data baru $jml_data");
//                echo "<b>sikronisasi data</b> windows ini akan menutup sendiri saat sikronisasi data selesai";
//                echo "<meta http-equiv='refresh' content='3'>";
//
//                echo "<script>
//                        // window.onbeforeunload = function(e) {
//                        //     return 'Please press the Logout button to logout.';
//                        // };
//                </script>";
//            }
        }
        else {
            cekKuning("tidak ada data baru");
//            echo "<script>
//                window.close();
//                // window.onunload = refreshParent;
//            </script>";
        }

    }
    //endregion


    //region non akunting purchasing FG IMPORT
    // running cli realtime
    public function generateNonAkuntingAllPurchaseImport()
    {
//        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "460";
        $divID = "18";
        $arrJenis = array("460r", "460a", "460");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//        arrPrintPink($tmpHist);
//mati_disini();
        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {
            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------
            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
//arrPrintPink($trDatas);
//arrPrintHijau($items);
//mati_disini();
            switch ($jenisTransaksi) {
                case "460r":
                    $sourceMain = array(
                        "loop" => array(
                            "460r" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "460a" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "460r" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "460a" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "460a":
                    $sourceMain = array(
                        "loop" => array(
                            "460a" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "460" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "460a" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "460" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "460":
                    $sourceMain = array(
                        "loop" => array(
                            "460" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "460r" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "460" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "460r" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
//            arrPrint($trDatas);
//            arrPrint($items);
//            arrPrint($trDatas);
//mati_disini();

            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");


        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");


    }

    public function generateNonAkuntingAllPurchaseRejectImport()
    {
//        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "460";
        $divID = "18";
        $arrJenis = array("460r", "460a");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting_reject=0");
        $tr->addFilter("trash_4=1");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//        arrPrintPink($tmpHist);
//mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id . " :: " . $tmpHist[0]->jenis . " ::");
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------

            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "cancel_dtime" => "cancel_dtime",
                "cancel_name" => "cancel_name",
                "cancel_id" => "cancel_id",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
//arrPrintHijau($items);
            switch ($jenisTransaksi) {
                case "460r":
                    $sourceMain = array(
                        "loop" => array(
                            "460a" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "460r" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "460a" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "460r" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    break;
                case "460a":
                    $sourceMain = array(
                        "loop" => array(
                            "460" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "460a" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "460" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "460a" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".rejected",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
//            arrPrint($trDatas);
//            arrPrint($items);

            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            $gateSource['static']['dtime_reject'] = $mainData['cancel_dtime'];
            $gateSource['static']['oleh_id_reject'] = $mainData['cancel_name'];
            $gateSource['static']['oleh_nama_reject'] = $mainData['cancel_id'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            $gateSource['static']['dtime_reject'] = $mainData['cancel_dtime'];
            $gateSource['static']['oleh_id_reject'] = $mainData['cancel_name'];
            $gateSource['static']['oleh_nama_reject'] = $mainData['cancel_id'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                $gateSourceDetail[$ii]['static']['dtime_reject'] = $mainData['cancel_dtime'];
                $gateSourceDetail[$ii]['static']['oleh_id_reject'] = $mainData['cancel_name'];
                $gateSourceDetail[$ii]['static']['oleh_nama_reject'] = $mainData['cancel_id'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                $gateTargetDetail[$ii]['static']['dtime_reject'] = $mainData['cancel_dtime'];
                $gateTargetDetail[$ii]['static']['oleh_id_reject'] = $mainData['cancel_name'];
                $gateTargetDetail[$ii]['static']['oleh_nama_reject'] = $mainData['cancel_id'];
            }
            //------------------------------------

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting_reject" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    public function generateNonAkuntingAllPurchaseClosedImport()
    {
//        header("refresh:3");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "1960";
        $divID = "18";
        $arrJenis = array("1960", "1960a");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//arrPrint($tmpHist);


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = isset($hisSpec['nomer']) ? $hisSpec['nomer'] : "";
                    $trDatas[$bb] = isset($hisSpec['olehID']) ? $hisSpec['olehID'] : "";
                    $trDatas[$cc] = isset($hisSpec['olehName']) ? $hisSpec['olehName'] : "";
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------


            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }


            //transaksi yang direturn-------
//            $tr = new MdlTransaksi();
//            $tr->setFilters(array());
//            $tr->addFilter("id='" . $trDatas['m_masterID'] . "'");
//            $trRtnTmp = $tr->lookupAll()->result();
//            if (sizeof($trRtnTmp) > 0) {
//                foreach ($trRtnTmp[0] as $rtn_key => $rtn_val) {
//                    $trDatas["cls_" . $rtn_key] = $rtn_val;
//                }
//            }
            //-------
//            arrPrintWebs($trDatas);
//            mati_disini();

            $addMain = array(
                "seller_id" => "cls_seller_id",
                "seller_nama" => "cls_seller_nama",
                "sellerID" => "cls_seller_id",
                "sellerName" => "cls_seller_nama",
            );
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "rtn_id_master" => "rtn_id_master",
                "seller_id" => "cls_seller_id",
                "seller_nama" => "cls_seller_nama",
                "sellerID" => "cls_seller_id",
                "sellerName" => "cls_seller_nama",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            foreach ($addMain as $akey => $aval) {
                $trDatas[$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
            }

//arrPrintHijau($trDatas);
//arrPrintWebs($items);
//            mati_disini(__LINE__);

            switch ($jenisTransaksi) {
                case "1960":
                    $sourceMain = array(
                        "loop" => array(
                            "1960" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "m_masterID",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "1960a" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "m_masterID",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "1960" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "1960a" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    break;
                case "1960a":
                    $sourceMain = array(
                        "loop" => array(
                            "1960a" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "m_masterID",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "1960" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "m_masterID",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "1960a" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "1960" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    break;

                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------
//arrPrint($gateTargetDetail);
//mati_disini(":: SETOP ::");

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion

//mati_disini(":: SETOP ::");

            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    public function generateNonAkuntingAllPurchaseReturnImport()
    {
//        header("refresh:3");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "960";
        $divID = "18";
        $arrJenis = array("960r", "960");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//        arrPrintPink($tmpHist);
//mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = isset($hisSpec['nomer']) ? $hisSpec['nomer'] : "";
                    $trDatas[$bb] = isset($hisSpec['olehID']) ? $hisSpec['olehID'] : "";
                    $trDatas[$cc] = isset($hisSpec['olehName']) ? $hisSpec['olehName'] : "";
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------


            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }

            //transaksi yang direturn-------
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id='" . $trDatas['m_referenceID'] . "'");
            $trRtnTmp = $tr->lookupAll()->result();
            if (sizeof($trRtnTmp) > 0) {
                foreach ($trRtnTmp[0] as $rtn_key => $rtn_val) {
                    $trDatas["rtn_" . $rtn_key] = $rtn_val;
                }
            }
            //-------

            $addMain = array(
                "seller_id" => "rtn_seller_id",
                "seller_nama" => "rtn_seller_nama",
                "sellerID" => "rtn_seller_id",
                "sellerName" => "rtn_seller_nama",
            );
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "rtn_id_master" => "rtn_id_master",
                "seller_id" => "rtn_seller_id",
                "seller_nama" => "rtn_seller_nama",
                "sellerID" => "rtn_seller_id",
                "sellerName" => "rtn_seller_nama",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            foreach ($addMain as $akey => $aval) {
                $trDatas[$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
            }

//arrPrintWebs($trDatas);
//mati_disini(__LINE__);

            switch ($jenisTransaksi) {
                case "960r":
                    $sourceMain = array(
                        "loop" => array(
                            "960r" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "960" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "960r" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "960" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "960":
                    $sourceMain = array(
                        "loop" => array(
                            "960" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "960r" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "960" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "960r" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }


            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------
//arrPrint($gateTargetDetail);
//mati_disini(":: SETOP ::");

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    public function generateNonAkuntingAllPurchaseImportBatal()
    {
//        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "9911";
        $divID = "18";
        $arrJenis = array("460");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("reference_jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
//        arrPrintPink($tmpHist);
//mati_disini();
        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {
            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
//                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------
            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
//arrPrintPink($trDatas);
//arrPrintHijau($items);
//mati_disini();
            switch ($jenisTransaksi) {
                case "9911":
                    $sourceMain = array(
                        "loop" => array(
                            "9911r" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "reference_id_top",//id_master
                            "master_jenis" => "reference_jenis",//jenis_master
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "9911" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "reference_id_top",//id_master
                            "master_jenis" => "reference_jenis",//jenis_master
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "9911r" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "reference_id_top",//id_master
                            "master_jenis" => "reference_jenis",//jenis_master
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "9911" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "reference_id_top",//id_master
                            "master_jenis" => "reference_jenis",//jenis_master
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    //-----
                    $targetMain_rev = array(
                        "loop" => array(
                            "9911" => "m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "reference_id_top",//id_master
                            "master_jenis" => "reference_jenis",//jenis_master
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceMain_rev = array(
                        "loop" => array(
                            "9911r" => "-m_exchange__harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_exchange__harga",
                            "harga_bruto" => "m_exchange__harga",
                            "ppn_nilai" => "m_exchange__ppn",
                            "harga_netto" => "m_exchange__harga",
                            "harga_nppn" => "m_exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "m_exchange__ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "reference_id_top",//id_master
                            "master_jenis" => "reference_jenis",//jenis_master
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetDetail_rev = array(
                        "loop" => array(
                            "9911" => "exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "reference_id_top",//id_master
                            "master_jenis" => "reference_jenis",//jenis_master
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".batal",
                        ),
                    );
                    $sourceDetail_rev = array(
                        "loop" => array(
                            "9911r" => "-exchange__sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "exchange__harga",
                            "harga_bruto" => "exchange__harga",
                            "ppn_nilai" => "exchange__ppn",
                            "harga_netto" => "exchange__harga",
                            "harga_nppn" => "exchange__hpp_nppn",
                            "diskon_nilai" => ".0",
                            "premi_nilai" => ".0",
                            "ppv_nilai" => "exchange__ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
//                            "transaksi_id" => "transaksi_id",
                            "master_id" => "reference_id_top",//id_master
                            "master_jenis" => "reference_jenis",//jenis_master
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
//                "dtime_order" => "dtime",
//                "dtime_kirim" => "shippingDate",
//                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".batal",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }

            //------------------------------------
//            arrPrint($trDatas);
//            arrPrint($items);
//            arrPrint($trDatas);
//mati_disini();

            $mainData = $trDatas;
            $gateSource = array();
            $gateSource_rev = array();
            $gateTarget = array();
            $gateTarget_rev = array();
            $gateMainToItems = array(
                "reference_jenis",
                "reference_id",
                "reference_nomer",
                "reference_id_top",
                "reference_nomer_top",
                "reference_jenis_top",
            );
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($sourceMain_rev['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource_rev['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource_rev['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain_rev['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource_rev['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource_rev['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource_rev['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource_rev['static']['transaksi_id'] = $mainData['id'];
            $gateSource_rev['static']['fulldate'] = $mainData['fulldate'];
            $gateSource_rev['static']['dtime'] = $mainData['dtime'];

            foreach ($targetMain_rev['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget_rev['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget_rev['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain_rev['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget_rev['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget_rev['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget_rev['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget_rev['static']['transaksi_id'] = $mainData['id'];
            $gateTarget_rev['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget_rev['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            $gateSourceDetail_rev = array();
            $gateTargetDetail_rev = array();
            foreach ($items as $ii => $iiSpec) {
                //---
                foreach ($gateMainToItems as $gmti) {
                    $iiSpec[$gmti] = isset($mainData[$gmti]) ? $mainData[$gmti] : "";
                }
                //---
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                //---
                foreach ($sourceDetail_rev['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail_rev[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail_rev[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail_rev['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail_rev[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail_rev[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail_rev[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail_rev[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail_rev[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail_rev[$ii]['static']['dtime'] = $mainData['dtime'];
                //---
                foreach ($targetDetail_rev['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail_rev[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail_rev[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail_rev['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail_rev[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail_rev[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail_rev[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail_rev[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail_rev[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail_rev[$ii]['static']['dtime'] = $mainData['dtime'];
                //---
            }
            //------------------------------------

            //region MASTER
            cekHitam("MAIN JALAN REGULER");
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            cekHitam("MAIN JALAN REVERT");
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource_rev);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget_rev);
            $rt->exec();
            //endregion

            //region DETAIL
            cekHitam("DETAIL JALAN REGULER");
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            cekHitam("DETAIL JALAN REVERT");
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail_rev);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail_rev);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");


        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");


    }

    //endregion


    //region non akunting purchasing SUPPLIES
    // running cli realtime
    public function generateNonAkuntingAllPurchaseSupplies()
    {
//        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "461";
        $divID = "18";
        $arrJenis = array("461ro", "461r", "461");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
        //        arrPrintPink($tmpHist);
        //mati_disini();
        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {
            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
                    //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------
            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }

            switch ($jenisTransaksi) {
                case "461ro":
                    $sourceMain = array(
                        "loop" => array(
                            "461ro" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "461r" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "461ro" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "461r" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    break;
                case "461r":
                    $sourceMain = array(
                        "loop" => array(
                            "461r" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "461" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "461r" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "461" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    break;
                case "461":
                    $sourceMain = array(
                        "loop" => array(
                            "461" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            //                            "dtime_order" => "dtime",
                            //                            "dtime_kirim" => "dtime",
                            "dtime_terima" => "dtime",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "461ro" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            //                            "oleh_id" => "m_olehID",
                            //                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            //                            "dtime_order" => "dtime",
                            //                            "dtime_kirim" => "dtime",
                            "dtime_terima" => "dtime",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "461" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            //                            "dtime_order" => "dtime",
                            //                            "dtime_kirim" => "dtime",
                            "dtime_terima" => "dtime",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "461ro" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            //                            "oleh_id" => "olehID",
                            //                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "update_lap" => false,
                            //                            "dtime_order" => "dtime",
                            //                            "dtime_kirim" => "dtime",
                            "dtime_terima" => "dtime",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
            //            arrPrint($trDatas);
            //            arrPrint($items);
//            arrPrint($trDatas);
//            mati_disini();

            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");


        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");


    }

    public function generateNonAkuntingAllPurchaseRejectSupplies()
    {
//        header("refresh:2");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "461";
        $divID = "18";
        $arrJenis = array("461ro", "461r");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting_reject=0");
        $tr->addFilter("trash_4=1");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
        //        arrPrintPink($tmpHist);
        //mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
                    //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------

            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "cancel_dtime" => "cancel_dtime",
                "cancel_name" => "cancel_name",
                "cancel_id" => "cancel_id",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }

            switch ($jenisTransaksi) {
                case "461ro":
                    $sourceMain = array(
                        "loop" => array(
                            "461r" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "461ro" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "461r" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "461ro" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    break;
                case "461r":
                    $sourceMain = array(
                        "loop" => array(
                            "461" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "461r" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "461" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "461r" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
            //            arrPrint($trDatas);
            //            arrPrint($items);

            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            $gateSource['static']['dtime_reject'] = $mainData['cancel_dtime'];
            $gateSource['static']['oleh_id_reject'] = $mainData['cancel_name'];
            $gateSource['static']['oleh_nama_reject'] = $mainData['cancel_id'];

            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            $gateSource['static']['dtime_reject'] = $mainData['cancel_dtime'];
            $gateSource['static']['oleh_id_reject'] = $mainData['cancel_name'];
            $gateSource['static']['oleh_nama_reject'] = $mainData['cancel_id'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                $gateSourceDetail[$ii]['static']['dtime_reject'] = $mainData['cancel_dtime'];
                $gateSourceDetail[$ii]['static']['oleh_id_reject'] = $mainData['cancel_name'];
                $gateSourceDetail[$ii]['static']['oleh_nama_reject'] = $mainData['cancel_id'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
                $gateTargetDetail[$ii]['static']['dtime_reject'] = $mainData['cancel_dtime'];
                $gateTargetDetail[$ii]['static']['oleh_id_reject'] = $mainData['cancel_name'];
                $gateTargetDetail[$ii]['static']['oleh_nama_reject'] = $mainData['cancel_id'];
            }
            //------------------------------------

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting_reject" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    // belum final
    public function generateNonAkuntingAllPurchaseClosedSupplies()
    {
        //        header("refresh:3");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "1961";
        $divID = "18";
        $arrJenis = array("1961", "1961a");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
        //arrPrint($tmpHist);


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
                    //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------


            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }


            //transaksi yang direturn-------
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id='" . $trDatas['m_masterID'] . "'");
            $trRtnTmp = $tr->lookupAll()->result();
            showLast_query("kuning");
            if (sizeof($trRtnTmp) > 0) {
                foreach ($trRtnTmp[0] as $rtn_key => $rtn_val) {
                    $trDatas["cls_" . $rtn_key] = $rtn_val;
                }
            }
            //-------
//            arrPrintWebs($trDatas);
//            mati_disini();

            $addMain = array(
                "seller_id" => "cls_seller_id",
                "seller_nama" => "cls_seller_nama",
                "sellerID" => "cls_seller_id",
                "sellerName" => "cls_seller_nama",
            );
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "rtn_id_master" => "rtn_id_master",
                "seller_id" => "cls_seller_id",
                "seller_nama" => "cls_seller_nama",
                "sellerID" => "cls_seller_id",
                "sellerName" => "cls_seller_nama",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            foreach ($addMain as $akey => $aval) {
                $trDatas[$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
            }
//
//            arrPrintWebs($trDatas);
//            arrPrintHijau($items);
//            mati_disini(__LINE__);
//
            switch ($jenisTransaksi) {
                case "1961":
                    $sourceMain = array(
                        "loop" => array(
                            "1961" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "cls_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "1961a" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "cls_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "1961" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "1961a" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
                            "dtime_order" => "dtime",
                            "dtime_kirim" => ".0",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    break;
                case "1961a":
                    $sourceMain = array(
                        "loop" => array(
                            "1961" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "cls_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "1961a" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga_disc",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "cls_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "1961" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "1961a" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga_disc",
                            "harga_nppn" => "hpp_nppn",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "ppv_nilai" => "ppv",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "masterID",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
//                            "transaksi_tipe" => ".reguler",
                            //                            "dtime_order" => "dtime",
                            "dtime_kirim" => "dtime",
                            "dtime_terima" => ".0",
                            "transaksi_tipe" => ".closed",
                        ),
                    );
                    break;
                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }
            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------
            //arrPrint($gateTargetDetail);
            //mati_disini(":: SETOP ::");

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }

    public function generateNonAkuntingAllPurchaseReturnSupplies()
    {
        //        header("refresh:3");

        $this->load->model("Coms/ComRekeningTransaksi");
        $this->load->model("Coms/ComRekeningTransaksiJenis");
        $this->load->model("Coms/ComRekeningTransaksiPembantu");
        $this->load->model("MdlTransaksi");

        $jenisMaster = "961";
        $divID = "18";
        $arrJenis = array("961r", "961");

        $tr = new MdlTransaksi();
        $tr->addFilter("div_id='$divID'");
        $tr->addFilter("jenis_master='$jenisMaster'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tr->addFilter("id_master>0");
        $tr->addFilter("non_akunting=0");
        $tr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $tmpHist = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHitam(sizeof($tmpHist));
        //        arrPrintPink($tmpHist);
        //mati_disini();


        $this->db->trans_start();


        $trDatas = array();
        if (sizeof($tmpHist) > 0) {

            foreach ($tmpHist[0] as $key => $val) {
                $trDatas[$key] = $val;
            }
            cekHitam(":: " . $tmpHist[0]->id);
            $trID = $tmpHist[0]->id;
            $masterID = $tmpHist[0]->id_master;
            $masterJenis = $tmpHist[0]->jenis_master;
            $jenisTransaksi = $tmpHist[0]->jenis;
            $counters = $tmpHist[0]->counters;
            //----------------------------
            $ids_his = $tmpHist[0]->ids_his != NULL ? blobDecode($tmpHist[0]->ids_his) : array();
            $ids_his_data = array();
            if (sizeof($ids_his) > 0) {
                foreach ($ids_his as $step => $hisSpec) {
                    $aa = "_step_" . $step . "_nomer";
                    $bb = "_step_" . $step . "_olehID";
                    $cc = "_step_" . $step . "_olehName";
                    $trDatas[$aa] = $hisSpec['nomer'];
                    $trDatas[$bb] = $hisSpec['olehID'];
                    $trDatas[$cc] = $hisSpec['olehName'];
                }
            }
            $cContent = blobDecode($tmpHist[0]->counters);
            $arrIndexVal = array();
            foreach ($cContent as $counterKey => $counterData) {
                $counterIndexKey = "_" . str_replace("|", "_", $counterKey);
                foreach ($counterData as $key => $index_conter) {
                    //                    $arrIndexVal[$counterIndexKey] = $index_conter;
                    $trDatas[$counterIndexKey] = $index_conter;
                }
            }
            //----------------------------


            // registry main dan items
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main, items");
            $tr->addFilter("transaksi_id='$trID'");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("kuning");
            $trRegResult = array();
            foreach ($trReg as $regSpec) {
                $trRegResult[$regSpec->transaksi_id] = array(
                    "main" => blobDecode($regSpec->main),
                    "items" => blobDecode($regSpec->items),
                );
            }
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['main'] as $mkey => $mval) {
                    $trDatas["m_" . $mkey] = $mval;
                }
            }

            //transaksi yang direturn-------
            $tr = new MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id='" . $trDatas['m_referenceID'] . "'");
            $trRtnTmp = $tr->lookupAll()->result();
            if (sizeof($trRtnTmp) > 0) {
                foreach ($trRtnTmp[0] as $rtn_key => $rtn_val) {
                    $trDatas["rtn_" . $rtn_key] = $rtn_val;
                }
            }
            //-------

            $addMain = array(
                "seller_id" => "rtn_seller_id",
                "seller_nama" => "rtn_seller_nama",
                "sellerID" => "rtn_seller_id",
                "sellerName" => "rtn_seller_nama",
            );
            $addItems = array(
                "id_master" => "id_master",
                "_stepCode_placeID" => "_stepCode_placeID",
                "_stepCode_olehID" => "_stepCode_olehID",
                "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                "_stepCode_customerID" => "_stepCode_customerID",
                "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                "_stepCode" => "_stepCode",
                "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                "_stepCode_supplierID" => "_stepCode_supplierID",
                "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                "_step_1_nomer" => "_step_1_nomer",
                "_step_1_olehName" => "_step_1_olehName",
                "_step_2_nomer" => "_step_2_nomer",
                "_step_2_olehName" => "_step_2_olehName",
                "_step_3_nomer" => "_step_3_nomer",
                "_step_3_olehName" => "_step_3_olehName",
                "_step_4_nomer" => "_step_4_nomer",
                "_step_4_olehName" => "_step_4_olehName",
                "_step_5_nomer" => "_step_5_nomer",
                "_step_5_olehName" => "_step_5_olehName",
                "rtn_id_master" => "rtn_id_master",
                "seller_id" => "rtn_seller_id",
                "seller_nama" => "rtn_seller_nama",
                "sellerID" => "rtn_seller_id",
                "sellerName" => "rtn_seller_nama",
            );
            $items = array();
            foreach ($trRegResult as $trid => $regSpec) {
                foreach ($regSpec['items'] as $mkey => $mSpec) {
                    $items[$mkey] = $mSpec;
                    foreach ($addItems as $akey => $aval) {
                        $items[$mkey][$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
                    }
                }
            }
            foreach ($addMain as $akey => $aval) {
                $trDatas[$akey] = isset($trDatas[$aval]) ? $trDatas[$aval] : "";
            }

//            arrPrintWebs($trDatas);
//            arrPrintHijau($items);
//            mati_disini(__LINE__);

            switch ($jenisTransaksi) {
                case "961r":
                    $sourceMain = array(
                        "loop" => array(
                            "961r" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "961" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "961r" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga",
                            "harga_nppn" => "hpp_nppn",
                            "ppv_nilai" => "ppv",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "961" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga",
                            "harga_nppn" => "hpp_nppn",
                            "ppv_nilai" => "ppv",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;
                case "961":
                    $sourceMain = array(
                        "loop" => array(
                            "961" => "m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "transaksi_id" => "id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetMain = array(
                        "loop" => array(
                            "961r" => "-m_harga",
                        ),
                        "static" => array(
                            "cabang_id" => "m_placeID",
                            "cabang_nama" => "m_placeName",
                            "gudang_id" => "m_gudangID",
                            "gudang_nama" => "m_gudangName",
                            "rekening_nama" => "m_sourceJenisLabel",
                            "produk_qty" => "qty",
                            "produk_nilai" => "m_harga",
                            "harga_bruto" => "m_harga",
                            "ppn_nilai" => "m_ppn",
                            "harga_netto" => "m_harga",
                            "harga_nppn" => "m_hpp_nppn",
                            "diskon_nilai" => "m_disc",
                            "premi_nilai" => "m_premi",
                            "ppv_nilai" => "m_ppv",
                            "ongkir_nilai" => "m_shipping_service",
                            "extern_id" => "rtn_id_master",
                            "extern_nama" => "nomer",
                            "satuan" => "satuan",
                            "oleh_id" => "m_olehID",
                            "oleh_nama" => "m_olehName",
                            "seller_id" => "m_sellerID",
                            "seller_nama" => "m_sellerName",
                            "customer_id" => "m_pihakID",
                            "customer_nama" => "m_pihakName",
                            "supplier_id" => "m_pihakID",
                            "supplier_nama" => "m_pihakName",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            "jenis" => "jenis",
                            "step_current" => "step_number",
                            "step_number" => "step_current",
                            "next_step_num" => "next_step_num",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "rel_target_jenis" => ".0",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $sourceDetail = array(
                        "loop" => array(
                            "961" => "sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga",
                            "harga_nppn" => "hpp_nppn",
                            "ppv_nilai" => "ppv",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    $targetDetail = array(
                        "loop" => array(
                            "961r" => "-sub_harga",
                        ),
                        "static" => array(
                            "rekening_nama" => "sourceJenisLabel",
                            "cabang_id" => "placeID",
                            "gudang_id" => "gudangID",
                            "gudang_nama" => "gudangName",
                            "cabang_nama" => "placeName",
                            "produk_qty" => "-qty",
                            "produk_nilai" => "harga",
                            "harga_bruto" => "harga",
                            "ppn_nilai" => "ppn",
                            "harga_netto" => "harga",
                            "harga_nppn" => "hpp_nppn",
                            "ppv_nilai" => "ppv",
                            "diskon_nilai" => "disc",
                            "premi_nilai" => "premi",
                            "extern_id" => "id",
                            "extern_nama" => "name",
                            "extern2_id" => "id_master",
                            "extern2_nama" => ".0",
                            "produk_kode" => "code",
                            "produk_part" => "no_part",
                            "produk_label" => "label",
                            "produk_jenis" => "jenis",
                            "produk_satuan" => "satuan",
                            "satuan" => "satuan",
                            "oleh_id" => "olehID",
                            "oleh_nama" => "olehName",
                            "seller_id" => "sellerID",
                            "seller_nama" => "sellerName",
                            "customer_id" => "pihakID",
                            "customer_nama" => "pihakName",
                            "supplier_id" => "pihakID",
                            "supplier_nama" => "pihakName",
                            //                            "transaksi_id" => "transaksi_id",
                            "master_id" => "rtn_id_master",
                            "master_jenis" => "jenis_master",
                            //------
                            "_stepCode_placeID" => "_stepCode_placeID",
                            "_stepCode_olehID" => "_stepCode_olehID",
                            "_stepCode_placeID_olehID" => "_stepCode_placeID_olehID",
                            "_stepCode_placeID_olehID_customerID" => "_stepCode_placeID_olehID_customerID",
                            "_stepCode_customerID" => "_stepCode_customerID",
                            "_stepCode_placeID_customerID" => "_stepCode_placeID_customerID",
                            "_stepCode_olehID_customerID" => "_stepCode_olehID_customerID",
                            "_stepCode" => "_stepCode",
                            "_stepCode_placeID_olehID_supplierID" => "_stepCode_placeID_olehID_supplierID",
                            "_stepCode_supplierID" => "_stepCode_supplierID",
                            "_stepCode_placeID_supplierID" => "_stepCode_placeID_supplierID",
                            "_stepCode_olehID_supplierID" => "_stepCode_olehID_supplierID",
                            //------
                            //                "dtime_order" => "dtime",
                            //                "dtime_kirim" => "shippingDate",
                            //                "dtime_terima" => "",
                            "_step_1_nomer" => "_step_1_nomer",
                            "_step_1_olehName" => "_step_1_olehName",
                            "_step_2_nomer" => "_step_2_nomer",
                            "_step_2_olehName" => "_step_2_olehName",
                            "_step_3_nomer" => "_step_3_nomer",
                            "_step_3_olehName" => "_step_3_olehName",
                            "_step_4_nomer" => "_step_4_nomer",
                            "_step_4_olehName" => "_step_4_olehName",
                            "_step_5_nomer" => "_step_5_nomer",
                            "_step_5_olehName" => "_step_5_olehName",
                            "transaksi_tipe" => ".reguler",
                        ),
                    );
                    break;

                default:

                    mati_disini(":: $jenisTransaksi ::");

                    break;
            }


            //------------------------------------
            $mainData = $trDatas;
            $gateSource = array();
            $gateTarget = array();
            foreach ($sourceMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateSource['loop'][$key] = $newVal_result;
                }
            }
            foreach ($sourceMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateSource['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateSource['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateSource['static']['transaksi_id'] = $mainData['id'];
            $gateSource['static']['fulldate'] = $mainData['fulldate'];
            $gateSource['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            foreach ($targetMain['loop'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['loop'][$key] = "-" . $newVal_result;
                }
                else {
                    $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                    $gateTarget['loop'][$key] = $newVal_result;
                }
            }
            foreach ($targetMain['static'] as $key => $val) {
                if (substr($val, 0, 1) == "-") {
                    $newVal = str_replace("-", "", $val);
                    $newVal_result = isset($mainData[$newVal]) ? $mainData[$newVal] : 0;
                    $gateTarget['static'][$key] = "-" . $newVal_result;
                }
                else {
                    if (substr($val, 0, 1) == ".") {
                        $newVal = str_replace(".", "", $val);
                        $newVal_result = $newVal;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                    else {
                        $newVal_result = isset($mainData[$val]) ? $mainData[$val] : 0;
                        $gateTarget['static'][$key] = $newVal_result;
                    }
                }
            }
            $gateTarget['static']['transaksi_id'] = $mainData['id'];
            $gateTarget['static']['fulldate'] = $mainData['fulldate'];
            $gateTarget['static']['dtime'] = $mainData['dtime'];
            //------------------------------------
            $gateSourceDetail = array();
            $gateTargetDetail = array();
            foreach ($items as $ii => $iiSpec) {
                foreach ($sourceDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateSourceDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($sourceDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateSourceDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateSourceDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateSourceDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateSourceDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateSourceDetail[$ii]['static']['dtime'] = $mainData['dtime'];

                foreach ($targetDetail['loop'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = "-" . $newVal_result;
                    }
                    else {
                        $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                        $gateTargetDetail[$ii]['loop'][$key] = $newVal_result;
                    }
                }
                foreach ($targetDetail['static'] as $key => $val) {
                    if (substr($val, 0, 1) == "-") {
                        $newVal = str_replace("-", "", $val);
                        $newVal_result = isset($iiSpec[$newVal]) ? $iiSpec[$newVal] : 0;
                        $gateTargetDetail[$ii]['static'][$key] = "-" . $newVal_result;
                    }
                    else {
                        if (substr($val, 0, 1) == ".") {
                            $newVal = str_replace(".", "", $val);
                            $newVal_result = $newVal;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                        else {
                            $newVal_result = isset($iiSpec[$val]) ? $iiSpec[$val] : 0;
                            $gateTargetDetail[$ii]['static'][$key] = $newVal_result;
                        }
                    }
                }
                $gateTargetDetail[$ii]['static']['transaksi_id'] = $mainData['id'];
                $gateTargetDetail[$ii]['static']['fulldate'] = $mainData['fulldate'];
                $gateTargetDetail[$ii]['static']['dtime'] = $mainData['dtime'];
            }
            //------------------------------------
            //arrPrint($gateTargetDetail);
            //mati_disini(":: SETOP ::");

            //region MASTER
            $rt = New ComRekeningTransaksi();
            $rt->pair($gateSource);
            $rt->exec();

            $rt = New ComRekeningTransaksi();
            $rt->pair($gateTarget);
            $rt->exec();
            //endregion

            //region DETAIL
            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateSourceDetail);
            $rt->exec();

            $rt = New ComRekeningTransaksiPembantu();
            $rt->pair($gateTargetDetail);
            $rt->exec();
            //endregion


            $tr = new MdlTransaksi();
            $updateData = array(
                "non_akunting" => "1",
            );
            $updateWhere = array(
                "id" => $trID
            );
            $tr->updateData($updateWhere, $updateData);
            showLast_query("orange");

        }


//        mati_disini(" OHOOOO ");

        $this->db->trans_complete();
        cekHijau("<h2>-- DONE --</h2>");

    }
    //endregion


    // generate detail laba lain-lain
    public function generateLR_lain_lain()
    {
        //        header("refresh:3");


        $this->load->model("MdlTransaksi");
        $tr = New MdlTransaksi();

        $getMode = $_GET['mode'];
        $tbl = "__rek_master__laba_lain_lain";
        $tbl_target = "z_tabel_lr_lain_lain";

        $this->db->trans_start();

        if ($getMode == 1) {

            $this->db->select("*");
            $this->db->where(array(
                "transaksi_id>" => "0"
            ));
            $this->db->where("fulldate>='2022-01-01'");
            $this->db->where("fulldate<'2022-04-01'");
            $this->db->order_by("id", "ASC");
            $tmp = $this->db->get($tbl)->result();
            showlast_query("biru");
            //            arrPrint($tmp);

            foreach ($tmp as $spec) {
                $data = array(
                    "id_tabel" => $spec->id,
                    "status" => "0",
                );
                $this->db->insert($tbl_target, $data);
                showlast_query("kuning");

            }
            //            mati_disini("-- setop mode 1 --");
        }
        else {
            $this->load->helper("he_mass_table_helper");
            $this->load->model("Coms/ComRekeningPembantuLRLainlain");

            //------------------------
            $arrJenisTr = array(
                "1118" => array(
                    "id" => "1",
                    "nama" => "opname supplies",
                ),
                "1119" => array(
                    "id" => "2",
                    "nama" => "opname produk",
                ),
                "2229" => array(
                    "id" => "2",
                    "nama" => "opname produk",
                ),
                "382spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "582spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "588spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "777_1" => array(
                    "id" => "4",
                    "nama" => "adjustment",
                ),
                "8789" => array(
                    "id" => "6",
                    "nama" => "jualbeli aset",
                ),
                "982" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "9911" => array(
                    "id" => "5",
                    "nama" => "pembatalan transaksi",
                ),
                "9912" => array(
                    "id" => "5",
                    "nama" => "pembatalan transaksi",
                ),
                "999" => array(
                    //                    "id" => "4",
                    //                    "nama" => "adjustment",
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "9996" => array(
                    "id" => "4",
                    "nama" => "adjustment",
                ),
                "1463" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
            );
            //------------------------
            $this->db->select("*");
            $this->db->where(array(
                "status" => "0"
                //                "id_tabel<" => "19056"
            ));
            //            $this->db->where("id_tabel='18969'");
            $this->db->order_by("id", "ASC");
            $this->db->limit(1);
            $tmpTbl = $this->db->get($tbl_target)->result();
            showlast_query("biru");

            if (sizeof($tmpTbl) > 0) {
                $tabelID = $tmpTbl[0]->id_tabel;
                //------------------------
                $this->db->select("*");
                $this->db->where(array(
                    "id" => $tabelID
                ));
                $this->db->order_by("id", "ASC");
                $tmp = $this->db->get($tbl)->result();
                showlast_query("biru");
                //                arrPrint($tmp);
                //------------------------

                $debet = $tmp[0]->debet;
                $kredit = $tmp[0]->kredit;
                $cabangID = $tmp[0]->cabang_id;
                $dtime = $tmp[0]->dtime;
                $fulldate = $tmp[0]->fulldate;
                $jenis = $tmp[0]->jenis;
                $transaksiID = $tmp[0]->transaksi_id;
                $transaksiNomer = $tmp[0]->transaksi_no;

                switch ($jenis) {
                    case "9911":
                    case "9912":
                        $tr->setJointSelectFields("main");
                        $tr->setFilters(array());
                        $tr->addFilter("transaksi_id='$transaksiID'");
                        $reg = $tr->lookupDataRegistries()->result();
                        showLast_query("kuning");
                        $main = blobDecode($reg[0]->main);

                        $jenis = $main['pihakExternID'];
                        $detailID = isset($arrJenisTr[$jenis]['id']) ? $arrJenisTr[$jenis]['id'] : 0;
                        $detailNama = isset($arrJenisTr[$jenis]['nama']) ? $arrJenisTr[$jenis]['nama'] : "";

                        break;
                    default:
                        $detailID = isset($arrJenisTr[$jenis]['id']) ? $arrJenisTr[$jenis]['id'] : 0;
                        $detailNama = isset($arrJenisTr[$jenis]['nama']) ? $arrJenisTr[$jenis]['nama'] : "";
                        break;
                }

                $detailID = isset($arrJenisTr[$jenis]['id']) ? $arrJenisTr[$jenis]['id'] : 0;
                $detailNama = isset($arrJenisTr[$jenis]['nama']) ? $arrJenisTr[$jenis]['nama'] : "";

                cekMerah(":: debet-> $debet :: kredit-> $kredit ::");

                if ($debet > 0) {
                    $data = array(
                        "loop" => array(
                            "laba lain lain" => "-$debet",
                        ),
                        "static" => array(
                            "cabang_id" => "$cabangID",
                            "extern_id" => $detailID,
                            "extern_nama" => $detailNama,
                            "jenis" => "$jenis",
                            "transaksi_no" => "$transaksiNomer",
                            "harga" => "$debet",
                            "transaksi_id" => $transaksiID,
                            "fulldate" => $fulldate,
                            "dtime" => $dtime,
                        ),
                    );
                }
                else {
                    $data = array(
                        "loop" => array(
                            "laba lain lain" => "$kredit",
                        ),
                        "static" => array(
                            "cabang_id" => "$cabangID",
                            "extern_id" => $detailID,
                            "extern_nama" => $detailNama,
                            "jenis" => "$jenis",
                            "transaksi_no" => "$transaksiNomer",
                            "harga" => "$kredit",
                            "transaksi_id" => $transaksiID,
                            "fulldate" => $fulldate,
                            "dtime" => $dtime,
                        ),
                    );
                }
                arrPrintPink($data);

                $crpph = New ComRekeningPembantuLRLainlain();
                $crpph->pair($data);
                $crpph->exec();


                $dataUpdate = array(
                    "status" => "1",
                    "dtime" => date("Y-m-d H:i:s")
                );
                $this->db->where(array(
                    "id_tabel" => $tabelID
                ));
                $this->db->update($tbl_target, $dataUpdate);
                showLast_query("ungu");
            }


        }


        mati_disini(" OHOOOO ");
        $this->db->trans_complete();
    }

    public function generateKerugian()
    {
        //        header("refresh:3");


        $this->load->model("MdlTransaksi");
        $tr = New MdlTransaksi();

        $getMode = $_GET['mode'];
        $tbl = "__rek_master__kerugian";
        $tbl_target = "z_tabel_lr_lain_lain";

        $this->db->trans_start();

        if ($getMode == 1) {

            $this->db->select("*");
            $this->db->where(array(
                "transaksi_id>" => "0"
            ));
            $this->db->where("fulldate>='2022-01-01'");
            //            $this->db->where("fulldate<'2022-04-01'");
            $this->db->order_by("id", "ASC");
            $tmp = $this->db->get($tbl)->result();
            showlast_query("biru");
            //            arrPrint($tmp);

            foreach ($tmp as $spec) {
                $data = array(
                    "id_tabel" => $spec->id,
                    "status" => "0",
                );
                $this->db->insert($tbl_target, $data);
                showlast_query("kuning");

            }
            //            mati_disini("-- setop mode 1 --");
        }
        else {
            $this->load->helper("he_mass_table_helper");
            $this->load->model("Coms/ComRekeningPembantuKerugian");

            //------------------------
            $arrJenisTr = array(
                "1118" => array(
                    "id" => "1",
                    "nama" => "opname supplies",
                ),
                "1119" => array(
                    "id" => "2",
                    "nama" => "opname produk",
                ),
                "2229" => array(
                    "id" => "2",
                    "nama" => "opname produk",
                ),
                "382spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "582spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "588spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "777_1" => array(
                    "id" => "4",
                    "nama" => "adjustment",
                ),
                "8789" => array(
                    "id" => "6",
                    "nama" => "jualbeli aset",
                ),
                "982" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "9911" => array(
                    "id" => "5",
                    "nama" => "pembatalan transaksi",
                ),
                "9912" => array(
                    "id" => "5",
                    "nama" => "pembatalan transaksi",
                ),
                "999" => array(
                    //                    "id" => "4",
                    //                    "nama" => "adjustment",
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "9996" => array(
                    "id" => "4",
                    "nama" => "adjustment",
                ),
                "1463" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
            );
            //------------------------
            $this->db->select("*");
            $this->db->where(array(
                "status" => "0"
                //                "id_tabel<" => "19056"
            ));
            //            $this->db->where("id_tabel='18969'");
            $this->db->order_by("id", "ASC");
            $this->db->limit(1);
            $tmpTbl = $this->db->get($tbl_target)->result();
            showlast_query("biru");

            if (sizeof($tmpTbl) > 0) {
                $tabelID = $tmpTbl[0]->id_tabel;
                //------------------------
                $this->db->select("*");
                $this->db->where(array(
                    "id" => $tabelID
                ));
                $this->db->order_by("id", "ASC");
                $tmp = $this->db->get($tbl)->result();
                showlast_query("biru");
                //                arrPrint($tmp);
                //------------------------

                $debet = $tmp[0]->debet;
                $kredit = $tmp[0]->kredit;
                $cabangID = $tmp[0]->cabang_id;
                $dtime = $tmp[0]->dtime;
                $fulldate = $tmp[0]->fulldate;
                $jenis = $tmp[0]->jenis;
                $transaksiID = $tmp[0]->transaksi_id;
                $transaksiNomer = $tmp[0]->transaksi_no;

                switch ($jenis) {
                    case "9911":
                    case "9912":
                        $tr->setJointSelectFields("main");
                        $tr->setFilters(array());
                        $tr->addFilter("transaksi_id='$transaksiID'");
                        $reg = $tr->lookupDataRegistries()->result();
                        showLast_query("kuning");
                        $main = blobDecode($reg[0]->main);

                        $jenis = $main['pihakExternID'];
                        $detailID = isset($arrJenisTr[$jenis]['id']) ? $arrJenisTr[$jenis]['id'] : 0;
                        $detailNama = isset($arrJenisTr[$jenis]['nama']) ? $arrJenisTr[$jenis]['nama'] : "";

                        break;
                    default:
                        $detailID = isset($arrJenisTr[$jenis]['id']) ? $arrJenisTr[$jenis]['id'] : 0;
                        $detailNama = isset($arrJenisTr[$jenis]['nama']) ? $arrJenisTr[$jenis]['nama'] : "";
                        break;
                }

                $detailID = isset($arrJenisTr[$jenis]['id']) ? $arrJenisTr[$jenis]['id'] : 0;
                $detailNama = isset($arrJenisTr[$jenis]['nama']) ? $arrJenisTr[$jenis]['nama'] : "";

                cekMerah(":: debet-> $debet :: kredit-> $kredit ::");

                if ($debet > 0) {
                    $data = array(
                        "loop" => array(
                            "kerugian" => "$debet",
                        ),
                        "static" => array(
                            "cabang_id" => "$cabangID",
                            "extern_id" => $detailID,
                            "extern_nama" => $detailNama,
                            "jenis" => "$jenis",
                            "transaksi_no" => "$transaksiNomer",
                            "harga" => "$debet",
                            "transaksi_id" => $transaksiID,
                            "fulldate" => $fulldate,
                            "dtime" => $dtime,
                        ),
                    );
                }
                else {
                    $data = array(
                        "loop" => array(
                            "kerugian" => "-$kredit",
                        ),
                        "static" => array(
                            "cabang_id" => "$cabangID",
                            "extern_id" => $detailID,
                            "extern_nama" => $detailNama,
                            "jenis" => "$jenis",
                            "transaksi_no" => "$transaksiNomer",
                            "harga" => "$kredit",
                            "transaksi_id" => $transaksiID,
                            "fulldate" => $fulldate,
                            "dtime" => $dtime,
                        ),
                    );
                }
                arrPrintPink($data);

                $crpph = New ComRekeningPembantuKerugian();
                $crpph->pair($data);
                $crpph->exec();


                $dataUpdate = array(
                    "status" => "1",
                    "dtime" => date("Y-m-d H:i:s")
                );
                $this->db->where(array(
                    "id_tabel" => $tabelID
                ));
                $this->db->update($tbl_target, $dataUpdate);
                showLast_query("ungu");
            }


        }


        mati_disini(" OHOOOO ");
        $this->db->trans_complete();
    }

    public function generateDPP_PPN_PYM_SRC()
    {
        $this->load->model("MdlTransaksi");

        $jenisTarget = "749";

        $tr = new MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("sisa>1000");
        $tmpSrc = $tr->lookupPaymentSrcByJenis($jenisTarget)->result();
        showLast_query("biru");
        cekBiru(sizeof($tmpSrc));
        if (sizeof($tmpSrc) > 0) {
            //            arrPrintWebs($tmpSrc);
            $trIDs = array();
            foreach ($tmpSrc as $spec) {
                $trIDs[$spec->id] = $spec->transaksi_id;
            }
            //            arrPrint($trIDs);

            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields(array("transaksi_id", "main"));
            $tr->addFilter("transaksi_id in ('" . implode("','", $trIDs) . "')");
            $trReg = $tr->lookupDataRegistries()->result();
            showLast_query("merah");
            $regData = array();
            foreach ($trReg as $regSpec) {
                $trID = $regSpec->transaksi_id;
                $trMain = blobDecode($regSpec->main);
                if (is_array($trMain)) {
                    $regData[$trID] = array(
                        "dpp_ppn" => isset($trMain['dpp_ppn']) ? $trMain['dpp_ppn'] : $trMain['nett1'],
                        "ppn" => isset($trMain['ppn']) ? $trMain['ppn'] : 0,
                    );
                }
                else {
                    $newTrMain = blobDecode($trMain);
                    $regData[$trID] = array(
                        "dpp_ppn" => isset($newTrMain['dpp_ppn']) ? $newTrMain['dpp_ppn'] : $newTrMain['nett1'],
                        "ppn" => isset($newTrMain['ppn']) ? $newTrMain['ppn'] : 0,
                    );
                }
            }

            arrPrint($regData);
            $this->db->trans_start();

            foreach ($trIDs as $tbl_id => $tr_id) {
                $dpp_ppn = isset($regData[$tr_id]['dpp_ppn']) ? $regData[$tr_id]['dpp_ppn'] : 0;
                $ppn = isset($regData[$tr_id]['ppn']) ? $regData[$tr_id]['ppn'] : 0;

                $dataUpdate = array(
                    "dpp_ppn" => $dpp_ppn,
                    "ppn" => $ppn,
                );
                $where = array(
                    "id" => $tbl_id
                );
                $tr = New MdlTransaksi();
                $tr->setFilters(array());
                $tr->updatePaymentSrc($where, $dataUpdate);
                showLast_query("kuning");
            }


            mati_disini(" OHOOOO ");
            $this->db->trans_complete();


        }

    }

    //-------------------------------------------------
    // generate detail penjualan customer
    public function generatePenjualan()
    {
        header("refresh:3");

        $this->load->model("MdlTransaksi");
        $tr = New MdlTransaksi();

        $getMode = $_GET['mode'];
        $tbl = "__rek_master__penjualan";
        $tbl_target = "z_tabel_lr_lain_lain";

        $this->db->trans_start();
        $penjualan = "penjualan";
        if ($getMode == 1) {

            $this->db->select("*");
            $this->db->where(array(
                "transaksi_id>" => "0"
            ));
            $this->db->where("fulldate>='2022-01-01'");
            //            $this->db->where("fulldate<'2022-04-01'");
            $this->db->order_by("id", "ASC");
            $tmp = $this->db->get($tbl)->result();
            showlast_query("biru");
            //            arrPrint($tmp);

            $penjualan = "penjualan";
            foreach ($tmp as $spec) {
                $id = $spec->id;

                //------------------
                $this->db->select("*");
                $this->db->where("id_tabel='$id'");
                $this->db->where("rekening='$penjualan'");
                $this->db->order_by("id", "ASC");
                $tmpCek = $this->db->get($tbl_target)->result();
                if (sizeof($tmpCek) == 0) {
                    //------------------
                    $data = array(
                        "id_tabel" => $id,
                        "status" => "0",
                        "rekening" => $penjualan,
                    );
                    $this->db->insert($tbl_target, $data);
                    showlast_query("kuning");
                    //------------------
                }

            }
            //            mati_disini("-- setop mode 1 --");
        }
        else {
            $this->load->helper("he_mass_table_helper");
            $this->load->model("Coms/ComRekeningPembantuPenjualan");
            $this->load->model("Coms/ComRekeningPembantuPenjualanSeller");
            $this->load->model("Coms/ComRekeningPembantuPenjualanKonsumen");

            //------------------------
            $arrJenisTr = array(
                "1118" => array(
                    "id" => "1",
                    "nama" => "opname supplies",
                ),
                "1119" => array(
                    "id" => "2",
                    "nama" => "opname produk",
                ),
                "2229" => array(
                    "id" => "2",
                    "nama" => "opname produk",
                ),
                "382spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "582spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "588spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "777_1" => array(
                    "id" => "4",
                    "nama" => "adjustment",
                ),
                "8789" => array(
                    "id" => "6",
                    "nama" => "jualbeli aset",
                ),
                "982" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "9911" => array(
                    "id" => "5",
                    "nama" => "pembatalan transaksi",
                ),
                "9912" => array(
                    "id" => "5",
                    "nama" => "pembatalan transaksi",
                ),
                "999" => array(
                    //                    "id" => "4",
                    //                    "nama" => "adjustment",
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "9996" => array(
                    "id" => "4",
                    "nama" => "adjustment",
                ),
                "1463" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
            );
            //------------------------
            $this->db->select("*");
            $this->db->where(array(
                "status" => "0",
                "rekening" => "$penjualan",
                //                "id_tabel<" => "19056"
            ));
            //            $this->db->where("id_tabel='1309'");
            $this->db->order_by("id", "ASC");
            $this->db->limit(1);
            $tmpTbl = $this->db->get($tbl_target)->result();
            showlast_query("biru");

            if (sizeof($tmpTbl) > 0) {
                $tabelID = $tmpTbl[0]->id_tabel;
                //------------------------
                $this->db->select("*");
                $this->db->where(array(
                    "id" => $tabelID
                ));
                $this->db->order_by("id", "ASC");
                $tmp = $this->db->get($tbl)->result();
                showlast_query("orange");
                //                arrPrint($tmp);
                //------------------------

                $debet = $tmp[0]->debet;
                $kredit = $tmp[0]->kredit;
                $cabangID = $tmp[0]->cabang_id;
                $dtime = $tmp[0]->dtime;
                $fulldate = $tmp[0]->fulldate;
                $jenis = $tmp[0]->jenis;
                $transaksiID = $tmp[0]->transaksi_id;
                $transaksiNomer = $tmp[0]->transaksi_no;

                $tr->setJointSelectFields("main");
                $tr->setFilters(array());
                $tr->addFilter("transaksi_id='$transaksiID'");
                $reg = $tr->lookupDataRegistries()->result();
                showLast_query("kuning");
                $main = blobDecode($reg[0]->main);

                switch ($jenis) {
                    case "9911":
                    case "9912":
                        $referenceID = $main['referenceID'];
                        $tr->setJointSelectFields("main");
                        $tr->setFilters(array());
                        $tr->addFilter("transaksi_id='$referenceID'");
                        $reg = $tr->lookupDataRegistries()->result();
                        showLast_query("kuning");
                        $mainReg = blobDecode($reg[0]->main);
                        arrPrintPink($mainReg);

                        //                        $detailID = isset($mainReg['pihakID']) ? $mainReg['pihakID'] : 0;
                        //                        $detailNama = isset($mainReg['pihakName']) ? $mainReg['pihakName'] : "";

                        $mainJenisTr = $mainReg['jenisTr'];
                        switch ($mainJenisTr) {
                            case "582spd":
                                $detailID = isset($main['pihakID']) ? $main['pihakID'] : 0;
                                $detailNama = isset($main['pihakName']) ? $main['pihakName'] : "";
                                $sellerID = isset($main['sellerID']) ? $main['sellerID'] : 0;
                                $sellerNama = isset($main['sellerName']) ? $main['sellerName'] : "";
                                if ($sellerID == 0) {
                                    $tr = New MdlTransaksi();
                                    $tr->addFilter("id='$transaksiID'");
                                    $trTmp = $tr->lookupAll()->result();

                                    $idsHis = blobDecode($trTmp[0]->ids_his);
                                    $sellerID = isset($idsHis[1]['olehID']) ? $idsHis[1]['olehID'] : 0;
                                    $sellerNama = isset($idsHis[1]['olehName']) ? $idsHis[1]['olehName'] : "";


                                }

                                if ($debet > 0) {
                                    $data = array(
                                        "loop" => array(
                                            "penjualan" => "-$debet",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "1",
                                            "extern_nama" => "lokal",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$debet",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    $data_konsumen = array(
                                        "loop" => array(
                                            "penjualan" => "-$debet",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "1",
                                            "extern_nama" => "lokal",
                                            "extern2_id" => "$detailID",
                                            "extern2_nama" => "$detailNama",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$debet",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    $data_seller = array(
                                        "loop" => array(
                                            "penjualan" => "-$debet",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "1",
                                            "extern_nama" => "lokal",
                                            "extern2_id" => "$sellerID",
                                            "extern2_nama" => "$sellerNama",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$debet",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                }
                                else {
                                    $data = array(
                                        "loop" => array(
                                            "penjualan" => "$kredit",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "1",
                                            "extern_nama" => "lokal",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$kredit",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    $data_konsumen = array(
                                        "loop" => array(
                                            "penjualan" => "$kredit",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "1",
                                            "extern_nama" => "lokal",
                                            "extern2_id" => "$detailID",
                                            "extern2_nama" => "$detailNama",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$kredit",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    $data_seller = array(
                                        "loop" => array(
                                            "penjualan" => "$kredit",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "1",
                                            "extern_nama" => "lokal",
                                            "extern2_id" => "$sellerID",
                                            "extern2_nama" => "$sellerNama",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$kredit",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                }
                                arrPrintPink($data);

                                //--------------
                                $crpph = New ComRekeningPembantuPenjualan();
                                $crpph->pair($data);
                                $crpph->exec();
                                //--------------
                                $crps = New ComRekeningPembantuPenjualanSeller();
                                $crps->pair($data_seller);
                                $crps->exec();
                                //--------------
                                $crpk = New ComRekeningPembantuPenjualanKonsumen();
                                $crpk->pair($data_konsumen);
                                $crpk->exec();
                                //--------------


                                break;
                            case "382spd":
                                $detailID = isset($main['pihakID']) ? $main['pihakID'] : 0;
                                $detailNama = isset($main['pihakName']) ? $main['pihakName'] : "";
                                $sellerID = isset($main['sellerID']) ? $main['sellerID'] : 0;
                                $sellerNama = isset($main['sellerName']) ? $main['sellerName'] : "";
                                if ($sellerID == 0) {
                                    $tr = New MdlTransaksi();
                                    $tr->addFilter("id='$transaksiID'");
                                    $trTmp = $tr->lookupAll()->result();

                                    $idsHis = blobDecode($trTmp[0]->ids_his);
                                    $sellerID = isset($idsHis[1]['olehID']) ? $idsHis[1]['olehID'] : 0;
                                    $sellerNama = isset($idsHis[1]['olehName']) ? $idsHis[1]['olehName'] : "";


                                }

                                if ($debet > 0) {
                                    $data = array(
                                        "loop" => array(
                                            "penjualan" => "-$debet",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "2",
                                            "extern_nama" => "export",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$debet",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    $data_konsumen = array(
                                        "loop" => array(
                                            "penjualan" => "-$debet",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "2",
                                            "extern_nama" => "export",
                                            "extern2_id" => "$detailID",
                                            "extern2_nama" => "$detailNama",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$debet",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    $data_seller = array(
                                        "loop" => array(
                                            "penjualan" => "-$debet",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "2",
                                            "extern_nama" => "export",
                                            "extern2_id" => "$sellerID",
                                            "extern2_nama" => "$sellerNama",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$debet",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                }
                                else {
                                    $data = array(
                                        "loop" => array(
                                            "penjualan" => "$kredit",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "2",
                                            "extern_nama" => "export",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$kredit",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    $data_konsumen = array(
                                        "loop" => array(
                                            "penjualan" => "$kredit",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "2",
                                            "extern_nama" => "export",
                                            "extern2_id" => "$detailID",
                                            "extern2_nama" => "$detailNama",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$kredit",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    $data_seller = array(
                                        "loop" => array(
                                            "penjualan" => "$kredit",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "2",
                                            "extern_nama" => "export",
                                            "extern2_id" => "$sellerID",
                                            "extern2_nama" => "$sellerNama",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$kredit",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                }
                                arrPrintPink($data);

                                //--------------
                                $crpph = New ComRekeningPembantuPenjualan();
                                $crpph->pair($data);
                                $crpph->exec();
                                //--------------
                                $crps = New ComRekeningPembantuPenjualanSeller();
                                $crps->pair($data_seller);
                                $crps->exec();
                                //--------------
                                $crpk = New ComRekeningPembantuPenjualanKonsumen();
                                $crpk->pair($data_konsumen);
                                $crpk->exec();
                                //--------------


                                break;
                        }

                        //                        mati_disini(":: $mainJenisTr ::");

                        break;
                    case "582spd":
                        $detailID = isset($main['pihakID']) ? $main['pihakID'] : 0;
                        $detailNama = isset($main['pihakName']) ? $main['pihakName'] : "";
                        $sellerID = isset($main['sellerID']) ? $main['sellerID'] : 0;
                        $sellerNama = isset($main['sellerName']) ? $main['sellerName'] : "";
                        if ($sellerID == 0) {
                            $tr = New MdlTransaksi();
                            $tr->addFilter("id='$transaksiID'");
                            $trTmp = $tr->lookupAll()->result();

                            $idsHis = blobDecode($trTmp[0]->ids_his);
                            $sellerID = isset($idsHis[1]['olehID']) ? $idsHis[1]['olehID'] : 0;
                            $sellerNama = isset($idsHis[1]['olehName']) ? $idsHis[1]['olehName'] : "";


                        }

                        if ($debet > 0) {
                            $data = array(
                                "loop" => array(
                                    "penjualan" => "-$debet",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "1",
                                    "extern_nama" => "lokal",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$debet",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            $data_konsumen = array(
                                "loop" => array(
                                    "penjualan" => "-$debet",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "1",
                                    "extern_nama" => "lokal",
                                    "extern2_id" => "$detailID",
                                    "extern2_nama" => "$detailNama",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$debet",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            $data_seller = array(
                                "loop" => array(
                                    "penjualan" => "-$debet",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "1",
                                    "extern_nama" => "lokal",
                                    "extern2_id" => "$sellerID",
                                    "extern2_nama" => "$sellerNama",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$debet",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                        }
                        else {
                            $data = array(
                                "loop" => array(
                                    "penjualan" => "$kredit",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "1",
                                    "extern_nama" => "lokal",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$kredit",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            $data_konsumen = array(
                                "loop" => array(
                                    "penjualan" => "$kredit",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "1",
                                    "extern_nama" => "lokal",
                                    "extern2_id" => "$detailID",
                                    "extern2_nama" => "$detailNama",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$kredit",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            $data_seller = array(
                                "loop" => array(
                                    "penjualan" => "$kredit",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "1",
                                    "extern_nama" => "lokal",
                                    "extern2_id" => "$sellerID",
                                    "extern2_nama" => "$sellerNama",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$kredit",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                        }
                        //                        arrPrintPink($data);
                        //                        arrPrintWebs($data_seller);
                        //                        arrPrint($data_konsumen);

                        //--------------
                        $crpph = New ComRekeningPembantuPenjualan();
                        $crpph->pair($data);
                        $crpph->exec();
                        //--------------
                        $crps = New ComRekeningPembantuPenjualanSeller();
                        $crps->pair($data_seller);
                        $crps->exec();
                        //--------------
                        $crpk = New ComRekeningPembantuPenjualanKonsumen();
                        $crpk->pair($data_konsumen);
                        $crpk->exec();
                        //--------------


                        break;
                    case "382spd":
                        $detailID = isset($main['pihakID']) ? $main['pihakID'] : 0;
                        $detailNama = isset($main['pihakName']) ? $main['pihakName'] : "";
                        $sellerID = isset($main['sellerID']) ? $main['sellerID'] : 0;
                        $sellerNama = isset($main['sellerName']) ? $main['sellerName'] : "";
                        if ($sellerID == 0) {
                            $tr = New MdlTransaksi();
                            $tr->addFilter("id='$transaksiID'");
                            $trTmp = $tr->lookupAll()->result();

                            $idsHis = blobDecode($trTmp[0]->ids_his);
                            $sellerID = isset($idsHis[1]['olehID']) ? $idsHis[1]['olehID'] : 0;
                            $sellerNama = isset($idsHis[1]['olehName']) ? $idsHis[1]['olehName'] : "";


                        }

                        if ($debet > 0) {
                            $data = array(
                                "loop" => array(
                                    "penjualan" => "-$debet",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "2",
                                    "extern_nama" => "export",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$debet",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            $data_konsumen = array(
                                "loop" => array(
                                    "penjualan" => "-$debet",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "2",
                                    "extern_nama" => "export",
                                    "extern2_id" => "$detailID",
                                    "extern2_nama" => "$detailNama",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$debet",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            $data_seller = array(
                                "loop" => array(
                                    "penjualan" => "-$debet",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "2",
                                    "extern_nama" => "export",
                                    "extern2_id" => "$sellerID",
                                    "extern2_nama" => "$sellerNama",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$debet",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                        }
                        else {
                            $data = array(
                                "loop" => array(
                                    "penjualan" => "$kredit",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "2",
                                    "extern_nama" => "export",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$kredit",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            $data_konsumen = array(
                                "loop" => array(
                                    "penjualan" => "$kredit",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "2",
                                    "extern_nama" => "export",
                                    "extern2_id" => "$detailID",
                                    "extern2_nama" => "$detailNama",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$kredit",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            $data_seller = array(
                                "loop" => array(
                                    "penjualan" => "$kredit",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "2",
                                    "extern_nama" => "export",
                                    "extern2_id" => "$sellerID",
                                    "extern2_nama" => "$sellerNama",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$kredit",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                        }
                        arrPrintPink($data);
                        arrPrintWebs($data_seller);
                        arrPrint($data_konsumen);

                        //--------------
                        $crpph = New ComRekeningPembantuPenjualan();
                        $crpph->pair($data);
                        $crpph->exec();
                        //--------------
                        $crps = New ComRekeningPembantuPenjualanSeller();
                        $crps->pair($data_seller);
                        $crps->exec();
                        //--------------
                        $crpk = New ComRekeningPembantuPenjualanKonsumen();
                        $crpk->pair($data_konsumen);
                        $crpk->exec();
                        //--------------


                        break;
                }


                $dataUpdate = array(
                    "status" => "1",
                    "dtime" => date("Y-m-d H:i:s")
                );
                $this->db->where(array(
                    "id_tabel" => $tabelID
                ));
                $this->db->update($tbl_target, $dataUpdate);
                showLast_query("ungu");
            }
            else {
                cekHitam("-- HABIS --");
            }


        }


        //        mati_disini(" OHOOOO ");
        $this->db->trans_complete();
    }

    public function generateHpp()
    {
        header("refresh:3");

        $this->load->model("MdlTransaksi");
        $tr = New MdlTransaksi();

        $getMode = $_GET['mode'];
        $tbl = "__rek_master__hpp";
        $tbl_target = "z_tabel_lr_lain_lain";

        $this->db->trans_start();
        $penjualan = "hpp";
        if ($getMode == 1) {

            $this->db->select("*");
            $this->db->where(array(
                "transaksi_id>" => "0"
            ));
            $this->db->where("fulldate>='2022-01-01'");
            //            $this->db->where("fulldate<'2022-04-01'");
            $this->db->order_by("id", "ASC");
            $tmp = $this->db->get($tbl)->result();
            showlast_query("biru");
            //            arrPrint($tmp);

            $penjualan = "hpp";
            foreach ($tmp as $spec) {
                $id = $spec->id;

                //------------------
                $this->db->select("*");
                $this->db->where("id_tabel='$id'");
                $this->db->where("rekening='$penjualan'");
                $this->db->order_by("id", "ASC");
                $tmpCek = $this->db->get($tbl_target)->result();
                if (sizeof($tmpCek) == 0) {
                    //------------------
                    $data = array(
                        "id_tabel" => $id,
                        "status" => "0",
                        "rekening" => $penjualan,
                    );
                    $this->db->insert($tbl_target, $data);
                    showlast_query("kuning");
                    //------------------
                }

            }
            //            mati_disini("-- setop mode 1 --");
        }
        else {
            $this->load->helper("he_mass_table_helper");
            $this->load->model("Coms/ComRekeningPembantuHpp");
            //            $this->load->model("Coms/ComRekeningPembantuPenjualanSeller");
            //            $this->load->model("Coms/ComRekeningPembantuPenjualanKonsumen");

            //------------------------
            $arrJenisTr = array(
                "1118" => array(
                    "id" => "1",
                    "nama" => "opname supplies",
                ),
                "1119" => array(
                    "id" => "2",
                    "nama" => "opname produk",
                ),
                "2229" => array(
                    "id" => "2",
                    "nama" => "opname produk",
                ),
                "382spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "582spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "588spd" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "777_1" => array(
                    "id" => "4",
                    "nama" => "adjustment",
                ),
                "8789" => array(
                    "id" => "6",
                    "nama" => "jualbeli aset",
                ),
                "982" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "9911" => array(
                    "id" => "5",
                    "nama" => "pembatalan transaksi",
                ),
                "9912" => array(
                    "id" => "5",
                    "nama" => "pembatalan transaksi",
                ),
                "999" => array(
                    //                    "id" => "4",
                    //                    "nama" => "adjustment",
                    "id" => "3",
                    "nama" => "ppv",
                ),
                "9996" => array(
                    "id" => "4",
                    "nama" => "adjustment",
                ),
                "1463" => array(
                    "id" => "3",
                    "nama" => "ppv",
                ),
            );
            //------------------------
            $this->db->select("*");
            $this->db->where(array(
                "status" => "0"
                //                "id_tabel<" => "19056"
            ));
            //            $this->db->where("id_tabel='1309'");
            $this->db->order_by("id", "ASC");
            $this->db->limit(1);
            $tmpTbl = $this->db->get($tbl_target)->result();
            showlast_query("biru");

            if (sizeof($tmpTbl) > 0) {
                $tabelID = $tmpTbl[0]->id_tabel;
                //------------------------
                $this->db->select("*");
                $this->db->where(array(
                    "id" => $tabelID,
                    "rekening" => "$penjualan",
                ));
                $this->db->order_by("id", "ASC");
                $tmp = $this->db->get($tbl)->result();
                showlast_query("orange");
                //                arrPrint($tmp);
                //------------------------

                $debet = $tmp[0]->debet;
                $kredit = $tmp[0]->kredit;
                $cabangID = $tmp[0]->cabang_id;
                $dtime = $tmp[0]->dtime;
                $fulldate = $tmp[0]->fulldate;
                $jenis = $tmp[0]->jenis;
                $transaksiID = $tmp[0]->transaksi_id;
                $transaksiNomer = $tmp[0]->transaksi_no;

                $tr->setJointSelectFields("main");
                $tr->setFilters(array());
                $tr->addFilter("transaksi_id='$transaksiID'");
                $reg = $tr->lookupDataRegistries()->result();
                showLast_query("kuning");
                $main = blobDecode($reg[0]->main);

                switch ($jenis) {
                    case "9911":
                    case "9912":
                        $referenceID = $main['referenceID'];
                        $tr->setJointSelectFields("main");
                        $tr->setFilters(array());
                        $tr->addFilter("transaksi_id='$referenceID'");
                        $reg = $tr->lookupDataRegistries()->result();
                        showLast_query("kuning");
                        $mainReg = blobDecode($reg[0]->main);
                        //                        arrPrintPink($mainReg);

                        //                        $detailID = isset($mainReg['pihakID']) ? $mainReg['pihakID'] : 0;
                        //                        $detailNama = isset($mainReg['pihakName']) ? $mainReg['pihakName'] : "";

                        $mainJenisTr = $mainReg['jenisTr'];
                        switch ($mainJenisTr) {
                            case "582spd":
                                $detailID = isset($main['pihakID']) ? $main['pihakID'] : 0;
                                $detailNama = isset($main['pihakName']) ? $main['pihakName'] : "";
                                $sellerID = isset($main['sellerID']) ? $main['sellerID'] : 0;
                                $sellerNama = isset($main['sellerName']) ? $main['sellerName'] : "";
                                if ($detailID == 0) {
                                    $tr = New MdlTransaksi();
                                    $tr->addFilter("id='$transaksiID'");
                                    $trTmp = $tr->lookupAll()->result();

                                    $idsHis = blobDecode($trTmp[0]->ids_his);
                                    $sellerID = isset($idsHis[1]['olehID']) ? $idsHis[1]['olehID'] : 0;
                                    $sellerNama = isset($idsHis[1]['olehName']) ? $idsHis[1]['olehName'] : "";


                                }

                                if ($debet > 0) {
                                    $data = array(
                                        "loop" => array(
                                            "hpp" => "$debet",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "1",
                                            "extern_nama" => "lokal",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$debet",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    //                                    $data_konsumen = array(
                                    //                                        "loop" => array(
                                    //                                            "penjualan" => "-$debet",
                                    //                                        ),
                                    //                                        "static" => array(
                                    //                                            "cabang_id" => "$cabangID",
                                    //                                            "extern_id" => "1",
                                    //                                            "extern_nama" => "lokal",
                                    //                                            "extern2_id" => "$detailID",
                                    //                                            "extern2_nama" => "$detailNama",
                                    //                                            "jenis" => "$jenis",
                                    //                                            "transaksi_no" => "$transaksiNomer",
                                    //                                            "harga" => "$debet",
                                    //                                            "transaksi_id" => $transaksiID,
                                    //                                            "fulldate" => $fulldate,
                                    //                                            "dtime" => $dtime,
                                    //                                        ),
                                    //                                    );
                                    //                                    $data_seller = array(
                                    //                                        "loop" => array(
                                    //                                            "penjualan" => "-$debet",
                                    //                                        ),
                                    //                                        "static" => array(
                                    //                                            "cabang_id" => "$cabangID",
                                    //                                            "extern_id" => "1",
                                    //                                            "extern_nama" => "lokal",
                                    //                                            "extern2_id" => "$sellerID",
                                    //                                            "extern2_nama" => "$sellerNama",
                                    //                                            "jenis" => "$jenis",
                                    //                                            "transaksi_no" => "$transaksiNomer",
                                    //                                            "harga" => "$debet",
                                    //                                            "transaksi_id" => $transaksiID,
                                    //                                            "fulldate" => $fulldate,
                                    //                                            "dtime" => $dtime,
                                    //                                        ),
                                    //                                    );
                                }
                                else {
                                    $data = array(
                                        "loop" => array(
                                            "hpp" => "-$kredit",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "1",
                                            "extern_nama" => "lokal",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$kredit",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    //                                    $data_konsumen = array(
                                    //                                        "loop" => array(
                                    //                                            "penjualan" => "$kredit",
                                    //                                        ),
                                    //                                        "static" => array(
                                    //                                            "cabang_id" => "$cabangID",
                                    //                                            "extern_id" => "1",
                                    //                                            "extern_nama" => "lokal",
                                    //                                            "extern2_id" => "$detailID",
                                    //                                            "extern2_nama" => "$detailNama",
                                    //                                            "jenis" => "$jenis",
                                    //                                            "transaksi_no" => "$transaksiNomer",
                                    //                                            "harga" => "$kredit",
                                    //                                            "transaksi_id" => $transaksiID,
                                    //                                            "fulldate" => $fulldate,
                                    //                                            "dtime" => $dtime,
                                    //                                        ),
                                    //                                    );
                                    //                                    $data_seller = array(
                                    //                                        "loop" => array(
                                    //                                            "penjualan" => "$kredit",
                                    //                                        ),
                                    //                                        "static" => array(
                                    //                                            "cabang_id" => "$cabangID",
                                    //                                            "extern_id" => "1",
                                    //                                            "extern_nama" => "lokal",
                                    //                                            "extern2_id" => "$sellerID",
                                    //                                            "extern2_nama" => "$sellerNama",
                                    //                                            "jenis" => "$jenis",
                                    //                                            "transaksi_no" => "$transaksiNomer",
                                    //                                            "harga" => "$kredit",
                                    //                                            "transaksi_id" => $transaksiID,
                                    //                                            "fulldate" => $fulldate,
                                    //                                            "dtime" => $dtime,
                                    //                                        ),
                                    //                                    );
                                }
                                arrPrintPink($data);

                                //--------------
                                $crpph = New ComRekeningPembantuHpp();
                                $crpph->pair($data);
                                $crpph->exec();
                                //--------------
                                //                                $crps = New ComRekeningPembantuPenjualanSeller();
                                //                                $crps->pair($data_seller);
                                //                                $crps->exec();
                                //                                //--------------
                                //                                $crpk = New ComRekeningPembantuPenjualanKonsumen();
                                //                                $crpk->pair($data_konsumen);
                                //                                $crpk->exec();
                                //--------------


                                break;
                            case "382spd":
                                $detailID = isset($main['pihakID']) ? $main['pihakID'] : 0;
                                $detailNama = isset($main['pihakName']) ? $main['pihakName'] : "";
                                $sellerID = isset($main['sellerID']) ? $main['sellerID'] : 0;
                                $sellerNama = isset($main['sellerName']) ? $main['sellerName'] : "";
                                if ($detailID == 0) {
                                    $tr = New MdlTransaksi();
                                    $tr->addFilter("id='$transaksiID'");
                                    $trTmp = $tr->lookupAll()->result();

                                    $idsHis = blobDecode($trTmp[0]->ids_his);
                                    $sellerID = isset($idsHis[1]['olehID']) ? $idsHis[1]['olehID'] : 0;
                                    $sellerNama = isset($idsHis[1]['olehName']) ? $idsHis[1]['olehName'] : "";


                                }

                                if ($debet > 0) {
                                    $data = array(
                                        "loop" => array(
                                            "hpp" => "$debet",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "2",
                                            "extern_nama" => "export",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$debet",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    //                                    $data_konsumen = array(
                                    //                                        "loop" => array(
                                    //                                            "penjualan" => "-$debet",
                                    //                                        ),
                                    //                                        "static" => array(
                                    //                                            "cabang_id" => "$cabangID",
                                    //                                            "extern_id" => "2",
                                    //                                            "extern_nama" => "export",
                                    //                                            "extern2_id" => "$detailID",
                                    //                                            "extern2_nama" => "$detailNama",
                                    //                                            "jenis" => "$jenis",
                                    //                                            "transaksi_no" => "$transaksiNomer",
                                    //                                            "harga" => "$debet",
                                    //                                            "transaksi_id" => $transaksiID,
                                    //                                            "fulldate" => $fulldate,
                                    //                                            "dtime" => $dtime,
                                    //                                        ),
                                    //                                    );
                                    //                                    $data_seller = array(
                                    //                                        "loop" => array(
                                    //                                            "penjualan" => "-$debet",
                                    //                                        ),
                                    //                                        "static" => array(
                                    //                                            "cabang_id" => "$cabangID",
                                    //                                            "extern_id" => "2",
                                    //                                            "extern_nama" => "export",
                                    //                                            "extern2_id" => "$sellerID",
                                    //                                            "extern2_nama" => "$sellerNama",
                                    //                                            "jenis" => "$jenis",
                                    //                                            "transaksi_no" => "$transaksiNomer",
                                    //                                            "harga" => "$debet",
                                    //                                            "transaksi_id" => $transaksiID,
                                    //                                            "fulldate" => $fulldate,
                                    //                                            "dtime" => $dtime,
                                    //                                        ),
                                    //                                    );
                                }
                                else {
                                    $data = array(
                                        "loop" => array(
                                            "hpp" => "-$kredit",
                                        ),
                                        "static" => array(
                                            "cabang_id" => "$cabangID",
                                            "extern_id" => "2",
                                            "extern_nama" => "export",
                                            "jenis" => "$jenis",
                                            "transaksi_no" => "$transaksiNomer",
                                            "harga" => "$kredit",
                                            "transaksi_id" => $transaksiID,
                                            "fulldate" => $fulldate,
                                            "dtime" => $dtime,
                                        ),
                                    );
                                    //                                    $data_konsumen = array(
                                    //                                        "loop" => array(
                                    //                                            "penjualan" => "$kredit",
                                    //                                        ),
                                    //                                        "static" => array(
                                    //                                            "cabang_id" => "$cabangID",
                                    //                                            "extern_id" => "2",
                                    //                                            "extern_nama" => "export",
                                    //                                            "extern2_id" => "$detailID",
                                    //                                            "extern2_nama" => "$detailNama",
                                    //                                            "jenis" => "$jenis",
                                    //                                            "transaksi_no" => "$transaksiNomer",
                                    //                                            "harga" => "$kredit",
                                    //                                            "transaksi_id" => $transaksiID,
                                    //                                            "fulldate" => $fulldate,
                                    //                                            "dtime" => $dtime,
                                    //                                        ),
                                    //                                    );
                                    //                                    $data_seller = array(
                                    //                                        "loop" => array(
                                    //                                            "penjualan" => "$kredit",
                                    //                                        ),
                                    //                                        "static" => array(
                                    //                                            "cabang_id" => "$cabangID",
                                    //                                            "extern_id" => "2",
                                    //                                            "extern_nama" => "export",
                                    //                                            "extern2_id" => "$sellerID",
                                    //                                            "extern2_nama" => "$sellerNama",
                                    //                                            "jenis" => "$jenis",
                                    //                                            "transaksi_no" => "$transaksiNomer",
                                    //                                            "harga" => "$kredit",
                                    //                                            "transaksi_id" => $transaksiID,
                                    //                                            "fulldate" => $fulldate,
                                    //                                            "dtime" => $dtime,
                                    //                                        ),
                                    //                                    );
                                }
                                arrPrintPink($data);

                                //--------------
                                $crpph = New ComRekeningPembantuHpp();
                                $crpph->pair($data);
                                $crpph->exec();
                                //--------------
                                //                                $crps = New ComRekeningPembantuPenjualanSeller();
                                //                                $crps->pair($data_seller);
                                //                                $crps->exec();
                                //                                //--------------
                                //                                $crpk = New ComRekeningPembantuPenjualanKonsumen();
                                //                                $crpk->pair($data_konsumen);
                                //                                $crpk->exec();
                                //--------------


                                break;
                        }

                        //                        mati_disini(":: $mainJenisTr ::");

                        break;
                    case "582spd":
                        $detailID = isset($main['pihakID']) ? $main['pihakID'] : 0;
                        $detailNama = isset($main['pihakName']) ? $main['pihakName'] : "";
                        $sellerID = isset($main['sellerID']) ? $main['sellerID'] : 0;
                        $sellerNama = isset($main['sellerName']) ? $main['sellerName'] : "";
                        if ($detailID == 0) {
                            $tr = New MdlTransaksi();
                            $tr->addFilter("id='$transaksiID'");
                            $trTmp = $tr->lookupAll()->result();

                            $idsHis = blobDecode($trTmp[0]->ids_his);
                            $sellerID = isset($idsHis[1]['olehID']) ? $idsHis[1]['olehID'] : 0;
                            $sellerNama = isset($idsHis[1]['olehName']) ? $idsHis[1]['olehName'] : "";


                        }

                        if ($debet > 0) {
                            $data = array(
                                "loop" => array(
                                    "hpp" => "$debet",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "1",
                                    "extern_nama" => "lokal",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$debet",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            //                            $data_konsumen = array(
                            //                                "loop" => array(
                            //                                    "penjualan" => "-$debet",
                            //                                ),
                            //                                "static" => array(
                            //                                    "cabang_id" => "$cabangID",
                            //                                    "extern_id" => "1",
                            //                                    "extern_nama" => "lokal",
                            //                                    "extern2_id" => "$detailID",
                            //                                    "extern2_nama" => "$detailNama",
                            //                                    "jenis" => "$jenis",
                            //                                    "transaksi_no" => "$transaksiNomer",
                            //                                    "harga" => "$debet",
                            //                                    "transaksi_id" => $transaksiID,
                            //                                    "fulldate" => $fulldate,
                            //                                    "dtime" => $dtime,
                            //                                ),
                            //                            );
                            //                            $data_seller = array(
                            //                                "loop" => array(
                            //                                    "penjualan" => "-$debet",
                            //                                ),
                            //                                "static" => array(
                            //                                    "cabang_id" => "$cabangID",
                            //                                    "extern_id" => "1",
                            //                                    "extern_nama" => "lokal",
                            //                                    "extern2_id" => "$sellerID",
                            //                                    "extern2_nama" => "$sellerNama",
                            //                                    "jenis" => "$jenis",
                            //                                    "transaksi_no" => "$transaksiNomer",
                            //                                    "harga" => "$debet",
                            //                                    "transaksi_id" => $transaksiID,
                            //                                    "fulldate" => $fulldate,
                            //                                    "dtime" => $dtime,
                            //                                ),
                            //                            );
                        }
                        else {
                            $data = array(
                                "loop" => array(
                                    "hpp" => "-$kredit",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "1",
                                    "extern_nama" => "lokal",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$kredit",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            //                            $data_konsumen = array(
                            //                                "loop" => array(
                            //                                    "penjualan" => "$kredit",
                            //                                ),
                            //                                "static" => array(
                            //                                    "cabang_id" => "$cabangID",
                            //                                    "extern_id" => "1",
                            //                                    "extern_nama" => "lokal",
                            //                                    "extern2_id" => "$detailID",
                            //                                    "extern2_nama" => "$detailNama",
                            //                                    "jenis" => "$jenis",
                            //                                    "transaksi_no" => "$transaksiNomer",
                            //                                    "harga" => "$kredit",
                            //                                    "transaksi_id" => $transaksiID,
                            //                                    "fulldate" => $fulldate,
                            //                                    "dtime" => $dtime,
                            //                                ),
                            //                            );
                            //                            $data_seller = array(
                            //                                "loop" => array(
                            //                                    "penjualan" => "$kredit",
                            //                                ),
                            //                                "static" => array(
                            //                                    "cabang_id" => "$cabangID",
                            //                                    "extern_id" => "1",
                            //                                    "extern_nama" => "lokal",
                            //                                    "extern2_id" => "$sellerID",
                            //                                    "extern2_nama" => "$sellerNama",
                            //                                    "jenis" => "$jenis",
                            //                                    "transaksi_no" => "$transaksiNomer",
                            //                                    "harga" => "$kredit",
                            //                                    "transaksi_id" => $transaksiID,
                            //                                    "fulldate" => $fulldate,
                            //                                    "dtime" => $dtime,
                            //                                ),
                            //                            );
                        }
                        arrPrintPink($data);

                        //--------------
                        $crpph = New ComRekeningPembantuHpp();
                        $crpph->pair($data);
                        $crpph->exec();
                        //--------------
                        //                        $crps = New ComRekeningPembantuPenjualanSeller();
                        //                        $crps->pair($data_seller);
                        //                        $crps->exec();
                        //                        //--------------
                        //                        $crpk = New ComRekeningPembantuPenjualanKonsumen();
                        //                        $crpk->pair($data_konsumen);
                        //                        $crpk->exec();
                        //--------------


                        break;
                    case "382spd":
                        $detailID = isset($main['pihakID']) ? $main['pihakID'] : 0;
                        $detailNama = isset($main['pihakName']) ? $main['pihakName'] : "";
                        $sellerID = isset($main['sellerID']) ? $main['sellerID'] : 0;
                        $sellerNama = isset($main['sellerName']) ? $main['sellerName'] : "";
                        if ($detailID == 0) {
                            $tr = New MdlTransaksi();
                            $tr->addFilter("id='$transaksiID'");
                            $trTmp = $tr->lookupAll()->result();

                            $idsHis = blobDecode($trTmp[0]->ids_his);
                            $sellerID = isset($idsHis[1]['olehID']) ? $idsHis[1]['olehID'] : 0;
                            $sellerNama = isset($idsHis[1]['olehName']) ? $idsHis[1]['olehName'] : "";


                        }

                        if ($debet > 0) {
                            $data = array(
                                "loop" => array(
                                    "hpp" => "$debet",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "2",
                                    "extern_nama" => "export",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$debet",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            //                            $data_konsumen = array(
                            //                                "loop" => array(
                            //                                    "penjualan" => "-$debet",
                            //                                ),
                            //                                "static" => array(
                            //                                    "cabang_id" => "$cabangID",
                            //                                    "extern_id" => "2",
                            //                                    "extern_nama" => "export",
                            //                                    "extern2_id" => "$detailID",
                            //                                    "extern2_nama" => "$detailNama",
                            //                                    "jenis" => "$jenis",
                            //                                    "transaksi_no" => "$transaksiNomer",
                            //                                    "harga" => "$debet",
                            //                                    "transaksi_id" => $transaksiID,
                            //                                    "fulldate" => $fulldate,
                            //                                    "dtime" => $dtime,
                            //                                ),
                            //                            );
                            //                            $data_seller = array(
                            //                                "loop" => array(
                            //                                    "penjualan" => "-$debet",
                            //                                ),
                            //                                "static" => array(
                            //                                    "cabang_id" => "$cabangID",
                            //                                    "extern_id" => "2",
                            //                                    "extern_nama" => "export",
                            //                                    "extern2_id" => "$sellerID",
                            //                                    "extern2_nama" => "$sellerNama",
                            //                                    "jenis" => "$jenis",
                            //                                    "transaksi_no" => "$transaksiNomer",
                            //                                    "harga" => "$debet",
                            //                                    "transaksi_id" => $transaksiID,
                            //                                    "fulldate" => $fulldate,
                            //                                    "dtime" => $dtime,
                            //                                ),
                            //                            );
                        }
                        else {
                            $data = array(
                                "loop" => array(
                                    "hpp" => "-$kredit",
                                ),
                                "static" => array(
                                    "cabang_id" => "$cabangID",
                                    "extern_id" => "2",
                                    "extern_nama" => "export",
                                    "jenis" => "$jenis",
                                    "transaksi_no" => "$transaksiNomer",
                                    "harga" => "$kredit",
                                    "transaksi_id" => $transaksiID,
                                    "fulldate" => $fulldate,
                                    "dtime" => $dtime,
                                ),
                            );
                            //                            $data_konsumen = array(
                            //                                "loop" => array(
                            //                                    "penjualan" => "$kredit",
                            //                                ),
                            //                                "static" => array(
                            //                                    "cabang_id" => "$cabangID",
                            //                                    "extern_id" => "2",
                            //                                    "extern_nama" => "export",
                            //                                    "extern2_id" => "$detailID",
                            //                                    "extern2_nama" => "$detailNama",
                            //                                    "jenis" => "$jenis",
                            //                                    "transaksi_no" => "$transaksiNomer",
                            //                                    "harga" => "$kredit",
                            //                                    "transaksi_id" => $transaksiID,
                            //                                    "fulldate" => $fulldate,
                            //                                    "dtime" => $dtime,
                            //                                ),
                            //                            );
                            //                            $data_seller = array(
                            //                                "loop" => array(
                            //                                    "penjualan" => "$kredit",
                            //                                ),
                            //                                "static" => array(
                            //                                    "cabang_id" => "$cabangID",
                            //                                    "extern_id" => "2",
                            //                                    "extern_nama" => "export",
                            //                                    "extern2_id" => "$sellerID",
                            //                                    "extern2_nama" => "$sellerNama",
                            //                                    "jenis" => "$jenis",
                            //                                    "transaksi_no" => "$transaksiNomer",
                            //                                    "harga" => "$kredit",
                            //                                    "transaksi_id" => $transaksiID,
                            //                                    "fulldate" => $fulldate,
                            //                                    "dtime" => $dtime,
                            //                                ),
                            //                            );
                        }
                        arrPrintPink($data);

                        //--------------
                        $crpph = New ComRekeningPembantuHpp();
                        $crpph->pair($data);
                        $crpph->exec();
                        //--------------
                        //                        $crps = New ComRekeningPembantuPenjualanSeller();
                        //                        $crps->pair($data_seller);
                        //                        $crps->exec();
                        //                        //--------------
                        //                        $crpk = New ComRekeningPembantuPenjualanKonsumen();
                        //                        $crpk->pair($data_konsumen);
                        //                        $crpk->exec();
                        //--------------


                        break;
                }


                $dataUpdate = array(
                    "status" => "1",
                    "dtime" => date("Y-m-d H:i:s")
                );
                $this->db->where(array(
                    "id_tabel" => $tabelID
                ));
                $this->db->update($tbl_target, $dataUpdate);
                showLast_query("ungu");
            }


        }


        //        mati_disini(" OHOOOO ");
        $this->db->trans_complete();
    }


    public function generatePricePPV()
    {
        $this->load->model("Coms/ComPriceProduk");
        $this->load->model("Mdls/MdlFifoProdukJadi");
        $this->load->model("Mdls/MdlFifoAverage");
        $cabangID = "-1";
        $jenis = array("467", "460");

        //------------------------------
        $fa = New MdlFifoAverage();
        $fa->setFilters(array());
        $fa->addFilter("cabang_id='$cabangID'");
        $fa->addFilter("jenis='produk'");
        //        $fp->addFilter("transaksi_jenis in ('".implode("','", $jenis)."')");
        $faTmp = $fa->lookupAll()->result();
        showLast_query("biru");
        $hppAvg = array();
        if (sizeof($faTmp) > 0) {
            foreach ($faTmp as $faTmpSpec) {
                $hppAvg[$faTmpSpec->produk_id] = $faTmpSpec->hpp;
            }
        }
        //        mati_disini();
        //------------------------------
        $fp = New MdlFifoProdukJadi();
        $fp->setFilters(array());
        $fp->addFilter("cabang_id='$cabangID'");
        $fp->addFilter("transaksi_jenis in ('" . implode("','", $jenis) . "')");
        $fpTmp = $fp->lookupAll()->result();
        showLast_query("biru");
        cekHere(sizeof($fpTmp));
        $arrData = array();
        if (sizeof($fpTmp) > 0) {
            foreach ($fpTmp as $fpTmpSpec) {
                //                arrPrint($fpTmpSpec);

                $arrData[$fpTmpSpec->produk_id]["hpp_nppv"] = $fpTmpSpec->hpp;
                $arrData[$fpTmpSpec->produk_id]["nama"] = $fpTmpSpec->produk_nama;

                //                break;
            }
            //            arrPrint($arrData);


            $this->db->trans_start();

            if (sizeof($arrData) > 0) {
                foreach ($arrData as $pID => $spec) {
                    $hpp_nppv = $spec["hpp_nppv"];
                    $pNama = $spec["nama"];
                    $hpp_avg = isset($hppAvg[$pID]) ? $hppAvg[$pID] : 0;
                    if ($hpp_avg > $hpp_nppv) {
                        $hpp_dipakai = $hpp_avg;
                    }
                    else {
                        $hpp_dipakai = $hpp_nppv;
                    }

                    $comData[0] = array(
                        "loop" => array(),
                        "static" => array(
                            "produk_id" => "$pID",
                            "produk_nama" => "$pNama",
                            "nilai" => "$hpp_dipakai",
                            "cabang_id" => "$cabangID",
                            "oleh_id" => "100",
                            "oleh_nama" => "sys",
                            "jenis" => "produk",
                            "jenis_value" => "hpp_nppv",
                        ),
                    );
                    $comDataSales[0] = array(
                        "loop" => array(),
                        "static" => array(
                            "produk_id" => "$pID",
                            "produk_nama" => "$pNama",
                            "nilai" => "$hpp_dipakai",
                            "cabang_id" => "$cabangID",
                            "oleh_id" => "100",
                            "oleh_nama" => "sys",
                            "jenis" => "produk",
                            "jenis_value" => "hpp_nppv_sales",
                        ),
                    );
                    $cp = New ComPriceProduk();
                    $cp->pair($comData);
                    $cp->exec();

                    $cp = New ComPriceProduk();
                    $cp->pair($comDataSales);
                    $cp->exec();


                    //                    break;
                }
            }


            mati_disini(" OHOOOO ");
            $this->db->trans_complete();

        }


    }


    public function generatePriceGRN()
    {
        $this->load->model("Coms/ComPriceProduk");
        $this->load->model("Mdls/MdlFifoProdukJadi");
        $this->load->model("Mdls/MdlFifoAverage");
        $this->load->model("MdlTransaksi");
        $cabangID = "-1";
        $jenis = array("467", "460");

        $tr = New MdlTransaksi();
        $tr->addFilter("jenis='467'");
        //        $tr->addFilter("date(dtime)>='2021-01-01'");
        $trTmp = $tr->lookupAll()->result();
        showLast_query("biru");
        cekHere(sizeof($trTmp));
        $trIDs = array();
        $dataHargaGrn = array();
        foreach ($trTmp as $spec) {
            $trIDs[$spec->id] = $spec->id;
            $id = $spec->id;

            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("transaksi_id='$id'");
            $tr->setJointSelectFields(array("items"));
            $reg = $tr->lookupDataRegistries()->result();
            //            showLast_query("kuning");
            $items = blobDecode($reg[0]->items);
            //            arrPrintWebs($items);
            foreach ($items as $iSpec) {
                $dataHargaGrn[$iSpec['id']]['harga'] = $iSpec['harga'];
                $dataHargaGrn[$iSpec['id']]['nama'] = $iSpec['nama'];
            }

        }
        //arrPrintWebs($dataHargaGrn);
        $this->db->trans_start();

        foreach ($dataHargaGrn as $pID => $specs) {
            $harga = $specs['harga'];
            $pNama = $specs['nama'];

            $comData[0] = array(
                "loop" => array(),
                "static" => array(
                    "produk_id" => "$pID",
                    "produk_nama" => "$pNama",
                    "nilai" => "$harga",
                    "cabang_id" => "$cabangID",
                    "oleh_id" => "100",
                    "oleh_nama" => "sys",
                    "jenis" => "produk",
                    "jenis_value" => "hpp_grn",
                ),
            );

            $cp = New ComPriceProduk();
            $cp->pair($comData);
            $cp->exec();


        }


        mati_disini(" OHOOOO ");
        $this->db->trans_complete();


    }


    public function generateLRKurs()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Coms/ComRekening");
        $this->load->helper("he_angka");

        $tr = New MdlTransaksi();
        $cr = New ComRekening();

        $tbl_1 = "__rek_master__kerugian_kurs";
        $tbl_2 = "__rek_master__keutungan_kurs";
        $arrKumpulanData = array();

        //---- ambil dari tbl 1
        $this->db->select("*");
        $this->db->where(array(
            "fulldate>=" => "2022-01-01",
            "jenis<>" => "999"
        ));
        $this->db->order_by("id", "ASC");
        $tmpTbl_1 = $this->db->get($tbl_1)->result();
        showlast_query("biru");
        if (sizeof($tmpTbl_1) > 0) {
            foreach ($tmpTbl_1 as $tmpTbl_1_spec) {
                //                arrPrint($tmpTbl_1_spec);
                $arrKumpulanData[$tmpTbl_1_spec->transaksi_id] = (array)$tmpTbl_1_spec;
            }
        }

        //---- ambil dari tbl 2
        $this->db->select("*");
        $this->db->where(array(
            "fulldate>=" => "2022-01-01",
            "jenis<>" => "999"
        ));
        $this->db->order_by("id", "ASC");
        $tmpTbl_2 = $this->db->get($tbl_2)->result();
        showlast_query("biru");
        if (sizeof($tmpTbl_2) > 0) {
            foreach ($tmpTbl_2 as $tmpTbl_2_spec) {
                //                arrPrint($tmpTbl_1_spec);
                $arrKumpulanData[$tmpTbl_2_spec->transaksi_id] = (array)$tmpTbl_2_spec;
            }
        }
        ksort($arrKumpulanData);
        //        arrPrintPink($arrKumpulanData);


        $this->db->trans_start();


        if (sizeof($arrKumpulanData) > 0) {
            foreach ($arrKumpulanData as $trID => $mutasiData) {
                arrPrintPink($mutasiData);
                $debet = $mutasiData['debet'];
                $kredit = $mutasiData['kredit'];
                $cabangID = $mutasiData['cabang_id'];
                $dtime = $mutasiData['dtime'];
                $fulldate = $mutasiData['fulldate'];
                $jenis = $mutasiData['jenis'];
                $transaksiID = $mutasiData['transaksi_id'];
                $transaksiNomer = $mutasiData['transaksi_no'];


                if ($debet > 0) {
                    $data = array(
                        "loop" => array(
                            "laba(rugi) selisih kurs" => "-$debet",
                        ),
                        "static" => array(
                            "cabang_id" => "$cabangID",
                            "jenis" => "$jenis",
                            "transaksi_no" => "$transaksiNomer",
                            "harga" => "$debet",
                            "transaksi_id" => $transaksiID,
                            "fulldate" => $fulldate,
                            "dtime" => $dtime,
                        ),
                    );

                }
                else {
                    $data = array(
                        "loop" => array(
                            "laba(rugi) selisih kurs" => "$kredit",
                        ),
                        "static" => array(
                            "cabang_id" => "$cabangID",
                            "jenis" => "$jenis",
                            "transaksi_no" => "$transaksiNomer",
                            "harga" => "$kredit",
                            "transaksi_id" => $transaksiID,
                            "fulldate" => $fulldate,
                            "dtime" => $dtime,
                        ),
                    );

                }

                //--------------
                $crpph = New ComRekening();
                $crpph->pair($data);
                $crpph->exec();

                //                break;
            }
        }


        mati_disini(" OHOOOO ");
        $this->db->trans_complete();
    }

    public function generateJurnalKurs()
    {
        $this->load->model("Coms/ComJurnal");
        $cabangID = "-1";
        $rekening = array(
            "kerugian kurs",
            "keutungan kurs"
        );
        $jenis = array("4891", "489", "487");
        $rekeningUpdate = "laba(rugi) selisih kurs";

        $this->db->trans_start();


        $jj = New ComJurnal();
        $jj->addFilter("jenis in ('" . implode("','", $jenis) . "')");
        $jj->addFilter("date(dtime)>='2022-01-01'");
        $jjTmp = $jj->lookupAll()->result();
        showLast_query("biru");
        foreach ($jjTmp as $spec) {
            //            arrPrint($spec);
            $idTbl = $spec->id;
            if (in_array($spec->rekening, $rekening)) {
                cekHere("ganti menjadi laba(rugi) selisih kurs, pada id tabel $idTbl");
                $jj = New ComJurnal();
                $updateData = array(
                    "rekening" => $rekeningUpdate,
                );
                $where = array(
                    "id" => $idTbl,
                );
                $jj->updateData($where, $updateData);
                showLast_query("orange");
            }


        }


        mati_disini(" OHOOOO ");
        $this->db->trans_complete();


    }

    //-------------------------------------------------
    public function generateCounters()
    {
//        header("refresh:1");


        $this->load->model("MdlTransaksi");
        $this->load->model("CustomCounter");
        $jenisTr = "";
        //        $trID = "12745";
        $jenisMaster = "466";
        $company = 100;// contoh company id 100
        //        $modul = "110";// contoh modul id 110
        //        $subModul = "111";// contoh submodul id 111

        //---------------------------------------------

        //        $tr = New MdlTransaksi();
        //        $tr->addFilter("id_master>'0'");
        //        $trTmpAll = $tr->lookupAll()->result();
        //        $arrTotalData = array();
        //        $arrWaitData = array();
        //        $arrDoneData = array();
        //        foreach ($trTmpAll as $allSpec) {
        //            $arrTotalData[] = 1;
        //            if ($allSpec->gen_counter == "0") {
        //                $arrWaitData[] = 1;
        //            }
        //            if ($allSpec->gen_counter == "1") {
        //                $arrDoneData[] = 1;
        //            }
        //        }
        //        $totalTransaksi = sizeof($arrTotalData);
        //        $totalWaitTransaksi = sizeof($arrWaitData);
        //        $totalDoneTransaksi = sizeof($arrDoneData);
        //        $persenDone = ($totalDoneTransaksi / $totalTransaksi) * 100;
        //        $persenWait = ($totalWaitTransaksi / $totalTransaksi) * 100;
        //        cekUngu("TOTAL: $totalTransaksi, WAITING: $totalWaitTransaksi, DONE: $totalDoneTransaksi");
        //        cekUngu("WAITING: " . number_format($persenWait, "2", ",", ".") . ", DONE: " . number_format($persenDone, "2", ",", ".") . "");

        //---------------------------------------------


        // tabel transaksi
        $tr = New MdlTransaksi();
        $tr->addFilter("id_master>'0'");
        $tr->addFilter("gen_counter='0'");
        $tr->setSortBy(array("mode" => "ASC", "kolom" => "id"));
        $this->db->limit(1);
        $trTmp = $tr->lookupAll()->result();
        showLast_query("biru");


        if (sizeof($trTmp) > 0) {
            //            arrPrint($trTmp);
            cekHitam("transaksi ID: " . $trTmp[0]->id . " || date: " . $trTmp[0]->dtime);
            //            cekHere($this->masterConfigUi[$trTmp[0]->jenis_master]);
            //mati_disini();
            $transaksiID = $trTmp[0]->id;
            $transaksiNomer = $trTmp[0]->nomer;
            $transaksiJenis = $trTmp[0]->jenis;
            $supplierID = $trTmp[0]->suppliers_id;
            $supplierName = $trTmp[0]->suppliers_nama;
            $customerID = $trTmp[0]->customers_id;
            $customerName = $trTmp[0]->customers_nama;
            $olehID = $trTmp[0]->oleh_id;
            $olehName = $trTmp[0]->oleh_nama;
            $cabangID = $trTmp[0]->cabang_id;
            $cabangName = $trTmp[0]->cabang_nama;
            $cabang2ID = $trTmp[0]->cabang2_id;
            $cabang2Name = $trTmp[0]->cabang2_nama;
            $gudangID = $trTmp[0]->gudang_id;
            $gudangName = $trTmp[0]->gudang_nama;
            $gudang2ID = $trTmp[0]->gudang2_id;
            $gudang2Name = $trTmp[0]->gudang2_nama;

            //---------------------------------------
            $tr = New MdlTransaksi();
            $detail = $tr->lookupDetailTransaksiNoJenis($transaksiID)->result();
            //            arrPrintPink($detail);
            $arrCoaCodeTransaksiData = array();
            if (sizeof($detail) > 0) {
                foreach ($detail as $detailSpec) {

                    switch ($detailSpec->produk_jenis) {
                        case "produk":
                            $arrCoaCodeTransaksiData[$detailSpec->produk_id] = "";
                            break;
                        case "supplies":
                            $arrCoaCodeTransaksiData[$detailSpec->produk_id] = "";
                            break;
                    }
                }
            }
            //---------------------------------------


            //            mati_disini();
            foreach ($trTmp[0] as $key => $val) {
                $$key = $val;
            }
            $arrTmpTr = (array)$trTmp[0];

            //region tabel registry
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("transaksi_id='$transaksiID'");
            $tr->setJointSelectFields(array("transaksi_id", "main", "items", "items2_sum", "items3", "items3_sum"));
            $trReg = $tr->lookupDataRegistries()->result();

            $regMain = blobDecode($trReg[0]->main);
            $regItems = blobDecode($trReg[0]->items);
            $regItems2_sum = blobDecode($trReg[0]->items2_sum);
            //endregion

            foreach ($regMain as $mkey => $mval) {
                $$mkey = $mval;
            }
            //
            //            $counterDefineValues = array();
            //            $counterDefineValuesItems = array();
            //            $counterDefine = array(
            //
            ////                "company",                           // 1
            ////                "company|jenis",                     // 2
            ////                "company|suppliers_id",              // 3
            ////                "company|customers_id",              // 4
            ////                "company|oleh_id",                   // 5
            ////                "company|seller_id",                   // 5
            ////                "company|cabang_id",                 // 6
            ////                "company|cabang2_id",                // 7
            ////                "company|gudang_id",                 // 8
            ////                "company|gudang2_id",                // 9
            ////                "company|jenis|suppliers_id",        // 10
            ////                "company|jenis|customers_id",        // 11
            ////                "company|jenis|oleh_id",             // 12
            ////                "company|jenis|seller_id",             // 13
            ////                "company|jenis|cabang_id",           // 14
            ////                "company|jenis|cabang2_id",          // 15
            ////                "company|jenis|gudang_id",           // 16
            ////                "company|jenis|gudang2_id",          // 17
            ////                "company|jenis|cabang_id|cabang2_id", // 18
            ////                "company|jenis|cabang_id|customers_id", // 18
            ////                "company|jenis|cabang_id|oleh_id",      // 19
            ////                "company|jenis|cabang_id|seller_id",    // 20
            ////                "company|jenis|cabang_id|gudang_id",    // 21
            ////                "company|jenis|cabang_id|gudang2_id",   // 22
            ////                "company|jenis|cabang_id|suppliers_id",   // 23
            //                //-----------------------
            //
            ////                "company",                           // 1
            ////                "company|jenisTr",                     // 2
            ////                "company|jenisTrMaster",                     // 2
            ////                "company|stepCode",                     // 2
            ////                "company|supplierID",              // 3
            ////                "company|customerID",              // 4
            ////                "company|olehID",                   // 5
            ////                "company|sellerID",                   // 5
            ////                "company|cabangID",                 // 6
            ////                "company|cabang2ID",                // 7
            ////                "company|gudangID",                 // 8
            ////                "company|gudang2ID",                // 9
            ////                "company|modul",                // 9
            ////                "company|subModul",                // 9
            //
            ////                "company|jenisTr|jenisTrMaster",        // 10
            ////                "company|jenisTr|stepCode",        // 10
            ////                "company|jenisTr|supplierID",        // 10
            ////                "company|jenisTr|customerID",        // 11
            ////                "company|jenisTr|olehID",             // 12
            ////                "company|jenisTr|sellerID",             // 13
            ////                "company|jenisTr|cabangID",           // 14
            ////                "company|jenisTr|cabang2ID",          // 15
            ////                "company|jenisTr|gudangID",           // 16
            ////                "company|jenisTr|gudang2ID",          // 17
            ////                "company|jenisTr|modul",          // 17
            ////                "company|jenisTr|subModul",          // 17
            ////
            ////                "company|jenisTr|cabangID|jenisTrMaster", // 18
            ////                "company|jenisTr|cabangID|stepCode", // 18
            ////                "company|jenisTr|cabangID|cabang2ID", // 18
            ////                "company|jenisTr|cabangID|customerID", // 18
            ////                "company|jenisTr|cabangID|olehID",      // 19
            ////                "company|jenisTr|cabangID|sellerID",    // 20
            ////                "company|jenisTr|cabangID|gudangID",    // 21
            ////                "company|jenisTr|cabangID|gudang2ID",   // 22
            ////                "company|jenisTr|cabangID|supplierID",   // 23
            ////                "company|jenisTr|cabangID|modul",   // 23
            ////                "company|jenisTr|cabangID|subModul",   // 23
            ////
            ////                "company|jenisTr|cabangID|stepCode|cabang2ID", // 18
            ////                "company|jenisTr|cabangID|stepCode|customerID", // 18
            ////                "company|jenisTr|cabangID|stepCode|olehID",      // 19
            ////                "company|jenisTr|cabangID|stepCode|sellerID",    // 20
            ////                "company|jenisTr|cabangID|stepCode|gudangID",    // 21
            ////                "company|jenisTr|cabangID|stepCode|gudang2ID",   // 22
            ////                "company|jenisTr|cabangID|stepCode|supplierID",   // 23
            ////                "company|jenisTr|cabangID|stepCode|modul",   // 23
            ////                "company|jenisTr|cabangID|stepCode|subModul",   // 23
            //
            //                "company",                           // 1
            //                "company|jenisTr",                     // 2
            //                "company|jenisTrMaster",                     // 2
            //                "company|stepCode",                     // 2
            //                "company|supplierID",              // 3
            //                "company|customerID",              // 4
            //                "company|olehID",                   // 5
            //                "company|sellerID",                   // 5
            //                "company|cabangID",                 // 6
            //                "company|cabang2ID",                // 7
            //                "company|gudangID",                 // 8
            //                "company|gudang2ID",                // 9
            //                "company|modul",                // 9
            //                "company|subModul",                // 9
            //
            //                "company|cabangID|jenisTr",                     // 2
            //                "company|cabangID|jenisTrMaster",                     // 2
            //                "company|cabangID|stepCode",                     // 2
            //                "company|cabangID|supplierID",              // 3
            //                "company|cabangID|customerID",              // 4
            //                "company|cabangID|olehID",                   // 5
            //                "company|cabangID|sellerID",                   // 5
            //                "company|cabangID|cabangID",                 // 6
            //                "company|cabangID|cabang2ID",                // 7
            //                "company|cabangID|gudangID",                 // 8
            //                "company|cabangID|gudang2ID",                // 9
            //                "company|cabangID|modul",                // 9
            //                "company|cabangID|subModul",                // 9
            //
            //                "company|cabangID|modul|jenisTr",                     // 2
            //                "company|cabangID|modul|jenisTrMaster",                     // 2
            //                "company|cabangID|modul|stepCode",                     // 2
            //                "company|cabangID|modul|supplierID",              // 3
            //                "company|cabangID|modul|customerID",              // 4
            //                "company|cabangID|modul|olehID",                   // 5
            //                "company|cabangID|modul|sellerID",                   // 5
            //                "company|cabangID|modul|cabangID",                 // 6
            //                "company|cabangID|modul|cabang2ID",                // 7
            //                "company|cabangID|modul|gudangID",                 // 8
            //                "company|cabangID|modul|gudang2ID",                // 9
            //                "company|cabangID|modul|subModul",                // 9
            //
            //                "company|cabangID|modul|subModul|jenisTr",                     // 2
            //                "company|cabangID|modul|subModul|jenisTrMaster",                     // 2
            //                "company|cabangID|modul|subModul|stepCode",                     // 2
            //                "company|cabangID|modul|subModul|supplierID",              // 3
            //                "company|cabangID|modul|subModul|customerID",              // 4
            //                "company|cabangID|modul|subModul|olehID",                   // 5
            //                "company|cabangID|modul|subModul|sellerID",                   // 5
            //                "company|cabangID|modul|subModul|cabangID",                 // 6
            //                "company|cabangID|modul|subModul|cabang2ID",                // 7
            //                "company|cabangID|modul|subModul|gudangID",                 // 8
            //                "company|cabangID|modul|subModul|gudang2ID",                // 9
            //
            //                "company|cabangID|modul|subModul|jenisTr|jenisTrMaster",                     // 2
            //                "company|cabangID|modul|subModul|jenisTr|stepCode",                     // 2
            //                "company|cabangID|modul|subModul|jenisTr|supplierID",              // 3
            //                "company|cabangID|modul|subModul|jenisTr|customerID",              // 4
            //                "company|cabangID|modul|subModul|jenisTr|olehID",                   // 5
            //                "company|cabangID|modul|subModul|jenisTr|sellerID",                   // 5
            //                "company|cabangID|modul|subModul|jenisTr|cabangID",                 // 6
            //                "company|cabangID|modul|subModul|jenisTr|cabang2ID",                // 7
            //                "company|cabangID|modul|subModul|jenisTr|gudangID",                 // 8
            //                "company|cabangID|modul|subModul|jenisTr|gudang2ID",                // 9
            //
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|jenisTrMaster",                     // 2
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|supplierID",              // 3
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|customerID",              // 4
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|olehID",                   // 5
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|sellerID",                   // 5
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|cabangID",                 // 6
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|cabang2ID",                // 7
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|gudangID",                 // 8
            //                "company|cabangID|modul|subModul|jenisTr|stepCode|gudang2ID",                // 9
            //            );
            //            // mesti bawa produk, rakitan, supplies, biaya
            //            $counterDefineItems = array(
            //                "company|item_id",           // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|cabang_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|gudang_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|gudang2_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|customers_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|suppliers_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|seller_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|oleh_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|cabang_id|jenis",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|cabang_id|gudang_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|cabang_id|gudang2_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|cabang_id|customers_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|cabang_id|suppliers_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|cabang_id|seller_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|cabang_id|oleh_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|cabang_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|gudang_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|gudang2_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|customers_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|suppliers_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|seller_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|oleh_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|cabang_id|gudang_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|cabang_id|gudang2_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|cabang_id|customers_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|cabang_id|suppliers_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|cabang_id|seller_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                "company|item_id|jenis|cabang_id|oleh_id",     // item bisa produk, rakitan, supplies, biaya, dll
            //                //-----------------------
            //
            //            );
            //
            //            foreach ($counterDefine as $spec) {
            //                $spec_ex = explode("|", $spec);
            //                $hasil = "";
            //                foreach ($spec_ex as $skey) {
            //                    $skey_val = isset($$skey) ? $$skey : 0;
            //                    if ($hasil == "") {
            //                        $hasil = "$skey_val";
            //                    }
            //                    else {
            //                        $hasil .= "|$skey_val";
            //                    }
            //                }
            //
            //                $ketemu = (strpos("$hasil, $hasil", "|0"));
            //                if ($ketemu > 0) {
            //
            //                }
            //                else {
            //
            //                    $counterDefineValues[$spec] = $hasil;
            //                }
            //
            //            }
            //
            ////            foreach($regItems as $iID => $iSpec){
            ////                foreach($iSpec as $ikey =>$ival){
            ////                    $$ikey = $ival;
            ////                }
            ////                $item_id = $iSpec['id'];
            ////
            ////
            ////                foreach($counterDefineItems as $spec){
            ////                    $spec_ex = explode("|", $spec);
            ////                    $hasil = "";
            ////                    foreach($spec_ex as $skey){
            ////                        $skey_val = isset($$skey) ? $$skey : 0;
            ////                        if($hasil == ""){
            ////                            $hasil = "$skey_val";
            ////                        }
            ////                        else{
            ////                            $hasil .= "|$skey_val";
            ////                        }
            ////                    }
            ////                    $counterDefineValuesItems[$item_id][$spec] = $hasil;
            ////                }
            ////
            ////
            ////            }
            //
            //
            //            $arrKolomTabel = array();
            //            foreach ($counterDefineValues as $kkey => $vval) {
            //                $arrKolomTabel[] = str_replace("|", "_", $kkey);
            //            }
            //
            ////            arrPrintWebs($arrKolomTabel);
            ////            arrPrintWebs($counterDefineValues);
            ////            arrPrintPink($counterDefineValuesItems);
            ////            mati_disini();


            $this->db->trans_start();
            $pakai_ini = 0;
            if ($pakai_ini == 1) {

                $counterHasil = array();
                $counterHasil_insert = array();

                foreach ($counterDefineValues as $key => $val) {
                    $cc = New CustomCounter();
                    $urut = $cc->setCounterNumber($key, $val, "master", "0");

                    $counterHasil['main'][] = array(
                        "key" => $key,
                        "value" => $val,
                        "hasil" => $urut,
                    );

                    $kolom = str_replace("|", "_", $key);
                    $counterHasil_insert[$kolom] = $urut;
                }

                $pakai_ini = 0;
                if ($pakai_ini == 1) {
                    foreach ($counterDefineValuesItems as $iID => $iSpec) {
                        foreach ($iSpec as $key => $val) {

                            $cc = New CustomCounter();
                            $urut = $cc->setCounterNumber($key, $val, "detail", "produk");// tembah produk dulu

                            $counterHasil['detail'][$iID][] = array(
                                "key" => $key,
                                "value" => $val,
                                "hasil" => $urut,
                            );
                        }
                    }
                }


                $counterHasil_insert['suppliers_id'] = $supplierID;
                $counterHasil_insert['suppliers_nama'] = $supplierName;
                $counterHasil_insert['customers_id'] = $customerID;
                $counterHasil_insert['customers_nama'] = $customerName;
                $counterHasil_insert['oleh_id'] = $olehID;
                $counterHasil_insert['oleh_nama'] = $olehName;
                $counterHasil_insert['cabang_id'] = $cabangID;
                $counterHasil_insert['cabang_nama'] = $cabangName;
                $counterHasil_insert['cabang2_id'] = $cabang2ID;
                $counterHasil_insert['cabang2_nama'] = $cabang2Name;
                $counterHasil_insert['gudang_id'] = $gudangID;
                $counterHasil_insert['gudang_nama'] = $gudangName;
                $counterHasil_insert['gudang2_id'] = $gudang2ID;
                $counterHasil_insert['gudang2_nama'] = $gudang2Name;
                $counterHasil_insert['modul_id'] = $modul;
                $counterHasil_insert['subModul_id'] = $subModul;
                $counterHasil_insert['company_id'] = $company;
                $counterHasil_insert['transaksi_id'] = $trTmp[0]->id;
                $counterHasil_insert['id_master'] = $trTmp[0]->id_master;
                $counterHasil_insert['id_top'] = $trTmp[0]->id_top;
                $counterHasil_insert['jenis_master'] = $trTmp[0]->jenis_master;
                $counterHasil_insert['jenis_top'] = $trTmp[0]->jenis_top;
                $counterHasil_insert['jenis'] = $trTmp[0]->jenis;
                $counterHasil_insert['jenis_label'] = $trTmp[0]->jenis_label;
                $counterHasil_insert['nomer_top'] = $trTmp[0]->nomer_top;
                $counterHasil_insert['nomer'] = $trTmp[0]->nomer;
                $counterHasil_insert['dtime'] = $trTmp[0]->dtime;


            }


            //------------------------------
            $cCode = "_TR_" . $arrTmpTr['jenis_master'];
            $this->load->library("CounterNumber");
            $ccn = new CounterNumber();
            $ccn->setCCode($cCode);
            $ccn->setJenisTr($arrTmpTr['jenis_master']);
            $ccn->setTransaksiGate($arrTmpTr);
            $ccn->setMainGate($regMain);
            $ccn->setItemsGate($regItems);
            $ccn->setItems2SumGate($regItems2_sum);
            $new_counter = $ccn->getCounterNumber();
            cekHitam("jenistr yang disett dari create " . $arrTmpTr['jenis_master']);

            //arrPrintPink($new_counter);
            //mati_disini("TEST...");
            //---MENULIS KE TABEL TRANSAKSI COUNTER----------------------------
            //            $tbl_target = "z_transaksi_counter";
            //            $this->db->insert($tbl_target, $new_counter['main']);
            //            showlast_query("kuning");
            //-------------------------------


            $tr = New MdlTransaksi();
            //            $data_update = array(
            //                "gen_counter" => 1
            //            );
            //
            $new_counter['main']['gen_counter'] = 1;
            $where = array(
                "id" => $transaksiID
            );
            $tr->updateData($where, $new_counter['main']);
            showLast_query("orange");


            //            mati_disini(" OHOOOO ");
            $this->db->trans_complete();

        }
        else {
            cekHijau("<h2>--- HABIS ---</h2>");
        }


    }

    public function generateCountersReset()
    {
        $this->load->model("MdlTransaksi");
        $tr = New MdlTransaksi();
        $data = array(
            "gen_counter" => 0
        );
        $where = array(
            "gen_counter" => 1,
        );


        $this->db->trans_start();

        //-----------
        $tr->updateData($where, $data);

        //-----------


        //        mati_disini(" OHOOOO ");
        $this->db->trans_complete();


    }

    public function generateCountersKas()
    {
//        header("refresh:1");


        $this->load->helper("he_mass_table");
        $this->load->model("MdlTransaksi");
        $this->load->model("CustomCounter");
        $this->load->model("Coms/ComRekening");
        $company = 100;// contoh company id 100

        //region rekening kas
        $cr = New ComRekening();
        //        $rekening = "010101";// kas
        $rekening = "kas";// kas 010101
        $cr->addFilter("gen_counter=0");
        $cr->setSortBy(array("kolom" => "id", "mode" => "ASC"));
        $this->db->limit(1);
        $crTmp = $cr->fetchMoves($rekening);
        //endregion

        if (sizeof($crTmp) > 0) {
            $trID_mutasi = $crTmp[0]->transaksi_id;

            //region transaksi
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id='$trID_mutasi'");
            $trTmp = $tr->lookupAll()->result();
            //endregion

            //region registry
            $reg = New MdlTransaksi();
            $reg->setFilters(array());
            $reg->setJointSelectFields(array("transaksi_id", "main", "items", "items2_sum", "items3", "items3_sum"));
            $reg->addFilter("transaksi_id='$trID_mutasi'");
            $regTmp = $reg->lookupDataRegistries()->result();
            //endregion


            $this->db->trans_start();

            $arrTmpTr = (array)$trTmp[0];
            $regMain = blobDecode($regTmp[0]->main);
            $regItems = blobDecode($regTmp[0]->items);
            $regItems2_sum = blobDecode($regTmp[0]->items2_sum);
            if (is_array($regMain)) {

            }
            else {
                $regMain = blobDecode($regMain);
            }

            //region counter susulan
            $cCode = "_TR_" . $arrTmpTr['jenis_master'];
            $this->load->library("CounterNumber");
            $ccn = new CounterNumber();
            $ccn->setCCode($cCode);
            $ccn->setJenisTr($arrTmpTr['jenis_master']);
            $ccn->setTransaksiGate($arrTmpTr);
            $ccn->setMainGate($regMain);
            //        $ccn->setItemsGate($regItems);
            //        $ccn->setItems2SumGate($regItems2_sum);
            $ccn->setRekening($rekening);
            $new_counter = $ccn->getCounterNumberRekening();
            //endregion


            //region update mutasi rekening
            $cr = New ComRekening();
            $where = array(
                "transaksi_id" => "$trID_mutasi",
                "rekening" => "$rekening"
            );
            $data = array(
                "gen_counter" => "1"
            );
            //            $cr->setTableName("__rek_master__010101");
            $cr->setTableName("__rek_master__kas");
            $cr->updateData($where, $data);
            showLast_query("orange");
            //endregion


            //region update transaksi
            $new_counter['main']['rekening'] = $rekening;
            $tr = New MdlTransaksi();
            $where = array(
                "id" => $trID_mutasi
            );
            $tr->setFilters(array());
            $tr->updateData($where, $new_counter['main']);
            showLast_query("orange");
            //endregion


            //            mati_disini(" OHOOOO ");
            $this->db->trans_complete();

        }
        else {
            cekHijau("<h2>--- HABIS ---</h2>");
        }

    }

    //-------------------------------------------------
    public function generateKategori()
    {
        $this->load->model("Mdls/MdlProduk2");
        $tabel_1 = "z_rekening_transaksi_pembantu_cache";
        $tabel_2 = "z_rekening_transaksi_pembantu_mutasi";


        $p = New MdlProduk2();
        $p->setFilters(array());
        $p->addFilter("jenis<>'folder'");
        $pTmp = $p->lookupAll()->result();
        $arrKategori = array();
        foreach ($pTmp as $pTmpSpec) {
            $arrKategori[$pTmpSpec->id] = array(
                "id" => $pTmpSpec->kategori_id,
                "nama" => $pTmpSpec->kategori_nama,
            );

        }
        //        arrPrint($arrKategori);

        $this->db->trans_start();

        $this->db->select("extern_id");
        $this->db->group_by("extern_id");
        $tmp = $this->db->get($tabel_1)->result();
        showLast_query("biru");
        $produkIDs = array();
        foreach ($tmp as $tmpSpec) {
            //            arrPrint($tmpSpec);
            $produkIDs[] = $tmpSpec->extern_id;
        }
        //        arrPrintPink($produkIDs);

        foreach ($produkIDs as $produk_id) {

            $where = array(
                "extern_id" => "$produk_id",
            );
            $data = array(
                "kategori_id" => isset($arrKategori[$produk_id]["id"]) ? $arrKategori[$produk_id]["id"] : 0,
                "kategori_nama" => isset($arrKategori[$produk_id]["nama"]) ? $arrKategori[$produk_id]["nama"] : 0,
            );
            $this->db->where($where);
            //            $this->db->update($tabel_1, $data);
            $this->db->update($tabel_2, $data);
            showLast_query("orange");
        }

        //        mati_disini(" OHOOOO ");
        $this->db->trans_complete();

    }


    public function viewRankTransaction()
    {

        //create by chepy
        //dtime: jum'at, 17 juni 2022  ||  16.22WIB

        $this->db->select("max(dtime)as dtimesss, month(dtime)as bulan, year(dtime)as tahun, jenis, method, controller, url as texts, count(method) as hitted");

        //        from log where
        //        year(dtime) = 2022 and ghost='0' and category='transaksi' OR ghost='0' and category='browser' group by method, year(dtime) order by jenis desc, dtime desc, hitted desc, controller desc, method desc");

        $this->db->from("log");
        $this->db->where("ghost='0' and category='transaksi'");
        $this->db->group_by("year(dtime), jenis, method,transaksi_id");
        $this->db->order_by("dtime desc, jenis asc, hitted desc, controller desc, method desc");

        $query = $this->db->get()->result();

        //        if ( $query->num_rows() > 0 )
        //        {
        //            $row = $query->row_array();
        //        }
        $html = "";
        $html .= "<table>";
        $html .= "<thead>";
        $html .= "<tr>";
        $html .= "<th>No.</th>";
        $html .= "<th>Dtime</th>";
        $html .= "<th>Jenis</th>";
        $html .= "<th>Method</th>";
        $html .= "<th>Controller</th>";
        $html .= "<th>URL</th>";
        $html .= "<th>VISITED</th>";
        $html .= "</tr>";
        $html .= "</thead>";
        $html .= "<tbody>";

        if (!empty($query)) {
            $num = 1;
            foreach ($query as $kk => $logData) {
                $html .= "<tr>";
                $html .= "<td>$num</td>";
                $html .= "<td>" . $logData->dtimesss . "</td>";
                $html .= "<td>" . $logData->jenis . "</td>";
                $html .= "<td>" . $logData->method . "</td>";
                $html .= "<td>" . $logData->controller . "</td>";
                $html .= "<td>" . $logData->texts . "</td>";
                $html .= "<td>" . $logData->hitted . "</td>";
                $html .= "</tr>";
                $num++;
            }
        }

        $html .= "</tbody>";
        $html .= "</table>";

        echo $html;
        //echo "<pre>";
        //print_r($query);
        //echo "</pre>";

        matiHere("sampe sini LINE: " . __LINE__);
        //select dtime, jenis, method, controller, url as texts, count(method) as hitted  from log where year(dtime) = 2022 and ghost='0' and category='transaksi' OR ghost='0' and category='browser' group by method, year(dtime) order by jenis desc, dtime desc, hitted desc, controller desc, method desc
    }

    //-------------------------------------------------
    public function generateAddMutasi()
    {
        //        $tabel = "__rek_pembantu_produk__persediaan_produk";
        $tabel = "__rek_master__persediaan_produk";
        $this->load->model("MdlTransaksi");


        // membaca tabel 1
        $arrJenis = array("9911", "9912");
        $this->db->select("id, transaksi_id, jenis");
        $this->db->where_in('jenis', $arrJenis);
        $this->db->group_by("transaksi_id");
        $tmp = $this->db->get($tabel)->result();
        showLast_query("biru");
        //        arrPrintPink($tmp);
        if (sizeof($tmp) > 0) {
            $arrTrIDs = array();
            $arrAddData = array();


            foreach ($tmp as $spec) {
                $arrTrIDs[$spec->transaksi_id] = $spec->transaksi_id;
            }
            // baca registry main
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main");
            $tr->addFilter("transaksi_id in ('" . implode("','", $arrTrIDs) . "')");
            $regTmp = $tr->lookupDataRegistries()->result();
            showLast_query("biru");
            //arrPrintPink($regTmp);
            foreach ($regTmp as $regSpec) {
                $trID = $regSpec->transaksi_id;
                $main_reg = blobDecode($regSpec->main);
                if (is_array($main_reg)) {
                    $main = $main_reg;
                }
                else {
                    $main = blobDecode($main_reg);
                }
                $arrAddData[$trID] = array(
                    "reference_id" => isset($main['referenceID']) ? $main['referenceID'] : 0,
                    "reference_nomer" => isset($main['referenceNomer']) ? $main['referenceNomer'] : 0,
                    "reference_jenis" => isset($main['jenisTr_reference']) ? $main['jenisTr_reference'] : 0,
                    "reference_id_top" => isset($main['referenceID_top']) ? $main['referenceID_top'] : 0,
                    "reference_nomer_top" => isset($main['referenceNomer_top']) ? $main['referenceNomer_top'] : 0,
                    "reference_jenis_top" => isset($main['pihakExternMasterID']) ? $main['pihakExternMasterID'] : 0,
                );
            }
            //            arrPrintHijau($arrAddData);

            $this->db->trans_start();

            if (sizeof($arrAddData) > 0) {
                foreach ($arrAddData as $trID => $spec) {
                    // update tabel mutasi
                    $this->db->where('transaksi_id', $trID);
                    $this->db->update($tabel, $spec);
                    showLast_query("orange");

                }
            }


            mati_disini();
            $this->db->trans_commit();
        }


        cekHijau("done, test inject data...");
    }

    public function generateAddTransaksi()
    {
        //        $tabel = "__rek_pembantu_produk__persediaan_produk";
        //        $tabel = "__rek_master__persediaan_produk";
        $this->load->model("MdlTransaksi");


        // membaca tabel 1
        $arrJenis = array("9911", "9912");
        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("link_id='0'");
        $tr->addFilter("jenis in ('" . implode("','", $arrJenis) . "')");
        $tmp = $tr->lookupAll()->result();
        showLast_query("biru");
        //        arrPrintPink($tmp);
        //        mati_disini(__LINE__ . " :: " . sizeof($tmp));
        if (sizeof($tmp) > 0) {
            $arrTrIDs = array();
            $arrAddData = array();
            foreach ($tmp as $spec) {
                $arrTrIDs[$spec->id] = $spec->id;
            }
            // baca registry main
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->setJointSelectFields("transaksi_id, main");
            $tr->addFilter("transaksi_id in ('" . implode("','", $arrTrIDs) . "')");
            $regTmp = $tr->lookupDataRegistries()->result();
            showLast_query("biru");
            //arrPrintPink($regTmp);
            foreach ($regTmp as $regSpec) {
                $trID = $regSpec->transaksi_id;
                $main_reg = blobDecode($regSpec->main);
                //                cekHijau("transaksiID: $trID");
                //                arrPrintHijau($main);
                if (is_array($main_reg)) {
                    $main = $main_reg;
                }
                else {
                    $main = blobDecode($main_reg);
                }
                //                arrPrintHijau($main);
                $arrAddData[$trID] = array(
                    "reference_id" => isset($main['referenceID']) ? $main['referenceID'] : 0,
                    "reference_nomer" => isset($main['referenceNomer']) ? $main['referenceNomer'] : 0,
                    "reference_jenis" => isset($main['jenisTr_reference']) ? $main['jenisTr_reference'] : 0,
                    "reference_id_top" => isset($main['referenceID_top']) ? $main['referenceID_top'] : 0,
                    "reference_nomer_top" => isset($main['referenceNomer_top']) ? $main['referenceNomer_top'] : 0,
                    "reference_jenis_top" => isset($main['pihakExternMasterID']) ? $main['pihakExternMasterID'] : 0,
                );
                //                break;
            }
            //            arrPrintHijau($arrAddData);
            //            mati_disini();
            $this->db->trans_start();

            if (sizeof($arrAddData) > 0) {
                foreach ($arrAddData as $trID => $spec) {
                    // update tabel transaksi
                    $where = array(
                        "id" => $trID
                    );
                    $tr = New MdlTransaksi();
                    $tr->setFilters(array());
                    $tr->updateData($where, $spec);
                    showLast_query("pink");
                }
            }


            mati_disini();
            $this->db->trans_commit();
        }


        cekhijau("done, test inject data...");
    }


    function viewCliNonAkunting()
    {

        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);

        $tbl = "z_tabel_timeline";
        $this->db->select("id, transaksi_id, jenis, dtime, tipe, seller_id, master_id, status, trash");
        $result = $this->db->get($tbl)->result();
        $total_data = (sizeof($result));


        $headerFields = array(
            "pID" => "pID",
            "pName" => "total data",
            "generate_done" => "sudah generate",
            "generate_done_persen" => "sudah generate (%)",
            "generate_wait" => "belum generate",
            "generate_wait_persen" => "belum generate (%)",
        );
        $nof = 0;
        $items = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($result) > 0) {
            $generate_done = 0;
            $generate_wait = 0;
            foreach ($result as $spec) {
//                arrPrintKuning($spec);
                if ($spec->status == 1) {
                    $generate_done += 1;
                }
                if ($spec->status == 0) {
                    $generate_wait += 1;
                }
            }
            $total_data = sizeof($result);
            $generate_done_persen = ($generate_done / $total_data) * 100;
            $generate_wait_persen = ($generate_wait / $total_data) * 100;


            $items[] = array(
                "pID" => $pID,
                "pName" => $total_data,
                "generate_done" => $generate_done,
                "generate_done_persen" => $generate_done_persen,
                "generate_wait" => $generate_wait,
                "generate_wait_persen" => $generate_wait_persen,
            );


        }


        $data = array(
            "mode" => "index",
            "title" => "",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
        );
        $this->load->view("tool", $data);
    }


    //-------------------------------------------------
    public function patchFifoSupplies()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlFifoSupplies");
        $this->load->model("Mdls/MdlFifoSuppliesProses");

        //region fifo supplies reguler
        $fs = New MdlFifoSupplies();
        $fs->addFilter("unit>0");
//        $fs->addFilter("transaksi_jenis is null");
        $fsTmp = $fs->lookupAll()->result();
        showLast_query("biru");
        $trIDs = array();
        $fifoUpdate = array();
        foreach ($fsTmp as $fsSpec) {
            $trIDs[$fsSpec->transaksi_id] = $fsSpec->transaksi_id;
            //-----
            $id = $fsSpec->id;
            $unit = $fsSpec->unit;
            $hpp_nppv = $fsSpec->hpp;
            $hpp_riil = ($hpp_nppv * 100) / 110;
            $ppv_riil = $hpp_nppv - $hpp_riil;
            $sub_hpp_riil = $hpp_riil * $unit;
            $sub_ppv_riil = $ppv_riil * $unit;

            $fifoUpdate[$id] = array(
                "hpp_riil" => $hpp_riil,
                "jml_nilai_riil" => $sub_hpp_riil,
                "ppv_riil" => $ppv_riil,
                "ppv_nilai_riil" => $sub_ppv_riil,
            );
        }
        //endregion

        //region fifo supplies proses
        $fs = New MdlFifoSuppliesProses();
        $fs->addFilter("unit>0");
//        $fs->addFilter("transaksi_jenis is null");
        $fsTmp = $fs->lookupAll()->result();
        showLast_query("biru");
        $trIDss = array();
        $fifoUpdateProses = array();
        foreach ($fsTmp as $fsSpec) {
            $trIDss[$fsSpec->transaksi_id] = $fsSpec->transaksi_id;
            //-----
            $id = $fsSpec->id;
            $unit = $fsSpec->unit;
            $hpp_nppv = $fsSpec->hpp;
            $hpp_riil = ($hpp_nppv * 100) / 110;
            $ppv_riil = $hpp_nppv - $hpp_riil;
            $sub_hpp_riil = $hpp_riil * $unit;
            $sub_ppv_riil = $ppv_riil * $unit;

            $fifoUpdateProses[$id] = array(
                "hpp_riil" => $hpp_riil,
                "jml_nilai_riil" => $sub_hpp_riil,
                "ppv_riil" => $ppv_riil,
                "ppv_nilai_riil" => $sub_ppv_riil,
            );
        }
        //endregion


        $this->db->trans_start();

        $pakai_ini = 0;
        if ($pakai_ini == 1) {
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tr->addFilter("id in ('" . implode("','", $trIDs) . "')");
            $trTmp = $tr->lookupAll()->result();
            showLast_query("biru");
            $trDatas = array();
            foreach ($trTmp as $trSpec) {
                $trDatas[$trSpec->id] = array(
                    "id" => $trSpec->id,
                    "jenis" => $trSpec->jenis,
                    "jenis_master" => $trSpec->jenis_master,
                );
            }

            foreach ($trIDs as $trID) {
                $jenis_transaksi = $trDatas[$trID]["jenis"];

                $where = array(
                    "transaksi_id" => $trID
                );
                $data = array(
                    "transaksi_jenis" => $jenis_transaksi
                );
                $fs = New MdlFifoSupplies();
                $fs->updateData($where, $data);
                showLast_query("orange");
            }
        }


        $pakai_ini = 0;
        if ($pakai_ini == 1) {
            foreach ($fifoUpdate as $id => $update) {
                $where = array(
                    "id" => $id
                );
                $fs = New MdlFifoSupplies();
                $fs->updateData($where, $update);
                showLast_query("orange");
            }
        }

        $pakai_ini = 1;
        if ($pakai_ini == 1) {
            foreach ($fifoUpdateProses as $id => $update) {
                $where = array(
                    "id" => $id
                );
                $fs = New MdlFifoSuppliesProses();
                $fs->updateData($where, $update);
                showLast_query("hijau");
            }
        }


        mati_disini();
        $this->db->trans_commit();
        cekHijau("<h3>-- DONE --</h3>");
    }

    public function cekPpvSuppliesFifo()
    {
        $this->load->helper("he_mass_table_helper");
        $this->load->model("Mdls/MdlFifoSupplies");
        $this->load->model("Mdls/MdlFifoSuppliesProses");
        $this->load->model("Coms/ComRekening");

        //region fifo supplies reguler
        $fs = New MdlFifoSupplies();
        $fs->addFilter("unit>0");
//        $fs->addFilter("transaksi_jenis is null");
        $fsTmp = $fs->lookupAll()->result();
        showLast_query("biru");
        $supplies_reguler = 0;
        $supplies_riil = 0;
        $ppv_nilai_riil_reguler = 0;
        foreach ($fsTmp as $fsSpec) {
            //-----
            $id = $fsSpec->id;
            $unit = $fsSpec->unit;
            $hpp_nppv = $fsSpec->hpp;
            $jml_nilai_riil = $fsSpec->jml_nilai_riil;
            $ppv_nilai_riil = $fsSpec->ppv_nilai_riil;

            $supplies_reguler += $fsSpec->jml_nilai;
            $supplies_riil += $fsSpec->jml_nilai_riil;
            $ppv_nilai_riil_reguler += $ppv_nilai_riil;
//            $hpp_riil = ($hpp_nppv * 100) / 110;
//            $ppv_riil = $hpp_nppv - $hpp_riil;
//            $sub_hpp_riil = $hpp_riil * $unit;
//            $sub_ppv_riil = $ppv_riil * $unit;

        }
        //endregion

        //region fifo supplies proses
        $fs = New MdlFifoSuppliesProses();
        $fs->addFilter("unit>0");
//        $fs->addFilter("transaksi_jenis is null");
        $fsTmp = $fs->lookupAll()->result();
        showLast_query("biru");

        $supplies_proses_riil = 0;
        $supplies_proses = 0;
        $ppv_nilai_riil_proses = 0;
        foreach ($fsTmp as $fsSpec) {
            //-----
            $id = $fsSpec->id;
            $unit = $fsSpec->unit;
            $hpp_nppv = $fsSpec->hpp;
            $jml_nilai_riil = $fsSpec->jml_nilai_riil;
            $ppv_nilai_riil = $fsSpec->ppv_nilai_riil;

            $supplies_proses += $fsSpec->jml_nilai;
            $supplies_proses_riil += $fsSpec->jml_nilai_riil;
            $ppv_nilai_riil_proses += $ppv_nilai_riil;
        }
        //endregion

        $supplies_riil_total = $supplies_riil + $supplies_proses_riil;
        $supplies_total = $supplies_reguler + $supplies_proses;
        $ppv_supplies_total = $ppv_nilai_riil_reguler + $ppv_nilai_riil_proses;

//        cekHijau("<h3>total ppv supplies: $ppv_supplies_total</h3>");

        //-----------------------------------
        $rek = "hutang lain ppv";
        $cr = New ComRekening();
        $tmp = $cr->fetchMoves($rek);
        showLast_query("biru");
        $total_kredit_461 = 0;
        $total_debet_961 = 0;
        foreach ($tmp as $spec) {
//            arrprint($spec);
//            break;
            $jenis = $spec->jenis;
            $debet = $spec->debet;
            $kredit = $spec->kredit;
            if ($jenis == "461") {
                $total_kredit_461 += $kredit;
            }
            if ($jenis == "961") {
                $total_debet_961 += $debet;
            }
        }
        $ppv_supplies_netto = $total_kredit_461 - $total_debet_961;
        $ppv_adjust = $ppv_supplies_netto - $ppv_supplies_total;

        cekHere("supplies cost: $supplies_total");
        cekHere("supplies riil: $supplies_riil_total");
        cekHere("ppv 461: $total_kredit_461");
        cekHere("ppv 961: $total_debet_961");
        cekHere("ppv supplies netto: $ppv_supplies_netto");
        cekHere("ppv supplies stok: $ppv_supplies_total");
        cekHere("ppv adjust: $ppv_adjust");
    }

    public function adjustEfisiensiBom()
    {
        header("refresh:10");

        $this->load->library("FieldCalculator");
        $this->load->helper("he_angka");
        $cal = new FieldCalculator();
        $selectedParam = array("main,rsltItems");
        $iteratorMain = array(
            "master" => array(
                // jurnal ke 1 efisiensi pada supplies riil yang diambil
                array(
                    "comName" => "Jurnal",
                    "loop" => array(
                        "3020010" => "-hpp",//efisiensi
                        "5020050" => "-hpp",
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "jenis" => "jenisTr",
                        "transaksi_no" => "nomer",
                    ),
                    "srcGateName" => "main",
                    "srcRawGateName" => "main",
                ),
                array(
                    "comName" => "Rekening",
                    "loop" => array(
                        "3020010" => "-hpp",//efisiensi
                        "5020050" => "-hpp",//persediaan supplies proses yang diambil
                        //                            "{costID_1_coa}" => "-costNilai_1", // ex:overhead
                        //                            "{costID_2_coa}" => "-costNilai_2", // ex:biaya_kirim
                        //                            "{costID_3_coa}" => "-costNilai_3", // ex:tenaga_kerja
                        //                            "{costID_4_coa}" => "-costNilai_4", // ex:tenaga_kerja
                        //                            "{costID_5_coa}" => "-costNilai_5", // ex:tenaga_kerja
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "jenis" => "jenisTr",
                        "transaksi_no" => "nomer",
                    ),
                    "srcGateName" => "main",
                    "srcRawGateName" => "main",
                ),
                // pembantu efisiensi riil dari jurnal ke
                array(
                    "comName" => "RekeningPembantuEfisiensiBiayaMain",
                    "loop" => array(
                        "3020010" => "-hpp",//supplies BOM
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        //                            "extern2_id" => "costID_1",
                        //                            "extern2_nama" => "costName_1",
                        //                            "extern_id" => "efisiensiID_1_coa",
                        //                            "extern_id" => "costID_1",
                        //                            "extern_nama" => "efisiensiName_1_coa",
                        "extern_id" => ".6",
                        "extern_nama" => ".bahan baku",
                        "extern2_id" => ".6",
                        "extern2_nama" => ".bahan baku",
                        "jenis" => "jenisTr",
                        "transaksi_no" => "nomer",
                    ),
                    "srcGateName" => "main",
                    "srcRawGateName" => "main",
                ),

                // jurnal ke 2  supplies riil yang diambil pada efisiensi
                array(
                    "comName" => "Jurnal",
                    "loop" => array(
                        "3020010" => "hpp",//efisiensi
                        "5020050" => "hpp",
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "jenis" => "jenisTr",
                        "transaksi_no" => "nomer",
                    ),
                    "srcGateName" => "main",
                    "srcRawGateName" => "main",
                ),
                array(
                    "comName" => "Rekening",
                    "loop" => array(
                        "3020010" => "hpp",//efisiensi
                        "5020050" => "hpp",//persediaan supplies proses yang diambil
                        //                            "{costID_1_coa}" => "-costNilai_1", // ex:overhead
                        //                            "{costID_2_coa}" => "-costNilai_2", // ex:biaya_kirim
                        //                            "{costID_3_coa}" => "-costNilai_3", // ex:tenaga_kerja
                        //                            "{costID_4_coa}" => "-costNilai_4", // ex:tenaga_kerja
                        //                            "{costID_5_coa}" => "-costNilai_5", // ex:tenaga_kerja
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "jenis" => "jenisTr",
                        "transaksi_no" => "nomer",
                    ),
                    "srcGateName" => "main",
                    "srcRawGateName" => "main",
                ),
                // pembantu efisiensi riil dari jurnal ke
                array(
                    "comName" => "RekeningPembantuEfisiensiBiayaMain",
                    "loop" => array(
                        "3020010" => "hpp",//supplies BOM
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        //                            "extern2_id" => "costID_1",
                        //                            "extern2_nama" => "costName_1",
                        //                            "extern_id" => "efisiensiID_1_coa",
                        //                            "extern_id" => "costID_1",
                        //                            "extern_nama" => "efisiensiName_1_coa",
                        "extern_id" => ".6",
                        "extern_nama" => ".bahan baku",
                        "extern2_id" => ".6",
                        "extern2_nama" => ".bahan baku",
                        "jenis" => "jenisTr",
                        "transaksi_no" => "nomer",
                    ),
                    "srcGateName" => "main",
                    "srcRawGateName" => "main",
                ),

            ),
            "detail" => array(
                //efisiensi in
                array(
                    "comName" => "RekeningPembantuEfisiensiBiaya",
                    "loop" => array(
                        //                            "3020010" => "sub_nilai_supplies",//bahan baku dengan nilai bom
                        "3020010" => "-sub_hpp",//bahan baku dengan nilai bom
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "extern_id" => "id",
                        "extern_nama" => "nama",
                        "extern2_id" => ".6",
                        "extern2_nama" => ".bahan baku",
                        "produk_qty" => "jml",
                        "produk_nilai" => "hpp",
                        "gudang_id" => "gudangID",
                        // "jenis" => "jenisTr",
                        // "transaksi_no" => "nomer",
                    ),
                    "srcGateName" => "rsltItems",
                    "srcRawGateName" => "rsltItems",
                ),
                //bahan baku in
                array(
                    "comName" => "RekeningPembantuBiayaKomposisiProduksi",
                    "loop" => array(
                        "5020050" => "-sub_hpp", // isi loop adalah overhead,tenaga kerja,biaya kirim
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "extern_id" => "id", // ID supplies
                        "extern_nama" => "nama", // NAME supplies
                        "extern2_id" => ".6", // ID biaya
                        "extern2_nama" => ".bahan baku", // label biaya
                        "jenis" => "jenisTr",
                        "produk_qty" => "jml",
                        "produk_nilai" => "hpp",
                        "gudang_id" => "gudangID",
                    ),
                    "srcGateName" => "rsltItems",
                    "srcRawGateName" => "rsltItems",
                ),
                //bahan baku out ke efisiensi jurnal 2
                array(
                    "comName" => "RekeningPembantuBiayaKomposisiProduksi",
                    "loop" => array(
                        "5020050" => "sub_hpp", // isi loop adalah overhead,tenaga kerja,biaya kirim
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "extern_id" => "id", // ID supplies
                        "extern_nama" => "nama", // NAME supplies
                        "extern2_id" => ".6", // ID biaya
                        "extern2_nama" => ".bahan baku", // label biaya
                        "jenis" => "jenisTr",
                        "produk_qty" => "jml",
                        "produk_nilai" => "hpp",
                        "gudang_id" => "gudangID",
                    ),
                    "srcGateName" => "rsltItems",
                    "srcRawGateName" => "rsltItems",
                ),
                //efisiensi out
                array(
                    "comName" => "RekeningPembantuEfisiensiBiaya",
                    "loop" => array(
                        //                            "3020010" => "sub_nilai_supplies",//bahan baku dengan nilai bom
                        "3020010" => "sub_hpp",//bahan baku dengan nilai bom
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "extern_id" => "id",
                        "extern_nama" => "nama",
                        "extern2_id" => ".6",
                        "extern2_nama" => ".bahan baku",
                        "produk_qty" => "jml",
                        "produk_nilai" => "hpp",
                        "gudang_id" => "gudangID",
                        "jenis" => "jenisTr",
                        "transaksi_no" => "nomer",
                    ),
                    "srcGateName" => "rsltItems",
                    "srcRawGateName" => "rsltItems",
                ),

            ),
        );
        $jenisTr = $jenisTrMaster = "776";
        $this->load->model("MdlTransaksi");
        $tr = new MdlTransaksi();
        $cek = 0; //ini kolom tabel transaksi
        $tr->addFilter("jenis='776'");
        $tr->addFilter("cek='$cek'");
        $this->db->order_by("id", "asc");
        // $tr->addFilter("id='173695'");//untuk tembak aja
        $this->db->limit(1);
        $tempTr = $tr->lookupMainTransaksi()->result();
        $this->db->trans_start();
        // cekMerah($this->db->last_query());
        if (sizeof($tempTr) > 0) {
            $trID = $transaksiID = $tempTr[0]->id;
            $trNomer = $tmpNomorNota = $tempTr[0]->nomer;
            $dtime = $tempTr[0]->dtime;
            $fulldate = $tempTr[0]->fulldate;

            $trTmpCabangID = $tempTr[0]->cabang_id;

            $configUi = loadConfigModulJenis_he_misc($jenisTrMaster, "coTransaksiUi");

            //lookUpRegistry
            $tr->setFilters(array());
            $tr->addFilter("transaksi_id='$trID'");
            //        $trr->addFilter("param='main'");
            // $trr->setJointSelectFields("main");
            $tmpReg = $tr->lookupDataRegistries()->result();
            cekMErah($this->db->last_query());
            $main = array();
            $rsltItems = array();
            foreach ($tmpReg as $tmpReg_0) {
                $main = blobDecode($tmpReg_0->main);
                $rsltItems = blobDecode($tmpReg_0->rsltItems);
            }
            // matiHEre();
// arrPrint($rsltItems);
            cekHitam($trNomer . " || " . $trID);
            $olehNama = isset($main['olehNama']) ? $main['olehNama'] : $main['olehName'];
            $stepNumber = "3";


            //region BUILD TABEL DATABASE OTOMATIS
            $cliComponent = "components";
            $buildTablesDetail = isset($iteratorMain['detail']) ? $iteratorMain['detail'] : array();
            //arrPrintWebs($buildTablesDetail);
            if (sizeof($buildTablesDetail) > 0) {
                foreach ($buildTablesDetail as $buildTablesDetail_specs) {
                    //arrPrintWebs($buildTablesDetail_specs);
                    $buildTablesDetail_specs_result = $buildTablesDetail_specs;
                    $srcGateName = $buildTablesDetail_specs['srcGateName'];
                    $srcRawGateName = $buildTablesDetail_specs['srcRawGateName'];
                    $specData = $$srcGateName;
                    foreach ($specData as $itemSpec) {

                        //arrPrintWebs($itemSpec);
                        $mdlName = $buildTablesDetail_specs['comName'];
                        //cekBiru("== $mdlName ==");
                        if (substr($mdlName, 0, 1) == "{") {
                            $mdlName = trim($mdlName, "{");
                            $mdlName = trim($mdlName, "}");
                            $mdlName = str_replace($mdlName, $itemSpec[$mdlName], $mdlName);
                        }

                        //cekBiru("== $mdlName ==");
                        if (isset($buildTablesDetail_specs['loop'])) {
                            foreach ($buildTablesDetail_specs['loop'] as $key => $val) {
                                //cekKuning(":: $key => $val ::");
                                unset($buildTablesDetail_specs_result['loop']);
                                if (substr($key, 0, 1) == "{") {
                                    $key = trim($key, "{");
                                    $key = trim($key, "}");
                                    $key = str_replace($key, $itemSpec[$key], $key);
                                }
                                $buildTablesDetail_specs_result['loop'][$key] = $val;
                                //                                cekHitam("LINE: " . __LINE__ . " ::sini bukan??  akan build tabel detail $key");
                            }
                        }

                        //arrPrintWebs($buildTablesDetail_specs_result['loop']);
                        //                        cekHere($mdlName . " == " . $srcGateName);
                        $mdlName = "Com" . $mdlName;
                        $this->load->model("Coms/" . $mdlName);
                        $m = new $mdlName();
                        if (method_exists($m, "getTableNameMaster")) {
                            if (sizeof($m->getTableNameMaster())) {
                                //                                cekMerah(":: $mdlName ::");
                                //                                arrPrintWebs($buildTablesDetail_specs_result);
                                $m->buildTables($buildTablesDetail_specs_result);
                            }
                        }
                    }
                }
            }
            else {
                cekMerah(":: TIDAK ADA CONFIG cliComponent");
            }
            //endregion


            //region mster
            $iterator = $iteratorMain["master"];
            $componentConfig['master'] = $iterator;

            $it = 0;
            //==filter nilai, jika NOL tidak dikirim, sesuai config==
            $compValidators = ($this->config->item('transaksi_value_required_components') != null) ? $this->config->item('transaksi_value_required_components') : array();
            foreach ($iterator as $cCtr => $tComSpec) {
                $it++;
                $comName = $tComSpec['comName'];
                $srcGateName = $tComSpec['srcGateName'];
                $srcRawGateName = $tComSpec['srcRawGateName'];
                echo "component #$it: $comName :: $srcGateName <br>";
                // matiHEre($$srcGateName);
                $dSpec = $$srcGateName;
                $tmpOutParams = array();
                if (isset($tComSpec['loop'])) {
                    foreach ($tComSpec['loop'] as $key => $value) {
                        if (substr($key, 0, 1) == "{") {
                            $key = trim($key, "{");
                            $key = trim($key, "}");
                            //                            $key = str_replace($key, $_SESSION[$cCode]['main'][$key], $key);
                            $key = str_replace($key, $dSpec[$key], $key);
                        }
                        $realValue = makeValue($value, $dSpec, $dSpec, 0);
                        if ($key != null) {
                            $tmpOutParams['loop'][$key] = $realValue;
                        }

                    }
                }
                //                cekBiru($tmpOutParams);
                //                mati_disini(__LINE__);
                if (isset($tComSpec['static'])) {
                    foreach ($tComSpec['static'] as $key => $value) {

                        $realValue = makeValue($value, $dSpec, $dSpec, 0);
                        $tmpOutParams['static'][$key] = $realValue;
                        cekHijau(":: NORMAL :: $key => $realValue ::");
                    }
                    // if (isset($paramPatchers[$comName]) && sizeof($paramPatchers[$comName]) > 0) {
                    //     cekHijau(":: masuk ke PATCHER ::");
                    //     foreach ($paramPatchers[$comName] as $k => $v) {
                    //         cekHijau(":: ada yang mau di-PATCHER ::");
                    //         arrPrint($tmpOutParams['static']);
                    //         if (!isset($tmpOutParams['static'][$k])) {
                    //             $tmpOutParams['static'][$k] = isset($$v) ? $$v : "_v";
                    //             cekHijau(":: PATCHER :: $key => $realValue ::");
                    //         }
                    //
                    //     }
                    // }
                    // else {
                    //     cekMerah(":: TIDAK TERMASUK PATCHER ::");
                    // }
                    // if (isset($paramForceFillers[$comName]) && sizeof($paramForceFillers[$comName]) > 0) {
                    //     $jenis = $_SESSION[$cCode]['main']['jenis'];
                    //     foreach ($paramForceFillers[$comName] as $k => $v) {
                    //         $tmpOutParams['static'][$k] = isset($$v) ? $$v : "_v";
                    //         cekHijau(":: FORCEFILL :: $key => $realValue ::");
                    //     }
                    // }
                    $tmpOutParams['static']["transaksi_id"] = $trID;
                    $tmpOutParams['static']["transaksi_no"] = $trNomer;
                    $tmpOutParams['static']["urut"] = $cCtr;
                    $tmpOutParams['static']["fulldate"] = $dSpec["fulldate"];
                    $tmpOutParams['static']["dtime"] = $dSpec["dtime"];
                    // $tmpOutParams['static']["keterangan"] = $this->configUi[$this->jenisTr]['steps'][$stepNum]['label'] . " nomor " . $tmpNomorNota . " oleh " . $this->session->login['nama'];


                }
                // if (isset($tComSpec['static2'])) {
                //     foreach ($tComSpec['static2'] as $key => $value) {
                //
                //         $realValue = makeValue($value, $_SESSION[$cCode][$srcGateName], $_SESSION[$cCode][$srcGateName], 0);
                //         $tmpOutParams['static2'][$key] = $realValue;
                //
                //     }
                //     if (isset($paramPatchers[$comName]) && sizeof($paramPatchers[$comName]) > 0) {
                //         foreach ($paramPatchers[$comName] as $k => $v) {
                //             if (!isset($subParams['static'][$k])) {
                //                 $subParams['static'][$k] = isset($$v) ? $$v : "_v";
                //             }
                //         }
                //     }
                //     if (isset($paramForceFillers[$comName]) && sizeof($paramForceFillers[$comName]) > 0) {
                //         $jenis = $_SESSION[$cCode]['main']['jenis'];
                //         foreach ($paramForceFillers[$comName] as $k => $v) {
                //             $subParams['static'][$k] = isset($$v) ? $$v : "_v";
                //         }
                //     }
                //     $tmpOutParams['static2']["fulldate"] = date("Y-m-d");
                //     $tmpOutParams['static2']["dtime"] = date("Y-m-d H:i:s");
                //     $tmpOutParams['static2']["keterangan"] = $this->configUi[$this->jenisTr]['steps'][$stepNum]['label'] . " nomor " . $tmpNomorNota . " oleh " . $this->session->login['nama'];
                //
                //
                // }

                //lgShowError("Ada kesalahan",);
                $mdlName = "Com" . ucfirst($comName);
                $this->load->model("Coms/" . $mdlName);
                $m = new $mdlName();

                //===filter value nol, jika harus difilter
                $tobeExecuted = true;

                if (in_array($mdlName, $compValidators)) {

                    $loopParams = isset($tmpOutParams['loop']) ? $tmpOutParams['loop'] : array();
                    if (sizeof($loopParams) > 0) {
                        foreach ($loopParams as $key => $val) {
                            cekmerah("$comName : $key = $val ");
                            if ($val == 0) {
                                unset($tmpOutParams['loop'][$key]);
                            }
                        }
                    }
                    if (sizeof($tmpOutParams['loop']) < 1) {
                        $tobeExecuted = false;
                    }

                }


                if ($tobeExecuted) {
                    cekBiru("kiriman komponen $comName");
                    arrPrint($tmpOutParams);
                    $m->pair($tmpOutParams) or die("Tidak berhasil memasang  values pada komponen: $comName/" . $this->jenisTr . "/" . __FUNCTION__ . "/" . __LINE__);
                    $m->exec() or die("Gagal saat berusaha  exec values pada komponen: $comName/" . $this->jenisTr . "/" . __FUNCTION__ . "/" . __LINE__);
                    cekMErah($this->db->last_query());;
                }
                else {
                    cekBiru("komponem $comName tidak memenuhi syarat untuk ditulis");
                }

                $componentGate['master'][$cCtr] = $tmpOutParams;
            }
            //endregion

            //region detail
            //region ----------subcomponents by cli
            //<editor-fold desc="----------subcomponents by cli">
            // $paramPatchers = $this->config->item('heTransaksi_paramPatchers') != null ? $this->config->item('heTransaksi_paramPatchers') : array();
            // $paramForceFillers = $this->config->item('heTransaksi_paramForceFillers') != null ? $this->config->item('heTransaksi_paramForceFillers') : array();
            // $validateSubComponent = $this->config->item('heTransaksi_validateComponentDetail') != null ? $this->config->item('heTransaksi_validateComponentDetail') : array();

            $componentGate['detail'] = array();
            $componentConfig['master'] = array();
            $componentConfig['detail'] = array();
            // if (isset($configCore['relativeComponets']) && $configCore['relativeComponets'] == true) {
            //     $iterator = isset($registryGates['revert']['jurnal']['detail']) ? $registryGates['revert']['jurnal']['detail'] : array();
            //     $revertedTarget = $registryGates['main']['pihakExternID'];
            //     $componentConfig['detail'] = $iterator;
            //     $componentConfig['master'] = isset($registryGates['revert']['jurnal']['master']) ? $registryGates['revert']['jurnal']['master'] : array();
            // }
            // else {
            //     $iterator = isset($configCore[$cliComponent][$jenisTr]['detail']) ? $configCore[$cliComponent][$jenisTr]['detail'] : array();
            //     $componentConfig['detail'] = $iterator;
            //     $componentConfig['master'] = isset($configCore[$cliComponent][$jenisTr]['master']) ? $configCore[$cliComponent][$jenisTr]['master'] : array();
            //
            //     $revertedTarget = "";
            //
            // }

            $iterator = $iteratorMain["detail"];
            $componentConfig['detail'] = $iterator;
            // arrPrint($iterator);
            // matiHEre();
            $subComModel = array();
            if (sizeof($iterator) > 0) {
                $compValidators = ($this->config->item('transaksi_value_required_components') != null) ? $this->config->item('transaksi_value_required_components') : array();
                $filterNeeded = false;

                $arrRekeningLoop = array();

                //                if (in_array($mdlName, $compValidators)) {//perlu validasi filter
                //                    $filterNeeded = true;
                //                }
                foreach ($iterator as $cCtr => $tComSpec) {
                    $comName_orig = $comName = $tComSpec['comName'];
                    $srcGateName = $tComSpec['srcGateName'];
                    $loopRequire = isset($tComSpec['loopRequire']) ? $tComSpec['loopRequire'] : false;
                    $srcRawGateName = $tComSpec['srcRawGateName'];

                    echo "sub-component: $comName, $srcGateName, initializing values <br>";
                    $paramSpec = $$srcGateName;
                    $tmpOutParams[$cCtr] = array();
                    foreach ($paramSpec as $id => $dSpec) {
                        $comName = $comName_orig;
                        if (substr($comName, 0, 1) == "{") {
                            $comName = trim($comName, "{");
                            $comName = trim($comName, "}");
                            $comName = str_replace($comName, $paramSpec[$id][$comName], $comName);
                            $tComSpec['comName'] = $comName;
                            $iterator[$cCtr]['comName'] = $comName;
                        }
                        //                        $subComModel[$comName] = $comName;
                        $filterNeeded = false;
                        $mdlName = "Com" . ucfirst($comName);
                        if (in_array($mdlName, $compValidators)) {//perlu validasi filter
                            $filterNeeded = true;
                        }


                        $subParams = array();
                        if (isset($tComSpec['loop'])) {
                            foreach ($tComSpec['loop'] as $key => $value) {
                                if (substr($key, 0, 1) == "{") {
                                    $key = trim($key, "{");
                                    $key = trim($key, "}");
                                    $key = str_replace($key, $paramSpec[$id][$key], $key);
                                }

                                $subComModel[$key] = $comName;

                                $realValue = makeValue($value, $paramSpec[$id], $paramSpec[$id], 0);

                                if (strlen($key) > 1) {
                                    $subParams['loop'][$key] = $realValue;
                                }
                                else {
                                    $subParams['loop'] = array();
                                }

                                // =================== =================== ===================
                                if (!isset($arrRekeningLoop[$dSpec[$tComSpec['static']['cabang_id']]][$key])) {
                                    $arrRekeningLoop[$dSpec[$tComSpec['static']['cabang_id']]][$key] = 0;
                                }
                                $arrRekeningLoop[$dSpec[$tComSpec['static']['cabang_id']]][$key] += $realValue;
                                if ($realValue != 0) {
                                    // cekUngu(":: cetak loop $key => $realValue ::");
                                }

                                if ($filterNeeded) {
                                    if ($subParams['loop'][$key] == 0) {
                                        unset($subParams['loop'][$key]);

                                        // =================== =================== ===================
                                    }
                                }
                            }
                        }
                        if (isset($tComSpec['static'])) {
                            foreach ($tComSpec['static'] as $key => $value) {

                                $realValue = makeValue($value, $paramSpec[$id], $paramSpec[$id], 0);
                                $subParams['static'][$key] = $realValue;
                                //                                cekKuning("STATIC: $key diisi dengan $realValue");
                            }
                            // if (isset($paramPatchers[$comName]) && sizeof($paramPatchers[$comName]) > 0) {
                            //     foreach ($paramPatchers[$comName] as $k => $v) {
                            //         if (!isset($subParams['static'][$k])) {
                            //             $subParams['static'][$k] = isset($$v) ? $$v : "_v";
                            //             cekOrange("fill :: $comName :: $k ($v) => " . $subParams['static'][$k]);
                            //         }
                            //     }
                            // }
                            // if (isset($paramForceFillers[$comName]) && sizeof($paramForceFillers[$comName]) > 0) {
                            //
                            //     $jenis = $registryGates['main']['jenis'];
                            //     foreach ($paramForceFillers[$comName] as $k => $v) {
                            //         $subParams['static'][$k] = isset($$v) ? $$v : "_v";
                            //         cekOrange("fillforce :: $comName :: $k ($v) => " . $subParams['static'][$k]);
                            //     }
                            // }
                            $subParams['static']["fulldate"] = $fulldate;
                            $subParams['static']["dtime"] = $dtime;
                            $subParams['static']["keterangan"] = $configUi['steps'][$stepNumber]['label'] . " nomor " . $tmpNomorNota . " oleh " . $olehNama;
                            //------
                            $subParams['static']["reference_id"] = isset($dSpec["referenceID"]) ? $dSpec["referenceID"] : "";
                            $subParams['static']["reference_nomer"] = isset($dSpec["referenceNomer"]) ? $dSpec["referenceNomer"] : "";
                            $subParams['static']["reference_jenis"] = isset($dSpec["jenisTr_reference"]) ? $dSpec["jenisTr_reference"] : "";
                            $subParams['static']["reference_id_top"] = isset($dSpec["referenceID_top"]) ? $dSpec["referenceID_top"] : "";
                            $subParams['static']["reference_nomer_top"] = isset($dSpec["referenceNomer_top"]) ? $dSpec["referenceNomer_top"] : "";
                            $subParams['static']["reference_jenis_top"] = isset($dSpec["pihakExternMasterID"]) ? $dSpec["pihakExternMasterID"] : "";
                            $subParams['static']["transaksi_id"] = $trID;
                            $subParams['static']["transaksi_no"] = $trNomer;
                            $subParams['static']["nomer"] = $trNomer;
                            $subParams['static']["jenis"] = $jenisTr;

                            //------
                            // if (strlen($revertedTarget) > 1) {
                            //     $subParams['static']['reverted_target'] = $revertedTarget;
                            // }
                        }
                        if (sizeof($subParams) > 0) {
                            if ($filterNeeded) {
                                if (isset($subParams['loop']) && !empty($subParams['loop'])) {
                                    $tmpOutParams[$cCtr][] = $subParams;
                                }
                            }
                            else {
                                if (empty($subParams['loop']) && $loopRequire == true) {
                                    unset($tmpOutParams[$cCtr]);
                                }
                                else {
                                    $tmpOutParams[$cCtr][] = $subParams;
                                }
                            }
                        }
                    }

                    $componentGate['detail'][$cCtr] = $subParams;
                }

                $it = 0;
                foreach ($iterator as $cCtr => $tComSpec) {
                    // matiHere(__LINE__);
                    $it++;
                    $comName = $tComSpec['comName'];
                    $srcGateName = $tComSpec['srcGateName'];
                    $srcRawGateName = $tComSpec['srcRawGateName'];

                    echo __LINE__ . " sub $cCtr component #$it: $comName, sending values <br>";

                    $mdlName = "Com" . ucfirst($comName);
                    $this->load->model("Coms/" . $mdlName);
                    $m = new $mdlName();

                    if (isset($tmpOutParams[$cCtr]) && sizeof($tmpOutParams[$cCtr]) > 0) {
                        $tobeExecuted = true;
                    }
                    else {
                        $tobeExecuted = false;
                    }


                    if ($tobeExecuted) {
                        $m->pair($tmpOutParams[$cCtr]) or die("Tidak berhasil memasang  values pada komponen: $comName/" . $jenisTrMaster . "/" . __FUNCTION__ . "/" . __LINE__);
                        $m->exec() or die("Gagal saat berusaha  exec values pada komponen: $comName/" . $jenisTrMaster . "/" . __FUNCTION__ . "/" . __LINE__);
                        cekHitam($this->db->last_query());
                    }
                    else {
                        cekBiru("sub-komponem $comName tidak memenuhi syarat untuk ditulis");
                    }
                }

                cekMerah("HAHAHA");
                $pakai_ini = 0;
                if ($pakai_ini == 1) {
                    // region baca jurnal rekening besar
                    $jn = New ComJurnal();
                    $jn->addFilter("transaksi_id='$transaksiID'");
                    $jnTmp = $jn->lookupAll()->result();
                    //                    arrPrint($jnTmp);
                    $arrJurnal = array();
                    if (sizeof($jnTmp) > 0) {
                        foreach ($jnTmp as $ii => $spec) {
                            $defPosition = detectRekDefaultPosition($spec->rekening);
                            switch ($defPosition) {
                                case "debet":
                                    $arrJurnal[$spec->cabang_id][$spec->rekening] = $spec->debet > 0 ? $spec->debet : $spec->kredit * -1;
                                    break;
                                case "kredit":
                                    $arrJurnal[$spec->cabang_id][$spec->rekening] = $spec->kredit > 0 ? $spec->kredit : $spec->debet * -1;
                                    break;
                                default:
                                    mati_disini("tidak menemukan default posisi rekening...");
                                    break;
                            }
                        }
                    }
                    // endregion

                    cekHere("cetak array jurnal");
                    arrPrint($arrJurnal);

                    cekHere("cetak rek loop");
                    arrPrint($arrRekeningLoop);


                    if (sizeof($arrJurnal) > 0) {
                        if (sizeof($arrRekeningLoop) > 0) {
                            foreach ($arrRekeningLoop as $cabang_id => $loopSpec) {
                                foreach ($loopSpec as $rekening => $rekValue) {
                                    if (array_key_exists($rekening, $arrJurnal[$cabang_id])) {
                                        if (floor($rekValue) != floor($arrJurnal[$cabang_id][$rekening])) {
                                            mati_disini("nilai $rekening, jurnal: " . floor($arrJurnal[$cabang_id][$rekening]) . ", akumulasi pembantu: " . floor($rekValue));
                                        }
                                        else {
                                            cekHijau(":: COCOK ::");
                                        }
                                    }
                                }
                            }
                        }
                    }


                }


                // validasi rekening besar vs rekening pembantu
                validateBalancesComparison($trTmpCabangID, $componentGate, $componentConfig, "detail", $transaksiID, $tmpNomorNota);

            }
            else {
                cekMerah("subcomponents is not set");
            }


            //</editor-fold>
            //endregion

            //endregion

            //region update transaksi supaya tidak di eksekusi lagi
            $tr->setFilters(array());
            $update = array("cek" => "1");
            $where = array("id" => $trID);
            $tr->updateData($where, $update) or matiHere("gagal update");
            //endregion
        }
        else {
            cekHitam("sudah habis untuk dieksekusi broo ");
        }

        // cekHitam($this->db->last_query());
        // mati_disini(__FUNCTION__ . "  TRANSAKSI BERHASIL (UNDER MAINTENANCE)  <br> silahkan tutup browser terlebih dahulu. <br>execute in " . $val . " ms");

        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        cekMerah("selesai bro");

    }


    public function cekPaymentSource()
    {
        $this->load->helper("he_mass_table_helper");
        $this->load->model("Coms/ComRekening");
        $this->load->model("Coms/ComRekeningPembantuCustomer");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlCustomer");
        $this->load->model("MdlTransaksi");
        $masterConfigUI = $this->config->item("heTransaksi_ui");

        $arrUangMukaSrc = array();
        $arrHutangKeKonsumen = array();
        $arrSaldo = array();
        $arrTotalBawah = array();
        $arrTransaksiIDs = array();

        $rekening = "2010050";
        $cabang_ids = array(
//            "-1",
//            "1",
            "21",
//            "25",
//            "26",
//            "27",
//            "28",
//            "29",
//            "30",
//            "31",
        );
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        $cabang_id = $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : 21;
        //------------------------------------
        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['0'] = "Semua";
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
                if ($cabang_id == 0) {
                    $items_new[$cabSpec->id] = (array)$cabSpec;
                    $items_new[$cabSpec->id]["extern_id"] = $cabSpec->id;
                    $items_new[$cabSpec->id]["extern_nama"] = $cabSpec->nama;
                }
            }
        }
        //------------------------------------
        $cs = new MdlCustomer();
        $cs->setFilters(array());
        $arrCustomerData = $cs->lookupAll()->result();
        foreach ($arrCustomerData as $csSpec) {
            if ($cabang_id != 0) {
                $items_new[$csSpec->id] = (array)$csSpec;
                $items_new[$csSpec->id]["extern_id"] = $csSpec->id;
                $items_new[$csSpec->id]["extern_nama"] = $csSpec->nama;
            }
        }
        //------------------------------------

        //region hutang ke konsumen
        $crpc = New ComRekeningPembantuCustomer();
        if ($cabang_id != 0) {
            $crpc->addFilter("cabang_id=$cabang_id");
        }
        $crpcTmp = $crpc->fetchBalances($rekening);
//        showLast_query("biru");
        if (sizeof($crpcTmp) > 0) {
            foreach ($crpcTmp as $crpcSpec) {
                $debet = $crpcSpec->debet;
                $kredit = $crpcSpec->kredit;
                $cabang_id_db = $crpcSpec->cabang_id;
                $cabang_nama_db = $crpcSpec->cabang_nama;
                $extern_id = $crpcSpec->extern_id;
                $extern_nama = $crpcSpec->extern_nama;
//                $arrHutangKeKonsumen[$extern_id] = array(
//                    "extern_id" => $extern_id,
//                    "extern_nama" => $extern_nama,
//                    "debet" => $debet,
//                    "kredit" => $kredit,
//                );
                if ($cabang_id != 0) {
                    $arrHutangKeKonsumen[$extern_id]["extern_id"] = $extern_id;
                    $arrHutangKeKonsumen[$extern_id]["extern_nama"] = $extern_nama;
                    $arrHutangKeKonsumen[$extern_id]["debet"] = $debet;
                    $arrHutangKeKonsumen[$extern_id]["kredit"] = $kredit;
                }
                else {
                    $arrHutangKeKonsumen[$cabang_id_db]["extern_id"] = $cabang_id_db;
                    $arrHutangKeKonsumen[$cabang_id_db]["extern_nama"] = $cabang_nama_db;
                    if (!isset($arrHutangKeKonsumen[$cabang_id_db]["debet"])) {
                        $arrHutangKeKonsumen[$cabang_id_db]["debet"] = 0;
                    }
                    if (!isset($arrHutangKeKonsumen[$cabang_id_db]["kredit"])) {
                        $arrHutangKeKonsumen[$cabang_id_db]["kredit"] = 0;
                    }
                    $arrHutangKeKonsumen[$cabang_id_db]["debet"] += $debet;
                    $arrHutangKeKonsumen[$cabang_id_db]["kredit"] += $kredit;
                }
            }
        }
        //endregion

        // region pym uang muka
        $jenis = "customer";
        $trm = New MdlTransaksi();
        $trm->setFilters(array());
//        $trm->addFilter("trash=0");
        if ($cabang_id != 0) {
            $trm->addFilter("cabang_id=$cabang_id");
        }
        $trmTmp = $trm->lookupUangMukaSrc($jenis)->result();
//        arrPrint($trmTmp);
        if (sizeof($trmTmp) > 0) {
            foreach ($trmTmp as $trmSpec) {
//                cekHere(":: $cabang_id ::");
//                if($cabang_id != 0){
                $arrUangMukaSrcExt[$trmSpec->extern_id] = array(
                    "extern_id" => $trmSpec->extern_id,
                    "extern_nama" => $trmSpec->extern_nama,
                    "cabang_id" => $trmSpec->cabang_id,
                    "cabang_nama" => $trmSpec->cabang_nama,
                );
                if (!isset($arrUangMukaSrcExt[$trmSpec->extern_id]['sisa'])) {
                    $arrUangMukaSrcExt[$trmSpec->extern_id]['sisa'] = 0;
                }
                $arrUangMukaSrcExt[$trmSpec->extern_id]['sisa'] += $trmSpec->sisa;
//                }
//                else{
//                    $arrUangMukaSrcCab[$trmSpec->cabang_id] = array(
//                        "extern_id" => $trmSpec->cabang_id,
//                        "extern_nama" => $trmSpec->cabang_nama,
//                        "cabang_id" => $trmSpec->cabang_id,
//                        "cabang_nama" => $trmSpec->cabang_nama,
//                    );
                if (!isset($arrUangMukaSrcCab[$trmSpec->cabang_id]['sisa'])) {
                    $arrUangMukaSrcCab[$trmSpec->cabang_id]['sisa'] = 0;
                }
                $arrUangMukaSrcCab[$trmSpec->cabang_id]['sisa'] += $trmSpec->sisa;
//                }
            }
            if ($cabang_id != 0) {
                $arrUangMukaSrc = $arrUangMukaSrcExt;
            }
            else {
                $arrUangMukaSrc = $arrUangMukaSrcCab;
            }
            foreach ($arrUangMukaSrc as $cus_id => $cusSpec) {
                $items_new[$cus_id]["pym_uang_muka"] = $cusSpec["sisa"];
            }
        }
        // endregion pym uang muka
//        cekBiru(sizeof($arrUangMukaSrc));
//        arrPrintWebs($arrUangMukaSrc);
//        arrPrintWebs($arrUangMukaSrcCab);
//        cekHere(sizeof($items_new));

        // region return penjualan
        $jenis = "piutang dagang";
        $trm = New MdlTransaksi();
        $trm->setFilters(array());
        $trm->addFilter("trash=0");
        if ($cabang_id != 0) {
            $trm->addFilter("cabang_id=$cabang_id");
        }
        $trmTmp = $trm->lookupPaymentAntiSrcByLabel($jenis)->result();
//        showLast_query("biru");
        if (sizeof($trmTmp) > 0) {
            foreach ($trmTmp as $trmSpec) {
//                if($cabang_id != 0){
                $arrAntiSrcExt[$trmSpec->extern_id] = array(
                    "extern_id" => $trmSpec->extern_id,
                    "extern_nama" => $trmSpec->extern_nama,
                    "cabang_id" => $trmSpec->cabang_id,
                    "cabang_nama" => $trmSpec->cabang_nama,
                );
                if (!isset($arrAntiSrcExt[$trmSpec->extern_id]['sisa'])) {
                    $arrAntiSrcExt[$trmSpec->extern_id]['sisa'] = 0;
                }
                $arrAntiSrcExt[$trmSpec->extern_id]['sisa'] += $trmSpec->sisa;
//                }
//                else{
//                    $arrAntiSrcCab[$trmSpec->cabang_id] = array(
//                        "extern_id" => $trmSpec->cabang_id,
//                        "extern_nama" => $trmSpec->cabang_nama,
//                        "cabang_id" => $trmSpec->cabang_id,
//                        "cabang_nama" => $trmSpec->cabang_nama,
//                    );
                if (!isset($arrAntiSrcCab[$trmSpec->cabang_id]['sisa'])) {
                    $arrAntiSrcCab[$trmSpec->cabang_id]['sisa'] = 0;
                }
                $arrAntiSrcCab[$trmSpec->cabang_id]['sisa'] += $trmSpec->sisa;
//                }
            }
            if ($cabang_id != 0) {
                $arrAntiSrc = $arrAntiSrcExt;
            }
            else {
                $arrAntiSrc = $arrAntiSrcCab;
            }
            foreach ($arrAntiSrc as $cus_id => $cusSpec) {
                $items_new[$cus_id]["pym_return_penjualan"] = $cusSpec["sisa"];
            }
        }
        // endregion return penjualan

        //------------------------------------
        if (sizeof($arrHutangKeKonsumen) > 0) {
            foreach ($arrHutangKeKonsumen as $cusId => $cusSpec) {
//                $items_new[$cusId] = array(
//                    "extern_id" => $cusId,
//                    "extern_nama" => $cusSpec['extern_nama'],
//                    "debet" => $cusSpec['debet'],
//                    "kredit" => $cusSpec['kredit'],
////                    "pym_uang_muka" => isset($arrUangMukaSrc[$cusId]['sisa']) ? $arrUangMukaSrc[$cusId]['sisa'] : 0,
////                    "pym_return_penjualan" => isset($arrAntiSrc[$cusId]['sisa']) ? $arrAntiSrc[$cusId]['sisa'] : 0,
//                );

//                $items_new[$cusId]["extern_id"] = $cusId;
//                $items_new[$cusId]["extern_nama"] = $cusSpec['extern_nama'];
                $items_new[$cusId]["debet"] = $cusSpec['debet'];
                $items_new[$cusId]["kredit"] = $cusSpec['kredit'];
                $items_new[$cusId]["pym_um_return"] = $items_new[$cusId]['pym_uang_muka'] + $items_new[$cusId]['pym_return_penjualan'];
            }
        }
        //------------------------------------

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">($branchIDc) $branchNama</button>";
        }

//        $headerFieldsSaldo = array(
//            "m_debet" => "master debet",
//            "m_kredit" => "master kredit",
//            "i_debet" => "detail debet",
//            "i_kredit" => "detail kredit",
//            "master" => "master",
//            "detail" => "detail",
//        );
//        arrPrint($items_new);
        $headerFields = array(
            "extern_id" => "cid",
            "extern_nama" => "konsumen",
//            "debet" => "debet",
            "kredit" => "kredit",
            "pym_uang_muka" => "pym uang muka",
            "pym_return_penjualan" => "pym return penjualan",
            "pym_um_return" => "pym<br>um + return",
        );
        $data = array(
            "mode" => "cekMasterDetail",
            "title" => "PAYMENT SOURCE UANG MUKA, ANTI SOURCE RETURN PENJUALAN, HUTANG KE KONSUMEN",
            "subTitle" => "",
            "headerFields" => isset($headerFields) ? $headerFields : array(),
            "headerFieldsSaldo" => isset($headerFieldsSaldo) ? $headerFieldsSaldo : array(),
            "items" => isset($items_new) ? $items_new : array(),
            "itemsGeseh" => isset($items_geseh) ? $items_geseh : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => isset($arrButton) ? $arrButton : array(),
            "arrTotalBawah" => isset($arrTotalBawah) ? $arrTotalBawah : array(),
            "arrTotalBawahGeseh" => isset($arrTotalBawahGeseh) ? $arrTotalBawahGeseh : array(),
            "arrSaldo" => isset($arrSaldoNew) ? $arrSaldoNew : array(),
        );
        $this->load->view("tool", $data);
    }

    /*
     * untuk generate coa rekening pembantu produk,supplier,bank
     * data coa rekening pembantu lama wajib dihapus dulu
     */
    public function createCoaChild()
    {
//        $mdl = "MdlBankAccount_cash_and_in";//model diganti disesuaikan yang akan digenerate
        $mdl = "MdlSupplier";//model diganti disesuaikan yang akan digenerate
//        $mdl = "MdlCustomer";//model diganti disesuaikan yang akan digenerate
//        $mdl = "MdlSuppliers";//model diganti disesuaikan yang akan digenerate
        $mdl = "MdlAsetDetail";//model diganti disesuaikan yang akan digenerate
        $tokoID = "0";
        $mdlaccount = "MdlAccounts";

        $this->load->model("Mdls/$mdlaccount");
        $this->load->model("Mdls/$mdl");

        $p = new $mdl();
        $a = new $mdlaccount();
        $this->db->trans_start();
//        $this->db->limit(2);
        $tempProduk = $p->lookUpAll()->result();
        $connectings = array(
            "MdlAccounts" => array(
                array(
                    "path" => "Mdls",
                    "fungsi" => "addExtern_coa_tk",
                    /* ------------------- ------------------- -------------------
                     * staticOptions bisa handling array atau singgle
                     * ---------------------------------------------------------*/
                    "staticOptions" => "1020010020",//disesuasikan ya
//                    "staticOptions" => "1010020010",//persediaan
//                    "staticOptions" => "2010010010",//
                    "fields" => array(
                        "extern_jenis" => array(
                            "str" => "item",
                        ),
                        "extern_id" => array(
                            "var_main" => "id",
                        ),
                        "head_name" => array(
                            "var_main" => "nama",
                        ),
                        "p_head_name" => array(
                            "var_main" => "strHead_code",
                        ),
                        "create_by" => array(
                            "var_main" => "oleh_nama",
                        ),
                        /* -------------------------------------------------
                         * filter yg ingin langsung diaktifkan
                         * -------------------------------------------------*/
                        "is_active" => array(
                            "str" => "1",
                        ),
                        /*
                         * penanda sebagai rekening pembantu
                         */
                        "is_rekening_pembantu" => array(
                            "str" => "1",
                        ),
                        "is_gl" => array(
                            "str" => "0",
                        ),
                        "is_neraca" => array(
                            "str" => "0",
                        ),
                    ),
                    "updateMain" => array(
                        "condites" => array(
                            "id" => "id",
                        ),
                        "datas" => array(
                            "coa_code" => "lastInset_code",
                        )
                    )
                ),
            )
        );
//        arrprint($connectings);
//        $this->db->limit(2);
//        cekBiru($strHead_code);
        $strHead_code = $connectings[$mdlaccount]["0"]['staticOptions'];
//        mati_disini("$strHead_code");
        $oleh_nama = "sys";
        foreach ($tempProduk as $tempProduk_0) {
            foreach ($connectings as $model => $param_connecting) {
                foreach ($param_connecting as $paramConnecting) {
                    $fields = isset($paramConnecting['fields']) ? $paramConnecting['fields'] : $paramConnecting;
//                    arrPrint($fields);
                    $this->load->model($paramConnecting['path'] . "/$model");
                    $connObj = new $model();
//                    if (isset($paramConnecting['staticOptions'])) {
//                        $strHead_code = is_array($paramConnecting['staticOptions']) ? $paramConnecting['staticOptions'][$extern_tipe] : $paramConnecting['staticOptions'];
//                    }
//                    else {
//                        matiHere("static optionnya tolong dikasih di data modelnya");
//                    }
//                    cekHitam($strHead_code);
//                    arrPrintWebs($fields);
                    $datas = array();
                    foreach ($fields as $field => $cfParams) {
                        if (isset($cfParams['var_main'])) {
//                            arrPrint($cfParams);
                            $cNilai = isset($tempProduk_0->$cfParams['var_main']) ? $tempProduk_0->$cfParams['var_main'] : $$cfParams['var_main'];
                        }
                        else {
                            $cNilai = $cfParams['str'];
                        }
                        $datas[$field] = $cNilai;
                    }
//                    arrPrint($datas);
//                    matiHere();
                    $lastInset_code = $connObj->$paramConnecting['fungsi']($strHead_code, $tokoID, $datas);
                    showLast_query("merah");
//                    mati_disini();
                    /* -------------------------------------------------
                     * ngupdate ke data utama
                     * -------------------------------------------------*/
                    if (isset($paramConnecting['updateMain'])) {
//                        foreach ($paramConnecting['updateMain']['condites'] as $key => $condite) {
//                            $mainCondites[$key] = $$condite;
//                        }
                        $mainCondites = array(
                            "id" => $tempProduk_0->id,
                        );
                        foreach ($paramConnecting['updateMain']['datas'] as $key => $val) {
                            $mainUpdate[$key] = $$val;
                        }
//                        arrprint($mainUpdate);
                        $p->setFilters(array());
                        $p->updateData($mainCondites, $mainUpdate);
                        showLast_query("orange");
                    }
                }
            }
        }
//        cekMErah(count($tempProduk));
//        matiHEre("komplitt");
//        cekBiru("HABISSSSS");
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
        cekHijau("<h3>DONE...</h3>");
    }


    function viewUnsyncedProdukSerial()
    {
        $ctrl = $this->uri->segment(1);
        $method = $this->uri->segment(2);
        //        $branchID = isset($this->session->login['cabang_id']) ? $this->session->login['cabang_id'] : "-1";
        $branchID = null != $this->uri->segment(3) ? $this->uri->segment(3) : -1;
        $whID = getDefaultWarehouseID($branchID)['gudang_id'];
        if (isset($_GET['q']) && (strlen($_GET['q']) < 3)) {
            $q = $search = NULL;
        }
        elseif (isset($_GET['q']) && (strlen($_GET['q']) > 3)) {
            $q = $search = $_GET['q'];
        }
        else {
            $q = $search = NULL;
        }


        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("Coms/ComRekeningPembantuProdukPerSerial");
        $this->load->model("Mdls/MdlCabang");
        $this->load->model("Mdls/MdlProduk2");

        $cb = new MdlCabang();
        $arrCabangData = $cb->lookupAll()->result();
        $arrCabangs['-1'] = "Center";
        if (sizeof($arrCabangData) > 0) {
            foreach ($arrCabangData as $cabSpec) {
                $arrCabangs[$cabSpec->id] = $cabSpec->nama;
            }
        }


        $productsData = array();
        $products = array();
        $products_rakitan = array();
        $ids = array();
        $ffStocks = array();
        $pIDs = array();

        $pd = New MdlProduk2();
        $pd->setFilters(array());
        $pd->addFilter("jenis in ('item','item_rakitan')");
        if (strlen($search) > 3) {
            if ($search != "semua") {
                $pdTmp = $pd->lookupByKeyword($search)->result();
            }
            else {
                $pdTmp = $pd->lookupAll()->result();
            }
        }
        else {
            $pdTmp = $pd->lookupAll()->result();
        }
        if (sizeof($pdTmp) > 0) {
            foreach ($pdTmp as $pdSpec) {
                $productsData[$pdSpec->id] = array(
                    "nama" => strtolower($pdSpec->nama),
                    "kode" => $pdSpec->kode,
                    "kategori" => $pdSpec->folders_nama,
                    "jml_serial" => $pdSpec->jml_serial,
                );
                $pIDs[$pdSpec->id] = $pdSpec->id;
            }
        }


        $c = new ComRekeningPembantuProduk();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("gudang_id='$whID'");
        if (sizeof($pIDs) > 0) {
            $c->addFilter("extern_id in ('" . implode("','", $pIDs) . "')");
        }
        $tmp = $c->fetchBalances("1010030030");
//        showLast_query("biru");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $products[$row->extern_id] = array(
                    "name" => $row->extern_nama,
                    "stock" => $row->qty_debet,
                    "debet" => $row->debet,
                );
                $ids[] = $row->extern_id;

            }
        }
//arrPrint($products);
        $c = new ComRekeningPembantuProdukPerSerial();
        $c->addFilter("cabang_id='$branchID'");
        $c->addFilter("gudang_id='$whID'");
        $c->addFilter("debet>0");
        if (sizeof($pIDs) > 0) {
            $c->addFilter("produk_id in ('" . implode("','", $pIDs) . "')");
        }
        $tmp = $c->fetchBalances("1010030030");
//        showlast_query("biru");
        if (sizeof($tmp) > 0) {
            foreach ($tmp as $row) {
                $productsSerial[$row->produk_id][] = array(
                    "name" => $row->extern_nama,
                    "sku" => $row->extern2_nama,
                    "debet" => $row->debet,
                );
                $ids[] = $row->extern_id;

            }
        }
//arrPrint($productsSerial);

        $productsLockerCache = array();
        $arrHppAvg = array();
        $ffStocks = array();
        $ffStocksRakitan = array();

        $arrButton = array();
        foreach ($arrCabangs as $branchIDc => $branchNama) {
            $link = base_url() . "$ctrl/$method/$branchIDc";
            $selected = $branchIDc == $branchID ? "selected" : "";
            $btn = $branchIDc == $branchID ? "btn-success" : "btn-secondary";
            $arrButton[$branchIDc] = "<button class='btn $btn' $selected onclick=\"location.href='$link'\">$branchNama</button>";
        }

        $headerFields = array(
            "pID" => "pID",
            "kode" => "code",
            "pName" => "product",
            "kategori" => "kategory",
//            "fifo" => "fifo",
//            "fifo_rakitan" => "fifo<br>rakitan",
//            "avg" => "fifo avg",
            "serial_setting" => "serial<br>setting",
            "stock" => "stock",
            "debet" => "debet<br>serial",
            "debet_hitung" => "hitung<br>serial",
//            "debet_rakitan" => "rek debet<br>rakitan",
//            "active" => "locker<br>active",
//            "active_rakitan" => "locker<br>active rkt",
//            "hold" => "locker<br>hold",
//            "holdTrID" => "locker<br>hold trID",
            //            "sold" => "locker<br>sold",
            //            "moved" => "locker<br>moved",
            //            "deactivate" => "locker<br>deactivate",
            //            "distribute" => "locker<br>distribute",
            //            "returned" => "locker<br>returned",
//            "totalLocker" => "total<br>locker",
//            "totalLockerCache" => "locker<br>cache",

//            "debet_value" => "debet<br>value",
//            "fifo_value" => "fifo<br>jml nilai",
//            "fifo_kali" => "fifo<br>jml * hpp",
//            "fifo_avg" => "fifo<br>jml * hpp",
        );
        $nof = 0;
        $items = array();
        $itemsGeseh = array();
        $warning = array();
        $marking = array();
        $markingColumn = array();
        if (sizeof($productsData) > 0) {

            $this->db->trans_start();

            $nof = 0;
            foreach ($productsData as $pID => $spec) {
//                cekHitam(":: $pID ::");
                $jmlSerial = isset($productsData[$pID]["jml_serial"]) ? $productsData[$pID]["jml_serial"] : 0;
                if ($jmlSerial > 0) {

                    $pName = $spec['nama'];
                    $kode = $spec['kode'];
                    $kategori = $spec['kategori'];
                    $jmlRek = isset($products[$pID]["stock"]) ? $products[$pID]["stock"] : 0;
                    $jmlSerialStock = $jmlSerial * $jmlRek;
                    $jmlSerialDebet = isset($productsSerial[$pID]) ? sizeof($productsSerial[$pID]) : 0;
//if($jmlRek>0){
//    cekHitam("$pID: $jmlRek");
//}
                    $bg_color = "";
                    $add = "";
                    if ($jmlSerialDebet != $jmlSerialStock) {
                        $bg_color = "background-color:yellow;";
                        $add = "<span style='text-align: right;font-size: 10px;'> ::: ( yellow )</span>";
                    }
                    if ($jmlAvg < 0) {
                        $bg_color = "background-color:pink;";
                    }


                    $markingColumn[$pID] = array(
                        "debet" => array(
                            "background-color" => "#B5FF7B",
                        ),
                        "active" => array(
                            "background-color" => "#7BFFF9",
                        ),
                        "hold" => array(
                            "background-color" => "#AC9AFF",
                        ),
                        "holdTrID" => array(
                            "background-color" => "#AC9AFF",
                        ),
                        "totalLocker" => array(
                            "background-color" => "#B5FF7B",
                        ),
                    );

                    $selisih = $jmlSerialDebet - $jmlSerialStock;
                    $selisih = ($selisih < 0) ? ($selisih * -1) : $selisih;
                    if ($selisih > 0) {
                        $marking[$pID] = array(
                            "add_name" => "(yellow)",
                            "background-color" => "yellow",
                        );
                        $itemsGeseh[] = array(
                            "pID" => $pID,
                            "kode" => $kode,
                            "pName" => $pName,
                            "kategori" => $kategori,
//                        "fifo" => $jmlFifo,
//                        "fifo_rakitan" => $jmlFifoRakitan,
                            "serial_setting" => $jmlSerial,
                            "stock" => $jmlRek,
                            "debet" => $jmlSerialDebet,
                            "debet_hitung" => $jmlSerialStock,
//                        "debet_rakitan" => $jmlRekRakitan,
//                        "active" => $jmlActive,
//                        "active_rakitan" => $jmlActiveRakitan,
//                        "hold" => $jmlHold,
//                        "holdTrID" => $jmlHoldTrID,

//                        "totalLocker" => $jmlLoker,
//                        "totalLockerCache" => $jmlLockerStockCache,

//                        "debet_value" => $debet_value,
//                        "fifo_value" => $fifo_jml_nilai,
//                        "fifo_kali" => $subhpp,
//                        "fifo_avg" => $jmlNilaiAvg,
                        );
                    }
                    else {
                        $items[] = array(
                            "pID" => $pID,
                            "kode" => $kode,
                            "pName" => $pName,
                            "kategori" => $kategori,
//                        "fifo" => $jmlFifo,
//                        "fifo_rakitan" => $jmlFifoRakitan,
//                        "avg" => $jmlAvg,
                            "serial_setting" => $jmlSerial,
                            "stock" => $jmlRek,
                            "debet" => $jmlSerialDebet,
                            "debet_hitung" => $jmlSerialStock,
//                        "debet_rakitan" => $jmlRekRakitan,
//                        "active" => $jmlActive,
//                        "active_rakitan" => $jmlActiveRakitan,
//                        "hold" => $jmlHold,
//                        "holdTrID" => $jmlHoldTrID,

//                        "totalLocker" => $jmlLoker,
//                        "totalLockerCache" => $jmlLockerStockCache,

//                        "debet_value" => $debet_value,
//                        "fifo_value" => $fifo_jml_nilai,
//                        "fifo_kali" => $subhpp,
//                        "fifo_avg" => $jmlNilaiAvg,
                        );
                    }

                }

            }


            //            $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

        }


        $thisPage = base_url() . $this->uri->segment(1) . "/" . $this->uri->segment(2) . "/" . $this->uri->segment(3) . "/?";
        $warning = array();
        $data = array(
            "mode" => "stock",
            "title" => "PRODUCT BRANCH ($branchID)",
            "subTitle" => "WAREHOUSE ($whID)",
            "headerFields" => $headerFields,
            "items" => $items,
            "itemsGeseh" => isset($itemsGeseh) ? $itemsGeseh : array(),
            "warning" => isset($warning) ? $warning : array(),
            "marking" => isset($marking) ? $marking : array(),
            "markingColumn" => isset($markingColumn) ? $markingColumn : array(),
            "button" => $arrButton,
            "thisPage" => $thisPage,
            "q" => "$q",
        );

        $this->load->view("tool", $data);
    }

    function patchHargaJual()
    {
        $this->db->trans_start();

        $this->load->model("Mdls/MdlHargaProduk");
        $p = new MdlHargaProduk();
//        $p->addFilter("produk_id='3365'");
        $p->addFilter("toko_nama='11'");
        $p->addFilter("jenis_value in ('jual_reseler','jual_online','jual')");
//        $p->addFilter("jenis_value='jual_reseller'");
//        $this->db->limit("10");
        $temp = $p->lookUpAll()->result();
        cekMErah($this->db->last_query());
        if (count($temp) > 0) {
            foreach ($temp as $temp_0) {
                $curID = $temp_0->id;
                switch ($temp_0->jenis_value) {
                    case "jual":
//                        $jual = $temp_0->nilai;
                        $jual_new = $temp_0->nilai / 1.11;
//                        $update = array(
//                            "jual"=>$jual_new
//                        );
                        break;
                    case "jual_reseller":
                        $jual = $temp_0->nilai;
                        $jual_new = $temp_0->nilai / 1.11;
//                        $update = array(
//                            "jual_reseler"=>$jual_new
//                        );
                        break;
                    case "jual_online":
//                        $jual = $temp_0->nilai;
                        $jual_new = $temp_0->nilai / 1.11;

                        break;
                }
                $update = array(
//                    "jenis_value"=>$temp_0->jenis_value,
                    "nilai" => $jual_new,
                    "toko_nama" => "0",
                );
                cekBiru($temp_0->nilai);
                $where = array("id" => $curID);
                $p->setFilters(array());
                $p->updateData($where, $update);
                cekHitam($this->db->last_query());
//arrPrint($update);

//                $jual = isset($temp_0->jual)?$temp_0->jual:0;
//                $jual_reseler = isset($temp_0->jual_reseler)?$temp_0->jual_online:0;
//                $jual_online = isset($temp_0->jual_online)?$temp_0->jual_online:0;
//                cekMErah("::reguler ".$jual."::releser ".$jual_reseler."::online ".$jual_online);
//                $jual_new = $jual/1.11;
//                $jual_reseler_new = $jual_reseler/1.11;
//                $jual_online_new = $jual_online/1.11;
//                cekHijau("$jual::reguler ".$jual_new."::releser ".$jual_reseler_new."::onlince ".$jual_online_new);

            }
        }
        else {
            cekMerah("HABISSSSSS");
        }
        matiHere();
        $this->db->trans_complete();
        cekMerah("selesaiiii");
    }

    function writeSalesBooking()
    {
        $this->db->trans_start();
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlLockerStockBooking");
        $ls = new MdlLockerStockBooking();
        $tr = new MdlTransaksi();
        $tr->addFilter("jenis='5822so'");
        $tr->addFilter("link_id='0'");
        $tr->addFilter("transaksi_data.valid_qty>0");
        $tmpHist = $tr->lookupJoined_OLD()->result();
        $dtaProduks = array();
        $trID = array();
        $this->db->truncate($ls->getTableName());
        if (count($tmpHist) > 0) {
            foreach ($tmpHist as $tmpHist_0) {
                $dtaProduks[$tmpHist_0->transaksi_id][$tmpHist_0->produk_id] = array(
                    "qty" => $tmpHist_0->valid_qty,
                    "nama" => $tmpHist_0->produk_nama,
                );
                $trID[$tmpHist_0->transaksi_id] = $tmpHist_0->nomer;
            }
        }
        if (count($dtaProduks) > 0) {
            foreach ($dtaProduks as $trIDs => $produksQty) {
                foreach ($produksQty as $produk_id => $produk_qty) {
                    $insert = array(
                        "transaksi_id" => "$trIDs",
                        "state" => "hold",
                        "jumlah" => $produk_qty["qty"],
                        "produk_id" => $produk_id,
                        "nama" => $produk_qty["nama"],
                        "jenis" => "produk",
                        "jenis_locker" => "stock",
                        "cabang_id" => "1",
                        "gudang_id" => "-10",
                    );
                    $ls->setFilters(array());
                    $ls->addData($insert) or matiHEre("gagal insert");
                    cekMErah($this->db->last_query());
                }
            }
        }
        matiHEre();
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
    }

    public function generateDueDate()
    {
        $this->db->trans_start();
        $requreParams = array(
            "customers_id" => "extern_id",
            "customers_nama" => "extern_nama",
            "cabang_id" => "cabang_id",
            "transaksi_id" => "transaksi_id",
            "nomer" => "nomer",
            "dtime" => "dtime",
            "transaksi_nilai" => "tagihan",
            "oleh_id" => "oleh_id",
            "oleh_nama" => "oleh_nama",
        );
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlPaymentSource");
        $t = new MdlTransaksi();
        $p = new MdlPaymentSource();
        $p->addFilter("target_jenis='749'");
//        $p->addFilter("sisa>'1000'");
        $tempPayment = $p->lookUpAll()->result();
//arrprint($tempPayment);
        $listTrID = array();
        $tmpDataDuedate = array();
        if (count($tempPayment)) {
            foreach ($tempPayment as $tempPayment_0) {
                $listTrID[] = $tempPayment_0->transaksi_id;
                foreach ($requreParams as $params => $param_alias) {
                    $tmpDataDuedate[$tempPayment_0->transaksi_id][$params] = $tempPayment_0->$param_alias;
                }
//                arrPrint($tempPayment_0);
            }
        }

        $regTmp = $t->lookupBaseDataRegistries($listTrID)->result();
//        arrprint($regTmp);
        $trDuedate = array();
        if (count($regTmp) > 0) {
            foreach ($regTmp as $regTmp_0) {
                if (isset($regTmp_0->main)) {
                    $trDuedate[$regTmp_0->transaksi_id]["due_date"] = blobDecode($regTmp_0->main)["dueDate"];
                }
            }
        }
        $finalDuedate = array();
        foreach ($tmpDataDuedate as $trid => $tridData) {
            if (isset($trDuedate[$trid])) {
                $finalDuedate[$trid] = $tridData + $trDuedate[$trid];
            }
        }

        $t->setTableName("transaksi_due_date");
        $t->setFilters(array());
        if (count($finalDuedate) > 0) {
            foreach ($finalDuedate as $finalDuedate_0) {
                $t->addData($finalDuedate_0);
                cekLime($this->db->last_query());
            }
        }
//        arrprint($finalDuedate);
//        matiHere();
        $this->db->trans_complete();

        cekHitam("habisss");
    }

    public function patchSerialMovement()
    {
        matiHEre("gak jadi dipakaiii");
        $this->db->trans_start();
        $produk_id = "236";
        $cabang_id = "-1";
        $gudang_id = "9";
        $trID = "2687";
        $trNO = "2687.-1.1";
        $this->load->model("Coms/ComRekeningPembantuProdukPerSerial");
        $this->load->model("Mdls/MdlProduk2");
        $tr = new ComRekeningPembantuProdukPerSerial();

        $tr->setFilters(array());
        $tr->addFilter("produk_id='$produk_id'");
        $tr->addFilter("cabang_id='$cabang_id'");
        $tr->addFilter("gudang_id='$gudang_id'");
        $tr->addFilter("qty_debet>0");
        $this->db->order_by("dtime", "asc");
        $items = $tr->fetchBalances("1010030030");
        foreach ($items as $items_0) {
            $update = array(
                "qty_debet" => "1",
                "saldo_qty_debet" => "1",
                "qty_kredit" => "0",
                "saldo_qty_kredit" => "0",

            );
            $where = array(
                "periode" => "forever",
                "rekening" => "1010030030",
                "produk_id" => $produk_id,
                "extern_nama" => $items_0->extern_nama,
                "extern2_nama" => $items_0->extern2_nama,
                "cabang_id" => "-1",
                "gudang_id" => "-1",
            );
            $tr->setFilters(array());
            $this->db->where($where);
            $tmp = $tr->lookUpAll()->result();
            if (count($tmp) > 0) {
                //update

                $tr->setFilters(array());
                $tr->updateData($where, $update) or matiHere("Gagall");
                cekBiru($this->db->last_query());
            }
            else {
                //insert
                cekHitam($this->db->last_query());
                matiHEre("insert");
            }

//            cekMErah($this->db->last_query());
        }
//        cekHitam(count($items));
//        cekMErah($this->db->last_query());


        matiHere("__habis");
        $this->db->trans_complete();

    }

    public function patchDiskonLockerValue()
    {
        if (isset($_GET["r"]) && ($_GET["r"] > 0)) {
            $refresh = $_GET["r"];
            header("refresh:$refresh");
        }
        $this->db->trans_start();
        $component = array(
            "master" => array(),
            "detail" => array(
                array(
                    "comName" => "LockerDiskonValue",
                    "loop" => array(
                        "exec_locker" => "sub_diskon_nilai",//sengaja dipasang kalau kalau tidak punya biar tidak ditulis
                    ),
                    "static" => array(
                        "cabang_id" => "placeID",
                        "jenis" => ".diskon",
                        "jenis2" => ".diskon",
                        "jenis_locker" => ".stock",
                        "state" => ".active",
                        "jumlah" => ".1",
                        "nilai" => "sub_diskon_nilai",
                        "nilai_unit" => "sub_diskon_nilai",
                        "produk_id" => "sub_diskon_nilai",//id diskon
                        "nama" => "diskon_nama",

                        "extern_id" => "diskon_id",//id produk hadiah/jika berupa diskon reguler diisi id diskon
                        "extern_nama" => "diskon_nama",
                        "extern2_id" => "id",//produk yang dibeli
                        "extern2_nama" => "nama",
                        "satuan" => "satuan",
                        "transaksi_id" => "transaksi_id",
                        "transaksi_no" => "nomer",
                        "nomer" => "nomer",
                        "oleh_id" => ".0",
                        "gudang_id" => "gudangID",
                        "supplier_id" => "pihakID",
                        "supplier_nama" => "pihakName",
                    ),
                    "srcGateName" => "items4_sum",
                    "srcRawGateName" => "items4_sum",
                ),
            ),
        );
        $this->load->model("Coms/ComRekeningPembantuPiutangSupplierDetailTransProdukItem");
        $this->load->model("MdlTransaksi");
        $c = new ComRekeningPembantuPiutangSupplierDetailTransProdukItem();
        $t = new MdlTransaksi();
        //ambil mutasinya
        $c->setTableName("__rek_pembantu_subpiutangsuppliertransproduk__1010020030");
        $c->addFilter("extern5_id='0'");
        $this->db->limit(1);
        $temp = $c->lookUpAll()->result();
//        arrPrint($this->db->last_query());
        if (count($temp) > 0) {
            $trID = $temp[0]->transaksi_id;
            $trInum = $temp[0]->transaksi_no;
            $t->setFilters(array());
            $t->addFIlter("transaksi_id='$trID'");
            $temReg = $t->lookupDataRegistries()->result();
            $items4 = blobDecode($temReg[0]->items4_sum);

            $items = array();
            if (count($items4) > 0) {
                foreach ($items4 as $items4_0) {
                    unset($items4_0["transaksi_id"]);
                    unset($items4_0["transaksi_no"]);
                    $items[] = $items4_0 + array("transaksi_id" => $trID, "transaksi_no" => $trInum);

                }
            }

            //region processing sub-components, if in single step geser ke CLI
            if (count($items) > 0) {
                $buildTablesDetail = $component["detail"];
                $componentGate['detail'] = array();
                $compValidators = ($this->config->item('transaksi_value_required_components') != null) ? $this->config->item('transaksi_value_required_components') : array();
                $filterNeeded = false;
                $componentConfig['detail'] = $buildTablesDetail;
                $iterator = $buildTablesDetail;
                // $iterator =array();
                if (sizeof($iterator) > 0) {
                    $comsLocation = "Coms";
                    $comsPrefix = "Com";
                    foreach ($iterator as $cCtr => $tComSpec) {
                        // arrprint($tComSpec);
                        $tmpOutParams[$cCtr] = array();
                        $gg = 0;
                        // $srcGateName = $tComSpec['srcGateName'];
                        // if ($componentsDetailLoop == true) {
                        foreach ($items as $id => $dSpec) {
//                            arrPrint($dSpec);
//                            matiHere();
                            // $srcRawGateName = $tComSpec['srcRawGateName'];
                            $comName = $tComSpec['comName'];
                            if (substr($comName, 0, 1) == "{") {
                                $comName = trim($comName, "{");
                                $comName = trim($comName, "}");
                                $comName = str_replace($comName, $items, $comName);
                            }

                            $mdlName = "$comsPrefix" . ucfirst($comName);
                            if (in_array($mdlName, $compValidators)) {//perlu validasi filter
                                $filterNeeded = true;
                            }
                            else {
                                $filterNeeded = false;
                            }
                            // cekHere("sub-component: [$comsLocation] $comName, initializing values <br>");

                            $subParams = array();

                            if (isset($tComSpec['loop'])) {
                                foreach ($tComSpec['loop'] as $key => $value) {
                                    if (substr($key, 0, 1) == "{") {
                                        $key = trim($key, "{");
                                        $key = trim($key, "}");
                                        $key = str_replace($key, $dSpec[$key], $key);
                                    }

                                    $realValue = makeValue($value, $dSpec, $dSpec, 0);
                                    // cekMErah("$key =>".$realValue);
                                    $subParams['loop'][$key] = $realValue;

                                    if ($filterNeeded) {
                                        if ($subParams['loop'][$key] == 0) {
                                            unset($subParams['loop'][$key]);
                                        }
                                    }
                                }
                            }
                            if (isset($tComSpec['static'])) {
                                foreach ($tComSpec['static'] as $key => $value) {
                                    $realValue = makeValue($value, $dSpec, $dSpec, 0);
                                    $subParams['static'][$key] = $realValue;
                                }
                                if (!isset($subParams['static']["transaksi_id"])) {
                                    $subParams['static']["transaksi_id"] = 0000;
                                }
                                if (!isset($subParams['static']["transaksi_no"])) {
                                    $subParams['static']["transaksi_no"] = 0000;
                                }

                                $subParams['static']["fulldate"] = date("Y-m-d");
                                $subParams['static']["dtime"] = date("Y-m-d H:i");
                                $subParams['static']["keterangan"] = $dSpec["jenisTr"] . " oleh " . $dSpec["olehName"];
                            }

                            if (sizeof($subParams) > 0) {
                                //                                cekhitam("subparam ada isinya");
                                if ($filterNeeded) {
                                    if (isset($subParams['loop']) && sizeof($subParams['loop']) > 0) {
                                        $tmpOutParams[$cCtr][] = $subParams;
                                    }
                                }
                                else {
                                    $tmpOutParams[$cCtr][] = $subParams;
                                }
                            }
                            else {
                                cekhitam("subparam TIDAK ada isinya");
                            }
                        }


                        $componentGate['detail'][$cCtr] = $subParams;
                    }
                    // arrPrint($tmpOutParams);
                    // matiHEre($cCtr);

                    foreach ($iterator as $cCtr => $tComSpec) {
                        // $srcGateName = $tComSpec['srcGateName'];
                        foreach ($items as $id => $dSpec) {
                            // $srcRawGateName = $tComSpec['srcRawGateName'];
                            $comName = $tComSpec['comName'];
                            if (substr($comName, 0, 1) == "{") {
                                $comName = trim($comName, "{");
                                $comName = trim($comName, "}");
                                $comName = str_replace($comName, $items[$id][$comName], $comName);
                            }
                        }
                        cekHere("sub component: [$comsLocation] $comName, sending values " . __LINE__ . "<br>");

                        $mdlName = "$comsPrefix" . ucfirst($comName);
                        $this->load->model("$comsLocation/" . $mdlName);
                        $m = new $mdlName();
                        //===filter value nol, jika harus difilter

                        if (sizeof($tmpOutParams[$cCtr]) > 0) {
                            $tobeExecuted = true;
                        }
                        else {
                            $tobeExecuted = false;
                        }

                        // matiHEre($tobeExecuted);
                        if ($tobeExecuted) {
                            //----- kiriman gerbang
                            if (method_exists($m, "setTableInMaster")) {
                                $m->setTableInMaster($tempTableinMAster);
                            }
                            if (method_exists($m, "setDetail")) {
                                $m->setDetail($items);
                            }
                            if (method_exists($m, "setJenisTr")) {
                                $m->setJenisTr($this->jenisTr);
                            }
                            //----- kiriman gerbang
                            $m->pair($tmpOutParams[$cCtr]) or die("Tidak berhasil memasang  values pada komponen: $comName/" . $this->jenisTr . "/" . __FUNCTION__ . "/" . __LINE__);
                            $m->exec() or die("Gagal saat berusaha  exec values pada komponen: $comName/" . $this->jenisTr . "/" . __FUNCTION__ . "/" . __LINE__);
                            cekBiru($this->db->last_query());
                        }
                        else {
                            cekMerah("$comName tidak eksekusi");
                        }

                    }
                }
                else {
                    cekKuning("subcomponents is not set");
                }
            }


            $udpate = array(
                "extern5_id" => "11"
            );
            $c->setFilters(array());
            $c->updateData(array("transaksi_id" => $trID), $udpate) or matiHEre("gagal update data");
//        cekBiru($this->db->last_query());
            //endregion
//            arrPrint($items);
        }
        else {
            CekBiru("HABISSSSS");
        }

//cekHitam($this->db->last_query());
//        cekHitam($trID."::".$trInum);


//        matiHere("__habis");
        $this->db->trans_complete();
        cekHitam("suksesss");
    }

    public function patchFakturPymSrc()
    {
        $this->db->trans_start();
        $this->load->model("MdlTransaksi");
        $t = new MdlTransaksi();
        $t->addFilter("jenis='110e'");
        $aa = $t->lookUpAll()->result();
        $ids = array();
        foreach ($aa as $aa_temp) {
            $ids[] = $aa_temp->id;
        }
//        cekHitam(count($aa));
//        arrprint($ids);
        $t->setFilters(array());
        $t->addFilter("transaksi_id in ('" . implode("','", $ids) . "')");
        $tempReg = $t->lookupDataRegistries()->result();
        cekMErah($this->db->last_query());
        $tempFaktur = array();
        if (count($tempReg) > 0) {
            foreach ($tempReg as $tempReg_0) {
//                arrPrint($tempReg_0);
                $tempMain = blobDecode($tempReg_0->main);
                $tempFaktur[$tempMain["efakturSource"]] = array(
                    "extern_date2" => $tempMain["dateFaktur"],
                    "extern_label2" => $tempMain["eFaktur"],
                    "dpp_ppn" => $tempMain["total_ui"],
                    "ppn" => $tempMain["new_grand_ppn"],
                    "npwp" => $tempMain["customerDetails__npwp"],
                );
//                arrprint($tempMain);
//                matiHEre();
            }
        }
        if (count($tempFaktur) > 0) {
            $t = new MdlTransaksi();
            $t->setFilters(array());
            $t->setTableName("transaksi_payment_source");

            foreach ($tempFaktur as $spdNum => $faktur_data) {
                $t->setFilters(array());
                $t->updateData(array("nomer" => $spdNum), $faktur_data) or matiHEre();
                cekBiru($this->db->last_query());
            }
        }
//        arrprint($tempFaktur);


//        matiHEre(__LINE__);
        //        cekHitam("__habis");
        $this->db->trans_complete();
    }

    public function patchPaymentSoureExter2ID()
    {
        $this->db->trans_start();
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlPaymentSource");
        $t = new MdlTransaksi();
        $m = new MdlPaymentSource();
        $m->addFilter("target_jenis='749'");
        $m->addFilter("extern2_id='0'");
        $this->db->order_by("id", "desc");
        $this->db->limit(500);
        $temp = $m->lookUpAll()->result();
        cekLime($this->db->last_query());

        foreach ($temp as $aa) {
//            arrPrint($aa);
            $trid = $aa->transaksi_id;
            $t->addFilter("id='$trid'");
            $tempTr = $t->lookupMainTransaksi()->result();
            $m->setFilters(array());
            $udpate = array(
                "extern2_id" => $tempTr[0]->id_master,
                "extern2_nama" => $tempTr[0]->nomer_top,
            );
            $m->updateData(array("id" => $aa->id), $udpate) or matiHere("gagal update payment source " . $aa->id);
            cekLime($this->db->last_query());
//arrPrint($tempTr);
        }
        cekMErah(count($temp));
//                matiHEre(__LINE__);
        //        cekHitam("__habis");
        $this->db->trans_complete();
        cekHitam("komplitt");

    }

    public function patchMutasiPaymentSoureExter2ID()
    {
        $this->db->trans_start();
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentSourcePembantu");
        $t = new MdlTransaksi();
        $p = new MdlPaymentSourcePembantu();
        $m = new MdlPaymentSource();
        $m->addFilter("target_jenis='749'");
        $this->db->order_by("id", "asc");
//        $this->db->limit(1);
        $temp = $m->lookUpAll()->result();
//        arrPrint($temp);
//        cekLime($this->db->last_query());
        //insert ke mutasi pertama dulu
        $datas = array();
        if (count($temp) > 0) {
            foreach ($temp as $temp_0) {
                $datas = array(
                    "extern_id" => $temp_0->extern_id,
                    "extern_nama" => $temp_0->extern_nama,
                    "transaksi_id" => $temp_0->transaksi_id,
                    "transaksi_no" => $temp_0->nomer,
                    "dtime" => $temp_0->dtime,
                    "fulldate" => $temp_0->fulldate,
                    "oleh_id" => $temp_0->oleh_id,
                    "oleh_nama" => $temp_0->oleh_nama,
                    "cabang_id" => $temp_0->cabang_id,
                    "jenis" => $temp_0->jenis,
//                "target_jenis"=>$temp_0->target_jenis,
                    "extern2_id" => $temp_0->extern2_id,
                    "extern2_nama" => $temp_0->extern2_nama,
                    "debet" => $temp_0->tagihan,
                    "debet_akhir" => $temp_0->tagihan,
                );
                $p->addData($datas) or matiHere("gagal insert data");
                cekMErah($this->db->last_query());
            }
        }
//        arrPrint($datas);


//        cekMErah(count($temp));
//                matiHEre(__LINE__);
//                cekHitam("__habis");
        $this->db->trans_complete();
        cekHitam("HABISSSS");

    }

    public function createMovePaymentSource()
    {
//        $q ="SELECT transaksi.id,transaksi.nomer,transaksi.customers_id,transaksi.customers_nama,transaksi_data.produk_id,transaksi_data.produk_nama,transaksi_data.produk_ord_hrg FROM transaksi LEFT JOIN transaksi_data ON transaksi_data.transaksi_id=transaksi.id WHERE transaksi.id='14647'";
//        $this->load->model("Coms/ComRekeningPembantuCustomer");
//        $m = new ComRekeningPembantuCustomer();
//        $m->addFilter();
        $startTime = microtime(true);
        $this->db->trans_start();
        $this->load->model("Mdls/MdlPaymentSource");
        $this->load->model("Mdls/MdlPaymentSourcePembantu");
        $this->load->model("MdlTransaksi");
        $t = new MdlTransaksi();
        $p = new MdlPaymentSource();
        $m = new MdlPaymentSourcePembantu();
//        $this->db->limit(1);
        $this->db->where(array("transaksi.jenis" => "749", "transaksi.link_id" => "0"));
        $this->db->select("transaksi.id,transaksi.nomer,transaksi.jenis,transaksi.dtime,transaksi.fulldate,transaksi.oleh_id,transaksi.oleh_nama,transaksi.customers_id,transaksi.customers_nama,transaksi_data.transaksi_id,transaksi_data.produk_id,transaksi_data.produk_nama,transaksi_data.produk_ord_hrg");
        $this->db->order_by("transaksi.id", "asc");
        $this->db->join("transaksi_data", "transaksi_data.transaksi_id = transaksi.id ");
        $rslt = $this->db->get("transaksi")->result_array();

        if (count($rslt) > 0) {
            $datas = array();
            foreach ($rslt as $ii => $resultData) {
//                arrprint($resultData);
//                matiHere();
                //cari nomer id_master
                $t->addFilter("id='" . $resultData['produk_id'] . "'");
                $tempTr = $t->lookupMainTransaksi()->result();
                $datas[$ii] = array(
                    "extern_id" => $resultData['customers_id'],
                    "extern_nama" => $resultData['customers_nama'],
                    "extern2_id" => $tempTr[0]->id_master,//id so
                    "extern2_nama" => $tempTr[0]->nomer_top,//nomer so
                    "extern3_id" => $resultData['produk_id'],//nomer packinglist
                    "extern3_nama" => $resultData['produk_nama'],
                    "transaksi_id" => $resultData['transaksi_id'],//transaksi pembayaran
                    "transaksi_no" => $resultData['nomer'],
                    "nilai" => $resultData['produk_ord_hrg'],
                    "dtime" => $resultData['dtime'],
                    "fulldate" => $resultData['fulldate'],
                    "jenis" => $resultData["jenis"],
                    "oleh_id" => $resultData['oleh_id'],
                    "oleh_nama" => $resultData['oleh_nama'],
                );
            }
        }
        if (count($datas) > 0) {
            foreach ($datas as $datas_0) {
                $m->setFilters(array());
                $m->addFilter("extern_id='" . $datas_0['extern_id'] . "'");
                $m->addFilter("extern2_id='" . $datas_0['extern2_id'] . "'");
                $m->addFilter("extern3_id='" . $datas_0['extern3_id'] . "'");
                $prevData = $m->lookUpAll()->result();
                foreach ($prevData as $prevData_0) {
                    $dataUpdate = array(
                        "debet_awal" => $prevData_0->debet_akhir,
                        "debet" => 0,
                        "debet_akhir" => $prevData_0->debet_akhir - $datas_0["nilai"],
                        "kredit_awal" => 0,
                        "kredit" => $datas_0["nilai"],
                        "kredit_akhir" => 0,
                        "extern_id" => $datas_0['extern_id'],
                        "extern_nama" => $datas_0['extern_nama'],
                        "extern2_id" => $datas_0['extern2_id'],
                        "extern2_nama" => $datas_0['extern2_nama'],
                        "extern3_id" => $datas_0['extern3_id'],
                        "extern3_nama" => $datas_0['extern_nama'],
                        "transaksi_id" => $datas_0['transaksi_id'],
                        "transaksi_no" => $datas_0['transaksi_no'],
                        "dtime" => $datas_0['dtime'],
                        "fulldate" => $datas_0['fulldate'],
                        "oleh_id" => $datas_0['oleh_id'],
                        "oleh_nama" => $datas_0['oleh_nama'],
                    );
                    $m->addData($dataUpdate) or matiHere("gagal insert mutasi");
//                    cekHitam($this->db->last_query());
                }
//                cekLime($this->db->last_query());
//                arrprint($datas_0);
//                arrprint($prevData);
//                matiHere();
            }
        }
//

//        //region baca dari payment sour untuk cari mutasi berdasarkan master id
//        $p->setFilters(array());
//        $p->addFilter("sisa> 100" );
//        $p->addFilter("target_jenis='749'" );
//        $tmpPaymentSrc = $p->lookUpAll()->result();
//        $listItem = array();
//        foreach($tmpPaymentSrc as $tmpPaymentSrc_0){
//            $listItem[$tmpPaymentSrc_0->transaksi_id]= array(
//                "extern_id"=>$tmpPaymentSrc_0->extern_id,
//                "extern_nama"=>$tmpPaymentSrc_0->extern_nama,
//                "extern2_id"=>$tmpPaymentSrc_0->extern2_id,
//                "extern2_nama"=>$tmpPaymentSrc_0->extern2_nama,
//                "extern3_id"=>$tmpPaymentSrc_0->transaksi_id,
//            );
//        }
//        arrprint($listItem);
//        arrprint(count($tmpPaymentSrc));
//
//
//        //endregion


//        arrprint($datas);
//        cekHitam($this->db->last_query());
//        cekHitam(count($rslt));
        $endTime = microtime(true);
        $execTime = $endTime - $startTime;
        matiHere(__LINE__ . "exec on " . $execTime . " s");
        $this->db->trans_complete();
        cekHitam("HABISSSS  exec on " . $execTime . " s");


    }

    public function execCounterModul()
    {
        $this->db->trans_start();
        $configUI = $this->load->config->item("heTransaksi_ui");
//        arrPrint($configUI);
        $masterJenisData = array();
        foreach ($configUI as $masterJenis => $tempJenis) {
            foreach ($tempJenis["steps"] as $step => $stepcode) {
                $masterJenisData[$stepcode["target"]] = array(
                    "modul" => $tempJenis["modul"],
                    "jenis_master" => $masterJenis,
                );
            }
        }
//        arrPrint($masterJenisData);
        $this->load->model("CustomCounter");
        $c = new CustomCounter();
        $temp = $c->lookUpAll()->result();
        foreach ($temp as $temp_0) {
            $where = array(
                "id" => $temp_0->id,
            );
            $dataParams = blobDecode($temp_0->paramValues);
            if (isset($dataParams["stepCode"])) {
                $modul = isset($masterJenisData[$dataParams["stepCode"]]["modul"]) ? $masterJenisData[$dataParams["stepCode"]]["modul"] : "(NULL)";
                $jenis_master = $masterJenisData[$dataParams["stepCode"]]["jenis_master"];
                $this->db->where(array("id" => $temp_0->id));
                $this->db->update($c->getTableName()['number'], array("modul" => $modul, "jenis_master" => $jenis_master, "step_code" => $dataParams["stepCode"]));
            }
//            cekMerah($this->db->last_query());
//            arrPrint($dataParams);
//            matiHEre();
        }
//        cekMerah(count($temp));
//        cekHere($this->db->last_query());
//        matiHere();
        $this->db->trans_complete();
        cekMErah("KELARRRR");
    }

    public function cekDuplikasiPLserial()
    {
        $this->load->helper("he_mass_table");
        $this->load->model("Coms/ComRekeningPembantuProdukPerSerial");
        $s = new ComRekeningPembantuProdukPerSerial();
        $s->addFilter("produk_id='1613'");
        $s->addFilter("cabang_id='1'");
        $s->addFilter("jenis='5822spd'");
//        $this->db->select("extern_nama","transaksi_id");
        $temp = $s->fetchMovement("1010030030");
        $duplicate = array();
        foreach ($temp as $temp_0) {
            $duplicate[$temp_0->extern_nama][] = $temp_0->transaksi_id;
        }
        $finalDuplicate = array();
        foreach ($duplicate as $sn => $snDatas) {
            if (count($snDatas) > 1) {
                $finalDuplicate[$sn] = $snDatas;
            }
        }
        arrPrint($finalDuplicate);
//        cekLime($this->db->last_query());
        //SELECT extern_nama,produk_nama,produk_id FROM `_rek_pembantu_produk_perserial_cache` WHERE produk_id='1613' AND cabang_id='1' AND jenis='5822spd'
    }

    public function cekStokandSerial()
    {

//        $cabangID = "-1";
//        $gudangID = "-1";

        $cabangID = isset($_GET["cb"]) ? $_GET["cb"] : "1";
        $gudangID = isset($_GET["gd"]) ? $_GET["gd"] : "-10";

        $header2Alias = array(
            "IN" => array(
                "IN" => "IN",
                "fulldate" => "date",
            ),
            "OT" => array(
                "OT" => "OT",
                "fulldate" => "date",
            ),
            "PART" => array(
                "PART" => "PART",
                "fulldate" => "date",
            )
        );

        $this->load->helper("he_mass_table");
        $this->load->model("Coms/ComRekeningPembantuProdukPerSerial");
        $this->load->model("Coms/ComRekeningPembantuProdukPerSerialIntransit");
        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("Mdls/MdlProduk");
        $this->load->model("Mdls/MdlProdukPerSerialNumber");

        $ps = new MdlProdukPerSerialNumber();
        $pr = new MdlProduk();
        $p = new ComRekeningPembantuProduk();
        $s = new ComRekeningPembantuProdukPerSerial();
        $i = new ComRekeningPembantuProdukPerSerialIntransit;
        $allGenSerialTmp = $ps->lookUpAll()->result();
        $allGenSerial = array();
        foreach ($allGenSerialTmp as $allGenSerialTmp_0) {
            $snn = $allGenSerialTmp_0->produk_sku_label;
            $allGenSerial[$allGenSerialTmp_0->produk_id][$allGenSerialTmp_0->produk_serial_number_2][$allGenSerialTmp_0->produk_sku_label] = array(
                "$snn" => $allGenSerialTmp_0->produk_serial_number_2,
                "fulldate" => $allGenSerialTmp_0->fulldate,
            );
        }
//        $s->addFilter("produk_id='1613'");
        $s->addFilter("cabang_id='$cabangID'");
        $s->addFilter("gudang_id='$gudangID'");
        $s->addFilter("qty_debet>'0'");

//        $this->db->select("extern_nama","transaksi_id");
        $temp = $s->fetchBalances("1010030030");
        $serial = array();
        $postSerial = array();
        foreach ($temp as $temp_0) {
            if (!isset($serial[$temp_0->produk_id])) {
                $serial[$temp_0->produk_id] = 0;
            }
            $serial[$temp_0->produk_id] += $temp_0->qty_debet;
            $postSerial[$temp_0->produk_id][] = $temp_0->extern_nama;
        }

//        $p->addFilter("qty_debet>'0'");
        $p->addFilter("cabang_id='$cabangID'");
        $p->addFilter("gudang_id='$gudangID'");
        $temProdukStok = $p->fetchBalances("1010030030");
        $stok = array();
        foreach ($temProdukStok as $temProdukStok) {
            $stok[$temProdukStok->extern_id] = $temProdukStok->qty_debet;
        }

        //intransit
        $i->addFilter("qty_debet>'0'");
        $i->addFilter("cabang_id=$cabangID");
        $i->addFilter("gudang_id=$gudangID");
        $tmpIntransit = $i->fetchBalances("1010030030");
        $inTransit = array();
        if (count($tmpIntransit) > 0) {
            foreach ($tmpIntransit as $tmpIntransit_0) {
                $inTransit[$tmpIntransit_0->produk_id][] = $tmpIntransit_0->extern_nama;
            }
        }
//        arrPrint($inTransit);
//        matiHere();
        //


        //data produk
        $pr->addFilter("jml_serial>=1");
        $tmpProduk = $pr->lookUpAll()->result();
        $produk = array();
        foreach ($tmpProduk as $produks_tmp) {
            $outdoor_sku = strlen($produks_tmp->outdoor_sku) > 3 ? 1 : 0;
            $indoor_sku1 = strlen($produks_tmp->indoor_sku_1) > 3 ? 1 : 0;
            $indoor_sku2 = strlen($produks_tmp->indoor_sku_2) > 3 ? 1 : 0;
            $indoor_sku3 = strlen($produks_tmp->indoor_sku_3) > 3 ? 1 : 0;
            $indoor_sku4 = strlen($produks_tmp->indoor_sku_4) > 3 ? 1 : 0;
            $produk_part_nama1 = strlen($produks_tmp->produk_part_nama_1) > 5 ? 1 : 0;
            $produk_part_nama2 = strlen($produks_tmp->produk_part_nama_2) > 5 ? 1 : 0;
            if ($produks_tmp->jml_serial == 1 && $produk_part_nama1 == 0 && $produk_part_nama2 == 0) {
                $produk_part_nama1 = 1;
            }
            $jmlSerial = $outdoor_sku + $indoor_sku1 + $indoor_sku2 + $indoor_sku3 + $indoor_sku4 + $produk_part_nama1 + $produk_part_nama2;
            $produk[$produks_tmp->id] = array(
                "jml_serial" => $jmlSerial,
                "nama" => $produks_tmp->nama,
            );
        }
        $table = "<table border='1'> ";
        $table .= "<tr> ";
        $table .= "<td >NO</td> ";
        $table .= "<td >PID</td> ";
        $table .= "<td >PRODUK</td> ";
        $table .= "<td >SERIAL</td> ";
        $table .= "<td >stok produk</td> ";
        $table .= "<td >stok serial</td> ";
        $table .= "<td >intransit</td> ";
        $table .= "<td >selisih serial</td> ";
//        $table .= "<td >serial all</td> ";
        $table .= "</tr> ";
        $i = 0;
        $totalGeseh = 0;
        foreach ($produk as $pid => $pidData) {
            if (isset($stok[$pid])) {
                $instransit = isset($inTransit[$pid]) ? count($inTransit[$pid]) : 0;
                if ($serial[$pid] - ($stok[$pid] * $pidData["jml_serial"]) == 0) {
                    $text_block = "";
                }
                else {
                    $i++;
                    $totalGeseh++;
                    $text_block = "background: coral;";
                    $selisish_serial = $serial[$pid] + $instransit - (($stok[$pid] * $pidData["jml_serial"]));
                    $table .= "<tr > ";
                    $table .= "<td style='$text_block'>$i</td> ";
                    $table .= "<td style='$text_block'>$pid</td> ";
                    $table .= "<td style='$text_block'>" . $pidData["nama"] . "</td> ";
//                    $table .= "<td style='$text_block'>" . $pidData["jml_serial"] . "</td> ";
                    $table .= "<td style='$text_block'>" . $pidData["jml_serial"] . "</td> ";
                    $table .= "<td style='$text_block'>" . $stok[$pid] . "</td> ";
                    $table .= "<td style='$text_block'>" . $serial[$pid] . "</td> ";
                    $table .= "<td style='$text_block'>" . $instransit . "</td> ";
                    $table .= "<td style='$text_block'>" . $selisish_serial . "</td> ";
//                    $table .= "<td style='$text_block'>-";

//                    $table .= "<table border='1' style='$text_block'>";
//                    $table .= "<tr style='$text_block'>";
//                    foreach ($header2Alias as $ix => $ixLabel) {
//                        foreach ($ixLabel as $ixx => $ixxLabel) {
//                            $table .= "<td style='$text_block'>$ixxLabel</td>";
//                        }
//                    }
//                    $table .= "</tr style='$text_block'>";
//                    if (isset($postSerial[$pid])) {
//                        foreach ($postSerial[$pid] as $sn) {
//                            if (isset($allGenSerial[$pid][$sn])) {
//                                $table .= "<tr style='$text_block'>";
//                                foreach ($header2Alias as $ix => $ixLabel) {
//                                    foreach ($ixLabel as $ixx => $ixxLabel) {
//                                        if (isset($allGenSerial[$pid][$sn][$ix][$ixx])) {
//                                            $table .= "<td style='$text_block'>" . $allGenSerial[$pid][$sn][$ix][$ixx] . "</td>";
//                                        }
//                                        else {
//                                            $table .= "<td style='$text_block'>--</td>";
//                                        }
//                                    }
////                                            $table .= "<td style='$text_block'>$sn</td>";
////                                            $table .= "<td style='$text_block'>$allGenSerial[$pid][$sn]</td>";
//                                }
//                                $table .= "</tr style='$text_block'>";
//                            }
//                        }
//                    }
//                    $table .= "</table style='$text_block'>";

                    $table .= "</td> ";
//                    $table .= "<tr> ";

//                    $table .= "<td style='$text_block'>".$selisish_serial."</td> ";
//                    $table .= "<td style='$text_block'>".$selisish_serial."</td> ";
                    $table .= "</tr> ";

                }

            }
        }
        $table .= "<tr > ";
        $table .= "<td colspan='2'>total geseh produk</td> ";
        $table .= "<td colspan='4'>$totalGeseh</td> ";
        $table .= "</tr > ";
        $table .= "</table border='1'> ";
        echo $table;
//        cekMerah(count($produk));


    }

    //-------------------------------
    public function cekPymUangMukaSource()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Coms/ComRekeningPembantuUangMukaMainReference");

        $extern_id = "11";
        $rekening = "1010050010";
        $jenis = "vendor";
        $label = "uang muka";
        $arrData = array();

        $tr = New MdlTransaksi();
        $tr->setFilters(array());
        $tr->addFilter("label='$label'");
        $tr->addFilter("extern_id='$extern_id'");
        $trTmp = $tr->lookupUangMukaSrc($jenis)->result();
        showLast_query("biru");
        if (sizeof($trTmp) > 0) {
            foreach ($trTmp as $spec) {
                $arrData[$spec->extern_id][$spec->extern2_id] = $spec;
            }
        }

        $cr = New ComRekeningPembantuUangMukaMainReference();
        $cr->addFilter("extern_id='$extern_id'");
        $crTmp = $cr->fetchBalances($rekening);
        showLast_query("biru");
        if (sizeof($crTmp) > 0) {
            foreach ($crTmp as $spec) {
                $arrDataRekeningReference[$spec->extern_id][$spec->extern2_id] = $spec;
            }
        }
        cekHitam("pym_uang_muka_src: " . count($arrData[$extern_id]) . ", ref_UM: " . count($arrDataRekeningReference[$extern_id]));

        foreach ($arrData as $s_id => $sSpec) {
            foreach ($sSpec as $po_id => $poSpec) {
                if (!isset($arrDataRekeningReference[$s_id][$po_id])) {
                    cekMerah("[s_id: $s_id] [po_id: $po_id]");
                }
            }
        }

    }

    public function generatePersediaanRiil()
    {
        $this->db->trans_start();
        $this->load->model("Coms/ComRekeningPembantuProduk");
        $this->load->model("Coms/ComRekeningPembantuProdukRiil");
        $r = new ComRekeningPembantuProduk();
        $rr = new ComRekeningPembantuProdukRiil();
        $r->addFilter("cabang_id='1'");
        $r->addFilter("gudang_id='-10'");
        $r->addFilter("qty_debet>'0'");
        $temp = $r->fetchBalances("1010030030");
//        cekHitam($this->db->last_query());
        cekmerah(count($temp));
        $datas = array();
        if (count($temp) > 0) {
            foreach ($temp as $temp_0) {
                $datas[$temp_0->extern_id] = (array)$temp_0;
            }
        }
//        arrprint($datas);
//matiHere();
        $totalupdate = 0;
        foreach ($datas as $pid => $pidata) {
            $rr->setFilters(array());
            $rr->addFilter("extern_id='$pid'");
            $preval = $rr->fetchBalances("1010030040");
//            cekHitam($this->db->last_query());
            if (count($preval) > 0) {
                $preDebet = $preval[0]->debet;
                $preQtyDebet = $preval[0]->qty_debet;
                $new_debet = $preDebet + $pidata["debet"];
                $new_qty = $preQtyDebet + $pidata["qty_debet"];
                $update = array(
                    "debet" => $new_debet,
                    "qty_debet" => $new_qty,
                );
                $rr->updateData(array("id" => $preval[0]->id), $update) or matiHEre("gagal memperbaharui data");
                cekHitam($this->db->last_query());
                $totalupdate++;
            }
            else {
//                arrprint($pidata);
                unset($pidata["cabang_id"]);
                unset($pidata["gudang_id"]);
                $insertData = $pidata + array("cabang_id" => "-1", "gudang_id" => "-1");
                $rr->addData($insertData);
                cekBiru($this->db->last_query());
            }
        }
//        cekBiru(count($datas));
//        arrPrint($datas);
//        matiHere(__LINE__.":: COMMIT total update $totalupdate vs ".count($datas));
        $this->db->trans_complete();

        cekHitam("komplit");
    }

    public function patchPOService()
    {
        $this->db->trans_start();
        $this->load->model("MdlTransaksi");
        $t = new MdlTransaksi;
        $t->addFilter("jenis='463o'");
        $t->addFilter("link_id='0'");
        $tempData = $t->lookUpAll()->result();
//        arrPrint($tempData);
        if (count($tempData) > 0) {

            foreach ($tempData as $tempData_0) {
                $id = $tempData_0->id;
                $t->setFilters(array());
                $t->addFilter("transaksi_id='$id'");
                //            $tmpReg = $tr->lookupRegistriesByMasterID($trID)->result();
                $tmpReg = $t->lookupDataRegistries()->result();
//                    arrPrint($tmpReg);
//                    matiHEre();
                if (count($tmpReg) > 0) {
                    foreach ($tmpReg as $row) {
                        foreach ($row as $key_reg => $reg_val) {
                            if ($key_reg == "main") {
                                $regValues = blobDecode($reg_val);
//                                arrPrint($regValues);
//                                matiHere();
                                $updateNilai = $regValues["nett"];
                                $t->setFilters(array());

                                $t->updateData(array("id" => $id), array("transaksi_nilai" => $updateNilai));

                                cekHitam($this->db->last_query());
                            }
                        }
                    }
                }
            }
        }

        matiHere(__LINE__);
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

    }

    //-------------------------------
    public function cekTitipan()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Coms/ComRekeningPembantuUangMukaMain");

        $cabang_id = "-1";
        $label = "uang muka nonrelasi";
        $rekening = "1010050040";
        $tr = New MdlTransaksi();
        $ttp = New ComRekeningPembantuUangMukaMain();

        $arrPihak = array();
        $pymData = array();
        $rekData = array();
        $items = array();

        // tabel payment uang muka
        $tr->setFilters(array());
        $tr->addFilter("label='$label'");
        $tr->addFilter("cabang_id='$cabang_id'");
        $trPym = $tr->lookupAllUangMukaSrc("4643")->result();
        showLast_query("biru");
        foreach ($trPym as $trSpec) {
            $extern_id = $trSpec->extern_id;
            $extern_nama = $trSpec->extern_nama;
            $sisa = $trSpec->sisa;
            $pymData[$extern_id] = array(
                "extern_id" => $extern_id,
                "extern_nama" => $extern_nama,
                "sisa" => $sisa,
            );
            $arrPihak[$extern_id] = $extern_nama;
        }

        // tabel rekening titipan tanpa relasi po
        $ttp->setFilters(array());
        $ttp->addFilter("cabang_id='$cabang_id'");
        $ttpRek = $ttp->fetchBalances($rekening);
        showLast_query("kuning");
//        arrPrint($ttpRek);
        foreach ($ttpRek as $ttpSpec) {
            $extern_id = $ttpSpec->extern_id;
            $extern_nama = $ttpSpec->extern_nama;
            $debet = $ttpSpec->debet;
            $rekData[$extern_id] = array(
                "extern_id" => $extern_id,
                "extern_nama" => $extern_nama,
                "debet" => $debet,
            );
            $arrPihak[$extern_id] = $extern_nama;
        }

        $headerFields = array(
            "pID" => "pID",
            "extern_id" => "extern id",
            "extern_nama" => "extern nama",
            "sisa" => "sisa pym",
            "debet" => "debet rek",
        );

        foreach ($arrPihak as $pid => $pnama) {
            $sisa = isset($pymData[$pid]["sisa"]) ? $pymData[$pid]["sisa"] : 0;
            $debet = isset($rekData[$pid]["debet"]) ? $rekData[$pid]["debet"] : 0;

            $items[] = array(
                "pID" => "$pid",
                "extern_id" => "$pid",
                "extern_nama" => "$pnama",
                "sisa" => "$sisa",
                "debet" => "$debet",
            );
        }


        $data = array(
            "mode" => "stock",
            "title" => "CEK TITIPAN (REKENING vs PYM UANG MUKA)",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "itemsGeseh" => array(),
            "warning" => array(),
            "marking" => array(),
            "markingColumn" => array(),
            "button" => "",
            "thisPage" => "",
            "q" => "",
        );
        $this->load->view("tool", $data);
    }

    public function cekTitipanRelasiPo()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Coms/ComRekeningPembantuUangMukaReference");

        $cabang_id = "-1";
        $label = "uang muka";
        $rekening = "1010050010";
        $tr = New MdlTransaksi();
        $ttp = New ComRekeningPembantuUangMukaReference();

        $arrPihak = array();
        $pymData = array();
        $rekData = array();
        $items = array();

        // tabel payment uang muka
        $tr->setFilters(array());
        $tr->addFilter("label='$label'");
        $tr->addFilter("cabang_id='$cabang_id'");
        $tr->addFilter("extern_id>0");
        $trPym = $tr->lookupAllUangMukaSrc("4643")->result();
        showLast_query("biru");
        foreach ($trPym as $trSpec) {
            $extern_id = $trSpec->extern_id;
            $extern_nama = $trSpec->extern_nama;
            $extern2_id = $trSpec->extern2_id;
            $extern2_nama = $trSpec->extern2_nama;
            $sisa = $trSpec->sisa;
            $pymData[$extern2_id] = array(
                "extern_id" => $extern_id,
                "extern_nama" => $extern_nama,
                "extern2_id" => $extern2_id,
                "extern2_nama" => $extern2_nama,
                "sisa" => $sisa,
            );
            $arrPihak[$extern2_id] = $extern2_nama;
        }

        // tabel rekening titipan tanpa relasi po
        $ttp->setFilters(array());
        $ttp->addFilter("cabang_id='$cabang_id'");
        $ttpRek = $ttp->fetchBalances($rekening);
        showLast_query("kuning");
//        arrPrint($ttpRek);
        foreach ($ttpRek as $ttpSpec) {
            $extern_id = $ttpSpec->extern_id;
            $extern_nama = $ttpSpec->extern_nama;
            $extern2_id = $ttpSpec->extern2_id;
            $extern2_nama = $ttpSpec->extern2_nama;
            $debet = $ttpSpec->debet;
            $rekData[$extern2_id] = array(
                "extern_id" => $extern_id,
                "extern_nama" => $extern_nama,
                "extern2_id" => $extern2_id,
                "extern2_nama" => $extern2_nama,
                "debet" => $debet,
            );
            $arrPihak[$extern2_id] = $extern2_nama;
        }

        $headerFields = array(
            "pID" => "pID",
            "extern_id" => "extern id",
            "extern_nama" => "extern nama",
            "extern2_id" => "extern2 id",
            "extern2_nama" => "extern2 nama",
            "sisa" => "sisa pym",
            "debet" => "debet rek",
        );

        foreach ($arrPihak as $pid => $pnama) {
            $sisa = isset($pymData[$pid]["sisa"]) ? $pymData[$pid]["sisa"] : 0;
            $debet = isset($rekData[$pid]["debet"]) ? $rekData[$pid]["debet"] : 0;

            $items[] = array(
                "pID" => "$pid",
                "extern_id" => "$pid",
                "extern_nama" => "$pnama",
                "sisa" => "$sisa",
                "debet" => "$debet",
            );
        }


        $data = array(
            "mode" => "stock",
            "title" => "CEK TITIPAN (REKENING vs PYM UANG MUKA)",
            "subTitle" => "",
            "headerFields" => $headerFields,
            "items" => $items,
            "itemsGeseh" => array(),
            "warning" => array(),
            "marking" => array(),
            "markingColumn" => array(),
            "button" => "",
            "thisPage" => "",
            "q" => "",
        );
        $this->load->view("tool", $data);
    }

    //-------------------------------
    public function cekBiaya()
    {
        $this->load->model("MdlTransaksi");

        $jenis = "1677r";
        $jenis_target = "1477";

        // cek jenis 1677r yang sudah dibatalkan...
        $tr = New MdlTransaksi();
        $tr->addFilter("jenis='$jenis'");
        $tr->addFilter("trash_4='1'");
        $trTmp = $tr->lookupAll()->result();
        showLast_query("biru");
        cekBiru(count($trTmp));

        // cek jenis 1477
        $tr = New MdlTransaksi();
        $tr->addFilter("jenis='$jenis_target'");
        $tr->addFilter("trash_4=0");
        $trTmpPembayaran = $tr->lookupAll()->result();
        showLast_query("biru");
        cekBiru(count($trTmpPembayaran));

        $arrTrDataBatal = array();
        foreach ($trTmp as $trSpec) {
            $arrTrDataBatal[$trSpec->id] = array(
                "id" => $trSpec->id,
                "nomer" => $trSpec->nomer,
            );


        }


        foreach ($trTmpPembayaran as $trBayarSpec) {

        }


        arrPrintCyan($arrTrDataBatal);

    }


    //-------------------------------
    public function patchStatusFaktur()
    {
        header("refresh:1");
        $this->load->model("MdlTransaksi");
        $jenis = "110";
        $jenis_master = "110";

        $tr = New MdlTransaksi();
        $tr->addFilter("jenis='$jenis'");
        $tr->addFilter("jenis_master='$jenis_master'");
        $tr->addFilter("trash_4='0'");
        $tr->addFilter("r_maju='0'");
        $this->db->limit(1);
        $this->db->order_by("id", "ASC");
        $trTmp = $tr->lookupAll()->result();


        $this->db->trans_start();

        if (sizeof($trTmp) > 0) {
            $id = $trTmp[0]->id;
            $id_top = $trTmp[0]->id_top;
            $gunggungan_mode = $trTmp[0]->gunggungan_mode;
            cekMerah("[$id] [$id_top] [$gunggungan_mode]");
            if ($gunggungan_mode == 1) {
                $tr = New MdlTransaksi();
                $tbl_detail = $tr->getTableNames()["detail"];
                $tr->setTableName($tbl_detail);
                $tr->setFilters(array());
                $tr->addFilter("transaksi_id='$id'");
                $tmpDetail = $tr->lookupAll()->result();
                foreach ($tmpDetail as $dSpec) {
                    $produk_id = $dSpec->produk_id;
                    $data_detail_update = array(
                        "next_step_code" => "",
                        "next_group_code" => "",
                    );
                    $where_detail_update = array(
                        "id" => $produk_id,
                    );
                    $tr->setFilters(array());
                    $tbl = $tr->getTableNames()["main"];
                    $tr->setTableName($tbl);
                    $tr->updateData($where_detail_update, $data_detail_update);
                    showLast_query("hitam");

                }
            }


            $data_update = array(
                "next_step_code" => "",
                "next_group_code" => "",
            );
            $where_update = array(
                "jenis_master" => $jenis_master,
                "id_top" => $id_top,
            );
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tbl = $tr->getTableNames()["main"];
            $tr->setTableName($tbl);
            $tr->updateData($where_update, $data_update);
            showLast_query("orange");


            $data_update = array(
                "r_maju" => 1,
            );
            $where_update = array(
                "id" => $id,
            );
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tbl = $tr->getTableNames()["main"];
            $tr->setTableName($tbl);
            $tr->updateData($where_update, $data_update);
            showLast_query("pink");


        }
        else {
            cekMerah("HABIS...");
        }


//        matiHere(__LINE__);
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

    }


    public function patchStatusFaktur2()
    {
        header("refresh:1");
        $this->load->model("MdlTransaksi");
        $jenis = "110e";
        $jenis_master = "110";

        $tr = New MdlTransaksi();
        $tr->addFilter("jenis='$jenis'");
        $tr->addFilter("jenis_master='$jenis_master'");
//        $tr->addFilter("trash_4='0'");
        $tr->addFilter("r_maju='0'");
        $tr->addFilter("gunggungan_mode='1'");
        $this->db->limit(1);
        $this->db->order_by("id", "ASC");
        $trTmp = $tr->lookupAll()->result();
        showLast_query("biru");

        $this->db->trans_start();

        if (sizeof($trTmp) > 0) {
            $id = $trTmp[0]->id;
            $id_top = $trTmp[0]->id_top;
            $gunggungan_mode = $trTmp[0]->gunggungan_mode;
            cekMerah("[$id] [$id_top] [$gunggungan_mode]");
            if ($gunggungan_mode == 1) {
                $tr = New MdlTransaksi();
                $tbl_detail = $tr->getTableNames()["detail"];
                $tr->setTableName($tbl_detail);
                $tr->setFilters(array());
                $tr->addFilter("transaksi_id='$id'");
                $tmpDetail = $tr->lookupAll()->result();
                showLast_query("biru");
                foreach ($tmpDetail as $dSpec) {
                    $produk_id = $dSpec->produk_id;
                    $data_detail_update = array(
                        "next_step_code" => "",
                        "next_group_code" => "",
                    );
                    $where_detail_update = array(
                        "id" => $produk_id,
                    );
                    $tr->setFilters(array());
                    $tbl = $tr->getTableNames()["main"];
                    $tr->setTableName($tbl);
                    $tr->updateData($where_detail_update, $data_detail_update);
                    showLast_query("hitam");

                }
            }


//            $data_update = array(
//                "next_step_code" => "",
//                "next_group_code" => "",
//            );
//            $where_update = array(
//                "jenis_master" => $jenis_master,
//                "id_top" => $id_top,
//            );
//            $tr = New MdlTransaksi();
//            $tr->setFilters(array());
//            $tbl = $tr->getTableNames()["main"];
//            $tr->setTableName($tbl);
//            $tr->updateData($where_update, $data_update);
//            showLast_query("orange");


            $data_update = array(
                "r_maju" => 1,
            );
            $where_update = array(
                "id" => $id,
            );
            $tr = New MdlTransaksi();
            $tr->setFilters(array());
            $tbl = $tr->getTableNames()["main"];
            $tr->setTableName($tbl);
            $tr->updateData($where_update, $data_update);
            showLast_query("pink");


        }
        else {
            cekMerah("HABIS...");
        }


//        matiHere(__LINE__);
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

    }


    public function cekStokBooking()
    {
        $this->load->model("Mdls/MdlLockerStockBooking");
        $lb = New MdlLockerStockBooking();
        $lbTmp = $lb->getStokBooking();
        arrprint($lbTmp);


        $lbTmp = $lb->getStokBookingByPoduk(24376, 12);
        arrprintWebs($lbTmp);

//        PIPA DAIKIN 2530 - PIM
//        SHARP 9ZCY
    }

    public function genereteBiayaidPPH()
    {
        $this->load->model("MdlTransaksi");
        $this->load->model("Mdls/MdlPaymentSource");
        $t = new MdlTransaksi();
        $p = new MdlPaymentSource();
//target_jenis='1483' AND sisa > 0 AND reference_jenis='16677'
        $p->addFilter("target_jenis='1483'");
        $p->addFilter("reference_jenis='16677'");
        $p->addFilter("sisa>'0'");
        $listTr = array();
        $listID = array();
        $tmpPayment = $p->lookUpAll()->result();
        foreach ($tmpPayment as $tmpPayment_0) {
            $listTr[$tmpPayment_0->transaksi_id] = $tmpPayment_0->transaksi_id;
        }
//        arrPrint($listTr);
//        matiHere();
//        $t->setFilters(array());
//        $t->addFilter("transaksi id in('".implode("','",$listTr)."')  ");
        $tmpReg = $t->lookupBaseDataRegistries($listTr)->result();
        $regUpdate = array();
        foreach ($tmpReg as $reg0) {


            $tmpMain = blobDecode($reg0->main);
            $regUpdate[$reg0->transaksi_id] = array(
                "biaya_rekening_id" => $tmpMain["biayaDetails"],
                "biaya_rekening_id_label" => $tmpMain["biayaDetails__label"],
            );

        }
        $this->db->trans_start();
//        arrPrint($regUpdate);
        foreach ($regUpdate as $tr_id => $data) {
            $p->setFilters(array());
            $p->updateData(array("transaksi_id" => $tr_id), $data);
        }
//        cekHitam($this->db->last_query());
//            arrPrint($tmpPayment);
//         mati_disini("LINE: " . __LINE__ . "Transaksi Normal, under maintenance, tunggu beberapa saat lagi yaa.., TRID: ");

        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");

    }

    public function patchInvRef()
    {
        header("refresh:1");
        $this->db->trans_start();
        $this->load->model("MdlTransaksi");
        $t = new MdlTransaksi();
        $t->addFilter("jenis='4822'");
        $this->db->where("reference_id is null");
//        $this->db->where("id='619575'");
        $this->db->limit(1);
        $a = $t->lookUpAll()->result();
        if (count($a) > 0) {
            $t->setFilters(array());

//        $t->addFilter("transaksi_id='".."'");
            $reg = $t->lookupDataRegistriesByMasterID($a[0]->id)->result();
            $main = blobdecode($reg[0]->main);
            $id_tr = $main["referenceID_current"];
            $num = $main["referenceNumber_current"];
            $udpate = array(
                "reference_id" => $id_tr,
                "reference_nomer" => $num,
            );
            $t->updateData(array("id" => $a[0]->id), $udpate);
            cekHere($this->db->last_query());
        }
        else {
            cekHitam("habis");
        }

//        matiHere($this->db->last_query());
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
    }

    public function patchTrashReject()
    {
        header("refresh:3");
        $this->db->trans_start();
        $this->load->model("MdlTransaksi");
        $t = new MdlTransaksi();
        $t->addFilter("jenis='9912'");
        $t->addFilter("sinkron='0'");
        $t->addFilter("reference_jenis='7499'");
        $this->db->limit(1);
        $a = $t->lookUpAll()->result();
        if (count($a) > 0) {
//            arrPrint($a);
            $curentID = $a[0]->id;
            $reference_id = $a[0]->reference_id;
            $where = array(
                "jenis" => "4822",
                "reference_id" => $reference_id,
            );
            $update = array(
                "trash_4" => "1",
                "cancel_dtime" => $a[0]->dtime,
                "cancel_name" => $a[0]->oleh_nama,
                "cancel_id" => $a[0]->oleh_id,
                "cancel_transaksi_jenis" => $a[0]->jenis,
                "cancel_transaksi_id" => $a[0]->id,
                "cancel_transaksi_nomer" => $a[0]->nomer,
            );

            //update referense
            $t->setFilters(array());
            $t->updateData($where, $update);
            cekMerah($this->db->last_query());

            //update current
            $t->setFilters(array());
            $t->updateData(array("id" => $curentID), array("sinkron" => "1"));
            cekHitam($this->db->last_query());
        }
        else {
            cekMerah("habis");
        }


//        matiHere(__LINE__."::");
        $this->db->trans_complete() or die("Gagal saat berusaha  commit transaction!");
    }
}


