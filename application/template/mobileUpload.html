<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>{title}</title>
    <link id="favicon" rel="icon" type='image/x-icon' href="{favicon}">
    <link rel="stylesheet" type="text/css" href="{cdn_suport}bootstrap-3.3.7-dist/css/bootstrap.min.css?v={local_version}"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.2/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="{cdn_suport}Font-Awesome-master/css/font-awesome.min.css?v={local_version}">
    <!--<link rel="stylesheet" type="text/css" href="{base}assets/custom/custom.min.css?v={local_version}"/>-->
    <link rel="stylesheet" href="{cdn_suport}sweetalert2-master/dist/sweetalert2.min.css?v={local_version}">
    <link rel="stylesheet" type="text/css" href="{cdn_suport}bootstrap-toggle-master/css/bootstrap-toggle.min.css?v={local_version}">
    <link rel="stylesheet" href="{cdn_suport}HoldOn/HoldOn.min.css?v={local_version}">
    <link rel="stylesheet" href="{cdn_suport}Jcrop/jquery.Jcrop.min.css?v={local_version}">
    <link rel="stylesheet" type="text/css" href="{cdn_suport}sweetalert2-master/dist/sweetalert2.min.css?v={local_version}">
    <link rel="stylesheet" href="{cdn_suport}bootstrap-select-1.13.9/dist/css/bootstrap-select.css?v={local_version}">
    <!--<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>-->
    <script src="{cdn_suport}AdminLTE-2.3.11/plugins/jQuery/jquery-2.2.3.min.js?v={local_version}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.2/js/plugins/piexif.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.2/js/plugins/sortable.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.2/js/plugins/purify.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="{cdn_suport}bootstrap-3.3.7-dist/js/bootstrap.min.js?v={local_version}"></script>
    <script src="{cdn_suport}Jcrop/jquery.Jcrop.js?v={local_version}"></script>
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" type="text/javascript"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.2/js/fileinput.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.2/themes/fa/theme.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.2/js/locales/id.js"></script>
    <script src="{cdn_suport}sweetalert2-master/dist/sweetalert2.js?v={local_version}"></script>
    <script src="{cdn_suport}bootstrap-select-1.13.9/dist/js/bootstrap-select.js?v={local_version}"></script>
    <!--<script type="text/javascript" src="{base}assets/AdminLTE-2.3.11/plugins/jQuery/jquery.1.11.3"></script>-->
    <!--<script src="{base}assets/custom/custom.js?v={local_version}"></script>-->
    <!--<script src="{base}assets/custom/md5.min.js?v={local_version}"></script>-->
    <!--<script src="{cdn_suport}HoldOn/HoldOn.min.js?v={local_version}"></script>-->

    <style>
        .no-padding {
            padding: 0 !important;
        }
        .on, .smenu a:hover {
            color: #ffffff;
            background: red;
        }

        .on {
            cursor: default;
        }
        .footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: orange;
            color: white;
            text-align: center;
            z-index: 2;
        }
    </style>

    <style type='text/css'>
        body {
            /*padding-top: 40px;*/
            /*padding-bottom: 40px;*/
            padding: 20px 0px 0px 0px;
            background-color: #eee;
            /*background-color: #e4eef3;*/
            /*background-color: #FFCCCC;*/
        }
        .spacer {
            margin-bottom: 3px;
        }
        .form-signin {
            max-width: 330px;
            padding: 15px;
            margin: 0 auto;
        }
        .form-signin .form-signin-heading,
        .form-signin .checkbox {
            margin-bottom: 10px;
        }
        .form-signin .checkbox {
            font-weight: normal;
        }
        .form-signin .form-control {
            position: relative;
            height: auto;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            padding: 10px;
            font-size: 16px;
        }
        * html .form-signin .form-control {
            vertical-align: middle;
        }
        .form-signin .form-control:focus {
            z-index: 2;
        }
        .form-signin input[type="text"] {
            margin-bottom: -1px;
            border-bottom-right-radius: 0;
            border-bottom-left-radius: 0;
        }
        .form-signins input[type="password"] {
            margin-bottom: 10px;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        .tengah {
            text-align: center;
            margin-top: 20px;
            font-family: consolas;
            color: #aaaaa9;
        }
        .btn-primary- {
            background-color: #CC0000;
            border: 1px solid #990000;
        }
    </style>
</head>
<body>

<div>
    <div id="" class="btn-group btn-group-justified">

        <a class="btn btn-sm btn-default" href="javascript:void(0)" onclick="window.location.href='{base}Login/authLogout'"><span style="white-space: break-spaces;" class="">LOGOUT</span></a>
        <a class="btn btn-sm btn-default " href="javascript:void(0)" onclick="window.location.href='{base}'"><span style="white-space: break-spaces;" class="">MAIN</span></a>

        <!--<a class="btn btn-sm btn-default " href="javascript:void(0)" onclick="window.open('https://san.mayagrahakencana.com/Images/mbdata/ProdukRakitan', '_self')"><span style="white-space: break-spaces;" class="">Produk Rakitan</span></a>-->
        <!--<a class="btn btn-sm btn-default " href="javascript:void(0)" onclick="window.open('https://san.mayagrahakencana.com/Images/mbdata/ProdukPaket', '_self')"><span style="white-space: break-spaces;" class="">Produk Paket</span></a>-->

    </div>
</div>

<div class="container">
<div id="baseURL" class="hidden">{base}</div>
<div class='text-center no-padding no-border'>
<img width="35%" src="{base}public/images/profiles/logo_header.png" class="img">
</div>
    <div class="clearfix">&nbsp;</div>
    <div style="font-size: 7vw;" class="text-center text-bold text-muted">UPLOAD IMAGES</div>
    <div class="col-xs-12 no-padding">
        {menuHeader}
    </div>
    <div class="clearfix">&nbsp;</div>
    {hSelector}
    <form action="{formTarget}"  enctype="multipart/form-data" id="fImages" name="fImages" target="result" method="post">
        {content}
        <div style="text-align:center;padding:8px;">
        <div id='divAlt' class='text-center btn-block text-danger'></div>
        <div class="panel-body">
            <div class="text-danger text-center"
                 style="font-family: 'Helvetica Neue Light', 'HelveticaNeue-Light', 'Helvetica Neue', Calibri, Helvetica, Arial, sans-serif; color:#dd3300;">
                {errMsg}
            </div>
        </div>
        </div>
    </form>
</div>

<div id="footer" class="footer"></div>

<div id=iframes>
    <iframe id="result" name="result" frameborder="0" style="resize: both;display: {display_iframe};width: 100%;"></iframe>
</div>

<script type='text/javascript' src='{cdn_suport}bootstrap-3.3.7-dist/js/bootstrap-show-password.min.js?v={local_version}'></script>
<script type='text/javascript' src='{cdn_suport}bootstrap-validator/validator.min.js?v={local_version}'></script>
<!--<script type='text/javascript' src="{cdn_suport}sweetalert2-master/dist/sweetalert2.min.js?v={local_version}"></script>-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="{cdn_suport}bootstrap-toggle-master/js/bootstrap-toggle.min.js?v={local_version}"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fingerprintjs2/2.1.0/fingerprint2.min.js?v={local_version}"></script>

<script type="text/javascript">
    var changingHash = false;
    function onbarcode(event) {
        switch (event.type) {
            case "hashchange": {
                if (changingHash == true) {
                    return;
                }
                var hash = window.location.hash;
                if (hash.substr(0, 3) == "#zx") {
                    hash = window.location.hash.substr(3);
                    changingHash = true;
                    window.location.hash = event.oldURL.split("\#")[1] || ""
                    changingHash = false;
                    processBarcode(hash);
                }
                break;
            }
            case "storage": {
                window.focus();
                if (event.key == "barcode") {
                    window.removeEventListener("storage", onbarcode, false);
                    processBarcode(event.newValue);
                }
                break;
            }
            default: {
                console.log(event)
                break;
            }
        }
    }
    window.addEventListener("hashchange", onbarcode, false);
    function getScan() {
        var href = window.location.href;
        var ptr = href.lastIndexOf("#");
        if (ptr > 0) {
            href = href.substr(0, ptr);
        }
        window.addEventListener("storage", onbarcode, false);
        setTimeout('window.removeEventListener("storage", onbarcode, false)', 15000);
        localStorage.removeItem("barcode");

        if (navigator.userAgent.match(/Firefox/i)) {
            window.location.href = ("zxing://scan/?ret=" + encodeURIComponent(href + "#zx{CODE}"));
        } else {
            window.open("zxing://scan/?ret=" + encodeURIComponent(href + "#zx{CODE}"));
        }
    }
    function processBarcode(bc) {
        document.getElementById("scans").innerHTML += "<div>" + bc + "</div>";
    }
</script>

<script>
    $('#myModal').on('hidden.bs.modal', function () {
        $(this).removeData('bs.modal');
        console.log("jalan");
    });
    $(document).ready(function () {
        $("body").tooltip({selector: '[data-toggle=tooltip]'});
    });
</script>
<script>
    $(function () {
        $('#password').password()
        .on('show.bs.password', function (e) {
            $('#eventLog')
            .text('On show event');
            $('#methods')
            .prop('checked', true);
        })
        .on('hide.bs.password', function (e) {
            $('#eventLog')
            .text('On hide event');
            $('#methods')
            .prop('checked', false);
        });
        $('#methods')
        .click(function () {
            $('#password')
            .password('toggle');
        });
    });
    function detectEnter() {
        var keyCode = event.keyCode ? event.keyCode : event.which ? event.which
            : event.charCode;
        if (keyCode == 13) {
            return true;
        }
        else {
            return false;
        }
    }
</script>
<script>{jsbottom}</script>
<script>

    var crop_max_width = 2500;
    var crop_max_height = 2500;
    var jcrop_api;
    var canvas;
    var context;
    var image;

    var prefsize;

    $("#files").change(function() {
//        $('#input-crop').removeClass('hidden');
        //loadImage( this );
    });

    $("#crop-image").click(function() {
        cropImage();
    });

    function cropImage(){
        Sweetalert2.fire({
            'title': 'image crop',
            'html': "" +
                    "<div id='views'>{no images}</div>" +
                    "<button id='cropbutton' type='button'>Crop</button>" +
                    "<button id='scalebutton' type='button'>Scale</button>" +
                    "<button id='rotatebutton' type='button'>Rotate</button>" +
                    "<button id='hflipbutton' type='button'>H-flip</button>" +
                    "<button id='vflipbutton' type='button'>V-flip</button>",
            onOpen: () => {
                loadImage( $('#files')[0] )
                $("#cropbutton").click(function(e) {
                    applyCrop();
                });
                $("#scalebutton").click(function(e) {
                    var scale = prompt("Scale Factor:", "1");
                    applyScale(scale);
                });
                $("#rotatebutton").click(function(e) {
                    applyRotate();
                });
                $("#hflipbutton").click(function(e) {
                    applyHflip();
                });
                $("#vflipbutton").click(function(e) {
                    applyVflip();
                });
            }
        }).then( (result)=> {

            if(result){
//                var blob = dataURLtoBlob(canvas.toDataURL('image/png'));
//                formData = new FormData($('#fImages')[0]);
//                formData.append("cropped_image[]", blob);

                $('.file-preview-image.kv-preview-data').attr('src', canvas.toDataURL('image/png') )

//                console.log(canvas.toDataURL('image/png'));
//                console.log(blob);
//                console.log(formData);
            }

        });
    }


//    $("#fImages").submit(function(e) {
//        e.preventDefault();
//        formData = new FormData($(this)[0]);
//        var blob = dataURLtoBlob(canvas.toDataURL('image/png'));
//        //---Add file blob to the form data
//        formData.append("cropped_image[]", blob);
//        $.ajax({
//            url: "whatever.php",
//            type: "POST",
//            data: formData,
//            contentType: false,
//            cache: false,
//            processData: false,
//            success: function(data) {
//                alert("Success");
//            },
//            error: function(data) {
//                alert("Error");
//            },
//            complete: function(data) {}
//        });
//    });

    function loadImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            canvas = null;
            reader.onload = function(e) {
                image = new Image();
                image.onload = validateImage;
                image.src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function dataURLtoBlob(dataURL) {
        var BASE64_MARKER = ';base64,';
        if (dataURL.indexOf(BASE64_MARKER) == -1) {
            var parts = dataURL.split(',');
            var contentType = parts[0].split(':')[1];
            var raw = decodeURIComponent(parts[1]);

            return new Blob([raw], {
                type: contentType
            });
        }
        var parts = dataURL.split(BASE64_MARKER);
        var contentType = parts[0].split(':')[1];
        var raw = window.atob(parts[1]);
        var rawLength = raw.length;
        var uInt8Array = new Uint8Array(rawLength);
        for (var i = 0; i < rawLength; ++i) {
            uInt8Array[i] = raw.charCodeAt(i);
        }

        return new Blob([uInt8Array], {
            type: contentType
        });
    }

    function validateImage() {
        if (canvas != null) {
            image = new Image();
            image.onload = restartJcrop;
            image.src = canvas.toDataURL('image/png');
        } else restartJcrop();
    }

    function restartJcrop() {
        if (jcrop_api != null) {
            jcrop_api.destroy();
        }
        $("#views").empty();
        $("#views").append("<canvas id=\"canvas\">");
        canvas = $("#canvas")[0];
        context = canvas.getContext("2d");
        canvas.width = image.width;
        canvas.height = image.height;
        context.drawImage(image, 0, 0);
        $("#canvas").Jcrop({
            onSelect: selectcanvas,
            onRelease: clearcanvas,
            boxWidth: crop_max_width,
            boxHeight: crop_max_height
        }, function() {
            jcrop_api = this;
        });
        clearcanvas();
    }

    function clearcanvas() {
        prefsize = {
            x: 0,
            y: 0,
            w: canvas.width,
            h: canvas.height,
        };
    }

    function selectcanvas(coords) {
        prefsize = {
            x: Math.round(coords.x),
            y: Math.round(coords.y),
            w: Math.round(coords.w),
            h: Math.round(coords.h)
        };
    }

    function applyCrop() {
        canvas.width = prefsize.w;
        canvas.height = prefsize.h;
        context.drawImage(image, prefsize.x, prefsize.y, prefsize.w, prefsize.h, 0, 0, canvas.width, canvas.height);
        validateImage();
    }

    function applyScale(scale) {
        if (scale == 1) return;
        canvas.width = canvas.width * scale;
        canvas.height = canvas.height * scale;
        context.drawImage(image, 0, 0, canvas.width, canvas.height);
        validateImage();
    }

    function applyRotate() {
        canvas.width = image.height;
        canvas.height = image.width;
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.translate(image.height / 2, image.width / 2);
        context.rotate(Math.PI / 2);
        context.drawImage(image, -image.width / 2, -image.height / 2);
        validateImage();
    }

    function applyHflip() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.translate(image.width, 0);
        context.scale(-1, 1);
        context.drawImage(image, 0, 0);
        validateImage();
    }

    function applyVflip() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.translate(0, image.height);
        context.scale(1, -1);
        context.drawImage(image, 0, 0);
        validateImage();
    }

</script>

</body>
</html>